<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SAKURA</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.leezy.top/"/>
  <updated>2020-02-04T10:19:09.918Z</updated>
  <id>https://www.leezy.top/</id>
  
  <author>
    <name>LEEZY</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Dockerå¸¸ç”¨å‘½ä»¤</title>
    <link href="https://www.leezy.top/2020/02/04/Ubuntu%E8%AE%BE%E7%BD%AESSH%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/"/>
    <id>https://www.leezy.top/2020/02/04/Ubuntuè®¾ç½®SSHå…å¯†ç ç™»å½•/</id>
    <published>2020-02-04T02:04:21.000Z</published>
    <updated>2020-02-04T10:19:09.918Z</updated>
    
    <content type="html"><![CDATA[<p>é€šè¿‡SSHå…¬é’¥ï¼ˆé”ğŸ”’ï¼‰å’Œå¯†é’¥ï¼ˆé’¥åŒ™ğŸ”‘ï¼‰æ¥å®ç°Puttyå…è¾“å…¥å¯†ç ç™»å½•æ“ä½œã€‚</p><a id="more"></a><h3 id="ç”Ÿæˆå…¬é’¥å’Œç§é’¥"><a href="#ç”Ÿæˆå…¬é’¥å’Œç§é’¥" class="headerlink" title="ç”Ÿæˆå…¬é’¥å’Œç§é’¥"></a>ç”Ÿæˆå…¬é’¥å’Œç§é’¥</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p><img src="/assets/blogImg/SSH_%E7%94%9F%E6%88%90%E5%85%AC%E9%92%A5_%E7%A7%81%E9%92%A5.png" alt="SSH_ç”Ÿæˆå…¬é’¥_ç§é’¥"> </p><p>ç”¨WinSCPæ‰“å¼€æ–‡ä»¶ä¿å­˜è·¯å¾„<code>/root/.ssh/</code></p><p><em>æ³¨æ„ è®¾ç½®/etc/ssh/sshd_config æ–‡ä»¶ä¸‹çš„ PermitRootLogin yes<br>PasswordAuthentication yes æ‰å¯ä»¥rootç™»å½•ï¼Œå¹¶é‡å¯sshæœåŠ¡ systemctl restart ssh.service</em></p><p>å°†<code>/root/.ssh/</code>è·¯å¾„ä¸‹çš„<code>id_rsa</code>å¯¼å…¥åˆ°PuTTYgen (Conversions -&gt; Import key)ï¼Œå¹¶ç”ŸæˆåŠä¿å­˜ç§é’¥ã€‚<br>åœ¨PuTTY SSH -&gt; Auth ä¸­æ·»åŠ ç§é’¥æ–‡ä»¶ã€‚</p><p>å†æ¬¡ä¿®æ”¹SSHé…ç½®æ–‡ä»¶<code>/etc/ssh/sshd_config</code>ï¼Œå–æ¶ˆä¸‹é¢å‡ é¡¹é…ç½®çš„æ³¨é‡Š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#PubkeyAuthentication yes</span><br><span class="line">#AuthorizedKeysFile     .ssh/authorized_keys .ssh/authorized_keys2</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œå°†å…¬é’¥æ·»åŠ åˆ°<code>.ssh/authorized_keys</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å®ŒæˆUbuntu SSH å…å¯†ç ç™»å½•è®¾ç½®ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é€šè¿‡SSHå…¬é’¥ï¼ˆé”ğŸ”’ï¼‰å’Œå¯†é’¥ï¼ˆé’¥åŒ™ğŸ”‘ï¼‰æ¥å®ç°Puttyå…è¾“å…¥å¯†ç ç™»å½•æ“ä½œã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Linux" scheme="https://www.leezy.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Dockerå¸¸ç”¨å‘½ä»¤</title>
    <link href="https://www.leezy.top/2020/01/11/Docker%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://www.leezy.top/2020/01/11/Docker å¸¸ç”¨å‘½ä»¤/</id>
    <published>2020-01-11T08:22:21.000Z</published>
    <updated>2020-01-11T09:38:49.608Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¯åŠ¨dockeré•œåƒ"><a href="#å¯åŠ¨dockeré•œåƒ" class="headerlink" title="å¯åŠ¨dockeré•œåƒ"></a>å¯åŠ¨dockeré•œåƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹å·²ç»å®‰è£…çš„é•œåƒ</span><br><span class="line">docker images</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹å®¹å™¨ID</span><br><span class="line">doker ps</span><br><span class="line"><span class="meta">#</span> å¯åŠ¨å®¹å™¨</span><br><span class="line">docker start &lt;å®¹å™¨id&gt;</span><br><span class="line"><span class="meta">#</span> å¼€å¯ä¸€ä¸ªå®¹å™¨å†…éƒ¨çš„äº¤äº’å¼ç»ˆç«¯</span><br><span class="line">docker exec -it &lt;å®¹å™¨id&gt;</span><br></pre></td></tr></table></figure><h3 id="Dockerå®‰è£…MySQL"><a href="#Dockerå®‰è£…MySQL" class="headerlink" title="Dockerå®‰è£…MySQL"></a>Dockerå®‰è£…MySQL</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line"><span class="meta">#</span> å°†å®¹å™¨çš„ 3306 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 3306 ç«¯å£, å®¹å™¨confç›®å½•å’Œlogsç›®å½•ã€dataç›®å½•éƒ½æŒ‚è½½åœ¨æœ¬åœ°ï¼Œå¹¶è®¾ç½®rootå¯†ç  root</span><br><span class="line">docker run -p 3306:3306 --name mymysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql</span><br><span class="line"><span class="meta">#</span> è¿™é‡Œä¼šè¾“å‡ºå®¹å™¨ID</span><br><span class="line"><span class="meta">#</span> è¿›å…¥å®¹å™¨</span><br><span class="line">docker exec -it &lt;å®¹å™¨ID&gt; /bin/bash</span><br><span class="line"><span class="meta">#</span> ç™»å½•Mysql</span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta">#</span> æˆæƒè¿œç¨‹ç™»å½•</span><br><span class="line">GRANT ALL ON *.* TO 'root'@'%';</span><br><span class="line"><span class="meta">#</span> åˆ·æ–°æƒé™</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="Dockerå®‰è£…Tomcat"><a href="#Dockerå®‰è£…Tomcat" class="headerlink" title="Dockerå®‰è£…Tomcat"></a>Dockerå®‰è£…Tomcat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å®‰è£…Tomcat</span><br><span class="line">docker pull tomcat</span><br><span class="line"><span class="meta">#</span> è¿è¡Œå®¹å™¨</span><br><span class="line"><span class="meta">#</span> å‘½ä»¤è¯´æ˜</span><br><span class="line"><span class="meta">#</span> -p 8080:8080ï¼šå°†å®¹å™¨çš„ 8080 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£ã€‚</span><br><span class="line"><span class="meta">#</span> -v $PWD/test:/usr/local/tomcat/webapps/testï¼šå°†ä¸»æœºä¸­å½“å‰ç›®å½•ä¸‹çš„ test æŒ‚è½½åˆ°å®¹å™¨çš„ /testã€‚</span><br><span class="line">docker run --name tomcat -p 8080:8080 -v $PWD/test:/usr/local/tomcat/webapps/test -d tomcat</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å¯åŠ¨dockeré•œåƒ&quot;&gt;&lt;a href=&quot;#å¯åŠ¨dockeré•œåƒ&quot; class=&quot;headerlink&quot; title=&quot;å¯åŠ¨dockeré•œåƒ&quot;&gt;&lt;/a&gt;å¯åŠ¨dockeré•œåƒ&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;t
      
    
    </summary>
    
    
    
      <category term="Docker" scheme="https://www.leezy.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>JavaåŸºç¡€çŸ¥è¯†-å¹¶å‘ç¼–ç¨‹</title>
    <link href="https://www.leezy.top/2019/11/30/JAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    <id>https://www.leezy.top/2019/11/30/JAVAåŸºç¡€çŸ¥è¯†-å¹¶å‘ç¼–ç¨‹/</id>
    <published>2019-11-29T16:00:00.000Z</published>
    <updated>2019-12-26T15:41:11.860Z</updated>
    
    <content type="html"><![CDATA[<p>å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ã€å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç ã€‚</p><a id="more"></a><h3 id="å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€"><a href="#å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€" class="headerlink" title="å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€"></a>å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€</h3><blockquote><p>CPUå¤šçº§ç¼“å­˜</p></blockquote><p>æ—¶é—´å±€éƒ¨æ€§ ç©ºé—´å±€éƒ¨æ€§<br>ç¼“å­˜ä¸€è‡´æ€§ï¼š M E S I ç”¨äºä¿è¯å¤šä¸ªCPU Cacheä¹‹é—´å…±äº«æ•°æ®çš„ä¸€è‡´<br>M ä¿®æ”¹çŠ¶æ€<br>E ç‹¬äº«çŠ¶æ€<br>S å…±äº«çŠ¶æ€<br>I æ— æ•ˆçŠ¶æ€</p><blockquote><p>ä¹±åºæ‰§è¡Œä¼˜åŒ–</p></blockquote><p>ä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦è€Œåšå‡ºè¿èƒŒä»£ç åŸæœ‰é¡ºåºçš„ä¼˜åŒ–</p><blockquote><p>JAVAå†…å­˜æ¨¡å‹ (Java Memory Model - JMM)</p></blockquote><p>Heap å †<br>å¯åŠ¨æ€åˆ†é…å†…å­˜å¤§å°ï¼Œç”Ÿå­˜æœŸä¸éœ€äº‹å…ˆå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå­˜å–é€Ÿåº¦æ…¢ï¼Œå¸¸ç”¨äºå­˜æ”¾å¯¹è±¡<br>Thread Stack æ ˆ<br>å­˜å–é€Ÿåº¦å¿«ï¼Œä»…æ¬¡äºå¯„å­˜å™¨ï¼Œæ•°æ®å¤§å°å’Œç”Ÿå­˜æœŸå¿…é¡»ç¡®å®šï¼Œå¸¸ç”¨äºå­˜å–åŸºæœ¬ç±»å‹å˜é‡ï¼Œæœ¬åœ°å˜é‡</p><p>æ ˆä¸Šçš„å¼•ç”¨å˜é‡æ•°æ®å¯ä»¥è®¿é—®å¼•ç”¨çš„å †å¯¹è±¡ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½ä¼šè®¿é—®æˆå‘˜å˜é‡ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼šæœ‰è‡ªå·±å˜é‡çš„ç§æœ‰æ‹·è´ã€‚</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„â€œæœ¬åœ°å†…å­˜â€ï¼ŒJavaä¸­çº¿ç¨‹çš„â€œæœ¬åœ°å†…å­˜â€æŒ‡çš„æ˜¯CPUå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜çš„æŠ½è±¡æè¿°ã€‚ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å˜é‡å…±äº«æ˜¯è¦é€šè¿‡ä¸»å†…å­˜çš„ã€‚</p><blockquote><p>Javaå†…å­˜æ¨¡å‹-åŒæ­¥å…«ç§æ“ä½œ</p></blockquote><ul><li><p>lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çŠ¶æ€</p></li><li><p>unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚</p></li><li><p>readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ã€‚</p></li><li><p>loadï¼ˆè½½å…¥ï¼‰: ä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡,å®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­</p></li><li><p>useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡,æŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“</p></li><li><p>assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡,å®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜çš„å˜é‡</p></li><li><p>storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­,ä»¥ä¾¿éšåçš„writeçš„æ“ä½œ</p></li><li><p>writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡,å®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜çš„å˜é‡ä¸­</p></li></ul><p>å·¥ä½œè§„åˆ™ï¼š</p><ul><li><p>å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜ä¸­å¤åˆ¶åˆ°å·¥ä½œå†…å­˜,å°±éœ€è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œreadå’Œloadæ“ä½œ,å¦‚æœæŠŠå˜é‡ä»å·¥ä½œå†…å­˜ä¸­åŒæ­¥å›ä¸»å†…å­˜ä¸­,å°±è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚ä½†Javaå†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°æ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œ,è€Œæ²¡æœ‰ä¿è¯å¿…é¡»æ˜¯è¿ç»­æ‰§è¡Œã€‚</p></li><li><p>ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°</p></li><li><p>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘assignçš„æ“ä½œ,å³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­</p></li><li><p>ä¸å…è®¸â€”ä¸ªçº¿ç¨‹æ— åŸå› åœ°(æ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œ)æŠŠæ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­</p></li><li><p>ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿ,ä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–(loadæˆ–assign )çš„å˜é‡ã€‚å³å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½useå’Œstoreæ“ä½œä¹‹å‰,å¿…é¡»å…ˆæ‰§è¡Œè¿‡äº†assignå’Œloadæ“ä½œ</p></li><li><p>ä¸€ä¸ªå˜é‡åœ¨åŒ_æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡,å¤šæ¬¡æ‰§è¡Œlockå,åªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œ,å˜é‡æ‰ä¼šè¢«è§£é”ã€‚lockå’Œunlockå¿…é¡»æˆå¯¹å‡ºç°</p></li><li><p>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œ,å°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼,åœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰éœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼</p></li><li><p>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­</p></li><li><p>ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿ/ä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ–assign ï¼‰çš„å˜é‡ã€‚å³å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½useå’Œstoreæ“ä½œä¹‹å‰, å¿…é¡»å…ˆæ‰§è¡Œè¿‡äº†assignå’Œloadæ“ä½œ</p></li></ul><h3 id="å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç "><a href="#å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç " class="headerlink" title="å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç :"></a>å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç :</h3><p>å·¥å…·ï¼š</p><blockquote><p>PostMan</p></blockquote><blockquote><p>Apache Bench</p></blockquote><blockquote><p>Apache JMeter</p></blockquote><p>ä»£ç ï¼š</p><blockquote><p>CountDownLatch - é—­é”ï¼š1. await() 2. countDown() é˜»å¡çº¿ç¨‹ï¼Œæ»¡è¶³æŸç§ç‰¹å®šçš„æ¡ä»¶ç»§ç»­æ‰§è¡Œï¼Œå¸¸ä¸ä¸çº¿ç¨‹æ± ä¸€åŒä½¿ç”¨ã€‚</p></blockquote><blockquote><p>Semaphore - ä¿¡å·é‡ï¼šå¯ä»¥é˜»å¡çº¿ç¨‹ï¼Œæ§åˆ¶åŒä¸€æ—¶é—´è¯·æ±‚çš„å¹¶å‘é‡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.concurrency;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leezy.concurrency.annoations.NotThreadSafe;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: spring-cloud-leezy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æµ‹è¯•å¹¶å‘</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: LEEZY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2019-11-30 16:03</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@NotThreadSafe</span></span><br><span class="line"><span class="comment">// count:4962 ç»“æœä¸å‡†ç¡®ï¼Œçº¿ç¨‹ä¸å®‰å…¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrencyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯·æ±‚æ€»æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> clientTotal = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ—¶å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> threadTotal = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ± </span></span><br><span class="line">        ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line">        <span class="comment">// ä¿¡å·é‡ä»¥åŠå¹¶å‘çº¿ç¨‹æ•°</span></span><br><span class="line">        <span class="keyword">final</span> Semaphore semaphore = <span class="keyword">new</span> Semaphore(threadTotal);</span><br><span class="line">        <span class="comment">// è®¡æ•°å™¨-é—­é” æ”¾å…¥è¯·æ±‚æ€»æ•°</span></span><br><span class="line">        <span class="keyword">final</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(clientTotal);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; clientTotal; i++) &#123;</span><br><span class="line">            executorService.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æ ¹æ®å¹¶å‘çš„é™åˆ¶æ•°é‡, åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å…è®¸è¢«æ‰§è¡Œ</span></span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    add();</span><br><span class="line">                    <span class="comment">// é‡Šæ”¾çº¿ç¨‹</span></span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    log.error(<span class="string">"exception"</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ‰§è¡Œä¸€æ¬¡å°±è¿›è¡ŒreleaseShared</span></span><br><span class="line">                countDownLatch.countDown();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ–¹æ³•å¯ä»¥ä¿è¯ countDown å‡ä¸º0</span></span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        executorService.shutdown();</span><br><span class="line">        log.info(<span class="string">"count:"</span> + count);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹å®‰å…¨æ€§"><a href="#çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ€§"></a>çº¿ç¨‹å®‰å…¨æ€§</h3><blockquote><p>åŸå­æ€§ï¼šæä¾›äº†äº’æ–¥è®¿é—®ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å¯¹å®ƒè¿›è¡Œæ“ä½œã€‚ - AtomicåŒ…</p></blockquote><h3 id="ThreadLocalçš„ä½¿ç”¨"><a href="#ThreadLocalçš„ä½¿ç”¨" class="headerlink" title="ThreadLocalçš„ä½¿ç”¨"></a>ThreadLocalçš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = Logger.getLogger(<span class="string">"logger"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ThreadLocal&lt;String&gt; mThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testThreadLocal</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        mThreadLocal.set(<span class="string">"main-thread"</span>);</span><br><span class="line">        logger.info(<span class="string">"result1: "</span> + mThreadLocal.get());</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                <span class="comment">// thread1å†…éƒ¨è®¾ç½®çš„å€¼åªæœ‰thead1å†…éƒ¨å¯ä»¥å¾—åˆ°ï¼Œæ‰€ä»¥result3ä¸ºç©º</span></span><br><span class="line">                mThreadLocal.set(<span class="string">"thread_one"</span>);</span><br><span class="line">                logger.info(<span class="string">"result2: "</span> + mThreadLocal.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread1.join();</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                logger.info(<span class="string">"result3: "</span> + mThreadLocal.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread2.join();</span><br><span class="line">        logger.info(<span class="string">"result4: "</span> + mThreadLocal.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ThreadLocalTest threadLocalTest = <span class="keyword">new</span> ThreadLocalTest();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            threadLocalTest.testThreadLocal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest testThreadLocal</span><br><span class="line">ä¿¡æ¯: result1: main-thread</span><br><span class="line"><span class="meta">#</span> åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest$1 run</span><br><span class="line">ä¿¡æ¯: result2: thread_one</span><br><span class="line"><span class="meta">#</span> åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest$2 run</span><br><span class="line">ä¿¡æ¯: result3: null</span><br><span class="line"><span class="meta">#</span> åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest testThreadLocal</span><br><span class="line">ä¿¡æ¯: result4: main-thread</span><br></pre></td></tr></table></figure><h3 id="ThreadLocalè¯¦è§£"><a href="#ThreadLocalè¯¦è§£" class="headerlink" title="ThreadLocalè¯¦è§£"></a>ThreadLocalè¯¦è§£</h3><p>å››ä¸ªæ¥å£ï¼š</p><ul><li><p>public void set(T value) { }<br>è®¾ç½®å½“å‰çº¿ç¨‹çš„ThreadLocalå€¼ä¸ºæŒ‡å®šçš„Value</p></li><li><p>public T get() { }<br>è·å–å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„ThreadLocalå€¼ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸‹æ²¡æœ‰å€¼ï¼Œå°±è°ƒç”¨initialValueå‡½æ•°å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–</p></li><li><p>public void remove() { }<br>åˆ é™¤å½“å‰çº¿ç¨‹ThreadLocalå¯¹åº”çš„å€¼ï¼Œå½“å‰çº¿ç¨‹ç»“æŸæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ”¶çº¿ç¨‹å±€éƒ¨å˜é‡å€¼ã€‚P.S. removeæ–¹æ³•è°ƒç”¨åå†è°ƒç”¨getæ–¹æ³•ä¼šä½¿<br>initialValue()é‡æ–°è¢«è°ƒç”¨ï¼Œä»è€Œä½¿ThreadLocalçš„å€¼è¢«é‡æ–°è¢«åˆå§‹åŒ–ã€‚</p></li><li><p>protected T initilValue() { }<br>å½“å‰çº¿ç¨‹é€šè¿‡get()æ–¹æ³•ç¬¬ä¸€æ¬¡å¯¹ThreadLocalè¿›è¡Œè®¿é—®æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p></li></ul><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ThreadLocalæ‹¥æœ‰ä¸€ä¸ªä¸ä¸ºnullçš„åˆå§‹å€¼ï¼Œåˆ™åº”è¯¥ä¸ºThreadLocalå®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œå¹¶é‡å†™initialValue()æ–¹æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ã€å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Java" scheme="https://www.leezy.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>JAVA8 å¸¸ç”¨çš„æ—¥æœŸæ—¶é—´æ–¹æ³•</title>
    <link href="https://www.leezy.top/2019/11/07/JAVA8%E5%B8%B8%E7%94%A8%E7%9A%84%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E6%96%B9%E6%B3%95/"/>
    <id>https://www.leezy.top/2019/11/07/JAVA8å¸¸ç”¨çš„æ—¥æœŸæ—¶é—´æ–¹æ³•/</id>
    <published>2019-11-07T08:27:03.000Z</published>
    <updated>2019-12-21T08:38:22.798Z</updated>
    
    <content type="html"><![CDATA[<p>JAVA8 æ›´æ–°äº†åŸæœ¬çº¿ç¨‹ä¸å®‰å…¨çš„SimpleDateFormat, æ–°çš„DateTimeFormatteråˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><a id="more"></a><p>ä¸‹é¢åˆ—å‡ºJAVA8å¼€å‘ä¸­å¸¸ç”¨çš„æ—¶é—´æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.DayOfWeek;</span><br><span class="line"><span class="keyword">import</span> java.time.Instant;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.Month;</span><br><span class="line"><span class="keyword">import</span> java.time.ZoneId;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.time.temporal.ChronoField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰å¹´æœˆæ—¥ - 2019-11-06</span></span><br><span class="line">        LocalDate nowDate = LocalDate.now();</span><br><span class="line">        <span class="comment">// 2019</span></span><br><span class="line">        <span class="keyword">int</span> nowYear = nowDate.getYear();</span><br><span class="line">        <span class="comment">// 2019</span></span><br><span class="line">        <span class="keyword">int</span> nowYear1 = nowDate.get(ChronoField.YEAR);</span><br><span class="line">        <span class="comment">// NOVEMBER</span></span><br><span class="line">        Month nowMonth = nowDate.getMonth();</span><br><span class="line">        <span class="comment">// 11</span></span><br><span class="line">        <span class="keyword">int</span> nowMonth1 = nowDate.get(ChronoField.MONTH_OF_YEAR);</span><br><span class="line">        <span class="comment">// 6</span></span><br><span class="line">        <span class="keyword">int</span> nowDay = nowDate.getDayOfMonth();</span><br><span class="line">        <span class="comment">// 6</span></span><br><span class="line">        <span class="keyword">int</span> nowDay1 = nowDate.get(ChronoField.DAY_OF_MONTH);</span><br><span class="line">        <span class="comment">// WEDNESDAY</span></span><br><span class="line">        DayOfWeek dayOfWeek = nowDate.getDayOfWeek();</span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="keyword">int</span> dayOfWeek1 = nowDate.get(ChronoField.DAY_OF_WEEK);</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶åˆ†ç§’ - 15:16:24.401</span></span><br><span class="line">        LocalTime nowTime = LocalTime.now();</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ—¶åˆ†ç§’ - 12:51:10</span></span><br><span class="line">        LocalTime nowTime1 = LocalTime.of(<span class="number">12</span>, <span class="number">51</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ—¶é—´ - 2019-11-06</span></span><br><span class="line">        LocalDate specificTime = LocalDate.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">6</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// LocalDateTime è·å–å¹´æœˆæ—¥æ—¶åˆ†ç§’</span></span><br><span class="line">        LocalDateTime localDateTime = LocalDateTime.now();</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ—¶é—´ 2019-11-11T16:14:20</span></span><br><span class="line">        LocalDateTime localDateTime1 = LocalDateTime.of(<span class="number">2019</span>, Month.NOVEMBER, <span class="number">11</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="comment">// 2019-11-06T16:19:51.506</span></span><br><span class="line">        LocalDateTime localDateTime2 = LocalDateTime.of(nowDate, nowTime);</span><br><span class="line">        <span class="comment">// LocalDateTime localDateTime3 = LocalDat</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ¯«ç§’æ•°</span></span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶é—´ 2019-11-06T07:18:39.956Z</span></span><br><span class="line">        Instant instant = Instant.now();</span><br><span class="line">        <span class="comment">// 1573028684 å¾—åˆ°çš„æ˜¯ç§’æ•°</span></span><br><span class="line">        <span class="keyword">long</span> currentSecond = instant.getEpochSecond();</span><br><span class="line">        <span class="comment">// 1573028779924 å¾—åˆ°æ¯«ç§’æ•°</span></span><br><span class="line">        <span class="keyword">long</span> currentMilli = instant.toEpochMilli();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰å¹´æœˆæ—¥ - 2019-11-06</span></span><br><span class="line">        LocalDate date = Instant.ofEpochMilli(instant.toEpochMilli()).atZone(ZoneId.systemDefault()).toLocalDate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¼å¼åŒ–æ—¶é—´</span></span><br><span class="line">        <span class="comment">// 2019-11-06</span></span><br><span class="line">        LocalDate localDate = LocalDate.of(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 20191106</span></span><br><span class="line">        String str1 = localDate.format(DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">        <span class="comment">// 2019-11-06</span></span><br><span class="line">        String str2 = localDate.format(DateTimeFormatter.ISO_LOCAL_DATE);</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰æ ¼å¼åŒ–</span></span><br><span class="line">        DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        <span class="comment">// 2019-11-06 16:41:10</span></span><br><span class="line">        String str3 = localDateTime.format(dateTimeFormatter);</span><br><span class="line">        System.out.println(str3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JAVA8 æ›´æ–°äº†åŸæœ¬çº¿ç¨‹ä¸å®‰å…¨çš„SimpleDateFormat, æ–°çš„DateTimeFormatteråˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Java" scheme="https://www.leezy.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>MySQLä¼˜åŒ–</title>
    <link href="https://www.leezy.top/2019/10/08/MySQL%E4%BC%98%E5%8C%96/"/>
    <id>https://www.leezy.top/2019/10/08/MySQLä¼˜åŒ–/</id>
    <published>2019-10-08T08:40:55.000Z</published>
    <updated>2019-12-16T07:59:22.802Z</updated>
    
    <content type="html"><![CDATA[<p>MySQLçš„ä¼˜åŒ–æ–¹æ³•ã€‚</p><a id="more"></a><h3 id="MySQLçš„æ ‡å‡†æ‰§è¡Œé¡ºåº"><a href="#MySQLçš„æ ‡å‡†æ‰§è¡Œé¡ºåº" class="headerlink" title="MySQLçš„æ ‡å‡†æ‰§è¡Œé¡ºåº"></a>MySQLçš„æ ‡å‡†æ‰§è¡Œé¡ºåº</h3><p>ä»ä¸Šåˆ°ä¸‹ï¼š</p><blockquote><p><code>FROM</code></p></blockquote><blockquote><p><code>ON</code><join_condition></join_condition></p></blockquote><blockquote><p><join_type><code>JOIN</code><right_table></right_table></join_type></p></blockquote><blockquote><p><code>WHERE</code><where_condition></where_condition></p></blockquote><blockquote><p><code>GROUP BY</code><group_by_list></group_by_list></p></blockquote><blockquote><p><code>WITH</code> {CUBE|ROLLUP}</p></blockquote><blockquote><p><code>HAVING</code><having_condition></having_condition></p></blockquote><blockquote><p><code>SELECT</code></p></blockquote><blockquote><p><code>DISTINCT</code><select_list></select_list></p></blockquote><blockquote><p><code>ORDER BY</code><order_by_list></order_by_list></p></blockquote><blockquote><p><code>LIMIT</code><limit_number></limit_number></p></blockquote><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><p>åœºæ™¯ï¼šå«æœ‰GroupByçš„è¯­å¥é‡Œå¦‚ä½•æ˜¾ç¤ºæŸ¥è¯¢Count()ä¸º0çš„å­—æ®µã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;MySQLçš„ä¼˜åŒ–æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="MySQL" scheme="https://www.leezy.top/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Git-ä»å…¥é—¨åˆ°ç²¾é€š</title>
    <link href="https://www.leezy.top/2019/09/29/Git-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/"/>
    <id>https://www.leezy.top/2019/09/29/Git-ä»å…¥é—¨åˆ°ç²¾é€š/</id>
    <published>2019-09-29T09:43:03.000Z</published>
    <updated>2019-12-18T13:50:14.337Z</updated>
    
    <content type="html"><![CDATA[<p>Git Bashçš„ç®€å•ä½¿ç”¨æ–¹æ³•ã€‚</p><a id="more"></a><p>git å¯ä»¥åˆ†ä¸‰ä¸ªåŒºï¼š</p><blockquote><p>å·¥ä½œåŒº(æ³¨è§£ç¼–è¾‘é¡µé¢)ï¼Œå°±æ˜¯æœ¬åœ°æ–‡ä»¶å¤¹ã€‚<br>æš‚å­˜åŒº(æ•°æ®æš‚æ—¶å­˜æ”¾çš„ä½ç½®ï¼Œå¯ä»¥åœ¨å·¥ä½œåŒºå’Œç‰ˆæœ¬åº“ä¹‹é—´è¿›è¡Œæ•°æ®çš„å‹å¥½äº¤æµ)ï¼Œgit add å‘½ä»¤å°†ä»–ä»¬æ·»åŠ åˆ°æš‚å­˜åŒºã€‚<br>ç‰ˆæœ¬åº“/æœ¬åœ°ä»“åº“(å­˜æ”¾å·²ç»æäº¤çš„æ•°æ®ï¼Œpushçš„æ—¶å€™ï¼Œå°±æ˜¯å°†è¿™ä¸ªåŒºçš„æ•°æ®pushåˆ°è¿œç¨‹ä»“åº“äº†)ï¼Œgit commit å‘½ä»¤åˆ™å°†æš‚å­˜åŒºä¸­çš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“ä¸­ã€‚</p></blockquote><p>é¦–å…ˆè¿æ¥åˆ°å›½é™…äº’è”ç½‘:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ä¸éœ€è¦çš„å°±ä¸ç”¨äº†</span><br><span class="line">export http_proxy="http://127.0.0.1:1080/"</span><br><span class="line">export https_proxy="http://127.0.0.1:1080/"</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºä»£ç ä»“åº“"><a href="#åˆ›å»ºä»£ç ä»“åº“" class="headerlink" title="åˆ›å»ºä»£ç ä»“åº“"></a>åˆ›å»ºä»£ç ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name "SAKURA"</span><br><span class="line">git config --global user.email "xxx@gmail.com"</span><br><span class="line"><span class="meta">#</span> å»ºç«‹ä»£ç ä»“åº“(åœ¨æŒ‡å®šç›®å½•å»ºç«‹.gitæ–‡ä»¶å¤¹)</span><br><span class="line">git init</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹ä»£ç ä»“åº“çŠ¶æ€</span><br><span class="line">git status</span><br></pre></td></tr></table></figure><h3 id="æäº¤æœ¬åœ°ä»£ç "><a href="#æäº¤æœ¬åœ°ä»£ç " class="headerlink" title="æäº¤æœ¬åœ°ä»£ç "></a>æäº¤æœ¬åœ°ä»£ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git add READEME.txt</span><br><span class="line"><span class="meta">#</span> å…¨éƒ¨æ›´æ–°åˆ°æš‚å­˜åŒº</span><br><span class="line">git add .</span><br><span class="line"><span class="meta">#</span> åœ¨ -m åé¢åŠ ä¸Šå£°æ˜, å°†ä»£ç æäº¤åˆ°æœ¬åœ°ä»“åº“</span><br><span class="line">git commit -m "Wrote a READEME file"</span><br><span class="line"><span class="meta">#</span> å¦‚æœè¦æ±‚çš„æäº¤å¤‡æ³¨ç‰¹åˆ«å¤š,å¯ä»¥æ‰“å¼€ä¸€ä¸ªviç¼–è¾‘å™¨</span><br><span class="line">git commit</span><br><span class="line"><span class="meta">#</span> ä»æœ¬åœ°ä»“åº“æäº¤åˆ°è¿œç¨‹ä»“åº“masteråˆ†æ”¯</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p><strong>æ³¨é‡Š</strong><br>å¯ä»¥åœ¨ä»£ç ä»“åº“çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º.gitignoreçš„æ–‡ä»¶ï¼Œç„¶åç¼–è¾‘é‡Œé¢çš„å†…å®¹ï¼ŒæŠŠä¸éœ€æäº¤çš„æ–‡ä»¶å¿½ç•¥æ‰ï¼</p><h3 id="commitå‰çš„æ–‡ä»¶çŠ¶æ€"><a href="#commitå‰çš„æ–‡ä»¶çŠ¶æ€" class="headerlink" title="commitå‰çš„æ–‡ä»¶çŠ¶æ€"></a>commitå‰çš„æ–‡ä»¶çŠ¶æ€</h3><p><code>git status</code>æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼ŒGitåœ¨æœªè¿›è¡Œcommitæ“ä½œä¹‹å‰ï¼Œå­˜åœ¨ä¸‰ç§çŠ¶æ€ï¼š</p><blockquote><p>Untracked files</p></blockquote><blockquote><p>Changes not staged for commit</p></blockquote><blockquote><p>Changes to be committed</p></blockquote><h3 id="åˆ†æ”¯çš„å»ºç«‹"><a href="#åˆ†æ”¯çš„å»ºç«‹" class="headerlink" title="åˆ†æ”¯çš„å»ºç«‹"></a>åˆ†æ”¯çš„å»ºç«‹</h3><p>æ—©å»ºåˆ†æ”¯, å¤šç”¨åˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å»ºç«‹åˆ†æ”¯</span><br><span class="line">git branch newImage</span><br><span class="line"><span class="meta">#</span> åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ newImage</span><br><span class="line">git checkout newImage;</span><br><span class="line"><span class="meta">#</span> æ–°åˆ†æ”¯ä»£ç æäº¤</span><br><span class="line">git commit</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ“ä½œå¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢ä¸¤æ­¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åˆ›å»ºæ–°çš„åˆ†æ”¯å¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯</span><br><span class="line">git checkout -b newImage</span><br><span class="line"><span class="meta">#</span> æ–°åˆ†æ”¯ä»£ç æäº¤</span><br><span class="line">git commit</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ”¯çš„åˆå¹¶"><a href="#åˆ†æ”¯çš„åˆå¹¶" class="headerlink" title="åˆ†æ”¯çš„åˆå¹¶"></a>åˆ†æ”¯çš„åˆå¹¶</h3><p>æ–¹æ³•ä¸€ï¼š<code>Merge</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å»ºç«‹æ–°çš„åˆ†æ”¯bugFix</span><br><span class="line">git branch bugFix</span><br><span class="line"><span class="meta">#</span> åˆ‡æ¢åˆ°bugFixåˆ†æ”¯</span><br><span class="line">git checkout bugFix</span><br><span class="line"><span class="meta">#</span> bugFixä»£ç æäº¤</span><br><span class="line">git commit</span><br><span class="line"><span class="meta">#</span> åˆ‡æ¢åˆ°masteråˆ†æ”¯</span><br><span class="line">git checkout master</span><br><span class="line"><span class="meta">#</span> masteråˆ†æ”¯ä»£ç æäº¤</span><br><span class="line">git commit</span><br><span class="line"><span class="meta">#</span> åˆ†æ”¯åˆå¹¶ - ç°åœ¨masteråˆ†æ”¯ä¸Šæœ‰äº†bugFixçš„æäº¤</span><br><span class="line">git merge bugFix</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š<code>Rebase</code><br>ç®€å•æ¥è¯´Rebaseå°±æ˜¯å–å‡ºä¸€ç³»åˆ—çš„æäº¤è®°å½•ï¼Œâ€œå¤åˆ¶â€å®ƒä»¬ï¼Œç„¶ååœ¨å¦å¤–ä¸€ä¸ªåœ°æ–¹é€ä¸ªå°†ä¿®æ”¹æ”¾ä¸‹å»ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¼šä½¿ä»£ç åº“çš„æäº¤å†å²å˜å¾—æ¸…æ™°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å‡è®¾å½“å‰æ˜¯åœ¨bugFixåˆ†æ”¯ä¸‹ï¼Œå°†bugFixåˆ†æ”¯çš„å·¥ä½œç›´æ¥ç§»åŠ¨åˆ°masteråˆ†æ”¯ä¸Š</span><br><span class="line">git rebase master</span><br><span class="line"><span class="meta">#</span> åˆ‡æ¢åˆ°masteråˆ†æ”¯</span><br><span class="line">git checkout master</span><br><span class="line"><span class="meta">#</span> å°†masteråˆ†æ”¯çš„å¼•ç”¨å‘å‰ç§»åŠ¨ï¼Œå³rebaseåˆ°bugFix</span><br><span class="line">git rebase bugFix</span><br></pre></td></tr></table></figure><h3 id="åœ¨æäº¤æ ‘ä¸Šç§»åŠ¨"><a href="#åœ¨æäº¤æ ‘ä¸Šç§»åŠ¨" class="headerlink" title="åœ¨æäº¤æ ‘ä¸Šç§»åŠ¨"></a>åœ¨æäº¤æ ‘ä¸Šç§»åŠ¨</h3><p>HEAD æ€»æ˜¯æŒ‡å‘å½“å‰åˆ†æ”¯ä¸Šæœ€è¿‘ä¸€æ¬¡æäº¤è®°å½•ï¼Œ<strong>HEADé€šå¸¸æ˜¯æŒ‡å‘åˆ†æ”¯åçš„,ä½†æ˜¯å¯ä»¥é€šè¿‡<code>git checkout &lt;å“ˆå¸Œå€¼&gt;</code>æ¥å°†HEADæŒ‡å‘ä¸€ä¸ªå…·ä½“çš„æäº¤è®°å½•</strong>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹HEADæŒ‡å‘çš„ä¸¤ç§æ–¹å¼</span><br><span class="line">cat .git/HEAD</span><br><span class="line"><span class="meta">#</span> å¦‚è‹¥HEADæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå¼•ç”¨</span><br><span class="line">git symbolic-ref HEAD </span><br><span class="line"><span class="meta">#</span> åˆ†ç¦»çš„HEADï¼Œä¸ºäº†è®©å…¶æŒ‡å‘æŸä¸ªå…·ä½“çš„æäº¤è®°å½•è€Œä¸æ˜¯åˆ†æ”¯å æ³¨ï¼šè¿™é‡Œçš„Hashå€¼å¹¶ä¸éœ€è¦å…¨éƒ¨40ä½ï¼Œ</span><br><span class="line"><span class="meta">#</span> èƒ½è¡¨ç¤ºå‡ºå”¯ä¸€æ ‡è¯†çš„å‰7ä½å­—ç¬¦å°±å¯ä»¥</span><br><span class="line">git checkout &lt;æäº¤è®°å½•çš„å“ˆå¸Œå€¼&gt;</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…ä½¿ç”¨<code>git log</code>å‘½ä»¤æŸ¥çœ‹Hashå€¼ï¼Œå†é€šè¿‡<code>git checkout</code>å‘½ä»¤åˆ†ç¦»HEADï¼Œæ‰€ä»¥æœ‰äº†<strong>ç›¸å¯¹å¼•ç”¨</strong></p><blockquote><p><code>^</code> è¡¨ç¤ºå‘ä¸Šç§»åŠ¨ä¸€ä¸ªæäº¤è®°å½•</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout HEAD^</span><br><span class="line"><span class="meta">#</span> æˆ–è€…</span><br><span class="line">git checkout master^</span><br></pre></td></tr></table></figure><blockquote><p><code>~&lt;num&gt;</code>è¡¨ç¤ºå‘ä¸Šç§»åŠ¨<strong>å¤šä¸ª</strong>æäº¤è®°å½•, numä¸º1æ—¶ç­‰ä»·ä¸<code>^</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å¯»æ‰¾æŒ‡å®šæäº¤è®°å½•çš„çˆ¶æäº¤</span><br><span class="line">git checkout HEAD~3</span><br><span class="line"><span class="meta">#</span> æˆ–è€…</span><br><span class="line">git checkout master~3</span><br></pre></td></tr></table></figure><p>ç›¸å¯¹å¼•ç”¨æœ€å¸¸è§çš„åœ°æ–¹å°±æ˜¯ç”¨æ¥ç§»åŠ¨åˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å°†masteråˆ†æ”¯ç§»åˆ°HEADæ‰€æŒ‡åˆ†æ”¯ä½ç½®å‰ä¸‰ä¸ªèŠ‚ç‚¹</span><br><span class="line">git branch -f master HEAD~3</span><br></pre></td></tr></table></figure><h3 id="æ’¤é”€å˜æ›´"><a href="#æ’¤é”€å˜æ›´" class="headerlink" title="æ’¤é”€å˜æ›´"></a>æ’¤é”€å˜æ›´</h3><p>æ–¹æ³•ä¸€ï¼š<code>git reset</code> - ä»…é™åœ¨æœ¬åœ°åˆ†æ”¯ä¸­ä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŠŠåˆ†æ”¯è®°å½•å›é€€å‡ ä¸ªæäº¤è®°å½•æ¥å®ç°æ’¤é”€æ”¹åŠ¨,æœ€æ–°çš„æäº¤å˜æˆäº†æœªåŠ å…¥æš‚å­˜åŒºçŠ¶æ€(git reset ç¼ºçœä¸º git reset --soft)å³æ–‡ä»¶æ²¡æœ‰æ›´æ”¹</span><br><span class="line"><span class="meta">#</span> åªæ˜¯å°†git commit çš„ä¿¡æ¯ç»™å›é€€äº†ã€‚æ¨èç›´æ¥ä½¿ç”¨ git reset --hard HEAD^, --hardå‚æ•°ä¼šå°†æ–‡ä»¶ç›´æ¥ä¿®æ”¹å›å»ã€‚</span><br><span class="line">git reset HEAD~1</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š<code>git revert</code> - é€‚ç”¨äºæäº¤åˆ°äº†è¿œç¨‹åˆ†æ”¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ä¼šåœ¨è¿œç¨‹æ·»åŠ ä¸€ä¸ªæ–°çš„æäº¤è®°å½•ï¼Œç”¨æ¥æŠµæ¶ˆæ‰è¿œç¨‹ä»“åº“æœ€æ–°çš„æ›´æ”¹</span><br><span class="line">git revert HEAD</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœä½ åæ‚”äº†æ€ä¹ˆåŠã€‚è¿™ä¸ªæ—¶å€™éœ€è¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬å·</span><br><span class="line">git reflog</span><br><span class="line"><span class="meta">#</span> é€€å›åˆ°æŒ‡å®šç‰ˆæœ¬ åŒ…æ‹¬å·²ç»åˆ é™¤äº†çš„ä¿®æ”¹</span><br><span class="line">git reset --hard XXX&lt;ç‰ˆæœ¬å·&gt;</span><br></pre></td></tr></table></figure><h3 id="æäº¤è®°å½•çš„æ•´ç†"><a href="#æäº¤è®°å½•çš„æ•´ç†" class="headerlink" title="æäº¤è®°å½•çš„æ•´ç†"></a>æäº¤è®°å½•çš„æ•´ç†</h3><blockquote><p>å°†ä¸€äº›æäº¤å¤åˆ¶åˆ°å½“å‰æ‰€åœ¨çš„ä½ç½®ï¼ˆHEADï¼‰çš„ä¸‹é¢ï¼Œcherry-pick å¯ä»¥å°†æäº¤æ ‘ä¸Šä»»ä½•åœ°æ–¹çš„æäº¤è®°å½•å–è¿‡æ¥è¿½åŠ åˆ° HEADä¸Šï¼ˆåªè¦ä¸æ˜¯HEADä¸Šæ¸¸çš„æäº¤å°±æ²¡æœ‰é—®é¢˜ï¼‰</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> git cherry-pick &lt;æäº¤å·&gt;...</span><br><span class="line">git cherry-pick d4b052 4aa0aa</span><br></pre></td></tr></table></figure><blockquote><p>äº¤äº’å¼çš„rebase</p></blockquote><p>ä½ å¯ä»¥é€šè¿‡ç»™<code>git rebase</code>å¢åŠ <code>-i</code>é€‰é¡¹æ¥ä»¥äº¤äº’æ–¹å¼åœ°è¿è¡Œrebaseã€‚ä½ å¿…é¡»é€šè¿‡å‘Šè¯‰å‘½ä»¤è¡åˆåˆ°å“ªæ¬¡æäº¤ï¼Œæ¥æŒ‡æ˜ä½ éœ€è¦é‡å†™çš„æäº¤çš„å›æº¯æ·±åº¦ã€‚</p><p><img src="/assets/blogImg/Git_git_log.png" alt="Git_git_log"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> è¿™æ˜¯ä¸€ä¸ªè¡åˆå‘½ä»¤â€”â€”HEAD~2..HEADèŒƒå›´å†…çš„æ¯ä¸€æ¬¡æäº¤éƒ½ä¼šè¢«é‡å†™ï¼Œæ— è®ºä½ æ˜¯å¦ä¿®æ”¹è¯´æ˜ã€‚</span><br><span class="line">git rebase -i HEAD~2</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤ä¼šæ‰“å¼€ä¸€ä¸ªäº¤äº’çª—å£ï¼š</p><p><img src="/assets/blogImg/Git_git_rebase_i.png" alt="Git-ä»å…¥é—¨åˆ°ç²¾é€š_git_rebase_-i"></p><p>å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ä½ å¾—æ³¨æ„è¿™äº›æäº¤çš„é¡ºåºä¸ä½ é€šå¸¸é€šè¿‡logå‘½ä»¤çœ‹åˆ°çš„æ˜¯ç›¸åçš„ã€‚</p><p>é€šè¿‡rebase UIç•Œé¢, ä½ èƒ½åš3ä»¶äº‹:</p><ul><li>è°ƒæ•´æäº¤è®°å½•çš„é¡ºåº</li><li>åˆ é™¤ä½ ä¸æƒ³è¦çš„æäº¤</li><li>åˆå¹¶æäº¤, æŠŠå¤šä¸ªæäº¤è®°å½•åˆå¹¶æˆä¸€ä¸ªã€‚</li></ul><p>è¯¦æƒ…è¯·çœ‹<a href="https://git-scm.com/book/zh/v1/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E5%86%99%E5%8E%86%E5%8F%B2" title="Git-å·¥å…·-é‡å†™å†å²" target="_blank" rel="noopener">è¿™é‡Œ</a></p><h3 id="æŸ¥çœ‹ä¿®æ”¹çš„å†…å®¹"><a href="#æŸ¥çœ‹ä¿®æ”¹çš„å†…å®¹" class="headerlink" title="æŸ¥çœ‹ä¿®æ”¹çš„å†…å®¹"></a>æŸ¥çœ‹ä¿®æ”¹çš„å†…å®¹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> "+"å·è¡¨ç¤ºæ–°å¢å†…å®¹ï¼Œ "-"å·è¡¨ç¤ºåˆ é™¤çš„å†…å®¹</span><br><span class="line">git diff</span><br><span class="line"><span class="meta">#</span> å¯è§†åŒ–çš„æŸ¥çœ‹æ–¹æ³•</span><br><span class="line">git difftool</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æäº¤è®°å½•"><a href="#æŸ¥çœ‹æäº¤è®°å½•" class="headerlink" title="æŸ¥çœ‹æäº¤è®°å½•"></a>æŸ¥çœ‹æäº¤è®°å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure><blockquote><ul><li>æ­¤æ¬¡æäº¤å¯¹åº”çš„ç‰ˆæœ¬å·</li><li>æäº¤äººï¼šå§“å é‚®ç®±</li><li>æäº¤çš„æ—¶é—´</li><li>æäº¤ç‰ˆæœ¬ä¿®æ”¹çš„å†…å®¹ï¼šå°±æ˜¯æˆ‘ä»¬commit -m  â€œxxxâ€é‡Œçš„xxx</li></ul></blockquote><h3 id="è®°ä½å¯†ç "><a href="#è®°ä½å¯†ç " class="headerlink" title="è®°ä½å¯†ç "></a>è®°ä½å¯†ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure><h3 id="ç‰ˆæœ¬å›é€€"><a href="#ç‰ˆæœ¬å›é€€" class="headerlink" title="ç‰ˆæœ¬å›é€€"></a>ç‰ˆæœ¬å›é€€</h3><p>æäº¤åå›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</p><blockquote><ul><li>éœ€è¦ç‰ˆæœ¬å·</li><li>HEADä»£è¡¨å½“å‰ç‰ˆæœ¬, HEAD^è¡¨ç¤ºä¸Šä¸€ä¸ªç‰ˆæœ¬, ä»¥æ­¤ç±»æ¨</li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹ç‰ˆæœ¬å·</span><br><span class="line">git log </span><br><span class="line">git reset --hard f37911a60ca123c86c712ff0539619902a7375e8(ç›®æ ‡ç‰ˆæœ¬å·)</span><br><span class="line"></span><br><span class="line">git reset --hard HEAD</span><br><span class="line">git reset --hard HEAD^</span><br><span class="line">git log</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ åˆåæ‚”äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br></pre></td></tr></table></figure><p>é”®å…¥ç‰ˆæœ¬å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard ç‰ˆæœ¬å·(ä½ è¦å›é€€çš„ç‰ˆæœ¬å·)</span><br></pre></td></tr></table></figure><p>åˆä¼šå›åˆ°ä½ æœŸæœ›çš„ç‰ˆæœ¬ï¼</p><h3 id="GitHub-åˆå§‹åŒ–æäº¤"><a href="#GitHub-åˆå§‹åŒ–æäº¤" class="headerlink" title="GitHub åˆå§‹åŒ–æäº¤"></a>GitHub åˆå§‹åŒ–æäº¤</h3><ul><li><p>create a new repository on the command line</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo "# NOTES" &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line"><span class="meta">#</span> git add .</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m "first commit"</span><br><span class="line">git remote add origin https://github.com/XXX/NOTES.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure></li><li><p>push an existing repository from the command line</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/XXX/NOTES.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure></li></ul><h3 id="è‡ªåŠ¨ä¸Šä¼ è„šæœ¬"><a href="#è‡ªåŠ¨ä¸Šä¼ è„šæœ¬" class="headerlink" title="è‡ªåŠ¨ä¸Šä¼ è„šæœ¬:"></a>è‡ªåŠ¨ä¸Šä¼ è„šæœ¬:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line">echo 'start autodeployment...:)'</span><br><span class="line">hexo clean</span><br><span class="line">echo 'hexo clean over...'</span><br><span class="line">hexo generate</span><br><span class="line">echo 'hexo generate over...'</span><br><span class="line">hexo deploy</span><br><span class="line">echo 'hexo deploy over...'</span><br><span class="line">echo 'run success!:)'</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h3><p>åœºæ™¯ï¼šæœ¬åœ°æ–°å»ºäº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œæƒ³æ‹‰å–è¿œç¨‹çš„ä¸€ä¸ªé¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin https://github.com/XXX/NOTES.git</span><br><span class="line"><span class="meta">#</span> git pull &lt;remote&gt; &lt;branch&gt; ç›´æ¥æŒ‡å®šè¿œç¨‹master</span><br><span class="line">git pull origin master</span><br><span class="line"><span class="meta">#</span> å…ˆæŒ‡å®šæœ¬åœ°masteråˆ°è¿œç¨‹çš„masterï¼Œç„¶åå†å»pull</span><br><span class="line">git branch --set-upstream-to=origin/master master</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure><p>åœºæ™¯ï¼šå°†æœ¬åœ°çš„<code>.git</code>æ–‡ä»¶åˆ é™¤äº†ï¼Œæœ¬åœ°æ–‡ä»¶ä¹Ÿæ›´æ–°äº†ï¼Œæ–°å»ºgitä»“åº“å’Œè¿œç¨‹åˆå¹¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin https://github.com/XXX/NOTES.git</span><br><span class="line"><span class="meta">#</span> ä¼šæŠ¥é”™ï¼Œfailed to push some refs to ...</span><br><span class="line">git push origin master</span><br><span class="line"><span class="meta">#</span> è¿™ä¸ªæ—¶å€™éœ€è¦å…ˆæ‹‰å–è¿œç¨‹çš„é¡¹ç›®</span><br><span class="line">git pull origin master</span><br><span class="line"><span class="meta">#</span> ç„¶åä¼šæŠ¥é”™ï¼Œfatal: refusing to merge unrelated histories</span><br><span class="line">git pull origin master --allow-unrelated-histories</span><br><span class="line"><span class="meta">#</span> ç„¶åæŒ‰ç…§è¦æ±‚è§£å†³å†²çªå°±å¥½ï¼Œå†commitä¸€ä¸‹</span><br><span class="line">git add .</span><br><span class="line">git commit -m "fix conflicts"</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>åœºæ™¯ï¼šè¿œç¨‹ä»“åº“é‡Œæäº¤äº†ä¸€äº›ä¸éœ€è¦çš„æ–‡ä»¶ï¼Œæœ¬åœ°æ·»åŠ åˆ°<code>.gitignore</code>æ–‡ä»¶åä¸èµ·ä½œç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .</span><br><span class="line">git add .</span><br><span class="line">git commit -m 'update .gitignore'</span><br></pre></td></tr></table></figure><p>åœºæ™¯ï¼šè¿œç¨‹ä»“åº“æœ‰ä¸¤ä¸ªåˆ†æ”¯<code>master</code>å’Œ<code>dev</code>ï¼Œæ¯”è¾ƒäºŒè€…çš„ç‰ˆæœ¬å·®å¼‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹è¿œç¨‹devæœ‰ä½†æ˜¯è¿œç¨‹masteræ²¡æœ‰çš„</span><br><span class="line">git log origin/dev ^origin/master</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹è¿œç¨‹masteræœ‰ä½†æ˜¯è¿œç¨‹devæ²¡æœ‰çš„</span><br><span class="line">git log origin/dev..origin/master</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹è¿œç¨‹masteræœ‰ä½†æ˜¯è¿œç¨‹devæ²¡æœ‰çš„</span><br><span class="line">git log origin/master ^origin/dev</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹è¿œç¨‹devæœ‰ä½†æ˜¯è¿œç¨‹masteræ²¡æœ‰çš„</span><br><span class="line">git log origin/master..origin/dev</span><br><span class="line"><span class="meta">#</span> å•çº¯æƒ³æ¯”è¾ƒä¸¤è€…ä¹‹é—´çš„åŒºåˆ«</span><br><span class="line">git log origin/dev...origin/master</span><br><span class="line"><span class="meta">#</span> æˆ–è€…</span><br><span class="line">git log --left-right dev...master</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å¯ä»¥åŠ ä¸Š<code>--pretty=oneline</code>è®©ç»“æœè¾“å‡ºæ›´ç®€æ´ã€‚</p><p>åœºæ™¯ï¼šå¤„ç†å®Œå†²çªåå°†æ–‡ä»¶æŸ¥çœ‹åˆ†æ”¯çš„æ›´æ”¹æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --graph --pretty=oneline --abbrev-commit</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Git Bashçš„ç®€å•ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Git" scheme="https://www.leezy.top/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>JAVAåŸºç¡€çŸ¥è¯†-Map</title>
    <link href="https://www.leezy.top/2019/09/09/JAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-Map/"/>
    <id>https://www.leezy.top/2019/09/09/JAVAåŸºç¡€çŸ¥è¯†-Map/</id>
    <published>2019-09-09T03:06:00.000Z</published>
    <updated>2019-12-18T14:56:13.629Z</updated>
    
    <content type="html"><![CDATA[<p>JAVAåŸºç¡€çŸ¥è¯†-Map ç›¸å…³çŸ¥è¯†ã€‚</p><a id="more"></a><h3 id="éå†Map"><a href="#éå†Map" class="headerlink" title="éå†Map"></a>éå†Map</h3><blockquote><p>æ–¹æ³•ä¸€ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlowMap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"A"</span>, <span class="string">"01"</span>);</span><br><span class="line">        map.put(<span class="string">"B"</span>, <span class="string">"02"</span>);</span><br><span class="line">        map.put(<span class="string">"C"</span>, <span class="string">"03"</span>);</span><br><span class="line">        <span class="comment">// è·å–é”®çš„é›†åˆ</span></span><br><span class="line">        Set&lt;String&gt; keySet = map.keySet();</span><br><span class="line">        <span class="comment">// åˆ©ç”¨seté›†åˆçš„è¿­ä»£å™¨</span></span><br><span class="line">        Iterator&lt;String&gt; iterator = keySet.iterator();</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            String key = iterator.next();</span><br><span class="line">            String value = map.get(key);</span><br><span class="line">            System.out.println(<span class="string">"MAP INFO KEY:"</span> + key + <span class="string">" VALUE:"</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">&gt; æ–¹æ³•äºŒï¼š</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickMap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"A"</span>, <span class="string">"01"</span>);</span><br><span class="line">        map.put(<span class="string">"B"</span>, <span class="string">"02"</span>);</span><br><span class="line">        map.put(<span class="string">"C"</span>, <span class="string">"03"</span>);</span><br><span class="line">        <span class="comment">// é€šè¿‡entrySet()æ–¹æ³•å°†mapé›†åˆä¸­çš„æ˜ å°„å…³ç³»å–å‡º</span></span><br><span class="line">        Set&lt;Map.Entry&lt;String, String&gt;&gt; entry = map.entrySet();</span><br><span class="line">        <span class="comment">// åˆ©ç”¨å…³ç³»é›†åˆentrySetçš„è¿­ä»£å™¨</span></span><br><span class="line">        Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iterator = entry.iterator();</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            <span class="comment">// è·å–Map.Entryçš„å…³ç³»å¯¹è±¡me</span></span><br><span class="line">            Map.Entry&lt;String, String&gt; me = iterator.next();</span><br><span class="line">            <span class="comment">// é€šè¿‡å…³ç³»å¯¹è±¡è·å–key</span></span><br><span class="line">            String key = me.getKey();</span><br><span class="line">            <span class="comment">// é€šè¿‡å…³ç³»å¯¹è±¡è·å–value</span></span><br><span class="line">            String value = me.getValue();</span><br><span class="line">            System.out.println(<span class="string">"Key :"</span> + key + <span class="string">" value :"</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ–¹æ³•ä¸‰ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionMap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"A"</span>, <span class="string">"01"</span>);</span><br><span class="line">        map.put(<span class="string">"B"</span>, <span class="string">"02"</span>);</span><br><span class="line">        map.put(<span class="string">"C"</span>, <span class="string">"03"</span>);</span><br><span class="line">        <span class="comment">// Collectioné›†åˆå­˜æ”¾Mapçš„valueå€¼</span></span><br><span class="line">        Collection&lt;String&gt; collection = map.values();</span><br><span class="line">        <span class="comment">// éå†Collection</span></span><br><span class="line">        Iterator&lt;String&gt; it = collection.iterator();</span><br><span class="line">        <span class="comment">// åªèƒ½éå†valueå€¼ï¼Œä¸èƒ½éå†keyå€¼</span></span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            Object value = it.next();</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æœ€ä½³å®è·µï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BestMap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"A"</span>, <span class="string">"01"</span>);</span><br><span class="line">        map.put(<span class="string">"B"</span>, <span class="string">"02"</span>);</span><br><span class="line">        map.put(<span class="string">"C"</span>, <span class="string">"03"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"key= "</span> + entry.getKey() + <span class="string">" and value= "</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JAVAåŸºç¡€çŸ¥è¯†-Map ç›¸å…³çŸ¥è¯†ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Java" scheme="https://www.leezy.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>JAVAåŸºç¡€çŸ¥è¯†-HashMap</title>
    <link href="https://www.leezy.top/2019/09/05/JAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-HashMap/"/>
    <id>https://www.leezy.top/2019/09/05/JAVAåŸºç¡€çŸ¥è¯†-HashMap/</id>
    <published>2019-09-05T03:06:00.000Z</published>
    <updated>2019-12-16T06:38:24.356Z</updated>
    
    <content type="html"><![CDATA[<p>JAVAåŸºç¡€çŸ¥è¯†-HashMap ç›¸å…³çŸ¥è¯†ã€‚</p><a id="more"></a><h3 id="å¸¸ç”¨çš„é€šé…ç¬¦"><a href="#å¸¸ç”¨çš„é€šé…ç¬¦" class="headerlink" title="å¸¸ç”¨çš„é€šé…ç¬¦"></a>å¸¸ç”¨çš„é€šé…ç¬¦</h3><p><strong>T</strong>, <strong>E</strong>, <strong>K</strong>, <strong>V</strong>, <strong>?</strong></p><p>æœ¬è´¨ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä½†æ˜¯ä¸ºäº†ç»´æŒå¯è¯»æ€§ï¼Œå¸¸è¿™æ ·çº¦å®šï¼š</p><p>ï¼Ÿè¡¨ç¤ºä¸ç¡®å®šçš„JAVAç±»å‹</p><p>T (type) è¡¨ç¤ºä¸€ä¸ªå…·ä½“çš„JAVAç±»å‹</p><p>K V (key value) åˆ†åˆ«è¡¨ç¤ºJAVAé”®å€¼å¯¹ key - value</p><p>E (element) ä»£è¡¨Element</p><h3 id="RBT-çº¢é»‘æ ‘"><a href="#RBT-çº¢é»‘æ ‘" class="headerlink" title="RBT(çº¢é»‘æ ‘)"></a>RBT(çº¢é»‘æ ‘)</h3><ul><li>æ¯ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²</li><li>æ¯ä¸ªå¶èŠ‚ç‚¹æ˜¯é»‘è‰²çš„</li><li>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå„¿å­éƒ½æ˜¯é»‘è‰²çš„</li><li>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œä»è¯¥ç»“ç‚¹åˆ°å…¶å¶å­èŠ‚ç‚¹æ„æˆçš„æ‰€æœ‰è·¯å¾„ä¸Šçš„é»‘è‰²ç»“ç‚¹ä¸ªæ•°ç›¸åŒ</li></ul><p><strong>æ’å…¥è¿‡ç¨‹ï¼š</strong></p><p>é»˜è®¤æ’å…¥èŠ‚ç‚¹ä¸ºçº¢è‰²</p><h3 id="AVL-è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#AVL-è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="AVL(è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘)"></a>AVL(è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘)</h3><ul><li><p>é¦–å…ˆæ˜¯ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘</p><p><em>æŸèŠ‚ç‚¹çš„å·¦å­æ ‘èŠ‚ç‚¹å€¼ä»…åŒ…å«å°äºè¯¥èŠ‚ç‚¹å€¼</em></p><p><em>æŸèŠ‚ç‚¹çš„å³å­æ ‘èŠ‚ç‚¹å€¼ä»…åŒ…å«å¤§äºè¯¥èŠ‚ç‚¹å€¼</em></p><p><em>å·¦å³å­æ ‘æ¯ä¸ªä¹Ÿå¿…é¡»æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘</em></p></li><li><p>å¸¦æœ‰å¹³è¡¡æ¡ä»¶ï¼Œæ¯ä¸ªç»“ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ï¼ˆå¹³è¡¡å› å­ï¼‰æœ€å¤šä¸º1</p></li></ul><h3 id="RBTå’ŒAVL"><a href="#RBTå’ŒAVL" class="headerlink" title="RBTå’ŒAVL"></a>RBTå’ŒAVL</h3><p>æŸ¥æ‰¾è¿œè¿œå¤šäºæ’å…¥åˆ é™¤ï¼Œé€‰æ‹©AVLæ ‘</p><p>å¦‚æœæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤é¢‘ç‡å·®ä¸å¤šï¼Œé‚£ä¹ˆé€‰æ‹©çº¢é»‘æ ‘</p><h3 id="JAVA-ä¸­çº¢é»‘æ ‘çš„å®ç°"><a href="#JAVA-ä¸­çº¢é»‘æ ‘çš„å®ç°" class="headerlink" title="JAVA ä¸­çº¢é»‘æ ‘çš„å®ç°"></a>JAVA ä¸­çº¢é»‘æ ‘çš„å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        TreeNode&lt;K,V&gt; parent;  <span class="comment">// red-black tree links</span></span><br><span class="line">        TreeNode&lt;K,V&gt; left;</span><br><span class="line">        TreeNode&lt;K,V&gt; right;</span><br><span class="line">        TreeNode&lt;K,V&gt; prev;    <span class="comment">// needed to unlink next upon deletion</span></span><br><span class="line">        <span class="keyword">boolean</span> red;</span><br><span class="line">        TreeNode(<span class="keyword">int</span> hash, K key, V val, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">super</span>(hash, key, val, next);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¢é»‘æ ‘çš„æ’å…¥è¿‡ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">balanceInsertion</span><span class="params">(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹æŸ“è‰²ä¸ºçº¢</span></span><br><span class="line">    x.red = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (TreeNode&lt;K,V&gt; xp, xpp, xppl, xppr;;) &#123;</span><br><span class="line">        <span class="comment">// æ’å…¥çš„ä¸ºæ ¹èŠ‚ç‚¹ï¼ˆçˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼‰ï¼Œåˆ™ç›´æ¥æŠŠé¢œè‰²æ”¹ä¸ºé»‘è‰²</span></span><br><span class="line">        <span class="keyword">if</span> ((xp = x.parent) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            x.red = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²èŠ‚ç‚¹æˆ–è€…æ’å…¥èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!xp.red || (xpp = xp.parent) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        <span class="comment">// I. çˆ¶èŠ‚ç‚¹å’Œç¥–çˆ¶èŠ‚ç‚¹éƒ½å­˜åœ¨ä¸”çˆ¶èŠ‚ç‚¹æ˜¯ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (xp == (xppl = xpp.left)) &#123;</span><br><span class="line">            <span class="comment">// 1. ç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰ä¸æ˜¯ç©ºä¸”ä¸ºçº¢è‰²</span></span><br><span class="line">            <span class="keyword">if</span> ((xppr = xpp.right) != <span class="keyword">null</span> &amp;&amp; xppr.red) &#123;</span><br><span class="line">                <span class="comment">// å°†å”å”èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰²</span></span><br><span class="line">                xppr.red = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">// å°†çˆ¶äº²èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰²</span></span><br><span class="line">                xp.red = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">// å°†ç¥–çˆ¶èŠ‚ç‚¹æ”¹ä¸ºçº¢è‰²</span></span><br><span class="line">                xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                x = xpp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2. ç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰æ˜¯ç©ºæˆ–è€…ä¸ºé»‘è‰²</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­©å­ï¼Œå°†çˆ¶èŠ‚ç‚¹å·¦æ—‹</span></span><br><span class="line">                <span class="keyword">if</span> (x == xp.right) &#123;</span><br><span class="line">                    root = rotateLeft(root, x = xp);</span><br><span class="line">                    xpp = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.parent;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­</span></span><br><span class="line">                <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å°†çˆ¶èŠ‚ç‚¹å˜æˆé»‘è‰²èŠ‚ç‚¹</span></span><br><span class="line">                    xp.red = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (xpp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// ç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²èŠ‚ç‚¹ï¼Œç„¶åå°†ç¥–çˆ¶èŠ‚ç‚¹å³æ—‹</span></span><br><span class="line">                        xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                        root = rotateRight(root, xpp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// II. çˆ¶èŠ‚ç‚¹å’Œç¥–çˆ¶èŠ‚ç‚¹éƒ½å­˜åœ¨ä¸”çˆ¶èŠ‚ç‚¹æ˜¯ç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 1. ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰ä¸ä¸ºç©ºä¸”ä¸ºçº¢è‰²</span></span><br><span class="line">            <span class="keyword">if</span> (xppl != <span class="keyword">null</span> &amp;&amp; xppl.red) &#123;</span><br><span class="line">                <span class="comment">// å°†å”å”èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰²</span></span><br><span class="line">                xppl.red = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">// å°†çˆ¶äº²èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰²</span></span><br><span class="line">                xp.red = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">// å°†ç¥–çˆ¶èŠ‚ç‚¹æ”¹ä¸ºçº¢è‰²</span></span><br><span class="line">                xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                x = xpp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2. ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰æ˜¯ç©ºæˆ–è€…ä¸ºé»‘è‰²</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­ï¼Œå°†çˆ¶èŠ‚ç‚¹å³æ—‹</span></span><br><span class="line">                <span class="keyword">if</span> (x == xp.left) &#123;</span><br><span class="line">                    root = rotateRight(root, x = xp);</span><br><span class="line">                    xpp = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.parent;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­©å­</span></span><br><span class="line">                <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å°†çˆ¶èŠ‚ç‚¹å˜æˆé»‘è‰²èŠ‚ç‚¹</span></span><br><span class="line">                    xp.red = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (xpp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// ç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²èŠ‚ç‚¹ï¼Œç„¶åå°†ç¥–çˆ¶èŠ‚ç‚¹å·¦æ—‹</span></span><br><span class="line">                        xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                        root = rotateLeft(root, xpp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¦æ—‹å³æ—‹æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">rotateLeft</span><span class="params">(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; r, pp, rl;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span> &amp;&amp; (r = p.right) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((rl = p.right = r.left) != <span class="keyword">null</span>)</span><br><span class="line">            rl.parent = p;</span><br><span class="line">        <span class="keyword">if</span> ((pp = r.parent = p.parent) == <span class="keyword">null</span>)</span><br><span class="line">            (root = r).red = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pp.left == p)</span><br><span class="line">            pp.left = r;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pp.right = r;</span><br><span class="line">        r.left = p;</span><br><span class="line">        p.parent = r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">rotateRight</span><span class="params">(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; l, pp, lr;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span> &amp;&amp; (l = p.left) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((lr = p.left = l.right) != <span class="keyword">null</span>)</span><br><span class="line">            lr.parent = p;</span><br><span class="line">        <span class="keyword">if</span> ((pp = l.parent = p.parent) == <span class="keyword">null</span>)</span><br><span class="line">            (root = l).red = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pp.right == p)</span><br><span class="line">            pp.right = l;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pp.left = l;</span><br><span class="line">        l.right = p;</span><br><span class="line">        p.parent = l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¢é»‘æ ‘çš„åˆ é™¤è¿‡ç¨‹ï¼š</p><ol><li>å…ˆè¿›è¡ŒäºŒå‰æœç´¢æ ‘çš„åˆ é™¤</li><li>ç„¶åè¿›è¡Œçº¢é»‘æ ‘çš„è°ƒæ•´</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pæ˜¯å¾…åˆ é™¤èŠ‚ç‚¹ï¼Œreplacementç”¨äºåç»­çš„çº¢é»‘æ ‘è°ƒæ•´ï¼ŒæŒ‡å‘çš„æ˜¯pæˆ–è€…pçš„ç»§æ‰¿è€…ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (pl != <span class="keyword">null</span> &amp;&amp; pr != <span class="keyword">null</span>) &#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; s = pr, sl;</span><br><span class="line">    <span class="keyword">while</span> ((sl = s.left) != <span class="keyword">null</span>) <span class="comment">// find successor</span></span><br><span class="line">        s = sl;</span><br><span class="line">    <span class="keyword">boolean</span> c = s.red; s.red = p.red; p.red = c; <span class="comment">// swap colors</span></span><br><span class="line">    TreeNode&lt;K,V&gt; sr = s.right;</span><br><span class="line">    TreeNode&lt;K,V&gt; pp = p.parent;</span><br><span class="line">    <span class="keyword">if</span> (s == pr) &#123; <span class="comment">// p was s's direct parent</span></span><br><span class="line">        p.parent = s;</span><br><span class="line">        s.right = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        TreeNode&lt;K,V&gt; sp = s.parent;</span><br><span class="line">        <span class="keyword">if</span> ((p.parent = sp) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s == sp.left)</span><br><span class="line">                sp.left = p;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                sp.right = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((s.right = pr) != <span class="keyword">null</span>)</span><br><span class="line">            pr.parent = s;</span><br><span class="line">    &#125;</span><br><span class="line">    p.left = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> ((p.right = sr) != <span class="keyword">null</span>)</span><br><span class="line">        sr.parent = p;</span><br><span class="line">    <span class="keyword">if</span> ((s.left = pl) != <span class="keyword">null</span>)</span><br><span class="line">        pl.parent = s;</span><br><span class="line">    <span class="keyword">if</span> ((s.parent = pp) == <span class="keyword">null</span>)</span><br><span class="line">        root = s;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (p == pp.left)</span><br><span class="line">        pp.left = s;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pp.right = s;</span><br><span class="line">    <span class="keyword">if</span> (sr != <span class="keyword">null</span>)</span><br><span class="line">        replacement = sr;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        replacement = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (pl != <span class="keyword">null</span>)</span><br><span class="line">    replacement = pl;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (pr != <span class="keyword">null</span>)</span><br><span class="line">    replacement = pr;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    replacement = p;</span><br><span class="line"><span class="keyword">if</span> (replacement != p) &#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; pp = replacement.parent = p.parent;</span><br><span class="line">    <span class="keyword">if</span> (pp == <span class="keyword">null</span>)</span><br><span class="line">        root = replacement;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (p == pp.left)</span><br><span class="line">        pp.left = replacement;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pp.right = replacement;</span><br><span class="line">    p.left = p.right = p.parent = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœåˆ é™¤æ—¶çš„èŠ‚ç‚¹pæ˜¯çº¢è‰²ï¼Œåˆ™æ ‘å¹³è¡¡ä¸ä¼šè¢«ç ´åï¼Œæ— éœ€è°ƒæ•´ã€‚ </span></span><br><span class="line">TreeNode&lt;K,V&gt; r = p.red ? root : balanceDeletion(root, replacement);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (replacement == p) &#123;  <span class="comment">// detach</span></span><br><span class="line">    TreeNode&lt;K,V&gt; pp = p.parent;</span><br><span class="line">    p.parent = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (pp != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p == pp.left)</span><br><span class="line">            pp.left = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p == pp.right)</span><br><span class="line">            pp.right = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (movable)</span><br><span class="line">    moveRootToFront(tab, r);</span><br></pre></td></tr></table></figure><p>åˆ é™¤åçš„è°ƒæ•´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// root : æ ¹èŠ‚ç‚¹ | x : æ ¹èŠ‚ç‚¹çš„ç»§æ‰¿è€…</span></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">balanceDeletion</span><span class="params">(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (TreeNode&lt;K,V&gt; xp, xpl, xpr;;) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœxä¸ºç©ºæˆ–xä¸ºæ ¹èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span> || x == root)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        <span class="comment">// xä¸ºæ ¹èŠ‚ç‚¹ï¼ŒæŸ“æˆé»‘è‰²ï¼Œç›´æ¥è¿”å›(åˆ é™¤çš„ä¸ºæ ¹èŠ‚ç‚¹ï¼Œåˆ™æ‰¶æ¤ç»§æ‰¿è€…xä¸ºæ–°çš„æ ¹èŠ‚ç‚¹)</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((xp = x.parent) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            x.red = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// xä¸ºçº¢è‰²ï¼Œåˆ™æ— éœ€è°ƒæ•´ï¼Œç›´æ¥è¿”å›æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x.red) &#123;</span><br><span class="line">            x.red = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((xpl = xp.left) == x) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœxæœ‰çº¢è‰²å…„å¼ŸèŠ‚ç‚¹xpr, åˆ™å®ƒçš„çˆ¶èŠ‚ç‚¹xpä¸€å®šæ˜¯é»‘è‰²èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> ((xpr = xp.right) != <span class="keyword">null</span> &amp;&amp; xpr.red) &#123;</span><br><span class="line">                xpr.red = <span class="keyword">false</span>;</span><br><span class="line">                xp.red = <span class="keyword">true</span>;</span><br><span class="line">                <span class="comment">// å°†çˆ¶èŠ‚ç‚¹å·¦æ—‹</span></span><br><span class="line">                root = rotateLeft(root, xp);</span><br><span class="line">                <span class="comment">// é‡æ–°å°†xpæŒ‡å‘xçš„çˆ¶èŠ‚ç‚¹ï¼ŒxpræŒ‡å‘xpæ–°çš„å³å­©å­</span></span><br><span class="line">                xpr = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœxprä¸ºç©ºï¼Œåˆ™å‘ä¸Šç»§ç»­è°ƒæ•´ï¼Œå°†xçš„çˆ¶èŠ‚ç‚¹xpä½œä¸ºæ–°çš„xç»§ç»­å¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (xpr == <span class="keyword">null</span>)</span><br><span class="line">                x = xp;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// slå’Œsråˆ†åˆ«ä¸ºå…¶è¿‘ä¾„å­å’Œè¿œä¾„å­</span></span><br><span class="line">                TreeNode&lt;K,V&gt; sl = xpr.left, sr = xpr.right;</span><br><span class="line">                <span class="comment">// è‹¥s1å’Œs2éƒ½ä¸ºé»‘è‰²æˆ–è€…ä¸å­˜åœ¨ï¼Œå³xpræ²¡æœ‰çº¢è‰²å­©å­ï¼Œåˆ™å°†xpræŸ“çº¢</span></span><br><span class="line">                <span class="keyword">if</span> ((sr == <span class="keyword">null</span> || !sr.red) &amp;&amp; (sl == <span class="keyword">null</span> || !sl.red)) &#123;</span><br><span class="line">                    xpr.red = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="comment">// ç»§ç»­å‘ä¸Šå¾ªç¯</span></span><br><span class="line">                    x = xp;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// å³å­©å­ä¸ºç©ºæˆ–è€…ä¸ºé»‘è‰²</span></span><br><span class="line">                    <span class="keyword">if</span> (sr == <span class="keyword">null</span> || !sr.red) &#123;</span><br><span class="line">                        <span class="comment">// æœ‰å·¦å­©å­åˆ™æŸ“é»‘</span></span><br><span class="line">                        <span class="keyword">if</span> (sl != <span class="keyword">null</span>)</span><br><span class="line">                            sl.red = <span class="keyword">false</span>;</span><br><span class="line">                        <span class="comment">// å°†xpræŸ“çº¢</span></span><br><span class="line">                        xpr.red = <span class="keyword">true</span>;</span><br><span class="line">                        <span class="comment">// xprå³æ—‹</span></span><br><span class="line">                        root = rotateRight(root, xpr);</span><br><span class="line">                        <span class="comment">// å³æ—‹åxpræŒ‡å‘xpçš„æ–°å³å­©å­ï¼Œå³ä¸Šé¢çš„s1</span></span><br><span class="line">                        xpr = (xp = x.parent) == <span class="keyword">null</span> ?</span><br><span class="line">                            <span class="keyword">null</span> : xp.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xpr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// xpræŸ“æˆè·Ÿçˆ¶èŠ‚ç‚¹ä¸€è‡´çš„é¢œè‰²ï¼Œä¸ºåé¢çˆ¶èŠ‚ç‚¹xpçš„å·¦æ—‹åšå‡†å¤‡</span></span><br><span class="line">                        <span class="keyword">if</span> ((sr = xpr.right) != <span class="keyword">null</span>)</span><br><span class="line">                        xpr.red = (xp == <span class="keyword">null</span>) ? <span class="keyword">false</span> : xp.red;</span><br><span class="line">                        <span class="keyword">if</span> ((sr = xpr.right) != <span class="keyword">null</span>)</span><br><span class="line">                            <span class="comment">// xpræ–°çš„å³å­©å­æŸ“é»‘ï¼Œé˜²æ­¢å‡ºç°ä¸¤ä¸ªçº¢è‰²ç›¸è¿</span></span><br><span class="line">                            sr.red = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// å°†xpæŸ“é»‘ï¼Œå¹¶å¯¹å…¶å·¦æ—‹ï¼Œè¿™æ ·å°±èƒ½ä¿è¯è¢«åˆ é™¤çš„Xæ‰€åœ¨çš„è·¯å¾„åˆå¤šäº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œä»è€Œè¾¾åˆ°æ¢å¤å¹³è¡¡çš„ç›®çš„</span></span><br><span class="line">                        xp.red = <span class="keyword">false</span>;</span><br><span class="line">                        root = rotateLeft(root, xp);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// åˆ°æ­¤è°ƒæ•´å·²ç»å®Œæ¯•ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯åå°†ç›´æ¥é€€å‡º</span></span><br><span class="line">                    x = root;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å³å­©å­...</span></span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// symmetric</span></span><br><span class="line">            <span class="keyword">if</span> (xpl != <span class="keyword">null</span> &amp;&amp; xpl.red) &#123;</span><br><span class="line">                xpl.red = <span class="keyword">false</span>;</span><br><span class="line">                xp.red = <span class="keyword">true</span>;</span><br><span class="line">                root = rotateRight(root, xp);</span><br><span class="line">                xpl = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (xpl == <span class="keyword">null</span>)</span><br><span class="line">                x = xp;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                TreeNode&lt;K,V&gt; sl = xpl.left, sr = xpl.right;</span><br><span class="line">                <span class="keyword">if</span> ((sl == <span class="keyword">null</span> || !sl.red) &amp;&amp;</span><br><span class="line">                    (sr == <span class="keyword">null</span> || !sr.red)) &#123;</span><br><span class="line">                    xpl.red = <span class="keyword">true</span>;</span><br><span class="line">                    x = xp;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (sl == <span class="keyword">null</span> || !sl.red) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (sr != <span class="keyword">null</span>)</span><br><span class="line">                            sr.red = <span class="keyword">false</span>;</span><br><span class="line">                        xpl.red = <span class="keyword">true</span>;</span><br><span class="line">                        root = rotateLeft(root, xpl);</span><br><span class="line">                        xpl = (xp = x.parent) == <span class="keyword">null</span> ?</span><br><span class="line">                            <span class="keyword">null</span> : xp.left;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xpl != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xpl.red = (xp == <span class="keyword">null</span>) ? <span class="keyword">false</span> : xp.red;</span><br><span class="line">                        <span class="keyword">if</span> ((sl = xpl.left) != <span class="keyword">null</span>)</span><br><span class="line">                            sl.red = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xp.red = <span class="keyword">false</span>;</span><br><span class="line">                        root = rotateRight(root, xp);</span><br><span class="line">                    &#125;</span><br><span class="line">                    x = root;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å†™HashCode-æ–¹æ³•å’ŒEquals-æ–¹æ³•"><a href="#é‡å†™HashCode-æ–¹æ³•å’ŒEquals-æ–¹æ³•" class="headerlink" title="é‡å†™HashCode()æ–¹æ³•å’ŒEquals()æ–¹æ³•"></a>é‡å†™HashCode()æ–¹æ³•å’ŒEquals()æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Prediction.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Prediction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> shadow = rand.nextDouble() &gt; <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (shadow) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Six more weeks of Winner!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Early Spring"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Groundhog.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Groundhog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Groundhog</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        number = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Groundhog #"</span> + number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SpringDetector.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDetector</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ©ç”¨åå°„æœºåˆ¶è·å–æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Groundhog&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">detectSpring</span><span class="params">(Class&lt;T&gt; type)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Constructor&lt;T&gt; ghog = type.getConstructor(<span class="keyword">int</span>.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;Groundhog, Prediction&gt; map = <span class="keyword">new</span> HashMap&lt;Groundhog, Prediction&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            map.put(ghog.newInstance(i), <span class="keyword">new</span> Prediction());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"MAP"</span> + map);</span><br><span class="line"></span><br><span class="line">        Groundhog groundhog = ghog.newInstance(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Looking up prediction for"</span> + groundhog);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(groundhog)) &#123;</span><br><span class="line">            System.out.println(map.get(groundhog));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Key not found:"</span> + groundhog);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        detectSpring(Groundhog.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MAP&#123;Groundhog #1=Six more weeks of Winner!, Groundhog #4=Six more weeks of Winner!, Groundhog #5=Early Spring, Groundhog #3=Early Spring, Groundhog #8=Six more weeks of Winner!, Groundhog #7=Early Spring, Groundhog #0=Six more weeks of Winner!, Groundhog #2=Early Spring, Groundhog #9=Six more weeks of Winner!, Groundhog #6=Early Spring&#125;</span><br><span class="line">Looking up prediction forGroundhog #3</span><br><span class="line">Key not found:Groundhog #3</span><br></pre></td></tr></table></figure><p>Groundhogé»˜è®¤è°ƒç”¨çš„æ˜¯åŸºç±»Objectçš„hashCodeæ–¹æ³•ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯å¯¹è±¡çš„åœ°å€è®¡ç®—çš„æ•£åˆ—ç ã€‚åŒæ—¶åªé‡å†™hashCode()æ–¹æ³•æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦é‡å†™equals()æ–¹æ³•ã€‚</p><blockquote><p><em>è¡¥å……ä¸€å¥ï¼ŒhashCode()æ˜¯åŸºç±»Objectçš„æ–¹æ³•ï¼Œæ‰€æœ‰Javaå¯¹è±¡éƒ½èƒ½äº§ç”Ÿæ•£åˆ—ç ã€‚</em></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Groundhog2.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Groundhog2</span> <span class="keyword">extends</span> <span class="title">Groundhog</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Groundhog2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> object <span class="keyword">instanceof</span> Groundhog2 &amp;&amp; (number == ((Groundhog2)object).number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SpringDetector2.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDetector2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SpringDetector.detectSpring(Groundhog2.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MAP&#123;Groundhog #0=Six more weeks of Winner!, Groundhog #1=Six more weeks of Winner!, Groundhog #2=Early Spring, Groundhog #3=Early Spring, Groundhog #4=Six more weeks of Winner!, Groundhog #5=Early Spring, Groundhog #6=Early Spring, Groundhog #7=Early Spring, Groundhog #8=Six more weeks of Winner!, Groundhog #9=Six more weeks of Winner!&#125;</span><br><span class="line">Looking up prediction forGroundhog #3</span><br><span class="line">Early Spring</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JAVAåŸºç¡€çŸ¥è¯†-HashMap ç›¸å…³çŸ¥è¯†ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Java" scheme="https://www.leezy.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ãƒ‡ãƒ¼ã‚¿ã¨ã®çµ†</title>
    <link href="https://www.leezy.top/2019/08/15/THE_DATA_ANALYSIS/"/>
    <id>https://www.leezy.top/2019/08/15/THE_DATA_ANALYSIS/</id>
    <published>2019-08-15T11:56:02.000Z</published>
    <updated>2019-12-16T06:40:32.587Z</updated>
    
    <content type="html"><![CDATA[<p>ã‚‚ã†ä¸€å›ã‚‚ã†ä¸€å›è¡Œã“ã†ãœ åƒ•ã‚‰ã®å£°</p><p>ã‚¢ã‚¤ãƒ ã‚¢ãƒ«ãƒ¼ã‚¶ãƒ¼ ãšã£ã¨å‰ã‹ã‚‰èã“ãˆã¦ãŸ</p><a id="more"></a><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init_woody</span><br></pre></td></tr></table></figure><pre><code>Matplotlib env init complete.Warnings off.</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸çœç•¥è¡Œçš„æŸ¥çœ‹æ•°æ®</span></span><br><span class="line">pd.set_option(<span class="string">'display.max_columns'</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æºå‡†å¤‡"><a href="#æ•°æ®æºå‡†å¤‡" class="headerlink" title="æ•°æ®æºå‡†å¤‡"></a>æ•°æ®æºå‡†å¤‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥trainæ•°æ®</span></span><br><span class="line">train_idv_td = pd.read_csv(<span class="string">"../data/2/train/IDV_TD.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_TDï¼‰</span></span><br><span class="line">train_idv_dpsa = pd.read_csv(<span class="string">"../data/2/train/IDV_DPSA.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ä¸ªäººæ´»æœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_DPSAï¼‰</span></span><br><span class="line">train_loan = pd.read_csv(<span class="string">"../data/2/train/LOAN.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># è´·æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆLOANï¼‰</span></span><br><span class="line">train_bond = pd.read_csv(<span class="string">"../data/2/train/BOND.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰</span></span><br><span class="line">train_fund = pd.read_csv(<span class="string">"../data/2/train/FUND.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰</span></span><br><span class="line">train_prec_metal = pd.read_csv(<span class="string">"../data/2/train/PREC_METAL.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># è´µé‡‘å±è´¦æˆ·ä¿¡æ¯ï¼ˆPREC_METALï¼‰</span></span><br><span class="line">train_aget_insr = pd.read_csv(<span class="string">"../data/2/train/AGET_INSR.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET_INSRï¼‰</span></span><br><span class="line">train_thr_pty_cstd = pd.read_csv(<span class="string">"../data/2/train/THR_PTY_CSTD.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ç¬¬ä¸‰æ–¹å­˜ç®¡è´¦æˆ·ä¿¡æ¯ï¼ˆTHR_PTY_CSTDï¼‰</span></span><br><span class="line">train_idv_cust_basic = pd.read_csv(<span class="string">"../data/2/train/IDV_CUST_BASIC.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆIDV_CUST_BASICï¼‰</span></span><br><span class="line">train_tr_dc = pd.read_csv(<span class="string">"../data/2/train/TR_DC.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># äº¤æ˜“ä¿¡æ¯ï¼ˆTR_DCï¼‰</span></span><br><span class="line">train_base_excg = pd.read_csv(<span class="string">"../data/2/train/BASE_EXCG.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># æ±‡ç‡è¡¨ï¼ˆBASE_EXCGï¼‰</span></span><br><span class="line">train_cust_result = pd.read_csv(<span class="string">"../data/2/train/CUST_RESULT.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># å®¢æˆ·æ ‡è®°ï¼ˆCUST_RESULTï¼‰</span></span><br><span class="line"><span class="comment"># Aæ¦œ</span></span><br><span class="line"><span class="comment"># BASE_EXCG.csv æ— </span></span><br><span class="line">A_idv_td = pd.read_csv(<span class="string">"../data/2/A/IDV_TD.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_idv_dpsa = pd.read_csv(<span class="string">"../data/2/A/IDV_DPSA.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_loan = pd.read_csv(<span class="string">"../data/2/A/LOAN.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_bond = pd.read_csv(<span class="string">"../data/2/A/BOND.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_fund = pd.read_csv(<span class="string">"../data/2/A/FUND.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_prec_metal = pd.read_csv(<span class="string">"../data/2/A/PREC_METAL.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_aget_insr = pd.read_csv(<span class="string">"../data/2/A/AGET_INSR.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_thr_pty_cstd = pd.read_csv(<span class="string">"../data/2/A/THR_PTY_CSTD.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_idv_cust_basic = pd.read_csv(<span class="string">"../data/2/A/IDV_CUST_BASIC.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_tr_dc = pd.read_csv(<span class="string">"../data/2/A/TR_DC.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">A_customid = pd.read_csv(<span class="string">"../data/2/A/CUSTOMID.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment"># Bæ¦œ</span></span><br><span class="line">B_idv_td = pd.read_csv(<span class="string">"../data/2/B/IDV_TD.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_idv_dpsa = pd.read_csv(<span class="string">"../data/2/B/IDV_DPSA.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_loan = pd.read_csv(<span class="string">"../data/2/B/LOAN.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_bond = pd.read_csv(<span class="string">"../data/2/B/BOND.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_fund = pd.read_csv(<span class="string">"../data/2/B/FUND.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_prec_metal = pd.read_csv(<span class="string">"../data/2/B/PREC_METAL.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_aget_insr = pd.read_csv(<span class="string">"../data/2/B/AGET_INSR.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_thr_pty_cstd = pd.read_csv(<span class="string">"../data/2/B/THR_PTY_CSTD.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_idv_cust_basic = pd.read_csv(<span class="string">"../data/2/B/IDV_CUST_BASIC.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_tr_dc = pd.read_csv(<span class="string">"../data/2/B/TR_DC.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">B_customid = pd.read_csv(<span class="string">"../data/2/B/CUSTOMID.csv"</span>, encoding=<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2728: DtypeWarning: Columns (12) have mixed types. Specify dtype option on import or set low_memory=False.  interactivity=interactivity, compiler=compiler, result=result)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠŠæ±‡ç‡è¡¨ä¸­çš„CCY_LETE_CDå­—æ®µè½¬åŒ–ä¸ºCCY_CDå­—æ®µ</span></span><br><span class="line">train_base_excg = pd.read_csv(<span class="string">"../data/2/train/BASE_EXCG.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># æ±‡ç‡è¡¨ï¼ˆBASE_EXCGï¼‰</span></span><br><span class="line">train_base_excg[<span class="string">'CCY_CD'</span>] = train_base_excg[<span class="string">'CCY_LETE_CD'</span>]</span><br><span class="line">train_base_excg = train_base_excg.drop([<span class="string">'CCY_LETE_CD'</span>], axis=<span class="number">1</span>)</span><br><span class="line">train_base_excg[<span class="string">'RMB_MID_PRIC'</span>].apply(<span class="keyword">lambda</span> x: float(x))</span><br><span class="line"><span class="comment"># æŠŠæ±‡ç‡è¡¨ä¸­çš„CCY_LETE_CDå­—æ®µè½¬åŒ–ä¸ºCCY_CDå­—æ®µ</span></span><br><span class="line">train_tr_dc[<span class="string">'TR_DAT'</span>].apply(<span class="keyword">lambda</span> x: int(x))</span><br></pre></td></tr></table></figure><h3 id="å…¬ç”¨å‡½æ•°"><a href="#å…¬ç”¨å‡½æ•°" class="headerlink" title="å…¬ç”¨å‡½æ•°"></a>å…¬ç”¨å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‰æ±‡ç‡è®¡ç®—ä»·å€¼ï¼ˆä¼ å…¥2ä¸ªå‚æ•°è¿”å›è®¡ç®—ç»“æœï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_REAL_MONEY</span><span class="params">(train_IDV_DPSA_SAMPLE, A, B)</span>:</span></span><br><span class="line">    NEED = train_IDV_DPSA_SAMPLE[A]</span><br><span class="line">    RMB_MID_PRIC = train_IDV_DPSA_SAMPLE[B]</span><br><span class="line">    <span class="keyword">return</span> NEED * float(RMB_MID_PRIC)</span><br><span class="line"></span><br><span class="line"><span class="comment"># one-hot å¤„ç†å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°è¯„ä»·</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate</span><span class="params">(test_y, y_pred)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics</span><br><span class="line">    test_pct_1 = test_y.sum()/test_y.shape[<span class="number">0</span>]</span><br><span class="line">    pred_pct_1 = y_pred.sum()/y_pred.shape[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    roc_auc = metrics.roc_auc_score(test_y,y_pred)</span><br><span class="line">    acc = metrics.accuracy_score(test_y,y_pred)</span><br><span class="line">    Recall = metrics.recall_score(test_y,y_pred)</span><br><span class="line">    F1 = metrics.f1_score(test_y,y_pred)</span><br><span class="line">    Precision = metrics.precision_score(test_y,y_pred)</span><br><span class="line">    Confusion = metrics.confusion_matrix(test_y,y_pred)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'test_pct_1: %.4f'</span> %  test_pct_1)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'pred_pct_1: %.4f'</span> %  pred_pct_1)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'Precesion: %.4f'</span> % Precision)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'Recall: %.4f'</span> %  Recall)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'F1-score: %.4f'</span> % F1)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'confusion matrix:'</span>)</span><br><span class="line">    <span class="keyword">print</span> (metrics.confusion_matrix(test_y,y_pred))</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'test_pct_1'</span>:test_pct_1,<span class="string">'pred_pct_1'</span>:pred_pct_1,<span class="string">'roc_auc'</span>:roc_auc,<span class="string">'acc'</span>:acc,<span class="string">'recall'</span>:Recall,<span class="string">'F1'</span>:F1,<span class="string">'Precision'</span>:Precision,<span class="string">'Confusuion'</span>:Confusion&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">feature_rank</span><span class="params">(model,num)</span>:</span></span><br><span class="line">    <span class="comment">##è®¡ç®—ç‰¹å¾å¾—åˆ†</span></span><br><span class="line">    feature_score = model.get_fscore()</span><br><span class="line">    df_feature_score = pd.DataFrame(&#123;<span class="string">"feature_name"</span>:list(feature_score.keys()),<span class="string">"feature_score"</span>:list(feature_score.values())&#125;)</span><br><span class="line">    df_feature_score_sort = df_feature_score.sort_values(ascending=<span class="number">0</span>,by=[<span class="string">'feature_score'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">#result_name = "feature_score_1_A_%s_%s_%s_%6f.csv"%(time_str,feature_num,train_steps,F1_score)</span></span><br><span class="line">    <span class="comment">#result_name_full = datas_dir_e + "out/" + result_name</span></span><br><span class="line">    <span class="comment">#df_feature_score_sort.to_csv(result_name_full,index=None)</span></span><br><span class="line">    <span class="keyword">return</span> df_feature_score_sort.head(num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stat_df</span><span class="params">(df)</span>:</span></span><br><span class="line">    stats = []</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">        stats.append((col, df[col].nunique(),df[col].isnull().sum()*<span class="number">100</span>/df.shape[<span class="number">0</span>],</span><br><span class="line">                     df[col].value_counts(normalize=<span class="keyword">True</span>,dropna=<span class="keyword">False</span>).values[<span class="number">0</span>]*<span class="number">100</span>,df[col].dtype))</span><br><span class="line">    stats_df = pd.DataFrame(stats, columns=[<span class="string">'ç‰¹å¾'</span>,<span class="string">'å”¯ä¸€æ•°æ•°é‡'</span>,<span class="string">'ç¼ºå¤±å€¼å æ¯”'</span>,<span class="string">'æœ€å¤šæ•°å æ¯”'</span>,<span class="string">'ç±»å‹'</span>])</span><br><span class="line">    stats_df.sort_values(<span class="string">'ç¼ºå¤±å€¼å æ¯”'</span>,ascending=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">return</span> stats_df</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_feature_distribution</span><span class="params">(df1,df2,label1,label2,features,width=<span class="number">6</span>,height=<span class="number">6</span>)</span>:</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    sns.set_style(<span class="string">'whitegrid'</span>)</span><br><span class="line">    plt.figure()</span><br><span class="line">    fig,ax = plt.subplots(width,height,figsize=(<span class="number">20</span>,<span class="number">12</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> feature <span class="keyword">in</span> features:</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">        plt.subplot(width,height,i)</span><br><span class="line">        sns.kdeplot(df1[feature],bw=<span class="number">0.5</span>,label=label1)</span><br><span class="line">        sns.kdeplot(df2[feature],bw=<span class="number">0.5</span>,label=label2)</span><br><span class="line">        plt.xlabel(feature,fontsize=<span class="number">9</span>)</span><br><span class="line">        locs, labels = plt.xticks()</span><br><span class="line">        plt.tick_params(axis=<span class="string">'x'</span>,which=<span class="string">'major'</span>,labelsize=<span class="number">6</span>,pad=<span class="number">-6</span>)</span><br><span class="line">        plt.tick_params(axis=<span class="string">'y'</span>,which=<span class="string">'major'</span>,labelsize=<span class="number">6</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure><h3 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h3><h4 id="ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨-IDV-CUST-BASIC-å¤„ç†"><a href="#ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨-IDV-CUST-BASIC-å¤„ç†" class="headerlink" title="ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨(IDV_CUST_BASIC) - å¤„ç†"></a>ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨(IDV_CUST_BASIC) - å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ²¡ç”¨çš„å­—æ®µ</span></span><br><span class="line">train_idv_cust_basic_SAMPLE = train_idv_cust_basic.drop([<span class="string">'DATA_DAT'</span>, <span class="string">'PROV_CD'</span>, <span class="string">'CUST_SEX_CD'</span>, <span class="string">'RES_CD'</span>, <span class="string">'RES_STA_CD'</span>, <span class="string">'NATY_CD'</span>,</span><br><span class="line">       <span class="string">'NATN_CD'</span>, <span class="string">'CULT_DGR_CD'</span>, <span class="string">'DGR_CD'</span>, <span class="string">'PLC_STS_CD'</span>, <span class="string">'PRFN'</span>, <span class="string">'ADMI_POS_CD'</span>,</span><br><span class="line">       <span class="string">'SPEC_TECH_PRFN_QUA_CD'</span>, <span class="string">'TITLE_RANK_CD'</span>, <span class="string">'WORK_TYP_CD'</span>, <span class="string">'GC_BRTH'</span>,</span><br><span class="line">       <span class="string">'UNIT_PROP_CD'</span>, <span class="string">'WORK_YEAR'</span>, <span class="string">'OCP_CD'</span>], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># å°†ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨ä¸ç»“æœæ•´åˆ</span></span><br><span class="line">train_idv_cust_basic_SAMPLE = pd.merge(train_idv_cust_basic_SAMPLE, train_cust_result, on=<span class="string">'CUST_NO'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">features = [x <span class="keyword">for</span> x <span class="keyword">in</span> train_idv_cust_basic_SAMPLE.columns <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'CUST_NO'</span>,<span class="string">'FLAG'</span>]]</span><br><span class="line">df0 = train_idv_cust_basic_SAMPLE[train_idv_cust_basic_SAMPLE.FLAG==<span class="number">0</span>]</span><br><span class="line">df1 = train_idv_cust_basic_SAMPLE[train_idv_cust_basic_SAMPLE.FLAG==<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">plot_feature_distribution(df0,df1,<span class="string">'0'</span>,<span class="string">'1'</span>,features,<span class="number">2</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/statsmodels/nonparametric/kde.py:454: RuntimeWarning: invalid value encountered in greater  X = X[np.logical_and(X&gt;clip[0], X&lt;clip[1])] # won&apos;t work for two columns./root/anaconda3/lib/python3.6/site-packages/statsmodels/nonparametric/kde.py:454: RuntimeWarning: invalid value encountered in less  X = X[np.logical_and(X&gt;clip[0], X&lt;clip[1])] # won&apos;t work for two columns.&lt;matplotlib.figure.Figure at 0x7f0167e93dd8&gt;</code></pre><p><img src="/assets/blogImg/OUTPUT_FEATURE.png" alt="FEATURE"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å£°æ˜å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IDV_CUST_BASIC_PARSE</span><span class="params">(dataset_IDV_CUST_BASIC)</span>:</span></span><br><span class="line">    <span class="comment"># åˆ é™¤ä¸ªäººç”¨æˆ·ä¿¡æ¯è¡¨ä¸­æ— å…³å…ƒç´ </span></span><br><span class="line">    dataset_IDV_CUST_BASIC = dataset_IDV_CUST_BASIC.drop([<span class="string">'DATA_DAT'</span>, <span class="string">'PROV_CD'</span>, <span class="string">'CUST_SEX_CD'</span>, <span class="string">'RES_CD'</span>, <span class="string">'RES_STA_CD'</span>, <span class="string">'NATY_CD'</span>,</span><br><span class="line">       <span class="string">'NATN_CD'</span>, <span class="string">'CULT_DGR_CD'</span>, <span class="string">'DGR_CD'</span>, <span class="string">'PLC_STS_CD'</span>, <span class="string">'PRFN'</span>, <span class="string">'ADMI_POS_CD'</span>,</span><br><span class="line">       <span class="string">'SPEC_TECH_PRFN_QUA_CD'</span>, <span class="string">'TITLE_RANK_CD'</span>, <span class="string">'WORK_TYP_CD'</span>, <span class="string">'GC_BRTH'</span>,</span><br><span class="line">       <span class="string">'UNIT_PROP_CD'</span>, <span class="string">'WORK_YEAR'</span>, <span class="string">'OCP_CD'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> dataset_IDV_CUST_BASIC</span><br></pre></td></tr></table></figure><h4 id="ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV-TDï¼‰-å¤„ç†"><a href="#ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV-TDï¼‰-å¤„ç†" class="headerlink" title="ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_TDï¼‰- å¤„ç†"></a>ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_TDï¼‰- å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®æ¯”ä¾‹</span></span><br><span class="line">stat_df(train_idv_td)</span><br></pre></td></tr></table></figure><p><img src="/assets/blogImg/OUTPUT_CUST_INFO.png" alt="å®¢æˆ·è¡¨ä¿¡æ¯æƒ…å†µ"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–æˆå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IDV_TD_PARSE</span><span class="params">(dataset_IDV_TD)</span>:</span></span><br><span class="line">    train_idv_td_3 = dataset_IDV_TD[dataset_IDV_TD[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">    <span class="comment"># ç®€åŒ–IDV_TDè¡¨</span></span><br><span class="line">    train_idv_td_3 = train_idv_td_3.drop([<span class="string">'DATA_DAT'</span>, <span class="string">'ARG_CRT_DAT'</span>, <span class="string">'DATA_DAT'</span>, <span class="string">'CLS_ACCT_DAT'</span>, <span class="string">'MATU_DAT'</span>, <span class="string">'LAC'</span>, <span class="string">'ACCT_STS_CD'</span>,<span class="string">'DP_DAY_CD'</span>, <span class="string">'RDEP_IND_CD'</span>, <span class="string">'RDEP_DP_DAY_CD'</span>, <span class="string">'RAT_CTG'</span>,<span class="string">'FXDI_SA_ACCM'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å»é‡</span></span><br><span class="line">    train_idv_td_3.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># å°†train_idv_tdå’Œtrain_base_excgåˆå¹¶</span></span><br><span class="line">    train_IDV_TD_SAMPLE_3 = pd.merge(train_idv_td_3, train_base_excg, on = <span class="string">'CCY_CD'</span>)</span><br><span class="line">    <span class="comment"># æ‰§è¡Œæ±‡ç‡è®¡ç®—å‡½æ•°</span></span><br><span class="line">    train_IDV_TD_SAMPLE_3[<span class="string">'CRBAL'</span>] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'CRBAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_TD_SAMPLE_3[<span class="string">'REG_CAP'</span>] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'REG_CAP'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_TD_SAMPLE_3[<span class="string">'FXDI_T_ACCM'</span>] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'FXDI_T_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_TD_SAMPLE_3[<span class="string">'TDOP_SHD_PAY_INTS'</span>] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'TDOP_SHD_PAY_INTS'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_TD_SAMPLE_3[<span class="string">'MOTH_CR_ACCM'</span>] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'MOTH_CR_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_TD_SAMPLE_3[<span class="string">'IDV_TD_SUM'</span>] = train_IDV_TD_SAMPLE_3[<span class="string">'TDOP_SHD_PAY_INTS'</span>] +  train_IDV_TD_SAMPLE_3[<span class="string">'REG_CAP'</span>]</span><br><span class="line">    <span class="comment"># å†æ¬¡ç²¾ç®€è¡¨</span></span><br><span class="line">    train_IDV_TD_SAMPLE_3 = train_IDV_TD_SAMPLE_3.drop([<span class="string">'CCY_CD'</span>, <span class="string">'RMB_MID_PRIC'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æ•°æ®å»é‡</span></span><br><span class="line">    train_IDV_TD_SAMPLE_3.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># å°†ä¸ªäººè´¦æˆ·é‡Œçš„æ•°æ®åˆå¹¶å³é‡‘é¢åŠ èµ·æ¥</span></span><br><span class="line">    train_IDV_TD_SAMPLE_SUM_3 = train_IDV_TD_SAMPLE_3[[<span class="string">'CUST_NO'</span>, <span class="string">'CRBAL'</span>, <span class="string">'REG_CAP'</span>, <span class="string">'FXDI_T_ACCM'</span>, <span class="string">'TDOP_SHD_PAY_INTS'</span>, <span class="string">'MOTH_CR_ACCM'</span>, <span class="string">'IDV_TD_SUM'</span>]].groupby(<span class="string">'CUST_NO'</span>).sum().reset_index()</span><br><span class="line">    <span class="comment"># åŒºåˆ†å­—æ®µ</span></span><br><span class="line">    train_IDV_TD_SAMPLE_SUM_3 = train_IDV_TD_SAMPLE_SUM_3.rename(columns=&#123;<span class="string">'CRBAL'</span>:<span class="string">'IDV_TD_CRBAL'</span>, <span class="string">'MOTH_CR_ACCM'</span>:<span class="string">'IDV_TD_MOTH_CR_ACCM'</span>&#125;)</span><br><span class="line">    <span class="comment"># @ å»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾</span></span><br><span class="line">    train_IDV_TD_SAMPLE_SUM_3 = train_IDV_TD_SAMPLE_SUM_3.drop([<span class="string">'TDOP_SHD_PAY_INTS'</span>, <span class="string">'REG_CAP'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># è¿”å›ç¬¬ä¸‰ä¸ªæ—¶é—´æ®µçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> train_IDV_TD_SAMPLE_SUM_3</span><br></pre></td></tr></table></figure><h4 id="ä¸ªäººæ´»æœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV-DPSAï¼‰-å¤„ç†"><a href="#ä¸ªäººæ´»æœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV-DPSAï¼‰-å¤„ç†" class="headerlink" title="ä¸ªäººæ´»æœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_DPSAï¼‰-  å¤„ç†"></a>ä¸ªäººæ´»æœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_DPSAï¼‰-  å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–æˆå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IDV_DPSA_PARSE</span><span class="params">(dataset_IDV_DPSA)</span>:</span></span><br><span class="line">    <span class="comment"># åˆ’åˆ†ä¸‰å¼ è¡¨</span></span><br><span class="line">    train_idv_dpsa_1 = dataset_IDV_DPSA[dataset_IDV_DPSA[<span class="string">'DATA_DAT'</span>]==<span class="number">3728764800</span>].reset_index()</span><br><span class="line">    train_idv_dpsa_2 = dataset_IDV_DPSA[dataset_IDV_DPSA[<span class="string">'DATA_DAT'</span>]==<span class="number">3731443200</span>].reset_index()</span><br><span class="line">    train_idv_dpsa_3 = dataset_IDV_DPSA[dataset_IDV_DPSA[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>].reset_index()</span><br><span class="line">    <span class="comment"># ç²¾ç®€å­—æ®µ</span></span><br><span class="line">    train_idv_dpsa_3 = train_idv_dpsa_3.drop([<span class="string">'DATA_DAT'</span>, <span class="string">'ARG_CRT_DAT'</span>, <span class="string">'CLS_ACCT_DAT'</span>, <span class="string">'MATU_DAT'</span>, <span class="string">'LAC'</span>, <span class="string">'ACCT_STS_CD'</span>, <span class="string">'RAT_CTG'</span>, <span class="string">'CUST_RANK_CD'</span>, <span class="string">'DAY_TFO_SUM'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å°†IDV_DPSAè¡¨ä¸æ±‡ç‡è¡¨æ•´åˆ</span></span><br><span class="line">    train_IDV_DPSA_SAMPLE_3 = pd.merge(train_idv_dpsa_3, train_base_excg, on = <span class="string">'CCY_CD'</span>)</span><br><span class="line">    <span class="comment"># å»é‡</span></span><br><span class="line">    train_IDV_DPSA_SAMPLE_3.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># æ‰§è¡Œæ±‡ç‡è®¡ç®—å‡½æ•°</span></span><br><span class="line">    train_IDV_DPSA_SAMPLE_3[<span class="string">'FRZ_TOT_AMT'</span>] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'FRZ_TOT_AMT'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_DPSA_SAMPLE_3[<span class="string">'DAY_WD_ACT_AMT'</span>] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_WD_ACT_AMT'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_DPSA_SAMPLE_3[<span class="string">'DAY_CSH_DP_SUM'</span>] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_CSH_DP_SUM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_DPSA_SAMPLE_3[<span class="string">'DAY_CSH_WD_SUM'</span>] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_CSH_WD_SUM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_DPSA_SAMPLE_3[<span class="string">'DAY_TFI_SUM'</span>] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_TFI_SUM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_DPSA_SAMPLE_3[<span class="string">'MOTH_CR_ACCM'</span>] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'MOTH_CR_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_IDV_DPSA_SAMPLE_3[<span class="string">'BEG_MOTH_CRBAL'</span>] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'BEG_MOTH_CRBAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    <span class="comment"># å†æ¬¡ç²¾ç®€è¡¨</span></span><br><span class="line">    train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3.drop([<span class="string">'CCY_CD'</span>, <span class="string">'RMB_MID_PRIC'</span>, <span class="string">'index'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># é¿å…é‡å¤å­—æ®µ</span></span><br><span class="line">    train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3.rename(columns=&#123;<span class="string">'CRBAL'</span>:<span class="string">'IDV_DPSA_CRBAL'</span>, <span class="string">'MOTH_CR_ACCM'</span>:<span class="string">'IDV_DPSA_MOTH_CR_ACCM'</span>&#125;)</span><br><span class="line">    <span class="comment"># æŒ‰ CUST_NO æ±‚å’Œ</span></span><br><span class="line">    train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3[[<span class="string">'CUST_NO'</span>, <span class="string">'IDV_DPSA_CRBAL'</span>, <span class="string">'ITST_BRNG_ACCM'</span>, <span class="string">'FRZ_TOT_AMT'</span>, <span class="string">'DAY_WD_ACT_AMT'</span>, <span class="string">'DAY_CSH_DP_SUM'</span>,</span><br><span class="line">                                                 <span class="string">'DAY_CSH_WD_SUM'</span>, <span class="string">'DAY_TFI_SUM'</span>, <span class="string">'IDV_DPSA_MOTH_CR_ACCM'</span>, <span class="string">'BEG_MOTH_CRBAL'</span>]].groupby(<span class="string">'CUST_NO'</span>).sum().reset_index()</span><br><span class="line">    <span class="comment"># @ å»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾</span></span><br><span class="line">    train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3.drop([<span class="string">'BEG_MOTH_CRBAL'</span>, <span class="string">'IDV_DPSA_MOTH_CR_ACCM'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¿”å›ç¬¬ä¸‰ä¸ªæ—¶é—´æ®µçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> train_IDV_DPSA_SAMPLE_3</span><br></pre></td></tr></table></figure><h4 id="äº¤æ˜“ä¿¡æ¯ï¼ˆTR-DCï¼‰-å¤„ç†"><a href="#äº¤æ˜“ä¿¡æ¯ï¼ˆTR-DCï¼‰-å¤„ç†" class="headerlink" title="äº¤æ˜“ä¿¡æ¯ï¼ˆTR_DCï¼‰ - å¤„ç†"></a>äº¤æ˜“ä¿¡æ¯ï¼ˆTR_DCï¼‰ - å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train_tr_dc_TR_TYPE = train_tr_dc.groupby([<span class="string">'CUST_NO'</span>,<span class="string">'TR_TYPE'</span>])[<span class="string">'TR_TYPE'</span>].count().unstack().reset_index()</span><br><span class="line">train_tr_dc_TR_TYPE[<span class="string">'TR_TYPE_TIMES'</span>] = train_tr_dc_TR_TYPE.drop(<span class="string">'CUST_NO'</span>,axis=<span class="number">1</span>).sum(axis=<span class="number">1</span>)</span><br><span class="line">train_tr_dc_BOE = train_tr_dc_TR_TYPE[[<span class="string">'CUST_NO'</span>,<span class="string">'TR_TYPE_TIMES'</span>,<span class="string">'EBMKO5RA'</span>]]</span><br><span class="line">train_tr_dc_BOE.columns = [<span class="string">'CUST_NO'</span>, <span class="string">'TR_TYPE_TIMES'</span>,<span class="string">'EBMKO5RA'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_tr_dc_BOE.head()</span><br></pre></td></tr></table></figure><p><img src="/assets/blogImg/OUTPUT_BOEING.png" alt="BOEING"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å£°æ˜å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">TR_DC_PARSE</span><span class="params">(dataset_TR_DC)</span>:</span></span><br><span class="line">    <span class="comment"># å»é™¤æŠ¹å¸(1),æ— æ„ä¹‰åˆ—- RED_BLU_CDï¼Œè¿™é‡Œå…¨æ˜¯0</span></span><br><span class="line">    dataset_TR_DC = dataset_TR_DC[dataset_TR_DC[<span class="string">'CAN_IND'</span>]==<span class="number">0</span>].drop([<span class="string">'RED_BLU_CD'</span>],axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å°†äº¤æ˜“æŒ‰ç…§ æ­£ / è´Ÿ åˆ†å¼€</span></span><br><span class="line">    dataset_TR_DC[<span class="string">'INCOME'</span>] = dataset_TR_DC[<span class="string">'TR_AMT'</span>] &gt; <span class="number">0</span></span><br><span class="line">    myseries = dataset_TR_DC.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'INCOME'</span>])[<span class="string">'TR_AMT'</span>].sum()</span><br><span class="line">    myseries = myseries.unstack()</span><br><span class="line">    TR_DC_IN_OUT = pd.DataFrame(myseries).reset_index()</span><br><span class="line">    TR_DC_IN_OUT[<span class="string">'IN_SUM'</span>] = TR_DC_IN_OUT[<span class="keyword">True</span>]</span><br><span class="line">    TR_DC_IN_OUT[<span class="string">'OUT_SUM'</span>] = TR_DC_IN_OUT[<span class="keyword">False</span>]</span><br><span class="line">    TR_DC_IN_OUT = TR_DC_IN_OUT.drop([<span class="keyword">True</span>, <span class="keyword">False</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æ ¹æ®BOEäº¤æ˜“ä»£ç åˆ’åˆ† ä»…ä½¿ç”¨ EBMKO5RA</span></span><br><span class="line">    train_tr_dc_TR_TYPE = dataset_TR_DC.groupby([<span class="string">'CUST_NO'</span>,<span class="string">'TR_TYPE'</span>])[<span class="string">'TR_TYPE'</span>].count().unstack().reset_index()</span><br><span class="line">    train_tr_dc_TR_TYPE[<span class="string">'TR_TYPE_TIMES'</span>] = train_tr_dc_TR_TYPE.drop(<span class="string">'CUST_NO'</span>,axis=<span class="number">1</span>).sum(axis=<span class="number">1</span>)</span><br><span class="line">    train_tr_dc_BOE = train_tr_dc_TR_TYPE[[<span class="string">'CUST_NO'</span>,<span class="string">'TR_TYPE_TIMES'</span>,<span class="string">'EBMKO5RA'</span>]]</span><br><span class="line">    train_tr_dc_BOE.columns = [<span class="string">'CUST_NO'</span>, <span class="string">'TR_TYPE_TIMES'</span>,<span class="string">'EBMKO5RA'</span>]</span><br><span class="line">    <span class="comment"># æ ¹æ®SVRTOäº¤æ˜“ç åˆ’åˆ† ä½¿ç”¨SVRTO061å’ŒSVRTO161</span></span><br><span class="line">    train_tr_dc_SVRTO061 = train_tr_dc_TR_TYPE[[<span class="string">'CUST_NO'</span>,<span class="string">'SVRTO061'</span>]]</span><br><span class="line">    train_tr_dc_SVRTO161 = train_tr_dc_TR_TYPE[[<span class="string">'CUST_NO'</span>,<span class="string">'SVRTO161'</span>]]</span><br><span class="line">    train_tr_dc_SVRTO061.columns = [<span class="string">'CUST_NO'</span>, <span class="string">'SVRTO061'</span>]</span><br><span class="line">    train_tr_dc_SVRTO161.columns = [<span class="string">'CUST_NO'</span>, <span class="string">'SVRTO161'</span>]</span><br><span class="line">    <span class="comment"># è®¡ç®—æ¯ç¬”äº¤æ˜“é‡‘é¢çš„å‡å€¼</span></span><br><span class="line">    TR_DC_IN_MEAN = dataset_TR_DC[dataset_TR_DC[<span class="string">'TR_AMT'</span>]&gt;<span class="number">0</span>][[<span class="string">'CUST_NO'</span>, <span class="string">'TR_AMT'</span>]].groupby(<span class="string">'CUST_NO'</span>).mean().reset_index()</span><br><span class="line">    TR_DC_IN_MEAN.columns = [<span class="string">'CUST_NO'</span>, <span class="string">'TR_DC_IN_MEAN'</span>]</span><br><span class="line">    TR_DC_OUT_MEAN = dataset_TR_DC[dataset_TR_DC[<span class="string">'TR_AMT'</span>]&lt;<span class="number">0</span>][[<span class="string">'CUST_NO'</span>, <span class="string">'TR_AMT'</span>]].groupby(<span class="string">'CUST_NO'</span>).mean().reset_index()</span><br><span class="line">    TR_DC_OUT_MEAN.columns = [<span class="string">'CUST_NO'</span>, <span class="string">'TR_DC_OUT_MEAN'</span>]</span><br><span class="line">    <span class="comment"># åˆå¹¶å„ä¸ªç‰¹å¾ 36041</span></span><br><span class="line">    <span class="comment"># train_TR_DC_SAMPLE = pd.merge(TR_DC_IN_OUT, train_tr_dc_BOE, on='CUST_NO', how='outer')</span></span><br><span class="line">    train_TR_DC_SAMPLE = pd.merge(TR_DC_IN_OUT, TR_DC_IN_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    train_TR_DC_SAMPLE = pd.merge(train_TR_DC_SAMPLE, TR_DC_OUT_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    <span class="comment"># train_TR_DC_SAMPLE = pd.merge(train_TR_DC_SAMPLE, train_tr_dc_SVRTO061, on='CUST_NO', how='outer')</span></span><br><span class="line">    <span class="comment"># train_TR_DC_SAMPLE = pd.merge(train_TR_DC_SAMPLE, train_tr_dc_SVRTO161, on='CUST_NO', how='outer')</span></span><br><span class="line">    <span class="keyword">return</span> train_TR_DC_SAMPLE</span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸‰æ–¹å­˜ç®¡è´¦æˆ·ä¿¡æ¯ï¼ˆTHR-PTY-CSTDï¼‰-å¤„ç†"><a href="#ç¬¬ä¸‰æ–¹å­˜ç®¡è´¦æˆ·ä¿¡æ¯ï¼ˆTHR-PTY-CSTDï¼‰-å¤„ç†" class="headerlink" title="ç¬¬ä¸‰æ–¹å­˜ç®¡è´¦æˆ·ä¿¡æ¯ï¼ˆTHR_PTY_CSTDï¼‰ - å¤„ç†"></a>ç¬¬ä¸‰æ–¹å­˜ç®¡è´¦æˆ·ä¿¡æ¯ï¼ˆTHR_PTY_CSTDï¼‰ - å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æå‰åˆ æ‰æ— ç”¨å­—æ®µ</span></span><br><span class="line">train_thr_pty_cstd_temple = train_thr_pty_cstd.drop([<span class="string">'CCY_CD'</span>, <span class="string">'CUST_CTG_CD'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># åˆ’åˆ†ä¸‰å¼ è¡¨</span></span><br><span class="line">train_thr_pty_cstd_1 = train_thr_pty_cstd_temple[train_thr_pty_cstd_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3728764800</span>].reset_index()</span><br><span class="line">train_thr_pty_cstd_2 = train_thr_pty_cstd_temple[train_thr_pty_cstd_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3731443200</span>].reset_index()</span><br><span class="line">train_thr_pty_cstd_3 = train_thr_pty_cstd_temple[train_thr_pty_cstd_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>].reset_index()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¸…ç†æ²¡ç”¨å­—æ®µ</span></span><br><span class="line">train_thr_pty_cstd_3 = train_thr_pty_cstd_3.drop([<span class="string">'index'</span>, <span class="string">'DATA_DAT'</span>], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># å¯¹å­—æ®µè¿›è¡Œå¤„ç†</span></span><br><span class="line">ARG_BAL = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'ARG_BAL'</span>].sum().reset_index()</span><br><span class="line">AVL_BAL = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'AVL_BAL'</span>].sum().reset_index()</span><br><span class="line">MTH_ARG_BAL_ACCM = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'MTH_ARG_BAL_ACCM'</span>].sum().reset_index()</span><br><span class="line">MTH_FUD_TF_INWD_AMT = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'MTH_FUD_TF_INWD_AMT'</span>].sum().reset_index()</span><br><span class="line">MTH_FUD_TF_OUT_AMT = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'MTH_FUD_TF_OUT_AMT'</span>].sum().reset_index()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å­—æ®µåˆå¹¶</span></span><br><span class="line">train_thr_pty_cstd_SAMPLE = pd.merge(ARG_BAL, AVL_BAL, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_ARG_BAL_ACCM, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_INWD_AMT, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_OUT_AMT, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @ å»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾</span></span><br><span class="line">train_thr_pty_cstd_SAMPLE = train_thr_pty_cstd_SAMPLE.drop([<span class="string">'ARG_BAL'</span>, <span class="string">'MTH_ARG_BAL_ACCM'</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å£°æ˜å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">THR_PTY_CSTD_PARSE</span><span class="params">(dataset_THR_PTY_CSTD)</span>:</span></span><br><span class="line">    <span class="comment"># æå‰åˆ æ‰æ— ç”¨å­—æ®µ</span></span><br><span class="line">    dataset_THR_PTY_CSTD = dataset_THR_PTY_CSTD.drop([<span class="string">'CCY_CD'</span>, <span class="string">'CUST_CTG_CD'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># åˆ’åˆ†ä¸‰å¼ è¡¨</span></span><br><span class="line">    train_thr_pty_cstd_1 = dataset_THR_PTY_CSTD[dataset_THR_PTY_CSTD[<span class="string">'DATA_DAT'</span>]==<span class="number">3728764800</span>].reset_index()</span><br><span class="line">    train_thr_pty_cstd_2 = dataset_THR_PTY_CSTD[dataset_THR_PTY_CSTD[<span class="string">'DATA_DAT'</span>]==<span class="number">3731443200</span>].reset_index()</span><br><span class="line">    train_thr_pty_cstd_3 = dataset_THR_PTY_CSTD[dataset_THR_PTY_CSTD[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>].reset_index()</span><br><span class="line">    <span class="comment"># æ¸…ç†æ²¡ç”¨å­—æ®µ</span></span><br><span class="line">    train_thr_pty_cstd_3 = train_thr_pty_cstd_3.drop([<span class="string">'index'</span>, <span class="string">'DATA_DAT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å¯¹å­—æ®µè¿›è¡Œå¤„ç†</span></span><br><span class="line">    ARG_BAL = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'ARG_BAL'</span>].sum().reset_index()</span><br><span class="line">    AVL_BAL = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'AVL_BAL'</span>].sum().reset_index()</span><br><span class="line">    MTH_ARG_BAL_ACCM = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'MTH_ARG_BAL_ACCM'</span>].sum().reset_index()</span><br><span class="line">    MTH_FUD_TF_INWD_AMT = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'MTH_FUD_TF_INWD_AMT'</span>].sum().reset_index()</span><br><span class="line">    MTH_FUD_TF_OUT_AMT = train_thr_pty_cstd_3.groupby([<span class="string">'CUST_NO'</span>])[<span class="string">'MTH_FUD_TF_OUT_AMT'</span>].sum().reset_index()</span><br><span class="line">    <span class="comment"># å°†å­—æ®µåˆå¹¶</span></span><br><span class="line">    train_thr_pty_cstd_SAMPLE = pd.merge(AVL_BAL, ARG_BAL, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_ARG_BAL_ACCM, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_INWD_AMT, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_OUT_AMT, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    <span class="comment"># @ å»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾</span></span><br><span class="line">    train_thr_pty_cstd_SAMPLE = train_thr_pty_cstd_SAMPLE.drop([<span class="string">'ARG_BAL'</span>, <span class="string">'MTH_ARG_BAL_ACCM'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> train_thr_pty_cstd_SAMPLE</span><br></pre></td></tr></table></figure><h4 id="è´·æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆLOANï¼‰-å¤„ç†"><a href="#è´·æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆLOANï¼‰-å¤„ç†" class="headerlink" title="è´·æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆLOANï¼‰- å¤„ç†"></a>è´·æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆLOANï¼‰- å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€‰æ‹©æœ‰ç”¨å­—æ®µ</span></span><br><span class="line">train_loan_temple = train_loan[[<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>, <span class="string">'ARG_TYP_CD'</span>, <span class="string">'CCY_CD'</span>, <span class="string">'ARG_LIF_CYC_STA_CD'</span>, <span class="string">'LN_STS_CD'</span>, <span class="string">'CHANL_CD'</span>, <span class="string">'LN_TERM'</span>, <span class="string">'RPAY_MOD_CD'</span>, <span class="string">'LAC'</span>, <span class="string">'NON_MATU_CAP'</span>, <span class="string">'ACD_NML_INTS'</span>, <span class="string">'INTS_TOT_AMT'</span></span><br><span class="line">                        , <span class="string">'BUS_BREED_CD'</span>, <span class="string">'NML_CAP_BAL'</span>, <span class="string">'MTH_NML_CAP_ACCM'</span>]]</span><br><span class="line">train_loan_temple =  pd.merge(train_loan_temple, train_base_excg, on = <span class="string">'CCY_CD'</span>)</span><br><span class="line"><span class="comment"># åˆ’åˆ†ä¸‰å¼ è¡¨</span></span><br><span class="line">train_loan_1 = train_loan_temple[train_loan_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3728764800</span>]</span><br><span class="line">train_loan_2 = train_loan_temple[train_loan_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3731443200</span>]</span><br><span class="line">train_loan_3 = train_loan_temple[train_loan_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">train_loan_3 = train_loan_3.drop([<span class="string">'DATA_DAT'</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_loan_3.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œæ±‡ç‡è®¡ç®—å‡½æ•°</span></span><br><span class="line">train_loan_3[<span class="string">'ACD_NML_INTS'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'ACD_NML_INTS'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">train_loan_3[<span class="string">'NON_MATU_CAP'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'NON_MATU_CAP'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">train_loan_3[<span class="string">'NML_CAP_BAL'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'NML_CAP_BAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">train_loan_3[<span class="string">'INTS_TOT_AMT'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'INTS_TOT_AMT'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">train_loan_3[<span class="string">'MTH_NML_CAP_ACCM'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'MTH_NML_CAP_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¹³å‡åº”è®¡æ­£å¸¸åˆ©æ¯</span></span><br><span class="line">MEAN_ACD_NML_INTS = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'ACD_NML_INTS'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line"><span class="comment"># å¹³å‡åº”è®¡æœªåˆ°æœŸæœ¬é‡‘</span></span><br><span class="line">MEAN_NON_MATU_CAP = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'NON_MATU_CAP'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line"><span class="comment"># å¹³å‡æœˆå†…æ­£å¸¸æœ¬é‡‘åŸºæ•°</span></span><br><span class="line">MEAN_MTH_NML_CAP_ACCM = train_loan_3[[<span class="string">'CUST_NO'</span>,<span class="string">'MTH_NML_CAP_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line"><span class="comment"># å¹³å‡è´·æ¬¾æœŸé™</span></span><br><span class="line">MEAN_LOAN_TERM = train_loan_3[[<span class="string">'CUST_NO'</span>,<span class="string">'LN_TERM'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line"><span class="comment"># å¹³å‡è´·æ¬¾é‡‘é¢</span></span><br><span class="line">MEAN_NML_CAP_BAL = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'NML_CAP_BAL'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line"><span class="comment"># å¹³å‡åˆ©æ¯æ€»é¢</span></span><br><span class="line">MEAN_INTS_TOT_AMT = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'INTS_TOT_AMT'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_loan_3_SAMPLE = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(MEAN_ACD_NML_INTS, MEAN_NON_MATU_CAP, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), MEAN_MTH_NML_CAP_ACCM, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), MEAN_LOAN_TERM, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>),</span><br><span class="line">                              MEAN_NML_CAP_BAL, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), MEAN_INTS_TOT_AMT, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_LOAN_METHOD</span><span class="params">(dataset_LOAN)</span>:</span></span><br><span class="line">    <span class="comment"># é€‰æ‹©æœ‰ç”¨å­—æ®µ</span></span><br><span class="line">    train_loan_temple = dataset_LOAN[[<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>, <span class="string">'ARG_TYP_CD'</span>, <span class="string">'CCY_CD'</span>, <span class="string">'ARG_LIF_CYC_STA_CD'</span>, <span class="string">'LN_STS_CD'</span>, <span class="string">'CHANL_CD'</span>, <span class="string">'LN_TERM'</span>, <span class="string">'RPAY_MOD_CD'</span>, <span class="string">'LAC'</span>, <span class="string">'NON_MATU_CAP'</span>, <span class="string">'ACD_NML_INTS'</span>, <span class="string">'INTS_TOT_AMT'</span> , <span class="string">'BUS_BREED_CD'</span>, <span class="string">'NML_CAP_BAL'</span>, <span class="string">'MTH_NML_CAP_ACCM'</span>]]</span><br><span class="line">    train_loan_temple =  pd.merge(train_loan_temple, train_base_excg, on = <span class="string">'CCY_CD'</span>)</span><br><span class="line">    <span class="comment"># åˆ’åˆ†ä¸‰å¼ è¡¨</span></span><br><span class="line">    train_loan_1 = train_loan_temple[train_loan_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3728764800</span>]</span><br><span class="line">    train_loan_2 = train_loan_temple[train_loan_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3731443200</span>]</span><br><span class="line">    train_loan_3 = train_loan_temple[train_loan_temple[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">    train_loan_3 = train_loan_3.drop([<span class="string">'DATA_DAT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    train_loan_3.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># æ‰§è¡Œæ±‡ç‡è®¡ç®—å‡½æ•°</span></span><br><span class="line">    train_loan_3[<span class="string">'ACD_NML_INTS'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'ACD_NML_INTS'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_loan_3[<span class="string">'NON_MATU_CAP'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'NON_MATU_CAP'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_loan_3[<span class="string">'NML_CAP_BAL'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'NML_CAP_BAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_loan_3[<span class="string">'INTS_TOT_AMT'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'INTS_TOT_AMT'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_loan_3[<span class="string">'MTH_NML_CAP_ACCM'</span>] = train_loan_3.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'MTH_NML_CAP_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    <span class="comment"># å¹³å‡åº”è®¡æ­£å¸¸åˆ©æ¯</span></span><br><span class="line">    MEAN_ACD_NML_INTS = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'ACD_NML_INTS'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    <span class="comment"># å¹³å‡åº”è®¡æœªåˆ°æœŸæœ¬é‡‘</span></span><br><span class="line">    MEAN_NON_MATU_CAP = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'NON_MATU_CAP'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    <span class="comment"># å¹³å‡æœˆå†…æ­£å¸¸æœ¬é‡‘åŸºæ•°</span></span><br><span class="line">    MEAN_MTH_NML_CAP_ACCM = train_loan_3[[<span class="string">'CUST_NO'</span>,<span class="string">'MTH_NML_CAP_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    <span class="comment"># å¹³å‡è´·æ¬¾æœŸé™</span></span><br><span class="line">    MEAN_LOAN_TERM = train_loan_3[[<span class="string">'CUST_NO'</span>,<span class="string">'LN_TERM'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    <span class="comment"># å¹³å‡è´·æ¬¾é‡‘é¢</span></span><br><span class="line">    MEAN_NML_CAP_BAL = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'NML_CAP_BAL'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    <span class="comment"># å¹³å‡åˆ©æ¯æ€»é¢</span></span><br><span class="line">    MEAN_INTS_TOT_AMT = train_loan_3[[<span class="string">'CUST_NO'</span>, <span class="string">'INTS_TOT_AMT'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    train_loan_3_SAMPLE = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(MEAN_ACD_NML_INTS, MEAN_NON_MATU_CAP, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), MEAN_MTH_NML_CAP_ACCM, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), MEAN_LOAN_TERM, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>),</span><br><span class="line">                              MEAN_NML_CAP_BAL, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), MEAN_INTS_TOT_AMT, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> train_loan_3_SAMPLE</span><br></pre></td></tr></table></figure><h4 id="åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰-å¤„ç†"><a href="#åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰-å¤„ç†" class="headerlink" title="åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰- å¤„ç†"></a>åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰- å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_FUND_METHOD</span><span class="params">(dataset_FOUND)</span>:</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†</span></span><br><span class="line">    train_fund_temple = dataset_FOUND.drop([<span class="string">'CCY_CD'</span>, <span class="string">'ARG_CRT_DAT'</span>, <span class="string">'ARG_LIF_CYC_STA_CD'</span>, <span class="string">'CHANL_CD'</span>, <span class="string">'VLU_DAT'</span>, <span class="string">'DATE_MATU'</span>, <span class="string">'CLS_ACCT_DAT'</span>, <span class="string">'LAST_ACT_CHNG_DAT'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„</span></span><br><span class="line">    BY_MONTH_FUND_TABLE = train_fund_temple.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>])[[<span class="string">'FUD_UNIT_NET_VAL'</span>, <span class="string">'FUD_PROD_TYP_CD'</span>, <span class="string">'RSK_RANK_CD'</span>, <span class="string">'SHR'</span>,</span><br><span class="line">           <span class="string">'MOTH_BAL_ACCM'</span>, <span class="string">'FUND_BAL'</span>, <span class="string">'FUND_BAL_MOTH_BAL_ACCM'</span>]].sum().unstack()</span><br><span class="line">    <span class="comment"># å£°æ˜å‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_FUND</span><span class="params">(key)</span>:</span></span><br><span class="line">        train_fund_temple_STD = BY_MONTH_FUND_TABLE[key].std(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_fund_temple_STD.columns = [<span class="string">'CUST_NO'</span>, str(<span class="string">'FUND_'</span>+key+<span class="string">'_STD'</span>)]</span><br><span class="line">        train_fund_temple_MEAN = BY_MONTH_FUND_TABLE[key].mean(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_fund_temple_MEAN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'FUND_'</span>+key+<span class="string">'_MEAN'</span>)]</span><br><span class="line">        train_fund_temple_MAX = BY_MONTH_FUND_TABLE[key].max(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_fund_temple_MAX.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'FUND_'</span>+key+<span class="string">'_MAX'</span>)]</span><br><span class="line">        train_fund_temple_MIN = BY_MONTH_FUND_TABLE[key].min(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_fund_temple_MIN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'FUND_'</span>+key+<span class="string">'_MIN'</span>)]</span><br><span class="line">        <span class="comment"># åˆå¹¶å­—æ®µ</span></span><br><span class="line">        train_fund_temple = pd.merge(train_fund_temple_STD, train_fund_temple_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_fund_temple = pd.merge(train_fund_temple, train_fund_temple_MAX, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_fund_temple = pd.merge(train_fund_temple, train_fund_temple_MIN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        <span class="keyword">return</span> train_fund_temple</span><br><span class="line">    train_fund_temple = BY_MONTH_FUND(<span class="string">'RSK_RANK_CD'</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">'FUD_UNIT_NET_VAL'</span>, <span class="string">'FUD_PROD_TYP_CD'</span>, <span class="string">'SHR'</span>, <span class="string">'MOTH_BAL_ACCM'</span>, <span class="string">'FUND_BAL'</span>, <span class="string">'FUND_BAL_MOTH_BAL_ACCM'</span>]:</span><br><span class="line">        train_fund_temple = pd.merge(train_fund_temple, BY_MONTH_FUND(key))</span><br><span class="line">        train_fund_temple.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># å®šç”³å®šèµ å¼€é€šæ ‡è¯†</span></span><br><span class="line">    SUM_FUND_RATN_APLY_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_APLY_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).sum().reset_index()</span><br><span class="line">    STD_FUND_RATN_APLY_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_APLY_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).std().reset_index()</span><br><span class="line">    MEAN_FUND_RATN_APLY_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_APLY_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    MAX_FUND_RATN_APLY_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_APLY_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).max().reset_index()</span><br><span class="line">    MIN_FUND_RATN_APLY_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_APLY_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).min().reset_index()</span><br><span class="line"></span><br><span class="line">    SUM_FUND_RATN_REDM_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_REDM_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).sum().reset_index()</span><br><span class="line">    STD_FUND_RATN_REDM_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_REDM_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).std().reset_index()</span><br><span class="line">    MEAN_FUND_RATN_REDM_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_REDM_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).mean().reset_index()</span><br><span class="line">    MAX_FUND_RATN_REDM_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_REDM_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).max().reset_index()</span><br><span class="line">    MIN_FUND_RATN_REDM_OPN_IND = dataset_FOUND[[<span class="string">'CUST_NO'</span>, <span class="string">'RATN_REDM_OPN_IND'</span>]].groupby([<span class="string">'CUST_NO'</span>]).min().reset_index()</span><br><span class="line">    train_fund_temple = pd.merge(pd.merge(train_fund_temple, STD_FUND_RATN_APLY_OPN_IND, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), MIN_FUND_RATN_REDM_OPN_IND, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">    <span class="keyword">return</span> train_fund_temple</span><br></pre></td></tr></table></figure><h4 id="å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰-å¤„ç†"><a href="#å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰-å¤„ç†" class="headerlink" title="å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰- å¤„ç†"></a>å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰- å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_BOND_METHOD</span><span class="params">(dataset_BOND)</span>:</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†</span></span><br><span class="line">    train_bond_temple = dataset_BOND.drop([<span class="string">'CCY_CD'</span>, <span class="string">'ARG_CRT_DAT'</span>, <span class="string">'MATU_DAT'</span>, <span class="string">'MATU_DAT'</span>, <span class="string">'PROD_CLS_CD'</span>, <span class="string">'CERT_DAT'</span>, <span class="string">'CLS_ACCT_DAT'</span>, <span class="string">'ARG_LIF_CYC_STA_CD'</span>, <span class="string">'NTNL_DEBT_INTS_TYP_CD'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„</span></span><br><span class="line">    BY_MONTH_BOND_TABLE = train_bond_temple.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>])[[<span class="string">'BOND_TERM_CD'</span>, <span class="string">'ARG_CUR_BAL'</span>, <span class="string">'HOD_SHR'</span>,</span><br><span class="line">       <span class="string">'UNIT_NET_VAL'</span>, <span class="string">'NVTA_MOTH_ACCM'</span>]].sum().unstack()</span><br><span class="line">    <span class="comment"># å£°æ˜å‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">BY_MONTH_BOND</span><span class="params">(key)</span>:</span></span><br><span class="line">        train_bond_temple_STD = BY_MONTH_BOND_TABLE[key].std(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_bond_temple_STD.columns = [<span class="string">'CUST_NO'</span>, str(<span class="string">'BOND_'</span>+key+<span class="string">'_STD'</span>)]</span><br><span class="line">        train_bond_temple_MEAN = BY_MONTH_BOND_TABLE[key].mean(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_bond_temple_MEAN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'BOND_'</span>+key+<span class="string">'_MEAN'</span>)]</span><br><span class="line">        train_bond_temple_MAX = BY_MONTH_BOND_TABLE[key].max(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_bond_temple_MAX.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'BOND_'</span>+key+<span class="string">'_MAX'</span>)]</span><br><span class="line">        train_bond_temple_MIN = BY_MONTH_BOND_TABLE[key].min(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_bond_temple_MIN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'BOND_'</span>+key+<span class="string">'_MIN'</span>)]</span><br><span class="line">        <span class="comment"># åˆå¹¶å­—æ®µ</span></span><br><span class="line">        train_bond_temple = pd.merge(train_bond_temple_STD, train_bond_temple_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_bond_temple = pd.merge(train_bond_temple, train_bond_temple_MAX, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_bond_temple = pd.merge(train_bond_temple, train_bond_temple_MIN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        <span class="keyword">return</span> train_bond_temple</span><br><span class="line">    train_bond_temple = BY_MONTH_BOND(<span class="string">'BOND_TERM_CD'</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">'ARG_CUR_BAL'</span>, <span class="string">'HOD_SHR'</span>, <span class="string">'UNIT_NET_VAL'</span>, <span class="string">'NVTA_MOTH_ACCM'</span>]:</span><br><span class="line">        train_bond_temple = pd.merge(train_bond_temple, BY_MONTH_BOND(key))</span><br><span class="line">        train_bond_temple.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="keyword">return</span> train_bond_temple</span><br></pre></td></tr></table></figure><h4 id="è´µé‡‘å±è´¦æˆ·ä¿¡æ¯ï¼ˆPREC-METALï¼‰-å¤„ç†"><a href="#è´µé‡‘å±è´¦æˆ·ä¿¡æ¯ï¼ˆPREC-METALï¼‰-å¤„ç†" class="headerlink" title="è´µé‡‘å±è´¦æˆ·ä¿¡æ¯ï¼ˆPREC_METALï¼‰- å¤„ç†"></a>è´µé‡‘å±è´¦æˆ·ä¿¡æ¯ï¼ˆPREC_METALï¼‰- å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_PREC_METAL_METHOD</span><span class="params">(dataset_PREC_METAL)</span>:</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†</span></span><br><span class="line">    train_prec_metal_temple = dataset_PREC_METAL.drop([<span class="string">'PREC_METAL_BREED_CD'</span>, <span class="string">'ARG_STS_CD'</span>, <span class="string">'SIGD_DAT'</span>, <span class="string">'SIGD_CHANL_CD'</span>, <span class="string">'TEMN_DAT'</span>, <span class="string">'TEMN_CHANL_CD'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å°†train_prec_metalå’Œtrain_base_excgåˆå¹¶</span></span><br><span class="line">    train_prec_metal_temple = pd.merge(train_prec_metal_temple, train_base_excg, on = <span class="string">'CCY_CD'</span>)</span><br><span class="line">    <span class="comment"># æ‰§è¡Œæ±‡ç‡è®¡ç®—å‡½æ•°</span></span><br><span class="line">    train_prec_metal_temple[<span class="string">'ARG_BAL'</span>] = train_prec_metal_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'ARG_BAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    <span class="comment"># æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„</span></span><br><span class="line">    BY_MONTH_PREC_METAL_TABLE = train_prec_metal_temple.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>])[[<span class="string">'BUS_CTG_CD'</span>, <span class="string">'CNT'</span>, <span class="string">'ARG_BAL'</span>,</span><br><span class="line">       <span class="string">'MTH_ARG_ACCM'</span>]].sum().unstack()</span><br><span class="line">    <span class="comment"># å£°æ˜å‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">BY_MONTH_PREC_METAL</span><span class="params">(key)</span>:</span></span><br><span class="line">        train_prec_metal_temple_STD = BY_MONTH_PREC_METAL_TABLE[key].std(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_prec_metal_temple_STD.columns = [<span class="string">'CUST_NO'</span>, str(<span class="string">'PREC_METAL_'</span>+key+<span class="string">'_STD'</span>)]</span><br><span class="line">        train_prec_metal_temple_MEAN = BY_MONTH_PREC_METAL_TABLE[key].mean(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_prec_metal_temple_MEAN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'PREC_METAL_'</span>+key+<span class="string">'_MEAN'</span>)]</span><br><span class="line">        train_prec_metal_temple_MAX = BY_MONTH_PREC_METAL_TABLE[key].max(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_prec_metal_temple_MAX.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'PREC_METAL_'</span>+key+<span class="string">'_MAX'</span>)]</span><br><span class="line">        train_prec_metal_temple_MIN = BY_MONTH_PREC_METAL_TABLE[key].min(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_prec_metal_temple_MIN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'PREC_METAL_'</span>+key+<span class="string">'_MIN'</span>)]</span><br><span class="line">        <span class="comment"># åˆå¹¶å­—æ®µ</span></span><br><span class="line">        train_prec_metal_temple = pd.merge(train_prec_metal_temple_STD, train_prec_metal_temple_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_prec_metal_temple = pd.merge(train_prec_metal_temple, train_prec_metal_temple_MAX, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_prec_metal_temple = pd.merge(train_prec_metal_temple, train_prec_metal_temple_MIN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        <span class="keyword">return</span> train_prec_metal_temple</span><br><span class="line">    train_prec_metal_temple = BY_MONTH_PREC_METAL(<span class="string">'BUS_CTG_CD'</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">'CNT'</span>, <span class="string">'ARG_BAL'</span>, <span class="string">'MTH_ARG_ACCM'</span>]:</span><br><span class="line">        train_prec_metal_temple = pd.merge(train_prec_metal_temple, BY_MONTH_PREC_METAL(key))</span><br><span class="line">        train_prec_metal_temple.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> train_prec_metal_temple</span><br></pre></td></tr></table></figure><h4 id="ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET-INSRï¼‰-å¤„ç†"><a href="#ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET-INSRï¼‰-å¤„ç†" class="headerlink" title="ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET_INSRï¼‰- å¤„ç†"></a>ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET_INSRï¼‰- å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_AGET_INSR_METHOD</span><span class="params">(dataset_AGET_INSR)</span>:</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†</span></span><br><span class="line">    train_aget_insr_temple = dataset_AGET_INSR[[<span class="string">'DATA_DAT'</span>, <span class="string">'CUST_NO'</span>, <span class="string">'PREM'</span>, <span class="string">'CVAG'</span>, <span class="string">'INSE_CNT'</span>, <span class="string">'MTH_PREM_ACCM'</span>, <span class="string">'BEG_MTH_PREM_BAL'</span>]]</span><br><span class="line">    <span class="comment"># æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„</span></span><br><span class="line">    BY_MONTH_AGET_INSR_TABLE = train_aget_insr_temple.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>])[[<span class="string">'PREM'</span>, <span class="string">'CVAG'</span>, <span class="string">'INSE_CNT'</span>, <span class="string">'MTH_PREM_ACCM'</span>, <span class="string">'BEG_MTH_PREM_BAL'</span>]].sum().unstack()</span><br><span class="line">    <span class="comment"># å£°æ˜å‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_AGET_INSR</span><span class="params">(key)</span>:</span></span><br><span class="line">        train_aget_insr_temple_STD = BY_MONTH_AGET_INSR_TABLE[key].std(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_aget_insr_temple_STD.columns = [<span class="string">'CUST_NO'</span>, str(<span class="string">'AGET_INSR_'</span>+key+<span class="string">'_STD'</span>)]</span><br><span class="line">        train_aget_insr_temple_MEAN = BY_MONTH_AGET_INSR_TABLE[key].mean(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_aget_insr_temple_MEAN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'AGET_INSR_'</span>+key+<span class="string">'_MEAN'</span>)]</span><br><span class="line">        train_aget_insr_temple_MAX = BY_MONTH_AGET_INSR_TABLE[key].max(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_aget_insr_temple_MAX.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'AGET_INSR_'</span>+key+<span class="string">'_MAX'</span>)]</span><br><span class="line">        train_aget_insr_temple_MIN = BY_MONTH_AGET_INSR_TABLE[key].min(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_aget_insr_temple_MIN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'AGET_INSR_'</span>+key+<span class="string">'_MIN'</span>)]</span><br><span class="line">        <span class="comment"># åˆå¹¶å­—æ®µ</span></span><br><span class="line">        train_aget_insr_temple = pd.merge(train_aget_insr_temple_STD, train_aget_insr_temple_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_aget_insr_temple = pd.merge(train_aget_insr_temple, train_aget_insr_temple_MAX, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_aget_insr_temple = pd.merge(train_aget_insr_temple, train_aget_insr_temple_MIN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        <span class="keyword">return</span> train_aget_insr_temple</span><br><span class="line">    train_aget_insr_temple = BY_MONTH_AGET_INSR(<span class="string">'PREM'</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">'CVAG'</span>, <span class="string">'INSE_CNT'</span>, <span class="string">'MTH_PREM_ACCM'</span>, <span class="string">'BEG_MTH_PREM_BAL'</span>]:</span><br><span class="line">        train_aget_insr_temple = pd.merge(train_aget_insr_temple, BY_MONTH_AGET_INSR(key))</span><br><span class="line">        train_aget_insr_temple.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> train_aget_insr_temple</span><br></pre></td></tr></table></figure><h3 id="è¡¨é—´èåˆ"><a href="#è¡¨é—´èåˆ" class="headerlink" title="è¡¨é—´èåˆ"></a>è¡¨é—´èåˆ</h3><h4 id="TRAINé›†"><a href="#TRAINé›†" class="headerlink" title="TRAINé›†"></a>TRAINé›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train é›† 38256</span></span><br><span class="line">dataset_train = pd.merge(IDV_CUST_BASIC_PARSE(CALC_AGE(train_idv_cust_basic)), IDV_TD_PARSE(train_idv_td), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, IDV_DPSA_PARSE(train_idv_dpsa), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, TR_DC_PARSE(train_tr_dc), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_IDV_TD_METHOD(train_idv_td), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_IDV_DPSA_METHOD(train_idv_dpsa), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_TR_DC_METHOD(train_tr_dc), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, THR_PTY_CSTD_PARSE(train_thr_pty_cstd), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_LOAN_METHOD(train_loan), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_FUND_METHOD(train_fund), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_BOND_METHOD(train_bond), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_PREC_METAL_METHOD(train_prec_metal), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, BY_MONTH_AGET_INSR_METHOD(train_aget_insr), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(dataset_train, AUM_NUMS(train_idv_td, train_bond, train_fund, train_prec_metal, train_aget_insr, train_idv_cust_basic), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_train = pd.merge(WEALTH(train_cust_result,train_idv_td,train_bond,train_fund,train_prec_metal,train_aget_insr,train_thr_pty_cstd), dataset_train, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:20: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:26: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy/root/anaconda3/lib/python3.6/site-packages/pandas/core/reshape/merge.py:558: UserWarning: merging between different levels can give an unintended result (1 levels on the left, 2 on the right)  warnings.warn(msg, UserWarning)/root/anaconda3/lib/python3.6/site-packages/pandas/core/generic.py:2530: PerformanceWarning: dropping on a non-lexsorted multi-index without a level parameter may impact performance.  obj = obj._drop_axis(labels, axis, level=level, errors=errors)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨ä¸ç»“æœæ•´åˆ</span></span><br><span class="line">dataset_train = pd.merge(dataset_train, train_cust_result, on=<span class="string">'CUST_NO'</span>)</span><br></pre></td></tr></table></figure><h4 id="TRAIN-å‰ªæ"><a href="#TRAIN-å‰ªæ" class="headerlink" title="TRAIN å‰ªæ"></a>TRAIN å‰ªæ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ— ç”¨å­—æ®µ</span></span><br><span class="line">dataset_train = dataset_train.drop([<span class="string">'CUST_NO'</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="Aé›†"><a href="#Aé›†" class="headerlink" title="Aé›†"></a>Aé›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># A é›† 4782</span></span><br><span class="line">dataset_A = pd.merge(IDV_CUST_BASIC_PARSE(CALC_AGE(A_idv_cust_basic)), IDV_TD_PARSE(A_idv_td), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, IDV_DPSA_PARSE(A_idv_dpsa), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, TR_DC_PARSE(A_tr_dc), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_IDV_TD_METHOD(A_idv_td), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_IDV_DPSA_METHOD(A_idv_dpsa), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_TR_DC_METHOD(A_tr_dc), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, THR_PTY_CSTD_PARSE(A_thr_pty_cstd), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_LOAN_METHOD(A_loan), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_FUND_METHOD(A_fund), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_BOND_METHOD(A_bond), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_PREC_METAL_METHOD(A_prec_metal), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, BY_MONTH_AGET_INSR_METHOD(A_aget_insr), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(dataset_A, AUM_NUMS(A_idv_td, A_bond, A_fund, A_prec_metal, A_aget_insr, A_idv_cust_basic), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_A = pd.merge(WEALTH(A_customid,A_idv_td,A_bond,A_fund,A_prec_metal,A_aget_insr,A_thr_pty_cstd), dataset_A, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:20: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:26: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy/root/anaconda3/lib/python3.6/site-packages/pandas/core/reshape/merge.py:558: UserWarning: merging between different levels can give an unintended result (1 levels on the left, 2 on the right)  warnings.warn(msg, UserWarning)/root/anaconda3/lib/python3.6/site-packages/pandas/core/generic.py:2530: PerformanceWarning: dropping on a non-lexsorted multi-index without a level parameter may impact performance.  obj = obj._drop_axis(labels, axis, level=level, errors=errors)</code></pre><h4 id="A-å‰ªæ"><a href="#A-å‰ªæ" class="headerlink" title="A å‰ªæ"></a>A å‰ªæ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ— ç”¨å­—æ®µ</span></span><br><span class="line">dataset_A = dataset_A.drop([<span class="string">'CUST_NO'</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="Bé›†"><a href="#Bé›†" class="headerlink" title="Bé›†"></a>Bé›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># A é›† 4782</span></span><br><span class="line">dataset_B = pd.merge(IDV_CUST_BASIC_PARSE(CALC_AGE(B_idv_cust_basic)), IDV_TD_PARSE(B_idv_td), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, IDV_DPSA_PARSE(B_idv_dpsa), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, TR_DC_PARSE(B_tr_dc), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_IDV_TD_METHOD(B_idv_td), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_IDV_DPSA_METHOD(B_idv_dpsa), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_TR_DC_METHOD(B_tr_dc), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, THR_PTY_CSTD_PARSE(B_thr_pty_cstd), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_LOAN_METHOD(B_loan), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_FUND_METHOD(B_fund), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_BOND_METHOD(B_bond), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_PREC_METAL_METHOD(B_prec_metal), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, BY_MONTH_AGET_INSR_METHOD(B_aget_insr), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(dataset_B, AUM_NUMS(B_idv_td, B_bond, B_fund, B_prec_metal, B_aget_insr, B_idv_cust_basic), on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br><span class="line">dataset_B = pd.merge(WEALTH(B_customid,B_idv_td,B_bond,B_fund,B_prec_metal,B_aget_insr,B_thr_pty_cstd), dataset_B, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:20: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:26: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy/root/anaconda3/lib/python3.6/site-packages/pandas/core/reshape/merge.py:558: UserWarning: merging between different levels can give an unintended result (1 levels on the left, 2 on the right)  warnings.warn(msg, UserWarning)/root/anaconda3/lib/python3.6/site-packages/pandas/core/generic.py:2530: PerformanceWarning: dropping on a non-lexsorted multi-index without a level parameter may impact performance.  obj = obj._drop_axis(labels, axis, level=level, errors=errors)</code></pre><h4 id="Bé›†å‰ªæ"><a href="#Bé›†å‰ªæ" class="headerlink" title="Bé›†å‰ªæ"></a>Bé›†å‰ªæ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ— ç”¨å­—æ®µ</span></span><br><span class="line">dataset_B = dataset_B.drop([<span class="string">'CUST_NO'</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="æ¬ é‡‡æ ·"><a href="#æ¬ é‡‡æ ·" class="headerlink" title="æ¬ é‡‡æ ·"></a>æ¬ é‡‡æ ·</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_SAMPLE = pd.concat([dataset_train[dataset_train[<span class="string">'FLAG'</span>]==<span class="number">0</span>].sample(frac=<span class="number">0.20</span>),dataset_train[dataset_train[<span class="string">'FLAG'</span>]==<span class="number">1</span>]],axis=<span class="number">0</span>).sample(frac=<span class="number">1.0</span>)</span><br></pre></td></tr></table></figure><h3 id="ç®—æ³•åˆ†æ"><a href="#ç®—æ³•åˆ†æ" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd  </span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> StratifiedKFold  </span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> imblearn.over_sampling <span class="keyword">import</span> SMOTE</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºç‰¹å¾  </span></span><br><span class="line"><span class="comment">#X = dataset_train.drop(['FLAG'],axis=1).fillna(0)</span></span><br><span class="line"><span class="comment">#y = dataset_train['FLAG']</span></span><br><span class="line">X = train_SAMPLE.drop([<span class="string">'FLAG'</span>],axis=<span class="number">1</span>).fillna(<span class="number">0</span>)</span><br><span class="line">y = train_SAMPLE[<span class="string">'FLAG'</span>]</span><br><span class="line"><span class="comment"># X = dataset_train_SAMPLE.drop(['FLAG'],axis=1)</span></span><br><span class="line"><span class="comment"># y = dataset_train_SAMPLE['FLAG']</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># ç”¨sklearn.cross_validationè¿›è¡Œè®­ç»ƒæ•°æ®é›†åˆ’åˆ†</span></span><br><span class="line">X, val_X, y, val_y = train_test_split(  </span><br><span class="line">    X,  </span><br><span class="line">    y,  </span><br><span class="line">    test_size=<span class="number">0.01</span>,</span><br><span class="line">    <span class="comment">#test_size=0.125,</span></span><br><span class="line">    random_state=<span class="number">2020</span>,  </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SMOTEè¿‡é‡‡æ ·</span></span><br><span class="line"><span class="comment"># smo = SMOTE(random_state=2019)</span></span><br><span class="line"><span class="comment"># X_smo, y_smo = smo.fit_sample(X, y)</span></span><br><span class="line"><span class="comment"># X_smo = pd.DataFrame(X_smo)</span></span><br><span class="line"><span class="comment"># X_smo.columns=['XXX']</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd  </span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> StratifiedKFold  </span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> imblearn.over_sampling <span class="keyword">import</span> SMOTE</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºç‰¹å¾  </span></span><br><span class="line">X = dataset_train.drop([<span class="string">'FLAG'</span>],axis=<span class="number">1</span>).fillna(<span class="number">0</span>)</span><br><span class="line">y = dataset_train[<span class="string">'FLAG'</span>]</span><br><span class="line">  </span><br><span class="line"><span class="comment"># ç”¨sklearn.cross_validationè¿›è¡Œè®­ç»ƒæ•°æ®é›†åˆ’åˆ†</span></span><br><span class="line">X, val_X, y, val_y = train_test_split(  </span><br><span class="line">    X,  </span><br><span class="line">    y,  </span><br><span class="line">    test_size=<span class="number">0.125</span>,</span><br><span class="line">    random_state=<span class="number">2019</span>,  </span><br><span class="line">)</span><br><span class="line">train_REAL = pd.concat([X,y],axis=<span class="number">1</span>)</span><br><span class="line">train_REAL = pd.concat([train_REAL[train_REAL[<span class="string">'FLAG'</span>]==<span class="number">0</span>].sample(frac=<span class="number">0.20</span>),train_REAL[train_REAL[<span class="string">'FLAG'</span>]==<span class="number">1</span>]],axis=<span class="number">0</span>).sample(frac=<span class="number">1.0</span>)</span><br><span class="line">X = train_REAL.drop([<span class="string">'FLAG'</span>],axis=<span class="number">1</span>)</span><br><span class="line">y = train_REAL[<span class="string">'FLAG'</span>]</span><br></pre></td></tr></table></figure><h4 id="XGBç®—æ³•"><a href="#XGBç®—æ³•" class="headerlink" title="XGBç®—æ³•"></a>XGBç®—æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xgbçŸ©é˜µèµ‹å€¼  </span></span><br><span class="line">xgb_val = xgb.DMatrix(val_X, label=val_y)  </span><br><span class="line"><span class="comment"># xgb_train = xgb.DMatrix(X_smo, label=y_smo)</span></span><br><span class="line">xgb_train = xgb.DMatrix(X, label=y)</span><br><span class="line">  </span><br><span class="line"><span class="comment"># xgboostæ¨¡å‹#</span></span><br><span class="line">params = &#123;  </span><br><span class="line">    <span class="string">'booster'</span>: <span class="string">'gbtree'</span>,  </span><br><span class="line">    <span class="comment"># 'objective': 'multi:softmax',  # å¤šåˆ†ç±»çš„é—®é¢˜ã€  </span></span><br><span class="line">    <span class="comment"># 'objective': 'multi:softprob',   # å¤šåˆ†ç±»æ¦‚ç‡  </span></span><br><span class="line">    <span class="string">'objective'</span>: <span class="string">'binary:logistic'</span>,  </span><br><span class="line">    <span class="string">'eval_metric'</span>: <span class="string">'logloss'</span>,  </span><br><span class="line">    <span class="comment"># 'num_class': 9,  # ç±»åˆ«æ•°ï¼Œä¸ multisoftmax å¹¶ç”¨  </span></span><br><span class="line">    <span class="string">'gamma'</span>: <span class="number">0.1</span>,  <span class="comment"># ç”¨äºæ§åˆ¶æ˜¯å¦åå‰ªæçš„å‚æ•°,è¶Šå¤§è¶Šä¿å®ˆï¼Œä¸€èˆ¬0.1ã€0.2è¿™æ ·å­ã€‚  </span></span><br><span class="line">    <span class="string">'max_depth'</span>: <span class="number">5</span>,  <span class="comment"># æ„å»ºæ ‘çš„æ·±åº¦ï¼Œè¶Šå¤§è¶Šå®¹æ˜“è¿‡æ‹Ÿåˆ  </span></span><br><span class="line">    <span class="string">'alpha'</span>: <span class="number">0</span>,   <span class="comment"># L1æ­£åˆ™åŒ–ç³»æ•°  </span></span><br><span class="line">    <span class="string">'lambda'</span>: <span class="number">8</span>,  <span class="comment"># æ§åˆ¶æ¨¡å‹å¤æ‚åº¦çš„æƒé‡å€¼çš„L2æ­£åˆ™åŒ–é¡¹å‚æ•°ï¼Œå‚æ•°è¶Šå¤§ï¼Œæ¨¡å‹è¶Šä¸å®¹æ˜“è¿‡æ‹Ÿåˆã€‚  </span></span><br><span class="line">    <span class="string">'subsample'</span>: <span class="number">1</span>,  <span class="comment"># éšæœºé‡‡æ ·è®­ç»ƒæ ·æœ¬  </span></span><br><span class="line">    <span class="string">'colsample_bytree'</span>: <span class="number">0.6</span>,  <span class="comment"># ç”Ÿæˆæ ‘æ—¶è¿›è¡Œçš„åˆ—é‡‡æ ·  </span></span><br><span class="line">    <span class="string">'min_child_weight'</span>: <span class="number">3</span>,  </span><br><span class="line">    <span class="comment"># è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯ 1ï¼Œæ˜¯æ¯ä¸ªå¶å­é‡Œé¢ h çš„å’Œè‡³å°‘æ˜¯å¤šå°‘ï¼Œå¯¹æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡æ—¶çš„ 0-1 åˆ†ç±»è€Œè¨€  </span></span><br><span class="line">    <span class="comment"># ï¼Œå‡è®¾ h åœ¨ 0.01 é™„è¿‘ï¼Œmin_child_weight ä¸º 1 æ„å‘³ç€å¶å­èŠ‚ç‚¹ä¸­æœ€å°‘éœ€è¦åŒ…å« 100 ä¸ªæ ·æœ¬ã€‚  </span></span><br><span class="line">    <span class="comment"># è¿™ä¸ªå‚æ•°éå¸¸å½±å“ç»“æœï¼Œæ§åˆ¶å¶å­èŠ‚ç‚¹ä¸­äºŒé˜¶å¯¼çš„å’Œçš„æœ€å°å€¼ï¼Œè¯¥å‚æ•°å€¼è¶Šå°ï¼Œè¶Šå®¹æ˜“ overfittingã€‚  </span></span><br><span class="line">    <span class="string">'silent'</span>: <span class="number">0</span>,  <span class="comment"># è®¾ç½®æˆ1åˆ™æ²¡æœ‰è¿è¡Œä¿¡æ¯è¾“å‡ºï¼Œæœ€å¥½æ˜¯è®¾ç½®ä¸º0.  </span></span><br><span class="line">    <span class="string">'eta'</span>: <span class="number">0.01</span> ,</span><br><span class="line">    <span class="comment">#'eta': 0.1,  # å¦‚åŒå­¦ä¹ ç‡ - result 0.554455</span></span><br><span class="line">    <span class="string">'seed'</span>: <span class="number">1000</span>,  </span><br><span class="line">    <span class="string">'nthread'</span>: <span class="number">24</span>,  <span class="comment"># cpu çº¿ç¨‹æ•°  </span></span><br><span class="line">    <span class="string">'missing'</span>: <span class="number">1</span>,  </span><br><span class="line">    <span class="string">'scale_pos_weight'</span>: (np.sum(y==<span class="number">0</span>)/np.sum(y==<span class="number">1</span>))  <span class="comment"># ç”¨æ¥å¤„ç†æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡çš„é—®é¢˜,é€šå¸¸å–ï¼šsum(negative cases) / sum(positive cases)  </span></span><br><span class="line">    <span class="comment"># 'eval_metric': 'auc'  </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">plst = list(params.items())  </span><br><span class="line">num_rounds = <span class="number">30000</span>  <span class="comment"># è¿­ä»£æ¬¡æ•°  </span></span><br><span class="line">watchlist = [(xgb_train, <span class="string">'train'</span>), (xgb_val, <span class="string">'val'</span>)]  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># äº¤å‰éªŒè¯  </span></span><br><span class="line">result = xgb.cv(plst, xgb_train, num_boost_round=<span class="number">200</span>, nfold=<span class="number">4</span>, early_stopping_rounds=<span class="number">200</span>, verbose_eval=<span class="keyword">True</span>, folds=StratifiedKFold(n_splits=<span class="number">4</span>).split(X, y))  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># è®­ç»ƒæ¨¡å‹å¹¶ä¿å­˜  </span></span><br><span class="line"><span class="comment"># early_stopping_rounds å½“è®¾ç½®çš„è¿­ä»£æ¬¡æ•°è¾ƒå¤§æ—¶ï¼Œearly_stopping_rounds å¯åœ¨ä¸€å®šçš„è¿­ä»£æ¬¡æ•°å†…å‡†ç¡®ç‡æ²¡æœ‰æå‡å°±åœæ­¢è®­ç»ƒ  </span></span><br><span class="line">model = xgb.train(plst, xgb_train, num_rounds, watchlist, early_stopping_rounds=<span class="number">400</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å‹ä¿å­˜</span></span><br><span class="line">model.save_model(<span class="string">'./leezy_xgb.model'</span>)  <span class="comment"># ç”¨äºå­˜å‚¨è®­ç»ƒå‡ºçš„æ¨¡å‹</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯»å–æ¨¡å‹</span></span><br><span class="line"><span class="comment"># model = xgb.Booster(model_file='5903-xgb.model')</span></span><br><span class="line"><span class="comment"># æœ¬åœ°éªŒè¯</span></span><br><span class="line">xgb_test = xgb.DMatrix(val_X) </span><br><span class="line">preds = model.predict(xgb_test)</span><br><span class="line"><span class="comment"># å¯¼å‡ºç»“æœ  </span></span><br><span class="line">threshold = <span class="number">0.70</span></span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> pred <span class="keyword">in</span> preds:  </span><br><span class="line">    result = <span class="number">1</span> <span class="keyword">if</span> pred &gt; threshold <span class="keyword">else</span> <span class="number">0</span> </span><br><span class="line">    ans.append(result)</span><br><span class="line">pred_result= pd.Series(ans, dtype=<span class="string">'int32'</span>)</span><br><span class="line">evaluate(val_y, pred_result)</span><br></pre></td></tr></table></figure><pre><code>test_pct_1: 0.1581pred_pct_1: 0.1836Precesion: 0.5581Recall: 0.6481F1-score: 0.5998confusion matrix:[[3638  388] [ 266  490]]{&apos;Confusuion&apos;: array([[3638,  388],        [ 266,  490]]), &apos;F1&apos;: 0.5997552019583843, &apos;Precision&apos;: 0.5580865603644647, &apos;acc&apos;: 0.863237139272271, &apos;pred_pct_1&apos;: 0.1836051861145964, &apos;recall&apos;: 0.6481481481481481, &apos;roc_auc&apos;: 0.7758872881823701, &apos;test_pct_1&apos;: 0.15809284818067754}</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Aé›†è®­ç»ƒ</span></span><br><span class="line">xgb_A = xgb.DMatrix(dataset_A)</span><br><span class="line">A_preds = model.predict(xgb_A)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºç»“æœ  </span></span><br><span class="line">threshold = <span class="number">0.40</span></span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> pred <span class="keyword">in</span> A_preds:  </span><br><span class="line">    result = <span class="number">1</span> <span class="keyword">if</span> pred &gt; threshold <span class="keyword">else</span> <span class="number">0</span> </span><br><span class="line">    ans.append(result)</span><br><span class="line">pred_A_result= pd.Series(ans, dtype=<span class="string">'int32'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bé›†è®­ç»ƒ</span></span><br><span class="line">xgb_B = xgb.DMatrix(dataset_B)</span><br><span class="line">B_preds = model.predict(xgb_B)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºç»“æœ  </span></span><br><span class="line">threshold = <span class="number">0.68</span></span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> pred <span class="keyword">in</span> B_preds:  </span><br><span class="line">    result = <span class="number">1</span> <span class="keyword">if</span> pred &gt; threshold <span class="keyword">else</span> <span class="number">0</span> </span><br><span class="line">    ans.append(result)</span><br><span class="line">pred_B_result= pd.Series(ans, dtype=<span class="string">'int32'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line">importance = model.get_fscore()</span><br><span class="line">importance = sorted(importance.items(), key=operator.itemgetter(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># print(importance)</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.rcParams[<span class="string">"figure.figsize"</span>]=(<span class="number">30</span>,<span class="number">40</span>)</span><br><span class="line">xgb.plot_importance(model, max_num_features=<span class="number">100</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1320: UserWarning: findfont: Font family [&apos;sans-serif&apos;] not found. Falling back to DejaVu Sans  (prop.get_family(), self.defaultFamily[fontext]))</code></pre><p><img src="/assets/blogImg/OUTPUT_IMPORTANCES.png" alt="IMPORTANCES"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å¾æ’å</span></span><br><span class="line">feature_rank(model, <span class="number">30</span>)</span><br></pre></td></tr></table></figure><h3 id="æäº¤ç»“æœ"><a href="#æäº¤ç»“æœ" class="headerlink" title="æäº¤ç»“æœ"></a>æäº¤ç»“æœ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pred_B_result.value_counts()</span><br></pre></td></tr></table></figure><pre><code>0    39011     881dtype: int64</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå¹¶ç»“æœ</span></span><br><span class="line">result = pd.concat([B_customid, pred_B_result],axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result.to_csv(<span class="string">'111.csv'</span>,header=<span class="number">0</span>,index=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init_woody</span><br></pre></td></tr></table></figure><pre><code>The prv extension is already loaded. To reload it, use:  %reload_ext prvMatplotlib env init complete.Warnings off.</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predict <span class="number">2</span> <span class="number">000.</span>csv</span><br></pre></td></tr></table></figure><pre><code>&apos;æäº¤æ¬¡æ•°å·²ç”¨å®Œï¼Œè¯·æ˜æ—¥å†è¯•ï¼&apos;</code></pre><h3 id="æ·±åŒ–ç‰¹å¾å·¥ç¨‹"><a href="#æ·±åŒ–ç‰¹å¾å·¥ç¨‹" class="headerlink" title="æ·±åŒ–ç‰¹å¾å·¥ç¨‹"></a>æ·±åŒ–ç‰¹å¾å·¥ç¨‹</h3><h4 id="å„ç±»ç†è´¢äº§å“çš„æŒæœ‰æ•°é‡"><a href="#å„ç±»ç†è´¢äº§å“çš„æŒæœ‰æ•°é‡" class="headerlink" title="å„ç±»ç†è´¢äº§å“çš„æŒæœ‰æ•°é‡"></a>å„ç±»ç†è´¢äº§å“çš„æŒæœ‰æ•°é‡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">train_idv_td = pd.read_csv(<span class="string">"../data/2/train/IDV_TD.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_TDï¼‰</span></span><br><span class="line">train_bond = pd.read_csv(<span class="string">"../data/2/train/BOND.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰</span></span><br><span class="line">train_fund = pd.read_csv(<span class="string">"../data/2/train/FUND.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰</span></span><br><span class="line">train_prec_metal = pd.read_csv(<span class="string">"../data/2/train/PREC_METAL.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># è´µé‡‘å±è´¦æˆ·ä¿¡æ¯ï¼ˆPREC_METALï¼‰</span></span><br><span class="line">train_aget_insr = pd.read_csv(<span class="string">"../data/2/train/AGET_INSR.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET_INSRï¼‰</span></span><br><span class="line">train_idv_cust_basic = pd.read_csv(<span class="string">"../data/2/train/IDV_CUST_BASIC.csv"</span>, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆIDV_CUST_BASICï¼‰</span></span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2728: DtypeWarning: Columns (12) have mixed types. Specify dtype option on import or set low_memory=False.  interactivity=interactivity, compiler=compiler, result=result)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šæœŸçš„ä¸ªæ•°</span></span><br><span class="line">train_idv_td_3 = train_idv_td[train_idv_td[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">train_idv_td_AUM = train_idv_td_3[[<span class="string">'CUST_NO'</span>, <span class="string">'ARG_CRT_DAT'</span>]]</span><br><span class="line">train_idv_td_num = train_idv_td_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">train_idv_td_num.rename(columns=&#123;<span class="string">'ARG_CRT_DAT'</span>:<span class="string">'IDV_TD_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å›½å€ºçš„ä¸ªæ•°</span></span><br><span class="line">train_bond_3 = train_bond[train_bond[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">train_bond_AUM = train_bond_3[[<span class="string">'CUST_NO'</span>, <span class="string">'ARG_CRT_DAT'</span>]]</span><br><span class="line">train_bond_num = train_bond_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">train_bond_num.rename(columns=&#123;<span class="string">'ARG_CRT_DAT'</span>:<span class="string">'BOND_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºé‡‘çš„ä¸ªæ•°</span></span><br><span class="line">train_fund_3 = train_fund[train_fund[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">train_fund_AUM = train_fund[[<span class="string">'CUST_NO'</span>, <span class="string">'ARG_CRT_DAT'</span>]]</span><br><span class="line">train_fund_num = train_fund_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">train_fund_num.rename(columns=&#123;<span class="string">'ARG_CRT_DAT'</span>:<span class="string">'FUND_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è´µé‡‘å±çš„ä¸ªæ•°</span></span><br><span class="line">train_prec_metal_3 = train_prec_metal[train_prec_metal[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">train_prec_metal_3.dropna(subset=[<span class="string">'SIGD_DAT'</span>], inplace=<span class="keyword">True</span>)</span><br><span class="line">train_prec_metal_AUM = train_prec_metal_3[[<span class="string">'CUST_NO'</span>, <span class="string">'SIGD_DAT'</span>]]</span><br><span class="line">train_prec_metal_num = train_prec_metal_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">train_prec_metal_num.rename(columns=&#123;<span class="string">'SIGD_DAT'</span>:<span class="string">'PREC_METAL_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy  This is separate from the ipykernel package so we can avoid doing imports until</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿é™©çš„ä¸ªæ•°</span></span><br><span class="line">train_aget_insr_3 = train_aget_insr[train_aget_insr[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">train_aget_insr_3.dropna(subset=[<span class="string">'INSE_DAT'</span>], inplace=<span class="keyword">True</span>)</span><br><span class="line">train_aget_insr_AUM = train_aget_insr_3[[<span class="string">'CUST_NO'</span>, <span class="string">'INSE_DAT'</span>]]</span><br><span class="line">train_aget_insr_num = train_aget_insr_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">train_aget_insr_num.rename(columns=&#123;<span class="string">'INSE_DAT'</span>:<span class="string">'AGET_INSR_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrameSee the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy  This is separate from the ipykernel package so we can avoid doing imports until</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ID</span></span><br><span class="line">CUST_NO_LSIT = train_idv_cust_basic[<span class="string">'CUST_NO'</span>].reset_index().drop(<span class="string">'index'</span>, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå¹¶ä¸ºä¸€ä¸ªè¡¨</span></span><br><span class="line">CUST_NO_AUM_LSIT = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(CUST_NO_LSIT, train_idv_td_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_bond_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_fund_num, </span><br><span class="line">                            on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_prec_metal_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_aget_insr_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>).fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUST_NO_AUM_LSIT[<span class="string">'PRODUCTS_NUM'</span>] = CUST_NO_AUM_LSIT[[<span class="string">'IDV_TD_NUM'</span>,<span class="string">'BOND_NUM'</span>,<span class="string">'FUND_NUM'</span>,<span class="string">'PREC_METAL_NUM'</span>,<span class="string">'AGET_INSR_NUM'</span>]].sum(axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUST_NO_AUM_LSIT[CUST_NO_AUM_LSIT[<span class="string">'CUST_NO'</span>] == <span class="string">'a100d07faf0bc3c60d7d65abd704142a'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUST_NO_AUM_LSIT.head(<span class="number">100</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyAUMTest = pd.merge(CUST_NO_AUM_LSIT, train_cust_result, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyAUMTest.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUST_NO_AUM_LSIT.shape</span><br></pre></td></tr></table></figure><pre><code>(38256, 6)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³è”å…³ç³»</span></span><br><span class="line">g = sns.heatmap(MyAUMTest[[<span class="string">'FLAG'</span>, <span class="string">'IDV_TD_NUM'</span>,<span class="string">'BOND_NUM'</span>,<span class="string">'FUND_NUM'</span>,<span class="string">'PREC_METAL_NUM'</span>,<span class="string">'AGET_INSR_NUM'</span>,<span class="string">'PRODUCTS_NUM'</span>]].corr(), annot=<span class="keyword">True</span>, cmap=<span class="string">"coolwarm"</span>)</span><br></pre></td></tr></table></figure><pre><code>/root/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1320: UserWarning: findfont: Font family [&apos;sans-serif&apos;] not found. Falling back to DejaVu Sans  (prop.get_family(), self.defaultFamily[fontext]))</code></pre><p><img src="/assets/blogImg/OUTPUT_HEATMAP.png" alt="HEATMAP"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–åˆ°æ‰€æœ‰æŠ•èµ„ç§ç±»çš„å’Œ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AUM_NUMS</span><span class="params">(train_idv_td, train_bond, train_fund, train_prec_metal, train_aget_insr, train_idv_cust_basic)</span>:</span></span><br><span class="line">    <span class="comment"># å®šæœŸçš„ä¸ªæ•°</span></span><br><span class="line">    train_idv_td_3 = train_idv_td[train_idv_td[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">    train_idv_td_AUM = train_idv_td_3[[<span class="string">'CUST_NO'</span>, <span class="string">'ARG_CRT_DAT'</span>]]</span><br><span class="line">    train_idv_td_num = train_idv_td_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">    train_idv_td_num.rename(columns=&#123;<span class="string">'ARG_CRT_DAT'</span>:<span class="string">'IDV_TD_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># å›½å€ºçš„ä¸ªæ•°</span></span><br><span class="line">    train_bond_3 = train_bond[train_bond[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">    train_bond_AUM = train_bond_3[[<span class="string">'CUST_NO'</span>, <span class="string">'ARG_CRT_DAT'</span>]]</span><br><span class="line">    train_bond_num = train_bond_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">    train_bond_num.rename(columns=&#123;<span class="string">'ARG_CRT_DAT'</span>:<span class="string">'BOND_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># åŸºé‡‘çš„ä¸ªæ•°</span></span><br><span class="line">    train_fund_3 = train_fund[train_fund[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">    train_fund_AUM = train_fund[[<span class="string">'CUST_NO'</span>, <span class="string">'ARG_CRT_DAT'</span>]]</span><br><span class="line">    train_fund_num = train_fund_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">    train_fund_num.rename(columns=&#123;<span class="string">'ARG_CRT_DAT'</span>:<span class="string">'FUND_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># è´µé‡‘å±çš„ä¸ªæ•°</span></span><br><span class="line">    train_prec_metal_3 = train_prec_metal[train_prec_metal[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">    train_prec_metal_3.dropna(subset=[<span class="string">'SIGD_DAT'</span>], inplace=<span class="keyword">True</span>)</span><br><span class="line">    train_prec_metal_AUM = train_prec_metal_3[[<span class="string">'CUST_NO'</span>, <span class="string">'SIGD_DAT'</span>]]</span><br><span class="line">    train_prec_metal_num = train_prec_metal_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">    train_prec_metal_num.rename(columns=&#123;<span class="string">'SIGD_DAT'</span>:<span class="string">'PREC_METAL_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># ä¿é™©çš„ä¸ªæ•°</span></span><br><span class="line">    train_aget_insr_3 = train_aget_insr[train_aget_insr[<span class="string">'DATA_DAT'</span>]==<span class="number">3734035200</span>]</span><br><span class="line">    train_aget_insr_3.dropna(subset=[<span class="string">'INSE_DAT'</span>], inplace=<span class="keyword">True</span>)</span><br><span class="line">    train_aget_insr_AUM = train_aget_insr_3[[<span class="string">'CUST_NO'</span>, <span class="string">'INSE_DAT'</span>]]</span><br><span class="line">    train_aget_insr_num = train_aget_insr_AUM.groupby(<span class="string">'CUST_NO'</span>).count().reset_index()</span><br><span class="line">    train_aget_insr_num.rename(columns=&#123;<span class="string">'INSE_DAT'</span>:<span class="string">'AGET_INSR_NUM'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># å®¢æˆ·ID</span></span><br><span class="line">    CUST_NO_LSIT = train_idv_cust_basic[<span class="string">'CUST_NO'</span>].reset_index().drop(<span class="string">'index'</span>, axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># åˆå¹¶ä¸ºä¸€ä¸ªè¡¨</span></span><br><span class="line">    CUST_NO_AUM_LSIT = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(CUST_NO_LSIT, train_idv_td_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_bond_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_fund_num, </span><br><span class="line">                            on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_prec_metal_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>), train_aget_insr_num, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'outer'</span>).fillna(<span class="number">0</span>)</span><br><span class="line">    CUST_NO_AUM_LSIT[<span class="string">'PRODUCTS_NUM'</span>] = CUST_NO_AUM_LSIT[[<span class="string">'IDV_TD_NUM'</span>,<span class="string">'BOND_NUM'</span>,<span class="string">'FUND_NUM'</span>,<span class="string">'PREC_METAL_NUM'</span>,<span class="string">'AGET_INSR_NUM'</span>]].sum(axis=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> CUST_NO_AUM_LSIT</span><br></pre></td></tr></table></figure><h4 id="ä¸‰ä¸ªæœˆå˜åŠ¨"><a href="#ä¸‰ä¸ªæœˆå˜åŠ¨" class="headerlink" title="ä¸‰ä¸ªæœˆå˜åŠ¨"></a>ä¸‰ä¸ªæœˆå˜åŠ¨</h4><h5 id="å®šæœŸè´¦æˆ·"><a href="#å®šæœŸè´¦æˆ·" class="headerlink" title="å®šæœŸè´¦æˆ·"></a>å®šæœŸè´¦æˆ·</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_IDV_TD_METHOD</span><span class="params">(dataset_IDV_TD)</span>:</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†</span></span><br><span class="line">    <span class="comment"># ç®€åŒ–IDV_TDè¡¨</span></span><br><span class="line">    train_idv_td_temple = dataset_IDV_TD.drop([<span class="string">'ARG_CRT_DAT'</span>, <span class="string">'CLS_ACCT_DAT'</span>, <span class="string">'MATU_DAT'</span>, <span class="string">'LAC'</span>, <span class="string">'ACCT_STS_CD'</span>,<span class="string">'DP_DAY_CD'</span>, <span class="string">'RDEP_IND_CD'</span>, <span class="string">'RDEP_DP_DAY_CD'</span>, <span class="string">'RAT_CTG'</span>,<span class="string">'FXDI_SA_ACCM'</span>, <span class="string">'MTH_ACT_DAYS_TOT'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># å°†train_idv_tdå’Œtrain_base_excgåˆå¹¶</span></span><br><span class="line">    train_idv_td_temple = pd.merge(train_idv_td_temple, train_base_excg, on = <span class="string">'CCY_CD'</span>)</span><br><span class="line">    <span class="comment"># æ‰§è¡Œæ±‡ç‡è®¡ç®—å‡½æ•°</span></span><br><span class="line">    train_idv_td_temple[<span class="string">'CRBAL'</span>] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'CRBAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_td_temple[<span class="string">'REG_CAP'</span>] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'REG_CAP'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_td_temple[<span class="string">'FXDI_T_ACCM'</span>] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'FXDI_T_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_td_temple[<span class="string">'TDOP_SHD_PAY_INTS'</span>] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'TDOP_SHD_PAY_INTS'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_td_temple[<span class="string">'MOTH_CR_ACCM'</span>] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'MOTH_CR_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_td_temple = train_idv_td_temple.drop([<span class="string">'CCY_CD'</span>, <span class="string">'RMB_MID_PRIC'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æŒ‰æœˆå°†é‡‘é¢åˆ†ç±»</span></span><br><span class="line">    BY_MONTH_TD = train_idv_td_temple.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>])[[<span class="string">'CRBAL'</span>, <span class="string">'REG_CAP'</span>, <span class="string">'FXDI_T_ACCM'</span>, <span class="string">'TDOP_SHD_PAY_INTS'</span>, <span class="string">'MOTH_CR_ACCM'</span>]].sum().unstack()</span><br><span class="line">    <span class="comment"># å£°æ˜å‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_IDV_TD</span><span class="params">(key)</span>:</span></span><br><span class="line">        train_idv_td_temple_STD = BY_MONTH_TD[key].std(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_td_temple_STD.columns = [<span class="string">'CUST_NO'</span>, str(<span class="string">'IDV_TD_'</span>+key+<span class="string">'_STD'</span>)]</span><br><span class="line">        train_idv_td_temple_MEAN = BY_MONTH_TD[key].mean(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_td_temple_MEAN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'IDV_TD_'</span>+key+<span class="string">'_MEAN'</span>)]</span><br><span class="line">        train_idv_td_temple_MAX = BY_MONTH_TD[key].max(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_td_temple_MAX.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'IDV_TD_'</span>+key+<span class="string">'_MAX'</span>)]</span><br><span class="line">        train_idv_td_temple_MIN = BY_MONTH_TD[key].min(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_td_temple_MIN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'IDV_TD_'</span>+key+<span class="string">'_MIN'</span>)]</span><br><span class="line">        <span class="comment"># åˆå¹¶å­—æ®µ</span></span><br><span class="line">        train_idv_td_temple = pd.merge(train_idv_td_temple_STD, train_idv_td_temple_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_idv_td_temple = pd.merge(train_idv_td_temple, train_idv_td_temple_MAX, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_idv_td_temple = pd.merge(train_idv_td_temple, train_idv_td_temple_MIN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_idv_td_temple = train_idv_td_temple.fillna(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> train_idv_td_temple</span><br><span class="line">    train_idv_td_temple = BY_MONTH_IDV_TD(<span class="string">'CRBAL'</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">'REG_CAP'</span>, <span class="string">'FXDI_T_ACCM'</span>,<span class="string">'TDOP_SHD_PAY_INTS'</span>, <span class="string">'MOTH_CR_ACCM'</span>]:</span><br><span class="line">        train_idv_td_temple = pd.merge(train_idv_td_temple, BY_MONTH_IDV_TD(key))</span><br><span class="line">        train_idv_td_temple.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> train_idv_td_temple</span><br></pre></td></tr></table></figure><h5 id="æ´»æœŸè´¦æˆ·"><a href="#æ´»æœŸè´¦æˆ·" class="headerlink" title="æ´»æœŸè´¦æˆ·"></a>æ´»æœŸè´¦æˆ·</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_IDV_DPSA_METHOD</span><span class="params">(dataset_IDV_DPSA)</span>:</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†</span></span><br><span class="line">    <span class="comment"># å°†IDV_DPSAè¡¨ä¸æ±‡ç‡è¡¨æ•´åˆ</span></span><br><span class="line">    train_idv_dpsa_temple = pd.merge(dataset_IDV_DPSA, train_base_excg, on = <span class="string">'CCY_CD'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">    train_idv_dpsa_temple.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># æ‰§è¡Œæ±‡ç‡è®¡ç®—å‡½æ•°</span></span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'CRBAL'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis=<span class="number">1</span>, args = (<span class="string">'CRBAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'ITST_BRNG_ACCM'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis=<span class="number">1</span>, args = (<span class="string">'ITST_BRNG_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'FRZ_TOT_AMT'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'FRZ_TOT_AMT'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'DAY_WD_ACT_AMT'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_WD_ACT_AMT'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'DAY_CSH_DP_SUM'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_CSH_DP_SUM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'DAY_CSH_WD_SUM'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_CSH_WD_SUM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'DAY_TFI_SUM'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'DAY_TFI_SUM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'MOTH_CR_ACCM'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'MOTH_CR_ACCM'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple[<span class="string">'BEG_MOTH_CRBAL'</span>] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = <span class="number">1</span>, args = (<span class="string">'BEG_MOTH_CRBAL'</span>, <span class="string">'RMB_MID_PRIC'</span>))</span><br><span class="line">    train_idv_dpsa_temple = train_idv_dpsa_temple.drop([<span class="string">'CCY_CD'</span>, <span class="string">'RMB_MID_PRIC'</span>], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„</span></span><br><span class="line">    BY_MONTH_DPSA = train_idv_dpsa_temple.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'DATA_DAT'</span>])[[<span class="string">'CRBAL'</span>, <span class="string">'ITST_BRNG_ACCM'</span>,</span><br><span class="line">           <span class="string">'FRZ_TOT_AMT'</span>, <span class="string">'DAY_WD_ACT_AMT'</span>, <span class="string">'DAY_CSH_DP_SUM'</span>, <span class="string">'DAY_CSH_WD_SUM'</span>,</span><br><span class="line">           <span class="string">'DAY_TFI_SUM'</span>, <span class="string">'MOTH_CR_ACCM'</span>, <span class="string">'BEG_MOTH_CRBAL'</span>]].sum().unstack()</span><br><span class="line">    <span class="comment"># å£°æ˜å‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_IDV_DPSA</span><span class="params">(key)</span>:</span></span><br><span class="line">        train_idv_dpsa_temple_STD = BY_MONTH_DPSA[key].std(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_dpsa_temple_STD.columns = [<span class="string">'CUST_NO'</span>, str(<span class="string">'IDV_DPSA_'</span>+key+<span class="string">'_STD'</span>)]</span><br><span class="line">        train_idv_dpsa_temple_MEAN = BY_MONTH_DPSA[key].mean(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_dpsa_temple_MEAN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'IDV_DPSA_'</span>+key+<span class="string">'_MEAN'</span>)]</span><br><span class="line">        train_idv_dpsa_temple_MAX = BY_MONTH_DPSA[key].max(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_dpsa_temple_MAX.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'IDV_DPSA_'</span>+key+<span class="string">'_MAX'</span>)]</span><br><span class="line">        train_idv_dpsa_temple_MIN = BY_MONTH_DPSA[key].min(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_idv_dpsa_temple_MIN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'IDV_DPSA_'</span>+key+<span class="string">'_MIN'</span>)]</span><br><span class="line">        <span class="comment"># åˆå¹¶å­—æ®µ</span></span><br><span class="line">        train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple_STD, train_idv_dpsa_temple_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple, train_idv_dpsa_temple_MAX, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple, train_idv_dpsa_temple_MIN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_idv_dpsa_temple = train_idv_dpsa_temple.fillna(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> train_idv_dpsa_temple</span><br><span class="line">    train_idv_dpsa_temple = BY_MONTH_IDV_DPSA(<span class="string">'CRBAL'</span>)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> [<span class="string">'ITST_BRNG_ACCM'</span>,<span class="string">'FRZ_TOT_AMT'</span>, <span class="string">'DAY_WD_ACT_AMT'</span>, <span class="string">'DAY_CSH_DP_SUM'</span>, </span><br><span class="line">              <span class="string">'DAY_CSH_WD_SUM'</span>,<span class="string">'DAY_TFI_SUM'</span>, <span class="string">'MOTH_CR_ACCM'</span>, <span class="string">'BEG_MOTH_CRBAL'</span>]:</span><br><span class="line">        train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple, BY_MONTH_IDV_DPSA(key))</span><br><span class="line">        train_idv_dpsa_temple.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> train_idv_dpsa_temple</span><br></pre></td></tr></table></figure><h5 id="äº¤æ˜“ä¿¡æ¯"><a href="#äº¤æ˜“ä¿¡æ¯" class="headerlink" title="äº¤æ˜“ä¿¡æ¯"></a>äº¤æ˜“ä¿¡æ¯</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_TR_DC_METHOD</span><span class="params">(dataset_TR_DC)</span>:</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†</span></span><br><span class="line">    <span class="comment"># å»é™¤æŠ¹å¸(1),æ— æ„ä¹‰åˆ—ï¼Œè¿™é‡Œå…¨æ˜¯0</span></span><br><span class="line">    dataset_TR_DC = dataset_TR_DC[dataset_TR_DC[<span class="string">'CAN_IND'</span>]==<span class="number">0</span>].drop([<span class="string">'RED_BLU_CD'</span>, <span class="string">'CRD_TYP1'</span>, <span class="string">'TR_TYPE'</span>, <span class="string">'TR_CHANL_CD'</span>, <span class="string">'CAN_IND'</span>, </span><br><span class="line">                                                                      <span class="string">'CARD_USETYPE'</span>, <span class="string">'CARD_ELECASH'</span>, <span class="string">'CARD_MATERIAL'</span>],axis=<span class="number">1</span>)</span><br><span class="line">    dataset_TR_DC.drop_duplicates(subset=<span class="keyword">None</span>, keep=<span class="string">'first'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># äº¤æ˜“è¡¨æ—¶é—´æ®µæ‰“ä¸Šæ ‡ç­¾</span></span><br><span class="line">    <span class="comment"># 2æœˆä»½ [3726432000, 3728937600), 3æœˆä»½ [3728937600, 3731616000), 4æœˆä»½ [3731616000, 3734035200]</span></span><br><span class="line">    dataset_TR_DC[<span class="string">'TR_DAT'</span>] = pd.cut(dataset_TR_DC[<span class="string">'TR_DAT'</span>], [<span class="number">3726432000</span>, <span class="number">3728937600</span>, <span class="number">3731616000</span>, <span class="number">3734035200</span>], labels=[<span class="string">'2æœˆä»½'</span>, <span class="string">'3æœˆä»½'</span>, <span class="string">'4æœˆä»½'</span>])</span><br><span class="line">    <span class="comment"># å°†äº¤æ˜“æŒ‰ç…§ æ­£ / è´Ÿ åˆ†å¼€</span></span><br><span class="line">    train_tr_dc[<span class="string">'INCOME'</span>] = train_tr_dc[<span class="string">'TR_AMT'</span>] &gt; <span class="number">0</span></span><br><span class="line">    myseries = train_tr_dc.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'INCOME'</span>])[<span class="string">'TR_AMT'</span>].sum()</span><br><span class="line">    myseries = myseries.unstack().fillna(<span class="number">0</span>)</span><br><span class="line">    TR_DC_IN_OUT = pd.DataFrame(myseries).reset_index()</span><br><span class="line">    TR_DC_IN_OUT[<span class="string">'IN_SUM'</span>] = TR_DC_IN_OUT[<span class="keyword">True</span>]</span><br><span class="line">    TR_DC_IN_OUT[<span class="string">'OUT_SUM'</span>] = TR_DC_IN_OUT[<span class="keyword">False</span>]</span><br><span class="line">    TR_DC_IN_OUT = TR_DC_IN_OUT.drop([<span class="keyword">True</span>, <span class="keyword">False</span>], axis=<span class="number">1</span>)</span><br><span class="line">    BY_MONTH_DC = dataset_TR_DC.groupby([<span class="string">'CUST_NO'</span>, <span class="string">'TR_DAT'</span>])[[<span class="string">'TR_AMT'</span>]].sum().unstack()</span><br><span class="line">    <span class="comment"># å£°æ˜å‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BY_MONTH_TR_DC</span><span class="params">(key)</span>:</span></span><br><span class="line">        train_tr_dc_temple_STD = BY_MONTH_DC[key].std(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_tr_dc_temple_STD.columns = [<span class="string">'CUST_NO'</span>, str(<span class="string">'TR_DC_'</span>+key+<span class="string">'_STD'</span>)]</span><br><span class="line">        train_tr_dc_temple_MEAN = BY_MONTH_DC[key].mean(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_tr_dc_temple_MEAN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'TR_DC_'</span>+key+<span class="string">'_MEAN'</span>)]</span><br><span class="line">        train_tr_dc_temple_MAX = BY_MONTH_DC[key].max(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_tr_dc_temple_MAX.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'TR_DC_'</span>+key+<span class="string">'_MAX'</span>)]</span><br><span class="line">        train_tr_dc_temple_MIN = BY_MONTH_DC[key].min(axis=<span class="number">1</span>).reset_index()</span><br><span class="line">        train_tr_dc_temple_MIN.columns = [<span class="string">'CUST_NO'</span>,str(<span class="string">'TR_DC_'</span>+key+<span class="string">'_MIN'</span>)]</span><br><span class="line">        <span class="comment"># åˆå¹¶å­—æ®µ</span></span><br><span class="line">        train_tr_dc_temple = pd.merge(train_tr_dc_temple_STD, train_tr_dc_temple_MEAN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_tr_dc_temple = pd.merge(train_tr_dc_temple, train_tr_dc_temple_MAX, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_tr_dc_temple = pd.merge(train_tr_dc_temple, train_tr_dc_temple_MIN, on=<span class="string">'CUST_NO'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line">        train_tr_dc_temple = train_tr_dc_temple.fillna(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> train_tr_dc_temple</span><br><span class="line">    train_tr_dc_temple = BY_MONTH_TR_DC(<span class="string">'TR_AMT'</span>)</span><br><span class="line">    <span class="keyword">return</span> train_tr_dc_temple</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_tr_dc[<span class="string">'TR_DAT'</span>] = pd.cut(train_tr_dc[<span class="string">'TR_DAT'</span>], [<span class="number">3726432000</span>, <span class="number">3728937600</span>, <span class="number">3731616000</span>, <span class="number">3734035200</span>], labels=[<span class="string">'FEB'</span>, <span class="string">'MAR'</span>, <span class="string">'APR'</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BY_MONTH_TR_DC_METHOD = train_tr_dc[[<span class="string">'TR_DAT'</span>]]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.countplot(x=<span class="string">'TR_DAT'</span>, data=BY_MONTH_TR_DC_METHOD)</span><br></pre></td></tr></table></figure><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f0167e23a58&gt;</code></pre><p><img src="/assets/blogImg/OUTPUT_COUNTPLOT.png" alt="COUNTPLOT"></p><h4 id="å¹´é¾„"><a href="#å¹´é¾„" class="headerlink" title="å¹´é¾„"></a>å¹´é¾„</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿”å›å•ä¸ª æˆ– series çš„mså¯¹åº”æ—¥æœŸ, å†è¢« 2015 å‡å¾—åˆ°çš„å¹´æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adj_date</span><span class="params">(series, datatype=<span class="string">'series'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">    initial_year = <span class="number">2015</span></span><br><span class="line">    adj_msj_obj = datetime.strptime(<span class="string">"2042-08-31 16:00:00.123"</span>, <span class="string">"%Y-%m-%d %H:%M:%S.%f"</span>)</span><br><span class="line">    adj_ms = int(time.mktime(adj_msj_obj.timetuple())*<span class="number">1000</span> + adj_msj_obj.microsecond/<span class="number">1000.0</span>)/<span class="number">1000</span></span><br><span class="line">    current_ms = train_idv_cust_basic[<span class="string">'DATA_DAT'</span>][<span class="number">0</span>]   <span class="comment"># 3736713600</span></span><br><span class="line">    <span class="keyword">if</span>(datatype==<span class="string">'single'</span>):</span><br><span class="line">        <span class="keyword">return</span> initial_year - int(time.strftime(<span class="string">"%Y%m"</span>, time.localtime(current_ms-adj_ms)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> series.map(<span class="keyword">lambda</span> x: initial_year - int(time.strftime(<span class="string">"%Y"</span>, time.localtime(x - adj_ms))) <span class="keyword">if</span> pd.notna(x) <span class="keyword">else</span> x)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¹´é¾„è®¡ç®—å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CALC_AGE</span><span class="params">(dataset_idv_cust_basic)</span>:</span></span><br><span class="line">    dataset_idv_cust_basic[<span class="string">'GC_BRTH'</span>] = dataset_idv_cust_basic[<span class="string">'GC_BRTH'</span>].fillna(dataset_idv_cust_basic[<span class="string">'GC_BRTH'</span>].mean())</span><br><span class="line">    dataset_idv_cust_basic[<span class="string">'AGE'</span>] = adj_date(dataset_idv_cust_basic[<span class="string">'GC_BRTH'</span>])</span><br><span class="line">    dataset_idv_cust_basic[<span class="string">'AGE'</span>] = np.where(dataset_idv_cust_basic[<span class="string">'AGE'</span>] &gt; <span class="number">100</span>, <span class="number">31</span>, dataset_idv_cust_basic[<span class="string">'AGE'</span>])</span><br><span class="line">    dataset_idv_cust_basic[<span class="string">'AGE'</span>] = np.where(dataset_idv_cust_basic[<span class="string">'AGE'</span>] &lt; <span class="number">16</span>, <span class="number">31</span>, dataset_idv_cust_basic[<span class="string">'AGE'</span>])</span><br><span class="line">    <span class="keyword">return</span> dataset_idv_cust_basic</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AGE = CALC_AGE(train_idv_cust_basic)[<span class="string">'AGE'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AGE.hist()</span><br></pre></td></tr></table></figure><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f01681b5cc0&gt;/root/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1320: UserWarning: findfont: Font family [&apos;sans-serif&apos;] not found. Falling back to DejaVu Sans  (prop.get_family(), self.defaultFamily[fontext]))</code></pre><p><img src="/assets/blogImg/OUTPUT_HIST.png" alt="HIST"></p><h4 id="æ‰€æœ‰èµ„äº§"><a href="#æ‰€æœ‰èµ„äº§" class="headerlink" title="æ‰€æœ‰èµ„äº§"></a>æ‰€æœ‰èµ„äº§</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tdå®šæœŸã€bondå›½å€ºã€fundåŸºé‡‘ã€prec_metalè´µé‡‘å±ã€aget_insrä¿é™©</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WEALTH</span><span class="params">(target,td,bond,fund,prec_metal,agent_insurance,thr_pty_cstd)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    # é”€æˆ·æ—¥æœŸå¿…é¡» &gt; 2æœˆåº•ï¼Œåˆçº¦å»ºç«‹æ—¥æœŸå¿…é¡» &lt; 4æœˆåº•</span></span><br><span class="line"><span class="string">        #gp = df_tr_train.groupby(['CUST_NO','TR_CD']).agg(&#123;'TR_AMT':['sum','mean','max','min','count','std']&#125;)</span></span><br><span class="line"><span class="string">        if len(suffix)==1:</span></span><br><span class="line"><span class="string">            td = td[td['DATA_DAT']==time_point[1]]</span></span><br><span class="line"><span class="string">            bond = bond[bond['DATA_DAT']==time_point[1]]</span></span><br><span class="line"><span class="string">            fund = fund[fund['DATA_DAT']==time_point[1]]</span></span><br><span class="line"><span class="string">            prec_metal = prec_metal[prec_metal['DATA_DAT']==time_point[1]]</span></span><br><span class="line"><span class="string">            agent_insurance = agent_insurance[agent_insurance['DATA_DAT']==time_point[1]]</span></span><br><span class="line"><span class="string">            thr_pty_cstd = thr_pty_cstd[thr_pty_cstd['DATA_DAT']==time_point[1]]</span></span><br><span class="line"><span class="string">        elif len(suffix)==2:</span></span><br><span class="line"><span class="string">            td = td[td['DATA_DAT']&gt;time_point[1]]</span></span><br><span class="line"><span class="string">            bond = bond[bond['DATA_DAT']&gt;time_point[1]]</span></span><br><span class="line"><span class="string">            fund = fund[fund['DATA_DAT']&gt;time_point[1]]</span></span><br><span class="line"><span class="string">            prec_metal = prec_metal[prec_metal['DATA_DAT']&gt;time_point[1]]</span></span><br><span class="line"><span class="string">            agent_insurance = agent_insurance[agent_insurance['DATA_DAT']&gt;time_point[1]]</span></span><br><span class="line"><span class="string">            thr_pty_cstd = thr_pty_cstd[thr_pty_cstd['DATA_DAT']&gt;time_point[1]]</span></span><br><span class="line"><span class="string">    '''</span>        </span><br><span class="line">            </span><br><span class="line">    <span class="comment"># é€‰å–å„è¡¨åˆå¹¶ç‰¹å¾</span></span><br><span class="line">    td = td[[<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>,<span class="string">'CRBAL'</span>,<span class="string">'MOTH_CR_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>]).sum().unstack().reset_index()</span><br><span class="line">    </span><br><span class="line">    bond = bond[[<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>,<span class="string">'ARG_CUR_BAL'</span>,<span class="string">'NVTA_MOTH_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>]).sum().unstack().reset_index()</span><br><span class="line">    </span><br><span class="line">    fund = fund[[<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>,<span class="string">'FUND_BAL'</span>,<span class="string">'FUND_BAL_MOTH_BAL_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>]).sum().unstack().reset_index()</span><br><span class="line">    </span><br><span class="line">    prec_metal = prec_metal[[<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>,<span class="string">'ARG_BAL'</span>,<span class="string">'MTH_ARG_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>]).sum().unstack().reset_index()</span><br><span class="line">    </span><br><span class="line">    agent_insurance = agent_insurance[[<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>,<span class="string">'BEG_MTH_PREM_BAL'</span>,<span class="string">'MTH_PREM_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>]).sum().unstack().reset_index()</span><br><span class="line">    </span><br><span class="line">    thr_pty_cstd = thr_pty_cstd[[<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>,<span class="string">'AVL_BAL'</span>,<span class="string">'MTH_ARG_BAL_ACCM'</span>]].groupby([<span class="string">'CUST_NO'</span>,<span class="string">'DATA_DAT'</span>]).sum().unstack().reset_index()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç†è´¢å„æœˆçš„é‡‘é¢ã€æŒæœ‰äº§å“çš„æ•°é‡ã€</span></span><br><span class="line">    wealth = pd.merge(target[[<span class="string">'CUST_NO'</span>]],td,on=[<span class="string">'CUST_NO'</span>],how=<span class="string">'outer'</span>)</span><br><span class="line">    wealth = pd.merge(wealth,bond,on=[<span class="string">'CUST_NO'</span>],how=<span class="string">'outer'</span>)</span><br><span class="line">    wealth = pd.merge(wealth,fund,on=[<span class="string">'CUST_NO'</span>],how=<span class="string">'outer'</span>)</span><br><span class="line">    wealth = pd.merge(wealth,prec_metal,on=[<span class="string">'CUST_NO'</span>],how=<span class="string">'outer'</span>)</span><br><span class="line">    wealth = pd.merge(wealth,thr_pty_cstd,on=[<span class="string">'CUST_NO'</span>],how=<span class="string">'outer'</span>)</span><br><span class="line">    wealth = pd.merge(wealth,agent_insurance,on=[<span class="string">'CUST_NO'</span>],how=<span class="string">'outer'</span>).fillna(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç†è´¢å„æœˆçš„é‡‘é¢ã€æŒæœ‰äº§å“çš„æ•°é‡ã€</span></span><br><span class="line">    <span class="comment">#wealth['WEALTH_BAL'] = wealth['CRBAL'] + wealth['ARG_CUR_BAL'] + wealth['FUND_BAL'] + wealth['ARG_BAL'] + wealth['BEG_MTH_PREM_BAL'] #+ wealth['AVL_BAL']</span></span><br><span class="line">    <span class="comment">#wealth['WEALTH_ACCM'] = wealth['MOTH_CR_ACCM'] + wealth['NVTA_MOTH_ACCM'] + wealth['FUND_BAL_MOTH_BAL_ACCM'] + wealth['MTH_ARG_ACCM'] + wealth['MTH_PREM_ACCM'] #+ wealth['MTH_ARG_BAL_ACCM']</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#wealth = wealth.groupby(['CUST_NO'])['WEALTH_BAL','WEALTH_ACCM'].sum().reset_index()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŒæœ‰çš„ç†è´¢äº§å“ç§ç±»ï¼ˆä¸åŒæœŸé™/åˆçº¦å»ºç«‹æ—¥æœŸã€ç›¸åŒå“ç§çš„ç®—ä¸åŒäº§å“ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é¦–ä»½ç†è´¢åˆçº¦å»ºç«‹æ—¶é—´ã€æœ€è¿‘ä¸€ä»½ç†è´¢åˆçº¦å»ºç«‹æ—¶é—´</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3ä¸ªæœˆå†…ä¹°å…¥ç†è´¢äº§å“æ¬¡æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3ä¸ªæœˆå­˜æ¬¾ç§¯æ•°ä¹‹å’Œï¼ˆæ´»æœŸï¼Œæ´»æœŸ+å®šæœŸ+ä¸‰æ–¹å­˜ç®¡ï¼‰</span></span><br><span class="line">    X = wealth.copy()</span><br><span class="line">    X[<span class="string">'WEALTH_BAL_1'</span>] = X[(<span class="string">'CRBAL'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'ARG_CUR_BAL'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'FUND_BAL'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'ARG_BAL'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'AVL_BAL'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'BEG_MTH_PREM_BAL'</span>, <span class="number">3728764800</span>)]</span><br><span class="line">    X[<span class="string">'WEALTH_BAL_2'</span>] = X[(<span class="string">'CRBAL'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'ARG_CUR_BAL'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'FUND_BAL'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'ARG_BAL'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'AVL_BAL'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'BEG_MTH_PREM_BAL'</span>, <span class="number">3731443200</span>)]</span><br><span class="line">    X[<span class="string">'WEALTH_BAL_3'</span>] = X[(<span class="string">'CRBAL'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'ARG_CUR_BAL'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'FUND_BAL'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'ARG_BAL'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'AVL_BAL'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'BEG_MTH_PREM_BAL'</span>, <span class="number">3734035200</span>)]</span><br><span class="line">    X[<span class="string">'WEALTH_ACCM_1'</span>] = X[(<span class="string">'MOTH_CR_ACCM'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'NVTA_MOTH_ACCM'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'FUND_BAL_MOTH_BAL_ACCM'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'MTH_ARG_ACCM'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'MTH_ARG_BAL_ACCM'</span>, <span class="number">3728764800</span>)]+X[(<span class="string">'MTH_PREM_ACCM'</span>, <span class="number">3728764800</span>)]</span><br><span class="line">    X[<span class="string">'WEALTH_ACCM_2'</span>] = X[(<span class="string">'MOTH_CR_ACCM'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'NVTA_MOTH_ACCM'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'FUND_BAL_MOTH_BAL_ACCM'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'MTH_ARG_ACCM'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'MTH_ARG_BAL_ACCM'</span>, <span class="number">3731443200</span>)]+X[(<span class="string">'MTH_PREM_ACCM'</span>, <span class="number">3731443200</span>)]</span><br><span class="line">    X[<span class="string">'WEALTH_ACCM_3'</span>] = X[(<span class="string">'MOTH_CR_ACCM'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'NVTA_MOTH_ACCM'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'FUND_BAL_MOTH_BAL_ACCM'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'MTH_ARG_ACCM'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'MTH_ARG_BAL_ACCM'</span>, <span class="number">3734035200</span>)]+X[(<span class="string">'MTH_PREM_ACCM'</span>, <span class="number">3734035200</span>)]</span><br><span class="line">    </span><br><span class="line">    X2 = X[[<span class="string">'CUST_NO'</span>,<span class="string">'WEALTH_BAL_1'</span>,<span class="string">'WEALTH_BAL_2'</span>,<span class="string">'WEALTH_BAL_3'</span>,<span class="string">'WEALTH_ACCM_1'</span>,<span class="string">'WEALTH_ACCM_2'</span>,<span class="string">'WEALTH_ACCM_3'</span>]].set_index(<span class="string">'CUST_NO'</span>)</span><br><span class="line">    </span><br><span class="line">    X2[<span class="string">'WEALTH_BAL_MAX'</span>] = X2[[<span class="string">'WEALTH_BAL_1'</span>,<span class="string">'WEALTH_BAL_2'</span>,<span class="string">'WEALTH_BAL_3'</span>]].max(axis=<span class="number">1</span>)</span><br><span class="line">    X2[<span class="string">'WEALTH_BAL_MEAN'</span>] = X2[[<span class="string">'WEALTH_BAL_1'</span>,<span class="string">'WEALTH_BAL_2'</span>,<span class="string">'WEALTH_BAL_3'</span>]].mean(axis=<span class="number">1</span>)</span><br><span class="line">    X2[<span class="string">'WEALTH_BAL_STD'</span>] = X2[[<span class="string">'WEALTH_BAL_1'</span>,<span class="string">'WEALTH_BAL_2'</span>,<span class="string">'WEALTH_BAL_3'</span>]].std(axis=<span class="number">1</span>).fillna(<span class="number">0.0</span>)</span><br><span class="line">    X2[<span class="string">'WEALTH_BAL_CV'</span>] = X2[<span class="string">'WEALTH_BAL_STD'</span>]/X2[<span class="string">'WEALTH_BAL_MEAN'</span>]</span><br><span class="line">    X2[<span class="string">'WEALTH_ACCM_MAX'</span>] = X2[[<span class="string">'WEALTH_ACCM_1'</span>,<span class="string">'WEALTH_ACCM_2'</span>,<span class="string">'WEALTH_ACCM_3'</span>]].max(axis=<span class="number">1</span>)</span><br><span class="line">    X2[<span class="string">'WEALTH_ACCM_MEAN'</span>] = X2[[<span class="string">'WEALTH_ACCM_1'</span>,<span class="string">'WEALTH_ACCM_2'</span>,<span class="string">'WEALTH_ACCM_3'</span>]].mean(axis=<span class="number">1</span>)</span><br><span class="line">    X2[<span class="string">'WEALTH_ACCM_STD'</span>] = X2[[<span class="string">'WEALTH_ACCM_1'</span>,<span class="string">'WEALTH_ACCM_2'</span>,<span class="string">'WEALTH_ACCM_3'</span>]].std(axis=<span class="number">1</span>).fillna(<span class="number">0.0</span>)</span><br><span class="line">    X2[<span class="string">'WEALTH_ACCM_CV'</span>] = X2[<span class="string">'WEALTH_ACCM_STD'</span>]/X2[<span class="string">'WEALTH_ACCM_MEAN'</span>]    </span><br><span class="line">    </span><br><span class="line">    X3 = X2.fillna(<span class="number">0.0</span>).drop([<span class="string">'WEALTH_BAL_1'</span>,<span class="string">'WEALTH_BAL_2'</span>,<span class="string">'WEALTH_BAL_3'</span>,<span class="string">'WEALTH_ACCM_1'</span>,<span class="string">'WEALTH_ACCM_2'</span>,<span class="string">'WEALTH_ACCM_3'</span>,<span class="string">'WEALTH_BAL_STD'</span>,<span class="string">'WEALTH_ACCM_STD'</span>],axis=<span class="number">1</span>).reset_index()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> X3[[<span class="string">'CUST_NO'</span>,<span class="string">'WEALTH_ACCM_MEAN'</span>,<span class="string">'WEALTH_ACCM_CV'</span>]]</span><br></pre></td></tr></table></figure><h3 id="ç»“æœæŒ–æ˜"><a href="#ç»“æœæŒ–æ˜" class="headerlink" title="ç»“æœæŒ–æ˜"></a>ç»“æœæŒ–æ˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_cust_result_1 = train_cust_result[train_cust_result[<span class="string">'FLAG'</span>]==<span class="number">1</span>]</span><br><span class="line">train_cust_result_0 = train_cust_result[train_cust_result[<span class="string">'FLAG'</span>]==<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lightgbm <span class="keyword">import</span> LGBMRegressor</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! pip install lightgbm<span class="number">-2.2</span><span class="number">.3</span>-py2.py3-none-manylinux1_x86_64.whl</span><br></pre></td></tr></table></figure><pre><code>Processing ./lightgbm-2.2.3-py2.py3-none-manylinux1_x86_64.whlRequirement already satisfied: scikit-learn in /root/anaconda3/lib/python3.6/site-packages (from lightgbm==2.2.3)Requirement already satisfied: scipy in /root/anaconda3/lib/python3.6/site-packages (from lightgbm==2.2.3)Requirement already satisfied: numpy in /root/anaconda3/lib/python3.6/site-packages (from lightgbm==2.2.3)Installing collected packages: lightgbmSuccessfully installed lightgbm-2.2.3</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! cp ./xgb_rfm-Copy1.ipynb ./xgb_rfm-Copy2.ipynb</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! pip install imbalanced-learn</span><br></pre></td></tr></table></figure><pre><code>Requirement already satisfied: imbalanced-learn in /root/anaconda3/lib/python3.6/site-packagesRequirement already satisfied: scipy&gt;=0.17 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn)Requirement already satisfied: joblib&gt;=0.11 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn)Requirement already satisfied: scikit-learn&gt;=0.21 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn)Requirement already satisfied: numpy&gt;=1.11 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn)</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ã‚‚ã†ä¸€å›ã‚‚ã†ä¸€å›è¡Œã“ã†ãœ åƒ•ã‚‰ã®å£°&lt;/p&gt;
&lt;p&gt;ã‚¢ã‚¤ãƒ ã‚¢ãƒ«ãƒ¼ã‚¶ãƒ¼ ãšã£ã¨å‰ã‹ã‚‰èã“ãˆã¦ãŸ&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Python" scheme="https://www.leezy.top/tags/Python/"/>
    
      <category term="æ•°æ®æŒ–æ˜" scheme="https://www.leezy.top/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title>CentOSå®‰è£…MySQL 8.0</title>
    <link href="https://www.leezy.top/2019/02/27/CentOS%E5%AE%89%E8%A3%85MySQL8/"/>
    <id>https://www.leezy.top/2019/02/27/CentOSå®‰è£…MySQL8/</id>
    <published>2019-02-27T08:22:21.000Z</published>
    <updated>2019-12-12T09:57:13.057Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS MySQLçš„å®‰è£…å’Œé…ç½®è®°å½•ã€‚</p><a id="more"></a><h3 id="å®‰è£…MySQL"><a href="#å®‰è£…MySQL" class="headerlink" title="å®‰è£…MySQL"></a>å®‰è£…MySQL</h3><ol><li><p>æ‰“å¼€å®˜ç½‘  <a href="https://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/repo/yum/</a> ä¸‹è½½(mysql80-community-release-el7-2.noarch.rpm)rpmæ–‡ä»¶</p></li><li><p>é€šè¿‡ WinSCPå°†æ–‡ä»¶ä¸Šä¼ è‡³ /usr/ ç›®å½•ä¸‹</p></li><li><p>æœ¬åœ°å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql80-community-release-el7-2.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹MySQL çš„æ‰€æœ‰ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist all | grep mysql</span><br></pre></td></tr></table></figure></li><li><p>é»˜è®¤ä¼šä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --disable mysql80-community</span><br><span class="line">sudo yum-config-manager --enable mysql57-community</span><br></pre></td></tr></table></figure></li></ol><p>æ¥è°ƒæ•´é»˜è®¤ç‰ˆæœ¬ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹ /etc/yum.repos.d/mysql-community.repo ä¸­enabledçš„å€¼(1 æˆ– 0)æ¥è¿›è¡Œä¿®æ”¹ã€‚<br>6. å®‰è£…MySQL</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install mysql-community-server</span><br></pre></td></tr></table></figure><ol start="7"><li><p>å¯åŠ¨MySQL</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysqld start</span><br></pre></td></tr></table></figure></li><li><p>ç”¨ä¸´æ—¶å¯†ç ç™»å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> sudo grep 'temporary password' /var/log/mysqld.log</span><br><span class="line"> mysql -uroot -p</span><br><span class="line"><span class="meta"> #</span> ä¿®æ”¹å¯†ç </span><br><span class="line"> ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass4!';</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹MySQLç‰ˆæœ¬</span><br><span class="line"> SHOW VARIABLES WHERE Variable_name = 'version';</span><br></pre></td></tr></table></figure></li><li><p>å…è®¸è¿œç¨‹è¿æ¥MySQLæ•°æ®åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> é¦–å…ˆç¡®ä¿3306ç«¯å£å¼€æ”¾</span><br><span class="line">user mysql</span><br><span class="line"><span class="meta">#</span> åˆ›å»ºç”¨æˆ·</span><br><span class="line">CREATE USER 'myuser'@'%' IDENTIFIED BY 'password';  (myuser å’Œ password æ›¿æ¢)</span><br><span class="line">GRANT ALL ON *.* TO 'myuser'@'%' WITH GRANT OPTION; (myuser æ›¿æ¢)</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CentOS MySQLçš„å®‰è£…å’Œé…ç½®è®°å½•ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Linux" scheme="https://www.leezy.top/tags/Linux/"/>
    
      <category term="MySQL" scheme="https://www.leezy.top/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Shiro å®‰å…¨æ¡†æ¶å­¦ä¹ ç¬”è®°</title>
    <link href="https://www.leezy.top/2019/02/26/Shiro%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B/"/>
    <id>https://www.leezy.top/2019/02/26/Shiroå®‰å…¨æ¡†æ¶ç®€ä»‹/</id>
    <published>2019-02-26T13:41:21.000Z</published>
    <updated>2019-09-18T12:12:30.741Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•æˆ‘å­¦ä¹ å®‰å…¨æ¡†æ¶Shiroçš„ä¸€äº›ç¬”è®°ã€‚</p><a id="more"></a><h3 id="Shiro-VS-Spring-Security"><a href="#Shiro-VS-Spring-Security" class="headerlink" title="Shiro VS Spring Security"></a>Shiro VS Spring Security</h3><p>Apache Shiro<br>ç®€å•çµæ´»ï¼Œå¯è„±ç¦»Springï¼Œç²’åº¦è¾ƒç²—ï¼›å¯ä»¥è‡ªå·±æ‹“å±•ï¼Œé€‚åˆé€šè¿‡èµ„æºè¿›è¡Œæƒé™æ§åˆ¶ï¼›<br>Spring Security<br>å¤æ‚ç¬¨é‡ï¼Œä¸å¯è„±ç¦»Springï¼ŒåŠ›åº¦æ›´ç»†ï¼›é€‚åˆåšæ•°æ®æƒé™æ§åˆ¶ï¼›</p><h3 id="Shiroçš„è®¤è¯è¿‡ç¨‹"><a href="#Shiroçš„è®¤è¯è¿‡ç¨‹" class="headerlink" title="Shiroçš„è®¤è¯è¿‡ç¨‹"></a>Shiroçš„è®¤è¯è¿‡ç¨‹</h3><ol><li>åˆ›å»ºSecurity Manager</li><li>ä¸»ä½“æäº¤è®¤è¯</li><li>Security Managerè®¤è¯</li><li>Authenticatorè®¤è¯</li><li>Realmè®¤è¯</li></ol><p>ä»£ç å¦‚ä¸‹ï¼š<br>javaä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.shirotest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.SimpleAccountRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">SimpleAccountRealm simpleAccountRealm = <span class="keyword">new</span> SimpleAccountRealm();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">simpleAccountRealm.addAccount(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1. æ„å»ºSecurityManagerç¯å¢ƒ</span></span><br><span class="line">DefaultSecurityManager defaultSecurityManager = <span class="keyword">new</span> DefaultSecurityManager();</span><br><span class="line"><span class="comment">// å°†SimpleAccountRealmè®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­æ¥</span></span><br><span class="line">defaultSecurityManager.setRealm(simpleAccountRealm);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span></span><br><span class="line">SecurityUtils.setSecurityManager(defaultSecurityManager);</span><br><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>);</span><br><span class="line">subject.login(token);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"isAuthenticated: "</span> + subject.isAuthenticated());</span><br><span class="line">subject.isAuthenticated();</span><br><span class="line"></span><br><span class="line">subject.logout();</span><br><span class="line">System.out.println(<span class="string">"isAuthenticated: "</span> + subject.isAuthenticated());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pomæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leezy.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shirotest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>shirotest<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>/.</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Shiroæˆæƒ"><a href="#Shiroæˆæƒ" class="headerlink" title="Shiroæˆæƒ"></a>Shiroæˆæƒ</h3><ol><li>åˆ›å»º Security Manager</li><li>ä¸»ä½“æˆæƒ</li><li>Security Manager æˆæƒ</li><li>Authorizerè®¤è¯</li><li>Realm è·å–è§’è‰²æƒé™æ•°æ®</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.shirotest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.SimpleAccountRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">SimpleAccountRealm simpleAccountRealm = <span class="keyword">new</span> SimpleAccountRealm();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">simpleAccountRealm.addAccount(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>, <span class="string">"admin"</span>, <span class="string">"user"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1. æ„å»ºSecurityManagerç¯å¢ƒ</span></span><br><span class="line">DefaultSecurityManager defaultSecurityManager = <span class="keyword">new</span> DefaultSecurityManager();</span><br><span class="line"><span class="comment">// å°†SimpleAccountRealmè®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­æ¥</span></span><br><span class="line">defaultSecurityManager.setRealm(simpleAccountRealm);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span></span><br><span class="line">SecurityUtils.setSecurityManager(defaultSecurityManager);</span><br><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>);</span><br><span class="line">subject.login(token);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"isAuthenticated: "</span> + subject.isAuthenticated());</span><br><span class="line">subject.isAuthenticated();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥ä¸€ä¸ªè§’è‰²</span></span><br><span class="line"><span class="comment">// subject.checkRole("admin");</span></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦å…·å¤‡å‚æ•°é‡Œæ‰€æœ‰çš„è§’è‰²ï¼Œé€šè¿‡éå†å‚æ•°æ¥è¿›è¡Œæˆæƒ</span></span><br><span class="line">subject.checkRoles(<span class="string">"admin"</span>, <span class="string">"user"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="InitRealmçš„ä½¿ç”¨"><a href="#InitRealmçš„ä½¿ç”¨" class="headerlink" title="InitRealmçš„ä½¿ç”¨"></a>InitRealmçš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.shirotest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.text.IniRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitRealmTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">IniRealm iniRealm = <span class="keyword">new</span> IniRealm(<span class="string">"classpath:user.ini"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æ„å»ºSecurityManagerç¯å¢ƒ</span></span><br><span class="line">DefaultSecurityManager defaultSecurityManager = <span class="keyword">new</span> DefaultSecurityManager();</span><br><span class="line">defaultSecurityManager.setRealm(iniRealm);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span></span><br><span class="line">SecurityUtils.setSecurityManager(defaultSecurityManager);</span><br><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>);</span><br><span class="line">subject.login(token);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"isAuthenticated: "</span> + subject.isAuthenticated());</span><br><span class="line"></span><br><span class="line">subject.checkRole(<span class="string">"admin"</span>);</span><br><span class="line"></span><br><span class="line">subject.checkPermission(<span class="string">"user:delete"</span>);</span><br><span class="line">subject.checkPermission(<span class="string">"user:update"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>user.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="attr">LEEZY</span>=<span class="number">123456</span>,admin</span><br><span class="line"><span class="section">[roles]</span></span><br><span class="line"><span class="attr">admin</span>=user:delete,user:update</span><br></pre></td></tr></table></figure><h3 id="JDBCRealmçš„ä½¿ç”¨"><a href="#JDBCRealmçš„ä½¿ç”¨" class="headerlink" title="JDBCRealmçš„ä½¿ç”¨"></a>JDBCRealmçš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.shirotest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.jdbc.JdbcRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcRealmTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">dataSource.setUrl(<span class="string">"jdbc:mysql://192.168.56.101:3306/test"</span>);</span><br><span class="line">dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">dataSource.setPassword(<span class="string">"Zdh!123456"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">JdbcRealm jdbcRealm = <span class="keyword">new</span> JdbcRealm();</span><br><span class="line">jdbcRealm.setDataSource(dataSource);</span><br><span class="line"><span class="comment">// å¼€å¯åæ‰å¯ä»¥è¿›è¡Œæƒé™è®¤è¯(é»˜è®¤å…³é—­)</span></span><br><span class="line">jdbcRealm.setPermissionsLookupEnabled(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">String select_sql = <span class="string">"select password from test_user where username = ?"</span>;</span><br><span class="line">jdbcRealm.setAuthenticationQuery(select_sql);</span><br><span class="line"></span><br><span class="line">String role_sql = <span class="string">"select role_name from test_user_role where user_name = ?"</span>;</span><br><span class="line">jdbcRealm.setUserRolesQuery(role_sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æ„å»ºSecurityManagerç¯å¢ƒ</span></span><br><span class="line">DefaultSecurityManager defaultSecurityManager = <span class="keyword">new</span> DefaultSecurityManager();</span><br><span class="line">defaultSecurityManager.setRealm(jdbcRealm);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span></span><br><span class="line">SecurityUtils.setSecurityManager(defaultSecurityManager);</span><br><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"SAKURA"</span>, <span class="string">"123456"</span>);</span><br><span class="line">subject.login(token);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"isAuthenticated: "</span> + subject.isAuthenticated());</span><br><span class="line"></span><br><span class="line">subject.checkRole(<span class="string">"admin"</span>);</span><br><span class="line"></span><br><span class="line">subject.checkPermission(<span class="string">"user:select"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MySQLé©±åŠ¨åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹JdbcRealmæºç å¯ä»¥å‘ç°ï¼Œå®ƒæœ‰é»˜è®¤çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œåªè¦å»ºç«‹ç›¸åº”çš„æ•°æ®è¡¨å°±å¯ä»¥ã€‚</p><h3 id="è‡ªå®šä¹‰Realm"><a href="#è‡ªå®šä¹‰Realm" class="headerlink" title="è‡ªå®šä¹‰Realm"></a>è‡ªå®šä¹‰Realm</h3><p>è‡ªå®šä¹‰Realmç»§æ‰¿AuthorizingRealm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.realm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span></span>&#123;</span><br><span class="line">Map&lt;String, String&gt; userMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">userMap.put(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>);</span><br><span class="line"><span class="keyword">super</span>.setName(<span class="string">"CustomRealm"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆæƒ</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">String username = (String) principals.getPrimaryPrincipal();</span><br><span class="line"><span class="comment">// ä»æ•°æ®åº“æˆ–è€…ç¼“å­˜ä¸­è·å–è§’è‰²æ•°æ®</span></span><br><span class="line">Set&lt;String&gt; roles = getRolesByUserName(username);</span><br><span class="line"></span><br><span class="line">Set&lt;String&gt; permissions = getPermissionsByUserName(username);</span><br><span class="line">SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">info.setRoles(roles);</span><br><span class="line">info.setStringPermissions(permissions);</span><br><span class="line"><span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¤è¯</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1 ä»ä¸»ä½“ä¼ è¿‡æ¥çš„è®¤è¯ä¿¡æ¯ä¸­è·å¾—ç”¨æˆ·å</span></span><br><span class="line">String username = (String) token.getPrincipal();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.é€šè¿‡ç”¨æˆ·ååˆ°æ•°æ®åº“ä¸­è·å–å‡­è¯</span></span><br><span class="line">String password = getPasswordByUserName(username);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(password == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimpleAuthenticationInfo authenticationInfo = <span class="keyword">new</span> SimpleAuthenticationInfo(<span class="string">"LEEZY"</span>, password, <span class="string">"CustomRealm"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> authenticationInfo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®åº“ä¸­æƒé™æŸ¥è¯¢</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Set&lt;String&gt; <span class="title">getPermissionsByUserName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">Set&lt;String&gt; sets = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">sets.add(<span class="string">"user:delete"</span>);</span><br><span class="line">sets.add(<span class="string">"user:add"</span>);</span><br><span class="line"><span class="keyword">return</span> sets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®åº“ä¸­è§’è‰²æŸ¥è¯¢</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getRolesByUserName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">Set&lt;String&gt; sets = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">sets.add(<span class="string">"admin"</span>);</span><br><span class="line">sets.add(<span class="string">"user"</span>);</span><br><span class="line"><span class="keyword">return</span> sets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®åº“çš„æŸ¥è¯¢å‡­è¯</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getPasswordByUserName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userMap.get(username);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.shirotest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leezy.shiro.realm.CustomRealm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomRealmTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">CustomRealm customRealm = <span class="keyword">new</span> CustomRealm();</span><br><span class="line"><span class="comment">// 1. æ„å»ºSecurityManagerç¯å¢ƒ</span></span><br><span class="line">DefaultSecurityManager defaultSecurityManager = <span class="keyword">new</span> DefaultSecurityManager();</span><br><span class="line">defaultSecurityManager.setRealm(customRealm);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span></span><br><span class="line">SecurityUtils.setSecurityManager(defaultSecurityManager);</span><br><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>);</span><br><span class="line">subject.login(token);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"isAuthenticated: "</span> + subject.isAuthenticated());</span><br><span class="line"></span><br><span class="line">subject.checkRole(<span class="string">"admin"</span>);</span><br><span class="line"></span><br><span class="line">subject.checkPermission(<span class="string">"user:delete"</span>);</span><br><span class="line">subject.checkPermission(<span class="string">"user:add"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ShiroåŠ å¯†"><a href="#ShiroåŠ å¯†" class="headerlink" title="ShiroåŠ å¯†"></a>ShiroåŠ å¯†</h3><p>ShiroåŠ å¯†æ–¹å¼ï¼š</p><ol><li>HashedCredentialsMatcher</li><li>è‡ªå®šä¹‰Realmä¸­ä½¿ç”¨æ•£åˆ—</li><li>ç›çš„ä½¿ç”¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.realm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.Md5Hash;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span></span>&#123;</span><br><span class="line">Map&lt;String, String&gt; userMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨åŠ å¯†ä¹‹åçš„å¯†æ–‡</span></span><br><span class="line">userMap.put(<span class="string">"LEEZY"</span>, <span class="string">"e43a7da8514a1c9d566164b3ea731a4a"</span>);</span><br><span class="line"><span class="keyword">super</span>.setName(<span class="string">"CustomRealm"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆæƒ</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">String username = (String) principals.getPrimaryPrincipal();</span><br><span class="line"><span class="comment">// ä»æ•°æ®åº“æˆ–è€…ç¼“å­˜ä¸­è·å–è§’è‰²æ•°æ®</span></span><br><span class="line">Set&lt;String&gt; roles = getRolesByUserName(username);</span><br><span class="line"></span><br><span class="line">Set&lt;String&gt; permissions = getPermissionsByUserName(username);</span><br><span class="line">SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">info.setRoles(roles);</span><br><span class="line">info.setStringPermissions(permissions);</span><br><span class="line"><span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¤è¯</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1 ä»ä¸»ä½“ä¼ è¿‡æ¥çš„è®¤è¯ä¿¡æ¯ä¸­è·å¾—ç”¨æˆ·å</span></span><br><span class="line">String username = (String) token.getPrincipal();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.é€šè¿‡ç”¨æˆ·ååˆ°æ•°æ®åº“ä¸­è·å–å‡­è¯</span></span><br><span class="line">String password = getPasswordByUserName(username);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(password == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimpleAuthenticationInfo authenticationInfo = <span class="keyword">new</span> SimpleAuthenticationInfo(<span class="string">"LEEZY"</span>, password, <span class="string">"CustomRealm"</span>);</span><br><span class="line"><span class="comment">// å°†ç›è®¾ç½®è¿›å»</span></span><br><span class="line">authenticationInfo.setCredentialsSalt(ByteSource.Util.bytes(<span class="string">"SAKURA"</span>));</span><br><span class="line"><span class="keyword">return</span> authenticationInfo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®åº“ä¸­æƒé™æŸ¥è¯¢</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Set&lt;String&gt; <span class="title">getPermissionsByUserName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">Set&lt;String&gt; sets = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">sets.add(<span class="string">"user:delete"</span>);</span><br><span class="line">sets.add(<span class="string">"user:add"</span>);</span><br><span class="line"><span class="keyword">return</span> sets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®åº“ä¸­è§’è‰²æŸ¥è¯¢</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getRolesByUserName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">Set&lt;String&gt; sets = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">sets.add(<span class="string">"admin"</span>);</span><br><span class="line">sets.add(<span class="string">"user"</span>);</span><br><span class="line"><span class="keyword">return</span> sets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®åº“çš„æŸ¥è¯¢å‡­è¯</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getPasswordByUserName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userMap.get(username);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// MD5 + åŠ ç›</span></span><br><span class="line">Md5Hash md5Hash = <span class="keyword">new</span> Md5Hash(<span class="string">"123456"</span>, <span class="string">"SAKURA"</span>);</span><br><span class="line">System.out.println(md5Hash.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.shiro.shirotest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.credential.HashedCredentialsMatcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leezy.shiro.realm.CustomRealm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomRealmTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">CustomRealm customRealm = <span class="keyword">new</span> CustomRealm();</span><br><span class="line"><span class="comment">// 1. æ„å»ºSecurityManagerç¯å¢ƒ</span></span><br><span class="line">DefaultSecurityManager defaultSecurityManager = <span class="keyword">new</span> DefaultSecurityManager();</span><br><span class="line">defaultSecurityManager.setRealm(customRealm);</span><br><span class="line"></span><br><span class="line">HashedCredentialsMatcher matcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line"><span class="comment">// è®¾ç½®åŠ å¯†æ–¹å¼</span></span><br><span class="line">matcher.setHashAlgorithmName(<span class="string">"md5"</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®åŠ å¯†æ¬¡æ•°</span></span><br><span class="line">matcher.setHashIterations(<span class="number">1</span>);</span><br><span class="line">customRealm.setCredentialsMatcher(matcher);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span></span><br><span class="line">SecurityUtils.setSecurityManager(defaultSecurityManager);</span><br><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"LEEZY"</span>, <span class="string">"123456"</span>);</span><br><span class="line">subject.login(token);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"isAuthenticated: "</span> + subject.isAuthenticated());</span><br><span class="line"></span><br><span class="line">subject.checkRole(<span class="string">"admin"</span>);</span><br><span class="line"></span><br><span class="line">subject.checkPermission(<span class="string">"user:delete"</span>);</span><br><span class="line">subject.checkPermission(<span class="string">"user:add"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Shiroé›†æˆSpring"><a href="#Shiroé›†æˆSpring" class="headerlink" title="Shiroé›†æˆSpring"></a>Shiroé›†æˆSpring</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½•æˆ‘å­¦ä¹ å®‰å…¨æ¡†æ¶Shiroçš„ä¸€äº›ç¬”è®°ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="SHIRO" scheme="https://www.leezy.top/tags/SHIRO/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7 åŠ Ubuntu18 å¸¸ç”¨å‘½ä»¤æ€»ç»“</title>
    <link href="https://www.leezy.top/2019/02/03/CentOS7%20%E5%8F%8A%20Ubuntu18%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
    <id>https://www.leezy.top/2019/02/03/CentOS7 åŠ Ubuntu18 å¸¸ç”¨å‘½ä»¤æ€»ç»“/</id>
    <published>2019-02-03T06:27:03.000Z</published>
    <updated>2020-01-11T09:19:42.315Z</updated>
    
    <content type="html"><![CDATA[<p>å¸¸ç”¨çš„CentOSå‘½ä»¤æ€»ç»“ï¼Œæ–¹ä¾¿æŸ¥çœ‹ä¸è®°å¿†ã€‚</p><a id="more"></a><h2 id="Linuxå¸¸ç”¨å‘½ä»¤"><a href="#Linuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Linuxå¸¸ç”¨å‘½ä»¤"></a>Linuxå¸¸ç”¨å‘½ä»¤</h2><p>(1)æŸ¥çœ‹DNSè®°å½•çš„å‘½ä»¤ï¼ˆAè®°å½•ã€MXè®°å½•ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install bind-utils</span><br><span class="line"></span><br><span class="line">dig +noall +answer www.leezy.top</span><br></pre></td></tr></table></figure><p>(2) æŸ¥çœ‹ç«¯å£å¸¸ç”¨å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -lnp|grep 80</span><br></pre></td></tr></table></figure><p>(3) æŸ¥çœ‹ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ll /etc/*centos*</span><br><span class="line">cat /etc/centos-release</span><br></pre></td></tr></table></figure><p>(4) æŸ¥çœ‹å†…æ ¸<br>ç»å¸¸åœ¨æ‰§è¡Œ yum udpate å‘½ä»¤åCentOSä¼šå‡ºç°å¤šä¸ªå¯åŠ¨é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸è¦åˆ é™¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬</span><br><span class="line">uname -a</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„å…¨éƒ¨Kernel</span><br><span class="line">rpm -q kernel</span><br><span class="line"><span class="meta">#</span> åˆ é™¤å¤šä½™çš„å†…æ ¸å¯åŠ¨é¡¹</span><br><span class="line">yum remove kernel-3.10.0-957.el7.x86_64</span><br><span class="line"><span class="meta">#</span> é‡æ–°å¯åŠ¨</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>(5) ä¿®æ”¹ä¸»æœºå</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname NAME</span><br><span class="line"><span class="meta">#</span> é‡å¯æœºå™¨</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="CentOS-Minimalç‰ˆæœ¬é…ç½®"><a href="#CentOS-Minimalç‰ˆæœ¬é…ç½®" class="headerlink" title="CentOS Minimalç‰ˆæœ¬é…ç½®"></a>CentOS Minimalç‰ˆæœ¬é…ç½®</h2><h3 id="æ¢æºï¼š"><a href="#æ¢æºï¼š" class="headerlink" title="æ¢æºï¼š"></a>æ¢æºï¼š</h3><p><a href="http://mirrors.163.com/.help/centos.html" target="_blank" rel="noopener">http://mirrors.163.com/.help/centos.html</a></p><h3 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools</span><br><span class="line">yum install wget</span><br><span class="line">yum install vim</span><br></pre></td></tr></table></figure><h3 id="é…ç½®JAVAç¯å¢ƒå˜é‡"><a href="#é…ç½®JAVAç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®JAVAç¯å¢ƒå˜é‡"></a>é…ç½®JAVAç¯å¢ƒå˜é‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ç¯å¢ƒé…ç½®</span><br><span class="line">export JAVA_HOME=/usr/jdk-11.0.2</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/jre/lib/rt.jar:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar</span><br><span class="line">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin</span><br><span class="line"><span class="meta">#</span> ä½¿æ–°çš„ç¯å¢ƒç”Ÿæ•ˆ</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å½“Javaç‰ˆæœ¬æ›´æ–°æ—¶ï¼Œä»…ä»…ä¿®æ”¹JAVA_HOMEçš„è·¯å¾„æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦åˆ é™¤é“¾æ¥</span><br><span class="line">which java</span><br><span class="line">/usr/jdk_xxx/bin/java</span><br><span class="line"></span><br><span class="line">which javac </span><br><span class="line">/usr/jdk_xxx_/bin/javac</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤é“¾æ¥</span><br><span class="line">rm -rf /usr/jdk_xxx/bin/java</span><br><span class="line">rm -rf /usr/jdk_xxx_/bin/javac</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å†æ‰§è¡Œä½¿å¾—æ–°ç¯å¢ƒç”Ÿæ•ˆ</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h3 id="GitLab-CEç‰ˆå®‰è£…"><a href="#GitLab-CEç‰ˆå®‰è£…" class="headerlink" title="GitLab CEç‰ˆå®‰è£…"></a>GitLab CEç‰ˆå®‰è£…</h3><p>æ–°å»º /etc/yum.repos.d/gitlab-ce.repoï¼Œå†…å®¹ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><p>å†æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install curl openssh-server openssh-clients postfix cronie</span><br><span class="line">sudo service postfix start</span><br><span class="line">systemctl enable postfix.service</span><br><span class="line">(yum install lokkit)</span><br><span class="line">sudo lokkit -s http -s ssh</span><br><span class="line"></span><br><span class="line">sudo yum makecache</span><br><span class="line">sudo yum install gitlab-ce</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>å¯åŠ¨GitLab</span><br><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨çš„ç½‘ç»œé…ç½®"><a href="#å¸¸ç”¨çš„ç½‘ç»œé…ç½®" class="headerlink" title="å¸¸ç”¨çš„ç½‘ç»œé…ç½®"></a>å¸¸ç”¨çš„ç½‘ç»œé…ç½®</h3><p>ä¿®æ”¹DNS(è²Œä¼¼ä¼šé‡å¯å¤±æ•ˆ)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹IPåœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-enp0s3</span><br></pre></td></tr></table></figure><h3 id="æ¸…ç†å†…å­˜"><a href="#æ¸…ç†å†…å­˜" class="headerlink" title="æ¸…ç†å†…å­˜"></a>æ¸…ç†å†…å­˜</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</span><br><span class="line">free -h</span><br></pre></td></tr></table></figure><h3 id="Dockerå®‰è£…åŠé…ç½®"><a href="#Dockerå®‰è£…åŠé…ç½®" class="headerlink" title="Dockerå®‰è£…åŠé…ç½®"></a>Dockerå®‰è£…åŠé…ç½®</h3><p>Dockerå®˜æ–¹æ–‡æ¡£è®¿é—®<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>é˜¿é‡Œäº‘å®‰è£…æ–‡æ¡£<a href="https://yq.aliyun.com/articles/110806?spm=5176.8351553.0.0.4ef81991AdnpKb" target="_blank" rel="noopener">è¿™é‡Œ</a><br>Dockerå®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ä»…å…¬ç½‘ç¯å¢ƒï¼Œä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬</span><br><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure><p>ç”±äºç›´æ¥ä½¿ç”¨DockerHubä¸‹è½½çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„å®¹å™¨é•œåƒåŠ é€ŸæœåŠ¡,é˜¿é‡Œäº‘é…ç½®åœ°å€è®¿é—®ç½‘å€<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span><br><span class="line">&#123;</span><br><span class="line">  "registry-mirrors": ["åŠ é€Ÿå™¨åœ°å€"]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥å¿«é€Ÿçš„ä½¿ç”¨Docker pull ç­‰å‘½ä»¤äº†ã€‚<br>æ¸…ç†Dcoker å®¹å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune</span><br></pre></td></tr></table></figure><h3 id="å¼€æ”¾é˜²ç«å¢™ç«¯å£"><a href="#å¼€æ”¾é˜²ç«å¢™ç«¯å£" class="headerlink" title="å¼€æ”¾é˜²ç«å¢™ç«¯å£"></a>å¼€æ”¾é˜²ç«å¢™ç«¯å£</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> --permanent æ°¸ä¹…ç”Ÿæ•ˆ</span><br><span class="line">firewall-cmd --zone=public --add-port=9092/tcp --permanent</span><br><span class="line"><span class="meta">#</span> é‡æ–°è½½å…¥</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹</span><br><span class="line">firewall-cmd --zone=public --query-port=80/tcp</span><br><span class="line"><span class="meta">#</span> åˆ é™¤</span><br><span class="line">firewall-cmd --zone=public --remove-port=80/tcp --permanent</span><br></pre></td></tr></table></figure><h3 id="Puttyè¿æ¥Ubuntuè™šæ‹Ÿæœº"><a href="#Puttyè¿æ¥Ubuntuè™šæ‹Ÿæœº" class="headerlink" title="Puttyè¿æ¥Ubuntuè™šæ‹Ÿæœº"></a>Puttyè¿æ¥Ubuntuè™šæ‹Ÿæœº</h3><blockquote><p>é¦–å…ˆç¡®ä¿è‡ªå·±æœ‰rootæƒé™</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> è®¾ç½®rootå¯†ç </span><br><span class="line">sudo passwd</span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆé…ç½®Host-Onlyç½‘å¡ï¼Œç„¶åç‚¹å‡» <img src="/assets/blogImg/VirtualBox_NetWork.png" alt="VirtualBox é…ç½®">  <img src="/assets/blogImg/VirtualBox_Host_Only.png" alt="VirtualBox Host Only é…ç½®">  </li><li>ç™»å…¥è™šæ‹Ÿæœºä½¿ç”¨<code>ifconfig -a</code>å‘½ä»¤, å‘ç°ä¼šæœ‰ä¸‰ä¸ªç½‘å¡(lo-æœ¬åœ°ã€enp0s3-NETã€enp0s8-Host-Only), ä½†æ˜¯Host-Onlyæ²¡æœ‰IPåœ°å€</li><li>è¾“å…¥<code>sudo dhclient enp0s8</code>, å³å¯è·å–IPåœ°å€</li><li>Ubuntu 18.0æ–°ç‰ˆå, <code>/etc/network/interfaces</code>çš„æ–‡ä»¶é…ç½®å·²ç»è¢«å¼ƒç”¨, <code>vim /etc/netplan/50-cloud-init.yaml</code></li></ol><p>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file is generated from information provided by</span></span><br><span class="line"><span class="comment"># the datasource.  Changes to it will not persist across an instance.</span></span><br><span class="line"><span class="comment"># To disable cloud-init's network configuration capabilities, write a file</span></span><br><span class="line"><span class="comment"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span></span><br><span class="line"><span class="comment"># network: &#123;config: disabled&#125;</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line"><span class="attr">    ethernets:</span></span><br><span class="line"><span class="attr">        enp0s3:</span></span><br><span class="line"><span class="attr">            dhcp4:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        enp0s8:</span></span><br><span class="line"><span class="attr">            dhcp4:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">            addresses:</span> <span class="string">[192.168.56.101/24]</span></span><br><span class="line"><span class="attr">            nameservers:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">            optional:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    version:</span> <span class="number">2</span></span><br><span class="line"><span class="string">~</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œä»¥åç›´æ¥æ‰§è¡Œ <code>sudo netplan apply</code></p><ol start="5"><li>é‡å¯sshæœåŠ¡ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service ssh restart</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¸¸ç”¨çš„CentOSå‘½ä»¤æ€»ç»“ï¼Œæ–¹ä¾¿æŸ¥çœ‹ä¸è®°å¿†ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Linux" scheme="https://www.leezy.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé‡æ–°å®šä¹‰SpringCloudå®æˆ˜ã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="https://www.leezy.top/2018/12/18/SpringCloud%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.leezy.top/2018/12/18/SpringCloudå­¦ä¹ /</id>
    <published>2018-12-18T00:45:23.000Z</published>
    <updated>2019-12-16T06:44:06.010Z</updated>
    
    <content type="html"><![CDATA[<p>SpringCloudæä¾›äº†å¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ä¸­å¸¸è§æ¨¡å¼çš„å·¥å…·ï¼ŒåŒ…æ‹¬é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ç­‰ã€‚SpringCloudä¸­é—´ä»¶æ˜¯åŸºäºSpringBootçš„å®ç°ï¼Œæä¾›äº†å¯¹å¾®æœåŠ¡å®Œæ•´çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚</p><a id="more"></a><p>åº”ç”¨æ¶æ„çš„å‘å±•å†ç¨‹ï¼š<br>å•ä½“åº”ç”¨æ¶æ„ â€“&gt; åˆ†å¸ƒå¼æ¶æ„ â€“&gt;é¢å‘æœåŠ¡çš„SOAæ¶æ„ â€“&gt; å¾®æœåŠ¡æ¶æ„<br>SOAæ¶æ„ä¸ªäººç†è§£æ˜¯å¤šä¸ªåº”ç”¨ä¹‹é—´é€šè¿‡ä¼ä¸šæ•°æ®æ€»çº¿ESBé€šä¿¡çš„æ¶æ„ï¼Œå…¶åº”ç”¨ç¨‹åºé€šè¿‡ç½‘ç»œåè®®æä¾›æœåŠ¡ï¼Œæ¶ˆè´¹æœåŠ¡ï¼Œä¸åŒä¸šåŠ¡æä¾›ä¸åŒçš„æœåŠ¡ã€‚(é˜¿é‡Œçš„æœåŠ¡æ²»ç†æ¡†æ¶Dubbo)<br>å¾®æœåŠ¡æ¶æ„ï¼šä¸€ä¸ªå¤§å‹çš„åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¹‹é—´æ¾è€¦åˆï¼Œé€šè¿‡REST APIæˆ–è€…HTTPè¿›è¡Œé€šä¿¡ã€‚</p><p><img src="/assets/blogImg/SOA_VS_%E5%BE%AE%E6%9C%8D%E5%8A%A1.png" alt="SOA VS MA"></p><p>SpringCloudåŒ…åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š<br>æœåŠ¡æ²»ç†ç»„ä»¶ Eureka / Consul + å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç»„ä»¶ Ribbon + å£°æ˜å¼æœåŠ¡è°ƒç”¨ç»„ä»¶ Feign + APIç½‘å…³æ²»ç†ç»„ä»¶ Zuul / GateWay(é«˜å¹¶å‘) + ç†”æ–­æœºåˆ¶ HyStrix + åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒç»„ä»¶ Spring Cloud Config / æºç¨‹ Apollo + æ¶ˆæ¯æ€»çº¿ç»„ä»¶ Bus + æ¶ˆæ¯é©±åŠ¨ç»„ä»¶ Stream + åˆ†å¸ƒå¼æœåŠ¡è·Ÿè¸ªç»„ä»¶ Sleuth + å…¨é“¾è·¯ç›‘æ§ SkyWalking.</p><hr><p><em>Tips: ä»£ç åŸºäºSpring Cloud Finchley ç‰ˆæœ¬</em></p><hr><h2 id="æœåŠ¡æ²»ç†ï¼šSpring-Cloud-Eureka"><a href="#æœåŠ¡æ²»ç†ï¼šSpring-Cloud-Eureka" class="headerlink" title="æœåŠ¡æ²»ç†ï¼šSpring Cloud Eureka"></a>æœåŠ¡æ²»ç†ï¼šSpring Cloud Eureka</h2><p>è´Ÿè´£å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œå³å„ä¸ªå¾®æœåŠ¡å®ä¾‹çš„è‡ªåŠ¨åŒ–æ³¨å†Œä¸å‘ç°ã€‚<br>SpringCloud Eureka æ˜¯ç”± Netflix Eurekaå®ç°çš„ï¼Œå³åŒ…å«äº†æœåŠ¡ç«¯ç»„ä»¶ä¹ŸåŒ…å«äº†å®¢æˆ·ç«¯ç»„ä»¶ã€‚<br>EurekaæœåŠ¡ç«¯ä¹Ÿè¢«ç§°ä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå„ä¸ªå¾®æœåŠ¡å¯åŠ¨æ—¶ä¼šå‘Eureka Server æ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š<br>åœ¨<a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a> ä¸­æ–°å»ºä¸€ä¸ªEureka Serverçš„Demoï¼Œæˆ–è€…ç›´æ¥åœ¨Mavené¡¹ç›®ä¸­çš„pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹Dependence:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>eureka-server<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.RC1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>EurekaServerApplication.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.eureka_server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//è¯¥æ³¨è§£å¯åŠ¨ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒæä¾›ç»™å…¶ä»–åº”ç”¨ä¼šè¯</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaServerApplication</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello Eureka Server!"</span>);</span><br><span class="line">        SpringApplication.run(EurekaServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Eureka Server ä¸­çš„ application.yml å’Œ application-standalone.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">standalone</span></span><br><span class="line"><span class="attr">  jackson:</span></span><br><span class="line"><span class="attr">    serialization:</span></span><br><span class="line"><span class="attr">      FAIL_ON_EMPTY_BEANS:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  server:</span></span><br><span class="line"><span class="attr">    use-read-only-response-cache:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    response-cache-auto-expiration-in-seconds:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line"><span class="attr">  endpoints:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">      exposure:</span></span><br><span class="line"><span class="attr">        include:</span> <span class="string">'*'</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-standalone.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8761</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    registerWithEureka:</span> <span class="literal">false</span> <span class="comment">#æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Server, é»˜è®¤ä¸ºTrue</span></span><br><span class="line"><span class="attr">    fetchRegistry:</span> <span class="literal">false</span> <span class="comment">#æ˜¯å¦éœ€è¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯, é»˜è®¤ä¸ºTure</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span> <span class="comment"># æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡çš„åœ°å€ï¼Œå¤šä¸ªç”¨","éš”å¼€</span></span><br><span class="line"><span class="attr">  server:</span></span><br><span class="line"><span class="attr">      waitTimeInMsWhenSyncEmpty:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">      enableSelfPreservation:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€ <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> çœ‹åˆ°Eurekaçš„æ§åˆ¶é¢æ¿ã€‚<br>EurekaæœåŠ¡æ³¨å†Œç«¯ï¼Œ Eureka Clientå°†å¾®æœåŠ¡æ³¨å†Œåˆ°Eureka Serverä¸Šã€‚<br>EurekaClientApplication.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.eureka_client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// è¯¥æ³¨è§£é€‚é…æ€§æ¯”è¾ƒå¥½ï¼Œå¯ä»¥ç”¨äºå¤šç§æœåŠ¡å‘ç°ç»„ä»¶(Zookeeperã€Consul)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaClientApplication</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello Eureka Client!"</span>);</span><br><span class="line">        SpringApplication.run(EurekaClientApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Mavenä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Eureka Clientçš„é…ç½®æ–‡ä»¶ï¼š application.yml å’Œ application-demo.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">demo</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#application-demo.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">demo-leezy</span> <span class="comment">#å£°æ˜æœåŠ¡æä¾›è€…çš„åº”ç”¨åç§°</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8761/eureka/</span> <span class="comment">#è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€</span></span><br><span class="line"><span class="attr">    instance:</span> </span><br><span class="line"><span class="attr">      prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>åˆ·æ–°Eurekaæ§åˆ¶å°å°±å¯ä»¥çœ‹åˆ°æ³¨å†Œåˆ°Serverä¸Šçš„æœåŠ¡äº†ã€‚</p><p>Eurekaçš„è®¾è®¡ç†å¿µï¼š</p><ol><li>æœåŠ¡å®ä¾‹å¦‚ä½•æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒï¼š<br>ï¼ˆ1ï¼‰è°ƒç”¨Eureka Serverçš„REST API çš„ registeræ–¹æ³•<br>ï¼ˆ2ï¼‰Javaè¯­è¨€ä½¿ç”¨è€…å¯ä»¥è°ƒç”¨NetFlixçš„Eureka Clientå°è£…çš„API<br>ï¼ˆ3ï¼‰Spring Cloudä½¿ç”¨è€…åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•ç”¨ spring-cloud-starter-netflix-eureka-clientï¼ŒåŸºäºSpring Bootçš„è‡ªåŠ¨é…ç½®å³å¯ã€‚</li><li>æœåŠ¡å®ä¾‹ä»æœåŠ¡ä¸­å¿ƒå‰”é™¤<br>ï¼ˆ1ï¼‰æœåŠ¡å®ä¾‹æ­£å¸¸å…³é—­æ—¶ï¼Œé€šè¿‡é’©å­æ–¹æ³•æˆ–è€…ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•è°ƒç”¨Eureka Server çš„REST APIçš„de-registeræ–¹æ³•ã€‚<br>ï¼ˆ2ï¼‰Eurekaè¦æ±‚Clientå®šæ—¶ç»­çº¦(30s)ï¼Œå¦‚æœ90sæ²¡æœ‰ç»­çº¦æ“ä½œåˆ™Eureka Serverä¸»åŠ¨å‰”é™¤è¯¥æ“ä½œã€‚</li><li>æœåŠ¡å®ä¾‹ä¿¡æ¯çš„ä¸€è‡´æ€§é—®é¢˜<br>æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­å¿ƒåº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œå¦‚ä½•ä¿è¯ä¸€è‡´æ€§<br>ï¼ˆ1ï¼‰APä¼˜äºCP (Zookeeper-CP, Eureka-AP)<br>ï¼ˆ2ï¼‰Peer to Peeræ¶æ„(1. ä¸»ä»å¤åˆ¶ 2. å¯¹ç­‰å¤åˆ¶)<br>ï¼ˆ3ï¼‰ZoneåŠRegionè®¾è®¡<br>ï¼ˆ4ï¼‰SELF PRESERVATIONè®¾è®¡</li></ol><h2 id="WebServiceå®¢æˆ·ç«¯-Feign"><a href="#WebServiceå®¢æˆ·ç«¯-Feign" class="headerlink" title="WebServiceå®¢æˆ·ç«¯ Feign"></a>WebServiceå®¢æˆ·ç«¯ Feign</h2><p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„Web Serviceå®¢æˆ·ç«¯ï¼Œç”¨äºæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œæ”¯æŒSpringMVCæ³¨è§£ï¼Œæ•´åˆäº†Ribbonä»¥åŠHystrixã€‚<br>å¯¹åº”çš„POMä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åº”ç”¨å…¥å£ç¨‹åºSpringCloudFeignApplication.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hello_feign;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloFeignApplication</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SpringApplication.run(HelloFeignApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£ç±»ï¼šHelloFeignService.javaï¼Œä½œç”¨æ˜¯åº”ç”¨æŒ‡å®šçš„URLæœ€ç»ˆè½¬åŒ–ä¸ºGithub APIå…è®¸çš„URLã€‚<br>egï¼š<a href="https://api.github.com/search/repositories?q=spring-cloud" target="_blank" rel="noopener">https://api.github.com/search/repositories?q=spring-cloud</a><br>(Github RestAPIçš„æ–‡æ¡£ï¼š<a href="https://developer.github.com/v3/search/" target="_blank" rel="noopener">https://developer.github.com/v3/search/</a>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hello_feign.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leezy.hello_feign.config.HelloFeignServiceConfig;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"github-client"</span>, url = <span class="string">"https://api.github.com"</span>, configuration = HelloFeignServiceConfig.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloFeignService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/search/repositories"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function">String <span class="title">searchRepo</span><span class="params">(@RequestParam(name = <span class="string">"q"</span>)</span> String quertStr)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶ç±»ï¼šHelloFeignController.javaï¼Œä½œç”¨ï¼šè°ƒç”¨æœåŠ¡æä¾›è€…çš„æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hello_feign.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leezy.hello_feign.service.HelloFeignService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloFeignController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloFeignService helloFeignService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/search/github"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">searchGithubRepoByStr</span><span class="params">(@RequestParam(<span class="string">"str"</span>)</span> String queryStr) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloFeignService.searchRepo(queryStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ç±»ï¼šHelloFeignServiceConfig.javaï¼Œ@Beanæ³¨è§£é…ç½®æ—¥å¿—çš„bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hello_feign.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloFeignServiceConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.<span class="function">Level <span class="title">feignLoggerLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//levelæœ‰å››ä¸ªçº§åˆ«</span></span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶: application.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">Hello</span> <span class="string">Feign</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="attr">  level:</span></span><br><span class="line">    <span class="string">com.leezy.hello_feign.service.HelloFeignService:</span> <span class="string">DEBUG</span> <span class="comment">#åœ¨è¿™é‡Œé…ç½®æ—¥å¿—çš„è¾“å‡ºçº§åˆ«</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨åº”ç”¨åï¼Œè®¿é—®ç½‘å€ï¼š<a href="http://localhost:8010/search/github?str=spring-cloud" target="_blank" rel="noopener">http://localhost:8010/search/github?str=spring-cloud</a><br>Feignæ”¯æŒçš„å±æ€§æ–‡ä»¶é…ç½®æ–¹å¼æœ‰ä¸¤ç§ï¼š<br>application.yml(application.properties) ä»¥åŠ Javaæ–¹å¼çš„é…ç½®ç±»ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§ä¼šé«˜äºJavaç±»çš„ä¼˜å…ˆçº§ã€‚<br>Feigné»˜è®¤çš„æ˜¯JDKåŸç”Ÿçš„URL Connectionï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨è¿æ¥æ± ï¼Œå¯ä»¥ç”¨Http Clientå’Œ okHttpè¿›è¡Œæ›¿æ¢å¯¹é¡¹ç›®è¿›è¡Œè°ƒä¼˜ã€‚</p><h3 id="Feign-çš„-POST-å’Œ-GET-çš„å¤šå‚æ•°ä¼ é€’"><a href="#Feign-çš„-POST-å’Œ-GET-çš„å¤šå‚æ•°ä¼ é€’" class="headerlink" title="Feign çš„ POST å’Œ GET çš„å¤šå‚æ•°ä¼ é€’"></a>Feign çš„ POST å’Œ GET çš„å¤šå‚æ•°ä¼ é€’</h3><p>Feignæ‹¦æˆªå™¨ï¼Œå°†Jsonè½¬åŒ–ä¸ºMapã€‚<br>å®ç°Feignçš„RequestInterceptorä¸­çš„applyæ–¹æ³•æ¥è¿›è¡Œç»Ÿä¸€æ‹¦æˆªè½¬æ¢å¤„ç†Feignä¸­çš„GETæ–¹æ³•å¤šå‚æ•°ä¼ é€’é—®é¢˜ã€‚é›†æˆSwapperï¼Œç¼–å†™æœåŠ¡æ¶ˆè´¹è€…ç”¨äºè°ƒç”¨Feignè¿›è¡ŒGetæˆ–Postå¤šå‚æ•°ä¼ é€’ã€‚</p><h2 id="è´Ÿè½½å‡è¡¡ç»„ä»¶-Ribbon"><a href="#è´Ÿè½½å‡è¡¡ç»„ä»¶-Ribbon" class="headerlink" title="è´Ÿè½½å‡è¡¡ç»„ä»¶ Ribbon"></a>è´Ÿè½½å‡è¡¡ç»„ä»¶ Ribbon</h2><p>Feignä¸­é›†æˆäº†Ribbonï¼Œä½†æ˜¯Ribbonå¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ç§è¿›ç¨‹å†…è´Ÿè½½å‡è¡¡å™¨ï¼ˆå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼‰ï¼Œå®ƒèµ‹äºˆäº†åº”ç”¨æ”¯é…Httpå’ŒTcpçš„èƒ½åŠ›ã€‚<br>è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šæœ€å¸¸ç”¨çš„æ˜¯RoundRobinRule è½®è¯¢ç­–ç•¥<br>ä»£ç æ ·ä¾‹ï¼š<br>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ï¼šRibbonLoadbalancerApplication.java<br>æ³¨å…¥ä¸€ä¸ªRestTemplateçš„Beanï¼Œå¹¶ä¸”ä½¿ç”¨@LoadBalancesæ³¨è§£æ‰èƒ½ä½¿å…¶å…·å¤‡è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.springcloud.book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RibbonLoadbalancerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(RibbonLoadbalancerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TestController.java<br>Ribbonå®¢æˆ·ç«¯éœ€è¦åˆ›å»ºä¸€ä¸ªAPIæ¥è°ƒç”¨EurekaæºæœåŠ¡è‡ªå®šä¹‰çš„API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/add"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(Integer a, Integer b)</span> </span>&#123;</span><br><span class="line">String result = restTemplate</span><br><span class="line">.getForObject(<span class="string">"http://CLIENT-A/add?a="</span> + a + <span class="string">"&amp;b="</span> + b, String.class);</span><br><span class="line">System.out.println(result);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥æ‰¾ç»§æ‰¿å…³ç³»ï¼Œå‘ç°æ¥å£ILoadBalancerçš„å®ç°æŠ½è±¡ç±»AbstractLoadBalancerçš„å®ç°ç±»BaseLoadBalancerä¸­çš„chooseServeræ–¹æ³•æ˜¯çœŸæ­£å®ç°è´Ÿè½½å‡è¡¡çš„åœ°æ–¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Get the alive server dedicated to key</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @return the dedicated server</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Server <span class="title">chooseServer</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (counter == <span class="keyword">null</span>) &#123;</span><br><span class="line">        counter = createCounter();</span><br><span class="line">    &#125;</span><br><span class="line">    counter.increment();</span><br><span class="line">    <span class="keyword">if</span> (rule == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> rule.choose(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.warn(<span class="string">"LoadBalancer [&#123;&#125;]:  Error choosing server for key &#123;&#125;"</span>, name, key, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç†”æ–­æœºåˆ¶-Spring-Cloud-Hystrix"><a href="#ç†”æ–­æœºåˆ¶-Spring-Cloud-Hystrix" class="headerlink" title="ç†”æ–­æœºåˆ¶ Spring Cloud Hystrix"></a>ç†”æ–­æœºåˆ¶ Spring Cloud Hystrix</h2><p>Hystrix is a latency and fault tolerance library designed to isolate points of access to remote systems, services and 3rd party libraries, stop cascading failure and enable resilience in complex distributed systems where failure is inevitable.<br>Hystrixçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š</p><ol><li>é€šè¿‡å®¢æˆ·ç«¯å¯¹å»¶è¿Ÿå’Œæ•…éšœè¿›è¡Œä¿æŠ¤å’Œæ§åˆ¶</li><li>åœ¨ä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åœæ­¢çº§è”æ•…éšœ</li><li>å¿«é€Ÿå¤±è´¥å’Œè¿…é€Ÿæ¢å¤</li><li>åœ¨åˆç†çš„æƒ…å†µä¸‹å›é€€å’Œä¼˜é›…åœ°é™çº§</li><li>å¼€å¯å®æ—¶ç›‘æ§ã€å‘Šè­¦å’Œæ“ä½œæ§åˆ¶<br>pom.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leezy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hystrix<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.RC1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>ClientApplication.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hystrix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.EnableHystrix;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ClientApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TestController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hystrix.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leezy.hystrix.service.IUserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/getUser"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(@RequestParam String username)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getUser(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IUserService.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hystrix.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(String username)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserService.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leezy.hystrix.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leezy.hystrix.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">IUserService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™çº§å¤„ç†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@HystrixCommand</span>(fallbackMethod=<span class="string">"defaultUser"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(String username)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (username.equals(<span class="string">"spring"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"This is real user."</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">defaultUser</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"The User does not exist in the system...Test!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>bootstrap.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8888</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">hystrix-client-service</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://$&#123;eureka.host:127.0.0.1&#125;:$&#123;eureka.port:8761&#125;/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8888/getUser?username=spring" target="_blank" rel="noopener">http://localhost:8888/getUser?username=spring</a> å’Œ <a href="http://localhost:8888/getUser?username=testERROR" target="_blank" rel="noopener">http://localhost:8888/getUser?username=testERROR</a></p><h3 id="Hystrix-Dashboard"><a href="#Hystrix-Dashboard" class="headerlink" title="Hystrix Dashboard"></a>Hystrix Dashboard</h3><p>Hystrix Dashboardä»ªè¡¨ç›˜æ˜¯æ ¹æ®ç³»ç»Ÿä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„è¯·æ±‚æƒ…å†µæ¥å±•ç¤ºçš„å¯è§†åŒ–é¢æ¿ã€‚<br>Hystrixçš„æŒ‡æ ‡éœ€è¦ç«¯å£è¿›è¡Œæ”¯æ’‘ï¼Œæ‰€ä»¥éœ€è¦å¢åŠ actuatorä¾èµ–ã€‚<br>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>HystrixDashboardApplication.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HystrixDashboardApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(HystrixDashboardApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯å•ä¸ªå®ä¾‹çš„Hystrix Dashboard,æ•´ä¸ªç³»ç»Ÿå’Œé›†ç¾¤çš„æƒ…å†µä¸‹å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚Turbineå°±æ˜¯èšåˆæ‰€æœ‰ç›¸å…³Hystrix.stream æµçš„æ–¹æ¡ˆã€‚</p><h2 id="ç½‘å…³æ²»ç†ç»„ä»¶-Zuul"><a href="#ç½‘å…³æ²»ç†ç»„ä»¶-Zuul" class="headerlink" title="ç½‘å…³æ²»ç†ç»„ä»¶ Zuul"></a>ç½‘å…³æ²»ç†ç»„ä»¶ Zuul</h2><p>Zuul is the front door for all requests from devices and web sites to the backend of the Netflix streaming application. Zuulæ˜¯å¯¹å†…éƒ¨çš„å¾®æœåŠ¡æä¾›å¯é…ç½®çš„ï¼Œå¯¹å¤–URLåˆ°æœåŠ¡çš„æ˜ å°„å…³ç³»ï¼ŒåŸºäºJVMçš„åç«¯è·¯ç”±å™¨ã€‚<br>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ZuulServerApplication.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZuulServerApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ZuulServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>bootstrap.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">zuul-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">5555</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://$&#123;eureka.host:127.0.0.1&#125;:$&#123;eureka.port:8888&#125;/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line"><span class="attr">  routes:</span></span><br><span class="line"><span class="attr">    client-a:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/client/**</span></span><br><span class="line"><span class="attr">      serviceId:</span> <span class="string">client-a</span></span><br></pre></td></tr></table></figure><p>æœ€åäº”è¡Œçš„ä»£ç è¡¨ç¤ºï¼ŒZuulç»„ä»¶çš„ç«¯å£ä¸ºportAï¼Œåˆ™å°†/clientå¼€å¤´çš„URLæ˜ å°„æ­é…client-aè¿™ä¸ªæœåŠ¡ä¸­å»ï¼Œå³å®é™…è®¿é—®portBã€‚<br>/<em>* åŒ¹é…ä»»æ„æ•°é‡çš„è·¯å¾„å’Œå­—ç¬¦<br>/</em> åŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦<br>/? åŒ¹é…å•ä¸ªå­—ç¬¦</p><h3 id="Spring-Cloud-Zuul-Filteré“¾"><a href="#Spring-Cloud-Zuul-Filteré“¾" class="headerlink" title="Spring Cloud Zuul Filteré“¾"></a>Spring Cloud Zuul Filteré“¾</h3><p>(1) Filterçš„ç±»å‹<br>(2) Filterçš„æ‰§è¡Œé¡ºåº<br>(3) Filterçš„æ‰§è¡Œæ¡ä»¶<br>(4) Filterçš„æ‰§è¡Œæ•ˆæœ<br>Zuulæœ‰å››ç§ä¸åŒç”Ÿå‘½å‘¨æœŸçš„Filter,åˆ†åˆ«æ˜¯ï¼š<br>pre Filter æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸‹çº§æœåŠ¡ä¹‹å‰æ‰§è¡Œã€‚æ¯”å¦‚é‰´æƒã€é™æµç­‰<br>route Filter è·¯ç”±åŠ¨ä½œçš„æ‰§è¡Œè€…ï¼ˆApache HttpClientæˆ–Netflix Ribbonæ„å»ºå’Œå‘é€åŸå§‹Httpè¯·æ±‚çš„åœ°æ–¹ï¼‰<br>post Fliter åœ¨æºæœåŠ¡è¿”å›ç»“æœæˆ–è€…å¼‚å¸¸ä¿¡æ¯å‘ç”Ÿåæ‰§è¡Œçš„ï¼Œå¯¹è¿”å›ä¿¡æ¯åšä¸€äº›å¤„ç†<br>error Filter åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™ä¼šè¿›å…¥error Filter</p><p>Spring Cloud Zuul æƒé™é›†æˆ<br>OAuth2.0 + JWT(JSON Web Token)</p><h3 id="åŠ¨æ€è·¯ç”±-Dynamic-Routing"><a href="#åŠ¨æ€è·¯ç”±-Dynamic-Routing" class="headerlink" title="åŠ¨æ€è·¯ç”± Dynamic Routing"></a>åŠ¨æ€è·¯ç”± Dynamic Routing</h3><p>æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š<br>ï¼ˆ1ï¼‰ Spring Cloud Config + Busã€åŠ¨æ€åˆ·æ–°é…ç½®æ–‡ä»¶ã€‚<br>ï¼ˆ2ï¼‰ é‡å†™Zuulçš„é…ç½®è¯»å–æ–¹å¼</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SpringCloudæä¾›äº†å¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ä¸­å¸¸è§æ¨¡å¼çš„å·¥å…·ï¼ŒåŒ…æ‹¬é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ç­‰ã€‚SpringCloudä¸­é—´ä»¶æ˜¯åŸºäºSpringBootçš„å®ç°ï¼Œæä¾›äº†å¯¹å¾®æœåŠ¡å®Œæ•´çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="SpringCloud" scheme="https://www.leezy.top/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootå­¦ä¹ </title>
    <link href="https://www.leezy.top/2018/12/11/SpringBoot%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.leezy.top/2018/12/11/SpringBootå­¦ä¹ /</id>
    <published>2018-12-11T02:34:25.000Z</published>
    <updated>2019-12-16T06:38:52.448Z</updated>
    
    <content type="html"><![CDATA[<p>Spring Boot makes it easy to create stand-alone, production-grade Spring-based Applications that you can run.</p><a id="more"></a><h2 id="1-å¸¸è§æ³¨è§£"><a href="#1-å¸¸è§æ³¨è§£" class="headerlink" title="1. å¸¸è§æ³¨è§£"></a>1. å¸¸è§æ³¨è§£</h2><h3 id="RequestMapping-GetMapping-amp-PostMapping"><a href="#RequestMapping-GetMapping-amp-PostMapping" class="headerlink" title="@RequestMapping (@GetMapping &amp; @PostMapping)"></a>@RequestMapping (@GetMapping &amp; @PostMapping)</h3><p>The @RequestMapping annotation provides â€œroutingâ€ information. It tells Spring that any HTTP request with the / path should be mapped to the home method.<br>@GetMappingæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œæ˜¯@RequestMapping(method = RequestMethod.GET)çš„ç¼©å†™ã€‚<br>@PostMappingæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œæ˜¯@RequestMapping(method = RequestMethod.POST)çš„ç¼©å†™ã€‚</p><h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p>The @RestController annotation tells Spring to render the resulting string directly back to the caller.<br>ç­‰ä»·äº @Controller + @ResponseBody,ä¸ºäº†ä½¿Httpè¯·æ±‚è¿”å›æ•°æ®æ ¼å¼ä¸ºjsonæ ¼å¼ã€‚</p><h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><p>Since spring-boot-starter-web added Tomcat and Spring MVC, the auto-configuration assumes that you are developing a web application and sets up Spring accordingly.</p><h3 id="ConditionalOnProperty"><a href="#ConditionalOnProperty" class="headerlink" title="@ConditionalOnProperty"></a>@ConditionalOnProperty</h3><p>å¯ä»¥ç”¨æ¥æ§åˆ¶é…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚</p><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>The @SpringBootApplication annotation is often placed on your main class, and it implicitly defines a base â€œsearch packageâ€ for certain items. same as @Configuration,@EnableAutoConfiguration,@ComponentScan.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(Application.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><p>Declare the configuration Classes.</p><h3 id="EnableAutoConfiguration-1"><a href="#EnableAutoConfiguration-1" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><p>If you find that specific auto-configuration classes that you do not want are being applied, you can use the exclude attribute of @EnableAutoConfiguration to disable them.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>(exclude=&#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EnableConfigurationProperties-å’Œ-ConfigurationProperties"><a href="#EnableConfigurationProperties-å’Œ-ConfigurationProperties" class="headerlink" title="@EnableConfigurationProperties å’Œ @ConfigurationProperties"></a>@EnableConfigurationProperties å’Œ @ConfigurationProperties</h3><p>è¿™ä¸¤ä¸ªæ³¨è§£çš„ä½œç”¨å¯ä»¥å‚è§ Spring Boot <a href="https://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/reference/htmlsingle/#boot-features-external-config-typesafe-configuration-properties" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UriConfigurationProperties</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String httpbin = <span class="string">"http://httpbin.org:80"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHttpbin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> httpbin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHttpbin</span><span class="params">(String httpbin)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.httpbin = httpbin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.spring.cloud.gateway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.spring.cloud.gateway.properties.UriConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.RouteLocator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//@EnableConfigurationProperties(org.spring.cloud.gateway.properties.UriConfigurationProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GateWayApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GateWayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouteLocator <span class="title">myRoutes</span><span class="params">(RouteLocatorBuilder builder, UriConfigurationProperties uriConfiguration)</span> </span>&#123;</span><br><span class="line">        String httpUri = uriConfiguration.getHttpbin();</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">            .route(p -&gt; p</span><br><span class="line">                .path(<span class="string">"/get"</span>)</span><br><span class="line">                .filters(f -&gt; f.addRequestHeader(<span class="string">"Hello"</span>, <span class="string">"World"</span>))</span><br><span class="line">                .uri(httpUri))</span><br><span class="line">            .route(p -&gt; p</span><br><span class="line">                .host(<span class="string">"*.hystrix.com"</span>)</span><br><span class="line">                .filters(f -&gt; f</span><br><span class="line">                    .hystrix(config -&gt; config</span><br><span class="line">                        .setName(<span class="string">"mycmd"</span>)</span><br><span class="line">                        .setFallbackUri(<span class="string">"forward:/fallback"</span>)))</span><br><span class="line">                .uri(httpUri))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶ä½äºä¸¤ä¸ªåŒ…ä¸‹ï¼Œå¦‚æœåœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨äº†@Componentï¼Œåˆ™åœ¨ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­å°±ä¸èƒ½å†ä½¿ç”¨@EnableConfigurationPropertiesæ³¨è§£ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ï¼Œæç¤ºæœ‰ä¸¤ä¸ªBeanã€‚<br>å¦‚æœç¬¬ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä½¿ç”¨@Componentåˆ™ç¬¬äºŒä¸ªæ–‡ä»¶å¯ä»¥å°†æ³¨é‡Šå»æ‰ã€‚</p><p><strong>å•å…ƒæµ‹è¯•å¸¸ç”¨æ³¨è§£</strong></p><h3 id="RunWith-SpringJUnit4ClassRunner-class"><a href="#RunWith-SpringJUnit4ClassRunner-class" class="headerlink" title="@RunWith(SpringJUnit4ClassRunner.class)"></a>@RunWith(SpringJUnit4ClassRunner.class)</h3><p>å¼•å…¥Springå¯¹JUnit4çš„æ”¯æŒã€‚</p><h3 id="SpringApplicationConfiguration-classes-HelloApplication-class"><a href="#SpringApplicationConfiguration-classes-HelloApplication-class" class="headerlink" title="@SpringApplicationConfiguration(classes = HelloApplication.class)"></a>@SpringApplicationConfiguration(classes = HelloApplication.class)</h3><p>æŒ‡å®šSpringBootçš„å¯åŠ¨ç±»</p><h3 id="WebAppConfiguration"><a href="#WebAppConfiguration" class="headerlink" title="@WebAppConfiguration"></a>@WebAppConfiguration</h3><p>å¼€å¯Webåº”ç”¨é…ç½®ï¼Œç”¨äºæ¨¡æ‹ŸServletContext</p><h3 id="Before-amp-Test-amp-After"><a href="#Before-amp-Test-amp-After" class="headerlink" title="@Before &amp; @Test &amp; @After"></a>@Before &amp; @Test &amp; @After</h3><p>@Beforeï¼šJUnitä¸­å®šä¹‰åœ¨æµ‹è¯•ç”¨ä¾‹@Testå†…å®¹æ‰§è¡Œå‰é¢„åŠ è½½çš„å†…å®¹ï¼ŒåŒç†åˆ¤æ–­ã€‚</p><h2 id="2-Starter-POMs"><a href="#2-Starter-POMs" class="headerlink" title="2. Starter POMs"></a>2. Starter POMs</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å‘½åè§„åˆ™éƒ½æ˜¯spring-boot-starter-<em>ï¼Œ</em>ä»£è¡¨ä¸€ä¸ªç‰¹åˆ«çš„åº”ç”¨åŠŸèƒ½æ¨¡å—ã€‚</p><h3 id="spring-boot-starter-web"><a href="#spring-boot-starter-web" class="headerlink" title="spring-boot-starter-web"></a>spring-boot-starter-web</h3><p>å…¨æ ˆWebå¼€å‘æ¨¡å—ï¼ŒåŒ…å«åµŒå…¥å¼çš„Tomcatã€SpringMVC</p><h3 id="spring-boot-starter-test"><a href="#spring-boot-starter-test" class="headerlink" title="spring-boot-starter-test"></a>spring-boot-starter-test</h3><p>åŒ…å«Junitã€Hamcrestã€Mockito</p><h3 id="spring-boot-starter-actuator"><a href="#spring-boot-starter-actuator" class="headerlink" title="spring-boot-starter-actuator"></a>spring-boot-starter-actuator</h3><p>ä¸ºSpringBootæ„å»ºçš„åº”ç”¨æä¾›ä¸€ç³»åˆ—ç”¨äºç›‘æ§çš„ç«¯ç‚¹ã€‚<br>è®¿é—®ï¼š<a href="http://127.0.0.1:8080/actuator" target="_blank" rel="noopener">http://127.0.0.1:8080/actuator</a><br>å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†å¦‚ä¸‹JSONæ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_links"</span>: &#123;</span><br><span class="line">        <span class="attr">"self"</span>: &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://127.0.0.1:8080/actuator"</span>,</span><br><span class="line">            <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"health"</span>: &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://127.0.0.1:8080/actuator/health"</span>,</span><br><span class="line">            <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"health-component"</span>: &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://127.0.0.1:8080/actuator/health/&#123;component&#125;"</span>,</span><br><span class="line">            <span class="attr">"templated"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"health-component-instance"</span>: &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://127.0.0.1:8080/actuator/health/&#123;component&#125;/&#123;instance&#125;"</span>,</span><br><span class="line">            <span class="attr">"templated"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"info"</span>: &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://127.0.0.1:8080/actuator/info"</span>,</span><br><span class="line">            <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="spring-boot-devtools"><a href="#spring-boot-devtools" class="headerlink" title="spring-boot-devtools"></a>spring-boot-devtools</h3><p>(1) Property Defaults<br>(2) Automatic Restart<br>(3) LiveReload<br>(4) Global Settings<br>(5) Remote Applications</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>SpringBootçš„é»˜è®¤é…ç½®æ–‡ä»¶ä½ç½®æ˜¯src/main/resources/application.properties.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- application.properties --&gt;</span></span><br><span class="line">book.name=JAVAç¼–ç¨‹æ€æƒ³</span><br><span class="line">book.author=Bruce Eckel</span><br></pre></td></tr></table></figure><p>åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨ @Vlaueæ³¨è§£æ¥åŠ è½½è¿™äº›è‡ªå®šä¹‰çš„å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;book.name&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@value</span>(<span class="string">"$&#123;book.author&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Javaä»£ç ä¸­å¼•ç”¨æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>PlaceHolderæ–¹å¼ ${â€¦}</li><li>SpELè¡¨è¾¾å¼ #{â€¦}</li></ol><p>é€šè¿‡application-{profile}å¤šç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š<br>application-dev.properties:å¼€å‘ç¯å¢ƒ<br>application-test.properties:æµ‹è¯•ç¯å¢ƒ<br>application-prod.properties:ç”Ÿäº§ç¯å¢ƒ<br>åœ¨application.propertiesä¸­çš„spring.profiles.activeå±æ€§æ¥è®¾ç½®ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// è°ƒç”¨æµ‹è¯•ç¯å¢ƒ</span><br><span class="line">spring.profiles.active = test;</span><br></pre></td></tr></table></figure><p>åœ¨é‡‡ç”¨java -jar xxx.jar å½¢å¼è¿è¡Œé¡¹ç›®æ—¶ï¼Œâ€â€“â€å°±æ˜¯å¯¹application.propertiesä¸­çš„å±æ€§å€¼è¿›è¡Œèµ‹å€¼çš„æ ‡è¯†ã€‚<br>é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§é¡ºåºå¦‚ä¸‹ï¼š<br>å‘½ä»¤è¡Œè¾“å…¥ &gt; åŒ…å¤– &gt; åŒ…å†…<br>æ‰€ä»¥å¯ä»¥åœ¨åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å¯¹é…ç½®è¿›è¡Œå¿«é€Ÿå‡†ç¡®çš„æ›´æ”¹ã€‚</p><h3 id="spring-factoriesæ–‡ä»¶"><a href="#spring-factoriesæ–‡ä»¶" class="headerlink" title="spring.factoriesæ–‡ä»¶"></a>spring.factoriesæ–‡ä»¶</h3><p>Spring Factorieså®ç°åŸç†(package org.springframework.core.io.supportåŒ…ä¸‹çš„SpringFactoriesLoader.classæ–‡ä»¶;)<br>Spring å®¹å™¨åˆå§‹åŒ–æ—¶ä¼šåŠ è½½è¯¥æ–‡ä»¶å£°æ˜çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡@SpringBootAppl<br>spring-coreåŒ…é‡Œå®šä¹‰äº†SpringFactoriesLoaderç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†æ£€ç´¢META-INF/spring.factoriesæ–‡ä»¶ï¼Œå¹¶è·å–æŒ‡å®šæ¥å£çš„é…ç½®çš„åŠŸèƒ½ã€‚åœ¨è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªå¯¹å¤–çš„æ–¹æ³•ï¼š</p><p>loadFactories: æ ¹æ®æ¥å£ç±»è·å–å…¶å®ç°ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯å¯¹è±¡åˆ—è¡¨ã€‚<br>loadFactoryNames: æ ¹æ®æ¥å£è·å–å…¶æ¥å£ç±»çš„åç§°ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ç±»åçš„åˆ—è¡¨ã€‚</p><h3 id="bootstrap-ymlå’Œappllication-ymlçš„åŒºåˆ«"><a href="#bootstrap-ymlå’Œappllication-ymlçš„åŒºåˆ«" class="headerlink" title="bootstrap.ymlå’Œappllication.ymlçš„åŒºåˆ«"></a>bootstrap.ymlå’Œappllication.ymlçš„åŒºåˆ«</h3><p>bootstrap.ymlåŠ è½½ï¼ˆçˆ¶SpringApplicationContextï¼‰é¡ºåºåœ¨application.ymlä¹‹å‰ï¼Œç”¨äºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µã€‚ç”¨äºæŒ‡å®šspring.application.nameå’Œspring.cloud.config.server.git.uriä»¥åŠä¸€äº›åŠ å¯†å’Œè§£å¯†ä¿¡æ¯ã€‚<br>egï¼šSpring Cloud Config é…ç½®ä¸­å¿ƒå†ä½¿ç”¨æ—¶ï¼Œé€šå¸¸å°†è®¿é—®è¿œç¨‹æ–‡ä»¶é…ç½®ä¿¡æ¯å†™åœ¨bootstrap.ymlæ–‡ä»¶ä¸­ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Spring Boot makes it easy to create stand-alone, production-grade Spring-based Applications that you can run.&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="SpringBoot" scheme="https://www.leezy.top/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>WebServiceå­¦ä¹ </title>
    <link href="https://www.leezy.top/2018/11/26/WebService%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.leezy.top/2018/11/26/WebServiceå­¦ä¹ /</id>
    <published>2018-11-26T06:34:25.000Z</published>
    <updated>2019-12-16T06:44:28.851Z</updated>
    
    <content type="html"><![CDATA[<p>WebServiceçš„ä¸¤ç§å®ç°æ–¹å¼ï¼ŒSoap WebServiceã€Restful WebServiceã€‚</p><a id="more"></a><p>RPC refers to Remote Procedure Call.<br>Use of RPC is recommended when there is heavy use of the client/server model.<br>RPC allows for the processing of multiple threads that share a given address.<br>RPC employed on a platform that uses EJB.<br>Web Service used in non-Java platforms when an app wants access.<br>Web Service also is used for synchronization of asynchronous communication.[1]</p><p>WebServiceæ˜¯ä¸€ç§æŠ€æœ¯ï¼Œæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šJAX-WS(Java API for XML-Based Serviceé¢å‘æ¶ˆæ¯)ã€JAX-RS(Java API for Restful WebServiceé¢å‘èµ„æº)<br>ps. RESTful è¯·æ±‚å¸¸ç”¨çš„æ–¹æ³•æœ‰ä»¥ä¸‹å››ç§ï¼š</p><ol><li>GET: ç”¨äºæŸ¥è¯¢å¯¹è±¡</li><li>POST: ç”¨äºåˆ›å»ºå¯¹è±¡</li><li>PUT: ç”¨äºä¿®æ”¹å¯¹è±¡</li><li>DELETE: ç”¨äºåˆ é™¤å¯¹è±¡</li></ol><h3 id="1-CXF-åŸºäº-SOAP-çš„-WebService"><a href="#1-CXF-åŸºäº-SOAP-çš„-WebService" class="headerlink" title="1. CXF åŸºäº SOAP çš„ WebService"></a>1. CXF åŸºäº SOAP çš„ WebService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- IHelloWorld.java --&gt;</span><br><span class="line"><span class="keyword">package</span> top.leezy.www;</span><br><span class="line"><span class="keyword">import</span> javax.jws.WebService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebService</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IHelloWorld</span> </span>&#123;</span><br><span class="line"><span class="function">String <span class="title">sayHello</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- HelloWorldImpl.java --&gt;</span><br><span class="line"><span class="keyword">package</span> top.leezy.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldImpl</span> <span class="keyword">implements</span> <span class="title">IHelloWorld</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Hello "</span> + name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- applicationContext.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jaxws</span>=<span class="string">"http://cxf.apache.org/jaxws"</span> <span class="attr">xmlns:cxf</span>=<span class="string">"http://cxf.apache.org/core"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:wsa</span>=<span class="string">"http://cxf.apache.org/ws/addressing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.1.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">     http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd    </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:META-INF/cxf/cxf.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:META-INF/cxf/cxf-servlet.xml"</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">jaxws:endpoint</span> <span class="attr">id</span>=<span class="string">"HelloWorld"</span> <span class="attr">implementor</span>=<span class="string">"top.leezy.www.HelloWorldImpl"</span> <span class="attr">address</span>=<span class="string">"/sayHello"</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">display-name</span>&gt;</span>CXFwebservice<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:top/**/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CxfServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.cxf.transport.servlet.CXFServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CxfServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/webservice/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jsp<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼š<a href="http://127.0.0.1:8081/SoapWebService/webservice" target="_blank" rel="noopener">http://127.0.0.1:8081/SoapWebService/webservice</a><br><img src="/assets/blogImg/SoapWebService.png" alt="SoapWebService"></p><h3 id="2-CXF-åŸºäº-RestFul-çš„-WebService"><a href="#2-CXF-åŸºäº-RestFul-çš„-WebService" class="headerlink" title="2. CXF åŸºäº RestFul çš„ WebService"></a>2. CXF åŸºäº RestFul çš„ WebService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Config.java --&gt;</span><br><span class="line"><span class="keyword">package</span> top.leezy.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; users;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">users = <span class="keyword">new</span> LinkedList&lt;User&gt;();</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setId(<span class="string">"123456"</span>);</span><br><span class="line">user.setName(<span class="string">"SAKURA"</span>);</span><br><span class="line">users.add(user);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- User.java --&gt;</span><br><span class="line"><span class="keyword">package</span> top.leezy.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.bind.annotation.XmlRootElement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@XmlRootElement</span>(name = <span class="string">"User"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- UserService.java --&gt;</span><br><span class="line"><span class="keyword">package</span> top.leezy.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Consumes;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.DELETE;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.GET;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.POST;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.PUT;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Path;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.Produces;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.QueryParam;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.MediaType;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Response;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Response.Status;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Path</span>(<span class="string">"/UserService"</span>)</span><br><span class="line"><span class="comment">// å¯ä»¥æ³¨é‡Šåœ¨æ–¹æ³•ä¸Šæˆ–è€…ç±»ä¸Šï¼ˆä»¥æœ€å°å•ä½ä¸ºå‡†ï¼‰, æŒ‡å®šè¿”å›ç»™å®¢æˆ·ç«¯çš„ç±»å‹</span></span><br><span class="line"><span class="meta">@Produces</span>(&#123;<span class="string">"application/json"</span>, <span class="string">"application/xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"><span class="meta">@GET</span></span><br><span class="line"><span class="meta">@Path</span>(<span class="string">"/getUser/&#123;id&#125;"</span>)</span><br><span class="line"><span class="meta">@Produces</span>(MediaType.APPLICATION_XML)</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(@PathParam(<span class="string">"id"</span>)</span> String id) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (id != <span class="keyword">null</span> &amp;&amp; id.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (User user : Config.users) &#123;</span><br><span class="line"><span class="keyword">if</span>(id.equals(user.getId()))</span><br><span class="line"><span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line">User add_user = <span class="keyword">new</span> User();</span><br><span class="line">add_user.setId(id);</span><br><span class="line"><span class="keyword">return</span> add_user;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@POST</span></span><br><span class="line"><span class="meta">@Path</span>(<span class="string">"/regUser"</span>)</span><br><span class="line"><span class="comment">// ä¸€èˆ¬ç”¨äº @PUTã€@POST, ç”¨äºæ¥å—å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„MIMEç±»å‹</span></span><br><span class="line"><span class="meta">@Consumes</span>(&#123;<span class="string">"application/json"</span>, <span class="string">"application/xml"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">regUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (Config.users.contains(user)) &#123;</span><br><span class="line"><span class="keyword">return</span> Response.status(Status.BAD_REQUEST).build();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Config.users.add(user);</span><br><span class="line"><span class="keyword">return</span> Response.ok(<span class="string">"id = "</span> + user.getId() + <span class="string">", name = "</span> + user.getName()).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DELETE</span></span><br><span class="line"><span class="meta">@Path</span>(<span class="string">"/delUser"</span>)</span><br><span class="line"><span class="meta">@Consumes</span>(&#123;<span class="string">"application/json"</span>, <span class="string">"application/xml"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">delPerson</span><span class="params">(@QueryParam(<span class="string">"id"</span>)</span> String id) </span>&#123;</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setId(id);</span><br><span class="line"><span class="keyword">if</span> (Config.users.contains(user)) &#123;</span><br><span class="line"><span class="keyword">return</span> Response.status(Status.BAD_REQUEST).build();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Config.users.remove(user);</span><br><span class="line"><span class="keyword">return</span> Response.ok(user).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PUT</span></span><br><span class="line"><span class="meta">@Path</span>(<span class="string">"/updateUser"</span>)</span><br><span class="line"><span class="meta">@Consumes</span>(&#123;<span class="string">"application/json"</span>, <span class="string">"application/xml"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (Config.users.contains(user)) &#123;</span><br><span class="line"><span class="keyword">return</span> Response.status(Status.BAD_REQUEST).build();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (User old_user : Config.users) &#123;</span><br><span class="line"><span class="keyword">if</span> (old_user.equals(user)) &#123;</span><br><span class="line">old_user.setName(user.getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> Response.ok(user).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- beans.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:jaxrs</span>=<span class="string">"http://cxf.apache.org/jaxrs"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                            http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                            http://cxf.apache.org/jaxrs</span></span></span><br><span class="line"><span class="tag"><span class="string">                            http://cxf.apache.org/schemas/jaxrs.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:META-INF/cxf/cxf.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:META-INF/cxf/cxf-servlet.xml"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"top.leezy.www.UserService"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">jaxrs:server</span> <span class="attr">id</span>=<span class="string">"rs_server"</span> <span class="attr">address</span>=<span class="string">"/restfulService"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jaxrs:serviceBeans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"userService"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jaxrs:serviceBeans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jaxrs:server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">display-name</span>&gt;</span>CxfRestWebservice<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:top/**/beans.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>cxfservlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.cxf.transport.servlet.CXFServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>cxfservlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/webservice/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼š<a href="http://127.0.0.1:8081/RestFulWebService/webservice/" target="_blank" rel="noopener">http://127.0.0.1:8081/RestFulWebService/webservice/</a><br><img src="/assets/blogImg/RestFulWebService.png" alt="RestFulWebService"><br>ä½¿ç”¨POSTManè¿›è¡Œæµ‹è¯•ï¼š<br><img src="/assets/blogImg/RestFulWebService%E4%BD%BF%E7%94%A8_POST.png" alt="RestFulWebServiceä½¿ç”¨_POST"><br>RestFul WebService çš„JARåŒ…è¾ƒ Soap WebService è¦åŒºåˆ«ä»¥ä¸‹å‡ ä¸ªï¼š<br>-javax.ws.rs-api-2.1.1.jar<br>-cxf-rt-frontend-jaxrs-3.2.7.jar</p><p>å‚è€ƒæ–‡çŒ®ï¼š<br>[1]<a href="http://www.differencebetween.net/technology/protocols-formats/difference-between-rpc-and-web-service/#ixzz5YLemRQhd" target="_blank" rel="noopener">http://www.differencebetween.net/technology/protocols-formats/difference-between-rpc-and-web-service/#ixzz5YLemRQhd</a><br>[2]<a href="https://www.cnblogs.com/zhuyiqizhi/p/6213502.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhuyiqizhi/p/6213502.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;WebServiceçš„ä¸¤ç§å®ç°æ–¹å¼ï¼ŒSoap WebServiceã€Restful WebServiceã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="JavaWEB" scheme="https://www.leezy.top/tags/JavaWEB/"/>
    
  </entry>
  
  <entry>
    <title>CentOSå®‰è£…Tomcat</title>
    <link href="https://www.leezy.top/2018/11/20/CentOS%E5%AE%89%E8%A3%85Tomcat/"/>
    <id>https://www.leezy.top/2018/11/20/CentOSå®‰è£…Tomcat/</id>
    <published>2018-11-20T14:46:41.000Z</published>
    <updated>2019-12-12T09:58:30.023Z</updated>
    
    <content type="html"><![CDATA[<p>ç³»ç»Ÿï¼šCentOS Linux release 7.5.1804<br>Tomcatç‰ˆæœ¬ï¼š apache-tomcat-7.0.92.tar.gz</p><a id="more"></a><h3 id="1-ä¸‹è½½Tomcat"><a href="#1-ä¸‹è½½Tomcat" class="headerlink" title="1. ä¸‹è½½Tomcat"></a>1. ä¸‹è½½Tomcat</h3><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://www-us.apache.org/dist/tomcat/tomcat-7/v7.0.92/bin/apache-tomcat-7.0.92.tar.gz" target="_blank" rel="noopener">https://www-us.apache.org/dist/tomcat/tomcat-7/v7.0.92/bin/apache-tomcat-7.0.92.tar.gz</a></p><h3 id="2-è§£å‹ç¼©æ–‡ä»¶"><a href="#2-è§£å‹ç¼©æ–‡ä»¶" class="headerlink" title="2. è§£å‹ç¼©æ–‡ä»¶"></a>2. è§£å‹ç¼©æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-tomcat-7.0.92.tar.gz</span><br></pre></td></tr></table></figure><h3 id="3-æ‰“å¼€8080ç«¯å£å¹¶é‡å¯é˜²ç«å¢™"><a href="#3-æ‰“å¼€8080ç«¯å£å¹¶é‡å¯é˜²ç«å¢™" class="headerlink" title="3. æ‰“å¼€8080ç«¯å£å¹¶é‡å¯é˜²ç«å¢™"></a>3. æ‰“å¼€8080ç«¯å£å¹¶é‡å¯é˜²ç«å¢™</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h3 id="4-é…ç½®tomcat-users-xml"><a href="#4-é…ç½®tomcat-users-xml" class="headerlink" title="4. é…ç½®tomcat-users.xml"></a>4. é…ç½®tomcat-users.xml</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- åœ¨æœ€åæ·»åŠ ç”¨æˆ·è§’è‰²ç”¨æˆ·åå¯†ç  å‚æ•°æ„ä¹‰å¯ä»¥åœ¨è‡ªå¸¦çš„æ–‡æ¡£ä¸ŠæŸ¥çœ‹--&gt;</span><br><span class="line">&lt;role rolename="admin-gui"/&gt;</span><br><span class="line">&lt;role rolename="manager-gui"/&gt;</span><br><span class="line">&lt;role rolename="manager-jmx"/&gt;</span><br><span class="line">&lt;user username="admin" password="admin" roles="admin-gui,manager-gui,manager-jmx" /&gt;</span><br></pre></td></tr></table></figure><h3 id="5-è®¿é—®Tomcat-Manager"><a href="#5-è®¿é—®Tomcat-Manager" class="headerlink" title="5. è®¿é—®Tomcat Manager"></a>5. è®¿é—®Tomcat Manager</h3><p>è®¿é—®åœ°å€ï¼š <a href="http://192.168.56.101:8080/" target="_blank" rel="noopener">http://192.168.56.101:8080/</a> å¹¶ç™»é™† admin admin<br><img src="/assets/blogImg/Tomcat%E6%8E%A7%E5%88%B6%E5%8F%B0.png" alt="Tomcatæ§åˆ¶å°"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç³»ç»Ÿï¼šCentOS Linux release 7.5.1804&lt;br&gt;Tomcatç‰ˆæœ¬ï¼š apache-tomcat-7.0.92.tar.gz&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Linux" scheme="https://www.leezy.top/tags/Linux/"/>
    
      <category term="Tomcat" scheme="https://www.leezy.top/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>MongoDBå®‰è£…</title>
    <link href="https://www.leezy.top/2018/11/20/MongoDB%E5%AE%89%E8%A3%85/"/>
    <id>https://www.leezy.top/2018/11/20/MongoDBå®‰è£…/</id>
    <published>2018-11-20T01:08:25.000Z</published>
    <updated>2019-12-16T06:38:36.893Z</updated>
    
    <content type="html"><![CDATA[<p>å®‰è£…è§£å‹ç¼©ç‰ˆæœ¬çš„MongoDB(mongodb-win32-x86_64-2008plus-ssl-4.0.4)çš„ç®€å•å‘½ä»¤ã€‚</p><a id="more"></a><h3 id="1-é…ç½®ç¯å¢ƒå˜é‡"><a href="#1-é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="1. é…ç½®ç¯å¢ƒå˜é‡"></a>1. é…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åŠ å…¥ç¯å¢ƒå˜é‡</span><br><span class="line">C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\bin</span><br></pre></td></tr></table></figure><h3 id="2-åˆ›å»º-data-æ–‡ä»¶å¤¹-åŠ-log-æ–‡ä»¶å¤¹"><a href="#2-åˆ›å»º-data-æ–‡ä»¶å¤¹-åŠ-log-æ–‡ä»¶å¤¹" class="headerlink" title="2. åˆ›å»º data æ–‡ä»¶å¤¹ åŠ log æ–‡ä»¶å¤¹"></a>2. åˆ›å»º data æ–‡ä»¶å¤¹ åŠ log æ–‡ä»¶å¤¹</h3><p>åˆ›å»º mongodb-data å’Œ mongodb-log æ–‡ä»¶å¤¹</p><h3 id="3-ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œå®‰è£…å‘½ä»¤"><a href="#3-ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œå®‰è£…å‘½ä»¤" class="headerlink" title="3. ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œå®‰è£…å‘½ä»¤"></a>3. ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œå®‰è£…å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\bin</span><br><span class="line">mongod --dbpath "C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\mongodb-data" --logpath "C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\mongodb-log\MongoDB.log" --install --serviceName "mongo" --logappend --directoryperdb</span><br></pre></td></tr></table></figure><h3 id="4-æµ‹è¯•å®‰è£…ç»“æœ"><a href="#4-æµ‹è¯•å®‰è£…ç»“æœ" class="headerlink" title="4. æµ‹è¯•å®‰è£…ç»“æœ"></a>4. æµ‹è¯•å®‰è£…ç»“æœ</h3><p>è®¿é—® <a href="http://127.0.0.1:27017/" target="_blank" rel="noopener">http://127.0.0.1:27017/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å®‰è£…è§£å‹ç¼©ç‰ˆæœ¬çš„MongoDB(mongodb-win32-x86_64-2008plus-ssl-4.0.4)çš„ç®€å•å‘½ä»¤ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="MongoDB" scheme="https://www.leezy.top/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>TensorFlowå®éªŒè®°å½•</title>
    <link href="https://www.leezy.top/2018/03/06/TensorFlow%E5%AE%9E%E9%AA%8C%E8%AE%B0%E5%BD%95/"/>
    <id>https://www.leezy.top/2018/03/06/TensorFlowå®éªŒè®°å½•/</id>
    <published>2018-03-06T03:28:53.000Z</published>
    <updated>2019-12-16T06:44:21.778Z</updated>
    
    <content type="html"><![CDATA[<p>ç¯å¢ƒè¯´æ˜ï¼š<br>ç³»ç»Ÿï¼šUbuntu Server 16.04.1 LTS 64ä½<br>Pythonç‰ˆæœ¬ï¼šPython 3.5.2<br>TensorFlowç‰ˆæœ¬ï¼š1.4</p><a id="more"></a><h3 id="ç”¨æˆ·åˆ‡æ¢ï¼ˆæœ€å¥½å¯ç”¨rootå¦åˆ™ä¼šæœ‰Bugï¼‰"><a href="#ç”¨æˆ·åˆ‡æ¢ï¼ˆæœ€å¥½å¯ç”¨rootå¦åˆ™ä¼šæœ‰Bugï¼‰" class="headerlink" title="ç”¨æˆ·åˆ‡æ¢ï¼ˆæœ€å¥½å¯ç”¨rootå¦åˆ™ä¼šæœ‰Bugï¼‰"></a>ç”¨æˆ·åˆ‡æ¢ï¼ˆæœ€å¥½å¯ç”¨rootå¦åˆ™ä¼šæœ‰Bugï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¾“å…¥Linux rootç”¨æˆ·å¯†ç </span><br><span class="line">sudo passwd root</span><br><span class="line"># é»˜è®¤ç”¨æˆ·åˆ‡æ¢åˆ°rootç”¨æˆ·</span><br><span class="line">su root</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…pythonç¯å¢ƒ"><a href="#å®‰è£…pythonç¯å¢ƒ" class="headerlink" title="å®‰è£…pythonç¯å¢ƒ"></a>å®‰è£…pythonç¯å¢ƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä¸ç”¨é»˜è®¤çš„2.7 å®‰è£…python3.5</span><br><span class="line">sudo apt-get install python3.5</span><br><span class="line"># ç³»ç»Ÿç¯å¢ƒåˆ‡æ¢æˆpython3.5</span><br><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100</span><br><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…TensorFlow"><a href="#å®‰è£…TensorFlow" class="headerlink" title="å®‰è£…TensorFlow"></a>å®‰è£…TensorFlow</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># é‡‡ç”¨pipå®‰è£…ï¼Œé¦–å…ˆå®‰è£…</span><br><span class="line"># æŸ¥çœ‹ç³»ç»Ÿå†…ç½®çš„pipç‰ˆæœ¬</span><br><span class="line">pip3 -V</span><br><span class="line"># æ›´æ–°å¹¶å®‰è£…</span><br><span class="line">sudo apt-get install python3-pip python3-dev</span><br><span class="line">sudo pip install --upgrade pip</span><br><span class="line"># å®‰è£…CPUç‰ˆæœ¬çš„TensorFlow</span><br><span class="line">pip3 install tensorflow</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¦ä¿è¯pipæ˜¯æœ€æ–°ç‰ˆæœ¬å¦åˆ™ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š<br><img src="/assets/blogImg/pip%E6%9C%AA%E8%BE%BE%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC.png" alt="pipæœªè¾¾åˆ°æœ€æ–°ç‰ˆæœ¬"></p><h3 id="æµ‹è¯•TensorFlow"><a href="#æµ‹è¯•TensorFlow" class="headerlink" title="æµ‹è¯•TensorFlow"></a>æµ‹è¯•TensorFlow</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hello = tf.constant(<span class="string">'Hello, TensorFlow'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sess = tf.Session()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sess.run(hello))</span><br></pre></td></tr></table></figure><p><img src="/assets/blogImg/%E6%B5%8B%E8%AF%95TensorFlow%E5%AE%89%E8%A3%85.png" alt="æµ‹è¯•TensorFlowå®‰è£…"></p><h3 id="æŸ¥çœ‹TensorFlowç‰ˆæœ¬"><a href="#æŸ¥çœ‹TensorFlowç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹TensorFlowç‰ˆæœ¬"></a>æŸ¥çœ‹TensorFlowç‰ˆæœ¬</h3><p><img src="/assets/blogImg/%E6%9F%A5%E7%9C%8BTensFlow%E7%89%88%E6%9C%AC.png" alt="æŸ¥çœ‹TensFlowç‰ˆæœ¬"></p><hr><h3 id="å¤‡ç”¨çŸ¥è¯†ç‚¹-Note"><a href="#å¤‡ç”¨çŸ¥è¯†ç‚¹-Note" class="headerlink" title="å¤‡ç”¨çŸ¥è¯†ç‚¹(Note)"></a>å¤‡ç”¨çŸ¥è¯†ç‚¹(Note)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. vim -r filename æ¢å¤æœªæ­£å¸¸ä¿å­˜ç”Ÿæˆçš„.swapæ–‡ä»¶</span><br><span class="line">2. (Note)</span><br><span class="line">convolutional neural network å·ç§¯ç¥ç»ç½‘ç»œ</span><br><span class="line">rectified linear unit çº¿æ€§ä¿®æ­£å•å…ƒ ReLU</span><br><span class="line">input layer --&gt; hidden layer(more than one) --&gt; output layer</span><br></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -U scikit-learn</span><br><span class="line"></span><br><span class="line">pip3 install scipy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ä¸‹è½½ MNIST æ•°æ®é›†ï¼ˆhttp://wiki.jikexueyuan.com/project/tensorflow-zh/tutorials/mnist_download.htmlï¼‰</span><br><span class="line">wget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/t10k-images-idx3-ubyte.gz</span><br><span class="line">wget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/t10k-labels-idx1-ubyte.gz</span><br><span class="line">wget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/train-images-idx3-ubyte.gz</span><br><span class="line">wget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/train-labels-idx1-ubyte.gz</span><br><span class="line"></span><br><span class="line">pip3 install \</span><br><span class="line">  -i https://pypi.tuna.tsinghua.edu.cn/simple/ \</span><br><span class="line">  https://mirrors.tuna.tsinghua.edu.cn/tensorflow/linux/cpu/tensorflow-1.7.0-cp35-cp35m-linux_x86_64.whl</span><br></pre></td></tr></table></figure><h3 id="Windowsç¯å¢ƒä¸‹-ipynbæ–‡ä»¶ç›¸å…³ï¼ˆpythonç¬”è®°ï¼‰"><a href="#Windowsç¯å¢ƒä¸‹-ipynbæ–‡ä»¶ç›¸å…³ï¼ˆpythonç¬”è®°ï¼‰" class="headerlink" title="Windowsç¯å¢ƒä¸‹.ipynbæ–‡ä»¶ç›¸å…³ï¼ˆpythonç¬”è®°ï¼‰"></a>Windowsç¯å¢ƒä¸‹.ipynbæ–‡ä»¶ç›¸å…³ï¼ˆpythonç¬”è®°ï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…pythonç¯å¢ƒä¸å¿…å¤šè¯´</span><br><span class="line">pip install ipython</span><br><span class="line"></span><br><span class="line">pip install &quot;ipython[notebook]&quot;</span><br><span class="line"></span><br><span class="line"># cd åˆ°æœ‰.ipynbæ–‡ä»¶çš„ç›®å½•ä¸‹æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å°±ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ç‚¹å‡»æ–‡ä»¶å³å¯æ‰“å¼€æ–‡ä»¶</span><br><span class="line">ipython notebook</span><br></pre></td></tr></table></figure><p><img src="/assets/blogImg/ipynb%E6%96%87%E4%BB%B6.png" alt="Windows10å®‰è£…æ•ˆæœ"></p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¯å¢ƒè¯´æ˜ï¼š&lt;br&gt;ç³»ç»Ÿï¼šUbuntu Server 16.04.1 LTS 64ä½&lt;br&gt;Pythonç‰ˆæœ¬ï¼šPython 3.5.2&lt;br&gt;TensorFlowç‰ˆæœ¬ï¼š1.4&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Linux" scheme="https://www.leezy.top/tags/Linux/"/>
    
      <category term="TensorFlow" scheme="https://www.leezy.top/tags/TensorFlow/"/>
    
  </entry>
  
  <entry>
    <title>C++æ ‡å‡†æ¨¡æ¿åº“STLå­¦ä¹ ç¬”è®°</title>
    <link href="https://www.leezy.top/2018/02/27/C++%E6%A0%87%E5%87%86%E6%A8%A1%E6%9D%BF%E5%BA%93STL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.leezy.top/2018/02/27/C++æ ‡å‡†æ¨¡æ¿åº“STLå­¦ä¹ ç¬”è®°/</id>
    <published>2018-02-27T14:35:25.000Z</published>
    <updated>2019-09-18T12:12:30.736Z</updated>
    
    <content type="html"><![CDATA[<p>é¢è¯•ç¬”è¯•ç®—æ³•å¿…å¤‡çŸ¥è¯†ç‚¹ï¼æ–‡ç« å†…å®¹æ€»ç»“è‡ªã€Šç®—æ³•ç¬”è®°ã€‹ï¼Œæ—¶åˆ»å·©å›ºä»¥å…å¿˜è®°(lllï¿¢Ï‰ï¿¢)</p><a id="more"></a><h3 id="1-vectoryç”¨æ³•ï¼š"><a href="#1-vectoryç”¨æ³•ï¼š" class="headerlink" title="1.vectoryç”¨æ³•ï¼š"></a>1.vectoryç”¨æ³•ï¼š</h3><p>Vectoryï¼šå˜é•¿æ•°ç»„</p><ol><li><p>å®šä¹‰æ–¹æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vectory&lt;<span class="keyword">typename</span>&gt; name;</span><br><span class="line"><span class="comment">// eg:</span></span><br><span class="line">vectory&lt;<span class="keyword">int</span>&gt; nums;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœtypenameç±»å‹ä¹Ÿæ˜¯ä¸€ä¸ªSTLå®¹å™¨ï¼Œå®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">vectory&lt;vectory&lt;<span class="keyword">int</span>&gt; &gt; name; <span class="comment">// &gt;&gt;ä¹‹é—´æœ‰ç©ºæ ¼é¿å…æ­§ä¹‰ --ã€‹ä¸¤ç»´éƒ½å¯å˜çš„äºŒç»´æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vectoryæ•°ç»„çš„å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">vectory&lt;<span class="keyword">typename</span>&gt; Arrayname[arraySize] <span class="comment">// ä¸€ç»´å¯å˜çš„äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">// eg:</span></span><br><span class="line">vectory&lt;<span class="keyword">int</span>&gt; nums[<span class="number">10</span>]</span><br></pre></td></tr></table></figure></li><li><p>è®¿é—®æ–¹æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼š</span></span><br><span class="line">nums[<span class="number">0</span>], nums[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡è¿­ä»£å™¨è®¿é—®ï¼š</span></span><br><span class="line">vectory&lt;<span class="keyword">typename</span>&gt;::iterator it;</span><br><span class="line"><span class="comment">//eg:</span></span><br><span class="line">vectory&lt;<span class="keyword">int</span>&gt;::iterator it; <span class="comment">// å¾—åˆ°è¿­ä»£å™¨itï¼Œé€šè¿‡*itè¿›è¡Œè®¿é—®vectory</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// nums[i] ç­‰ä»·äº *(it + i)</span></span><br></pre></td></tr></table></figure></li><li><p>å¸¸ç”¨å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. push_back(x) åœ¨vectoryæœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ x O(1) nums.push_back(i);</span><br><span class="line">2. pop_back() åœ¨vectoryæœ«å°¾åˆ é™¤ä¸€ä¸ªå…ƒç´  O(1) nums.pop_back();</span><br><span class="line">3. size() æ±‚å¾—vectoryå…ƒç´ ä¸ªæ•° O(1) nums.size()</span><br><span class="line">4. begin() æ±‚å¾—vectoryæ•°ç»„numsé¦–åœ°å€ä¸itæŒ‡å‘åœ°å€ä¸€æ · O(1) nums.beagin()</span><br><span class="line">5. end() æ±‚å¾—vectoryæ•°ç»„numså°¾å…ƒç´ çš„ä¸‹ä¸€ä¸ªåœ°å€ O(1) nums.end()</span><br><span class="line">6. clear() æ¸…ç©ºvectoryæ‰€æœ‰å…ƒç´  O(n) nums.clear()</span><br><span class="line">7. insert(it, x) å‘vectoryä»»æ„è¿­ä»£å™¨itå¤„æ’å…¥ä¸€ä¸ªå…ƒç´ x O(N) nums.insert(nums.begin() + 2ï¼Œ 3)</span><br><span class="line">8. erase(it) åˆ é™¤è¿­ä»£å™¨itå¤„å…ƒç´  O(n) nums.erase(nums.begin() + 2)</span><br><span class="line">9. erase(first, last) åˆ é™¤[first, last)å†…çš„æ‰€æœ‰å…ƒç´  O(n) nums.erase(num.begin() + 1, num.end())åˆ é™¤é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¤–çš„å…¶ä»–å…ƒç´ </span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é¢è¯•ç¬”è¯•ç®—æ³•å¿…å¤‡çŸ¥è¯†ç‚¹ï¼æ–‡ç« å†…å®¹æ€»ç»“è‡ªã€Šç®—æ³•ç¬”è®°ã€‹ï¼Œæ—¶åˆ»å·©å›ºä»¥å…å¿˜è®°(lllï¿¢Ï‰ï¿¢)&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="C++" scheme="https://www.leezy.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>SSMæ¡†æ¶æ€»ç»“</title>
    <link href="https://www.leezy.top/2017/08/09/SSM%E6%A1%86%E6%9E%B6%E6%80%BB%E7%BB%93/"/>
    <id>https://www.leezy.top/2017/08/09/SSMæ¡†æ¶æ€»ç»“/</id>
    <published>2017-08-09T12:10:41.000Z</published>
    <updated>2019-12-16T06:44:12.853Z</updated>
    
    <content type="html"><![CDATA[<p>SSMæ¡†æ¶çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†æ€»ç»“ã€‚</p><a id="more"></a><h3 id="1-SSMå®šä¹‰"><a href="#1-SSMå®šä¹‰" class="headerlink" title="1.SSMå®šä¹‰"></a>1.SSMå®šä¹‰</h3><p>SSM = Spring + SpringMVC + MyBatis<br>Spring:<br>Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰çš„å®¹å™¨æ¡†æ¶ã€‚</p><p>SpringMVCå‘½ååŠåˆ†å±‚ï¼š<br>edu.xju.common.util å…¬å…±éƒ¨åˆ†<br>edu.xju.controller æ§åˆ¶å±‚<br>edu.xju.dao æ•°æ®å±‚<br>edu.xju.entity å®ä½“å±‚<br>edu.xju.service æœåŠ¡å±‚</p><p>MyBatis:<br>æ¯”Hibernateè¦çµæ´»å¤šç”¨äºéœ€æ±‚ä¸æ–­å˜æ›´çš„é¡¹ç›®ã€‚</p><h3 id="2-Webé¡¹ç›®æ‰§è¡Œé¡ºåº"><a href="#2-Webé¡¹ç›®æ‰§è¡Œé¡ºåº" class="headerlink" title="2.Webé¡¹ç›®æ‰§è¡Œé¡ºåº"></a>2.Webé¡¹ç›®æ‰§è¡Œé¡ºåº</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml ç¨‹åºæ‰§è¡Œå…¥å£ --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¦‚æœä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼ŒSpring Web MVCæ¡†æ¶å°†åŠ è½½â€œclasspath:spring-mvc.xmlâ€æ¥è¿›è¡Œåˆå§‹åŒ–ä¸Šä¸‹æ–‡è€Œä¸æ˜¯â€œ/WEB-INF/[servletåå­—]-servlet.xmlâ€ã€‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- ä¼ ç»™ä¸Šä¸‹æ–‡å®ä¾‹ï¼ˆç”±contextClassæŒ‡å®šï¼‰çš„å­—ç¬¦ä¸²ï¼Œç”¨æ¥æŒ‡å®šä¸Šä¸‹æ–‡çš„ä½ç½®ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è¢«åˆ†æˆå¤šä¸ªå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ æ¥æ”¯æŒå¤šä¸ªä¸Šä¸‹æ–‡ï¼ˆåœ¨å¤šä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œå¦‚æœåŒä¸€ä¸ªbeanè¢«å®šä¹‰ä¸¤æ¬¡ï¼Œåé¢ä¸€ä¸ªä¼˜å…ˆï¼‰ã€‚ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- load-on-startupï¼šè¡¨ç¤ºå¯åŠ¨å®¹å™¨æ—¶åˆå§‹åŒ–è¯¥Servletï¼› --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- url-patternï¼šè¡¨ç¤ºå“ªäº›è¯·æ±‚äº¤ç»™Spring Web MVCå¤„ç†ï¼Œ â€œ/â€ æ˜¯ç”¨æ¥å®šä¹‰é»˜è®¤servletæ˜ å°„çš„ã€‚ä¹Ÿå¯ä»¥å¦‚â€œ*.htmlâ€è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰ä»¥htmlä¸ºæ‰©å±•åçš„è¯·æ±‚ã€‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.json<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä»main.jspå¼€å§‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>main.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>DispatcherServletæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œåœ¨è¿™é‡Œæ˜¯æ‹¦æˆª.doå’Œ.jsonç»“å°¾çš„è¯·æ±‚ã€‚<br>è¯¥DispatcherServleté»˜è®¤ä½¿ç”¨WebApplicationContextä½œä¸ºä¸Šä¸‹æ–‡ï¼ŒSpringé»˜è®¤é…ç½®æ–‡ä»¶ä¸ºâ€œ/WEB-INF/[servletåå­—]-servlet.xmlâ€ã€‚<br><strong>ContextLoaderListeneråˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡å’ŒDispatcherServletåˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡å…³ç³»</strong><br><img src="/assets/blogImg/%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87%E5%85%B3%E7%B3%BB.jpg" alt="åˆå§‹åŒ–ä¸Šä¸‹æ–‡å…³ç³»"><br>ContextLoaderListeneråˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡åŠ è½½çš„Beanæ˜¯å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå…±äº«çš„ï¼›<br>DispatcherServletåˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡åŠ è½½çš„Beanæ˜¯åªå¯¹Spring Web MVCæœ‰æ•ˆçš„Beanï¼›å³åªåŠ è½½Webç›¸å…³çš„ç»„ä»¶ã€‚<br><strong>DispatcherServletçš„ç»§æ‰¿å…³ç³»</strong><br><img src="/assets/blogImg/DispatcherServlet%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png" alt="DispatcherServletç»§æ‰¿å…³ç³»"></p><p><strong>DispatcherServlet initialization parameters</strong><br>![DispatcherServlet initialization parameters](/assets/blogImg/DispatcherServlet initialization parameters.png)</p><ol><li><em>HttpServletBeanç»§æ‰¿HttpServlet</em>ï¼Œå› æ­¤åœ¨Webå®¹å™¨å¯åŠ¨æ—¶å°†è°ƒç”¨å®ƒçš„initæ–¹æ³•ï¼Œè¯¥åˆå§‹åŒ–æ–¹æ³•çš„ä¸»è¦ä½œç”¨<br>å°†Servletåˆå§‹åŒ–å‚æ•°ï¼ˆinit-paramï¼‰è®¾ç½®åˆ°è¯¥ç»„ä»¶ä¸Šï¼ˆå¦‚contextAttributeã€contextClassã€namespaceã€contextConfigLocationï¼‰ï¼Œé€šè¿‡BeanWrapperç®€åŒ–è®¾å€¼è¿‡ç¨‹ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ï¼›æä¾›ç»™å­ç±»åˆå§‹åŒ–æ‰©å±•ç‚¹ï¼ŒinitServletBean()ï¼Œè¯¥æ–¹æ³•ç”±FrameworkServletè¦†ç›–ã€‚</li><li><em>FrameworkServletç»§æ‰¿HttpServletBean</em>ï¼Œé€šè¿‡initServletBean()è¿›è¡ŒWebä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼Œè¯¥æ–¹æ³•ä¸»è¦è¦†ç›–ä¸€ä¸‹ä¸¤ä»¶äº‹æƒ…ï¼š<br> åˆå§‹åŒ–webä¸Šä¸‹æ–‡ï¼›<br> æä¾›ç»™å­ç±»åˆå§‹åŒ–æ‰©å±•ç‚¹ï¼›</li><li><em>DispatcherServletç»§æ‰¿FrameworkServlet</em>ï¼Œå¹¶å®ç°äº†onRefresh()æ–¹æ³•æä¾›ä¸€äº›å‰ç«¯æ§åˆ¶å™¨ç›¸å…³çš„é…ç½®ï¼›</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-mvc.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ‰«æè¿™ä¸ªæ§åˆ¶åŒ…å†…éƒ¨çš„Controller --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"edu.xju.controller"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jspViewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"viewClass"</span> <span class="attr">value</span>=<span class="string">"org.springframework.web.servlet.view.JstlView"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageConverters"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// spring-mybatis.xml</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"edu"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mydb?charsetEncoding=utf8"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--sessionFactoryä»£ç†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ³¨è§£æ‰«æ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"edu.xju.dao"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sessionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring äº‹åŠ¡ç®¡ç†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰äº‹åŠ¡å£°æ˜ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"serviceAop"</span> <span class="attr">expression</span>=<span class="string">"execution(* edu.xju.service.*Service.*(..))"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"serviceAop"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// main.jsp</span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>åŸºæœ¬çš„ ssm æ¡†æ¶<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">a&#123;</span></span><br><span class="line"><span class="undefined">font-size: 20px;</span></span><br><span class="line"><span class="undefined">display: block;</span></span><br><span class="line"><span class="undefined">margin-top: 30px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/user/addUser.do"</span>&gt;</span>æ·»åŠ ç”¨æˆ·<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/user/list.do"</span>&gt;</span>æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/user/getUserA.json?id=1"</span>&gt;</span>è·å–æŸä¸ªç”¨æˆ·JSONæ ¼å¼1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/user/getUserB.json?id=2"</span>&gt;</span>è·å–æŸä¸ªç”¨æˆ·JSONæ ¼å¼2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController.java</span></span><br><span class="line"><span class="keyword">package</span> edu.xju.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> edu.xju.common.util.JsonUtil;</span><br><span class="line"><span class="keyword">import</span> edu.xju.entity.User;</span><br><span class="line"><span class="keyword">import</span> edu.xju.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ˜¯è¿”å›é¡µé¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/list.do"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsers</span><span class="params">(Model model,HttpSession session)</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userService.getAll();</span><br><span class="line">        model.addAttribute(<span class="string">"list"</span>,users);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"list"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–json çš„ç¬¬ä¸€ç§æ–¹å¼</span></span><br><span class="line"><span class="comment">     * è¿”å›json æ ¼å¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getUserA.json"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getUserByIdA</span><span class="params">(Model model,HttpSession session,Integer id )</span></span>&#123;</span><br><span class="line">    User user = userService.findUserById(id);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¬¬json çš„ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getUserB.json"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUserByIdB</span><span class="params">(Model model,HttpServletResponse response,HttpSession session,Integer id )</span></span>&#123;</span><br><span class="line">    User user = userService.findUserById(id);</span><br><span class="line">    JsonUtil.printByJSON(response, user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/addUser.do"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">insertUser</span><span class="params">(Model model,HttpSession session,Integer id,String name,Integer age )</span></span>&#123;</span><br><span class="line">    name = <span class="string">"æµ‹è¯•å§“å"</span>;</span><br><span class="line">    age = <span class="number">99</span>;</span><br><span class="line">    User user = <span class="keyword">new</span> User(name, age);</span><br><span class="line">    userService.addUser(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"insertOK"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User.java</span></span><br><span class="line"><span class="keyword">package</span> edu.xju.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">( String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserService.java</span></span><br><span class="line"><span class="keyword">package</span> edu.xju.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> edu.xju.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span>  List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserServiceImpl.java</span></span><br><span class="line"><span class="keyword">package</span> edu.xju.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> edu.xju.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> edu.xju.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.getAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userMapper.getUserById(id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">userMapper.insertUser(user);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>MyBatis</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserMapper.java</span></span><br><span class="line"><span class="keyword">package</span> edu.xju.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> edu.xju.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// UserMapper.xml</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"edu.xju.dao.UserMapper"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å£°æ˜å±æ€§ä¸æŸ¥è¯¢å­—æ®µä¹‹é—´çš„çš„å¯¹åº”å…³ç³» --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"edu.xju.entity.User"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAll"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">      select id,name,age from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">      select id,name,age from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"edu.xju.entity.User"</span>&gt;</span></span><br><span class="line">        insert into user(name,age) values(#&#123;name&#125;,#&#123;age&#125;)</span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-åºåˆ—å›¾"><a href="#3-åºåˆ—å›¾" class="headerlink" title="3.åºåˆ—å›¾"></a>3.åºåˆ—å›¾</h3><p><img src="/assets/blogImg/%E5%BA%8F%E5%88%97%E5%9B%BE.png" alt="æµç¨‹åºåˆ—å›¾"></p><h3 id="4-å¸¸ç”¨æ³¨è§£è§£æï¼š"><a href="#4-å¸¸ç”¨æ³¨è§£è§£æï¼š" class="headerlink" title="4.å¸¸ç”¨æ³¨è§£è§£æï¼š"></a>4.å¸¸ç”¨æ³¨è§£è§£æï¼š</h3><blockquote><p>@Autowired å’Œ @Resourceçš„ä½¿ç”¨åœºæ™¯å’ŒåŒºåˆ«</p></blockquote><p>@Autowired æ˜¯byTypeè‡ªåŠ¨æ³¨å…¥ï¼Œæ˜¯Springçš„æ³¨è§£ã€‚@Resourceé»˜è®¤æ˜¯byNameæ³¨å…¥ï¼Œé»˜è®¤ä½¿ç”¨æˆå‘˜å±æ€§çš„å˜é‡åæ³¨å…¥ï¼Œæ˜¯Javaè‡ªå¸¦çš„æ³¨è§£ã€‚</p><blockquote><p>@Scope(â€œprototypeâ€) å’Œ @Scope(â€œsingletonâ€) çš„åŒºåˆ«</p></blockquote><p>singleton è¡¨ç¤ºSpringå®¹å™¨ä¸­çš„å•ä¾‹ï¼Œé€šè¿‡spring å®¹å™¨è·å–è¯¥beanæ—¶æ€»æ˜¯è¿”å›å”¯ä¸€çš„å®ä¾‹ã€‚<br>prototype è¡¨ç¤ºæ¯æ¬¡è·å–è¯¥beanæ—¶éƒ½ä¼šnew ä¸€ä¸ªæ–°çš„å¯¹è±¡å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonTestService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä»£ç æ‰€ç¤ºï¼Œå¦‚æœè®¾ç½®ä¸ºsingletonï¼Œå½“a++å’Œb++æ—¶ï¼Œaå’Œbéƒ½ä¼šå¢åŠ ã€‚å¦‚æœè®¾ç½®ä¸ºprototypeçš„è¯ï¼Œåˆ™åªæœ‰aä¼šå¢åŠ ï¼Œbä¸ä¼šå¢åŠ ã€‚</p><blockquote><p>static é™æ€å˜é‡</p></blockquote><p>é™æ€å˜é‡æ•´ä¸ªå†…å­˜ä¸­<code>åªæœ‰ä¸€ä¸ªå‰¯æœ¬</code>ï¼Œä¸ºæ‰€æœ‰å¯¹è±¡æ‰€å…±äº«ï¼Œå½“ä¸”ä»…å½“ç±»åŠ è½½æ—¶æ‰ä¼šè¢«åˆå§‹åŒ–ï¼›è€Œéé™æ€å˜é‡æ˜¯å¯¹è±¡æ‰€æ‹¥æœ‰çš„ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶è¢«åˆå§‹åŒ–ï¼Œ<code>å­˜åœ¨å¤šä¸ªå‰¯æœ¬</code>ï¼Œæ¯ä¸ªå¯¹è±¡ä¹‹é—´æ‹¥æœ‰çš„å‰¯æœ¬äº’ä¸å½±å“ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SSMæ¡†æ¶çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†æ€»ç»“ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="JavaWEB" scheme="https://www.leezy.top/tags/JavaWEB/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“è®¾è®¡æŠ€å·§</title>
    <link href="https://www.leezy.top/2017/08/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%8A%80%E5%B7%A7/"/>
    <id>https://www.leezy.top/2017/08/09/æ•°æ®åº“è®¾è®¡æŠ€å·§/</id>
    <published>2017-08-09T01:58:25.000Z</published>
    <updated>2019-12-16T06:43:15.614Z</updated>
    
    <content type="html"><![CDATA[<p>è®¾è®¡æ•°æ®åº“çš„ä¸€äº›å‘çš„æ€»ç»“ã€‚</p><a id="more"></a><h3 id="1-Intä¸Integerçš„åŒºåˆ«"><a href="#1-Intä¸Integerçš„åŒºåˆ«" class="headerlink" title="1.Intä¸Integerçš„åŒºåˆ«"></a>1.Intä¸Integerçš„åŒºåˆ«</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­¦ç”Ÿ</span></span><br><span class="line"><span class="comment"> * åœ¨ä½¿ç”¨Hibernateè®¾è®¡æ•°æ®è¡¨å£°æ˜æ•°æ®ç±»å‹æ—¶ï¼ŒJavaä»£ç ä¸­IDä¸€èˆ¬éƒ½è®¾ç½®æˆIntegerç±»å‹ï¼Œå› ä¸ºå®ƒå¯ä»¥é»˜è®¤ä¸ºnullï¼Œè€Œ</span></span><br><span class="line"><span class="comment"> * åœ¨ä½¿ç”¨æ€§åˆ«æ—¶ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Intç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_student"</span>)</span><br><span class="line"><span class="meta">@Cache</span>(usage=CacheConcurrencyStrategy.READ_WRITE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">// å§“å</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="comment">// å¹´é¾„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"><span class="comment">// æ€§åˆ«</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æœ‰ä¾èµ–å…³è”è¡¨ä¸æ— ä¾èµ–å…³è”è¡¨"><a href="#2-æœ‰ä¾èµ–å…³è”è¡¨ä¸æ— ä¾èµ–å…³è”è¡¨" class="headerlink" title="2.æœ‰ä¾èµ–å…³è”è¡¨ä¸æ— ä¾èµ–å…³è”è¡¨"></a>2.æœ‰ä¾èµ–å…³è”è¡¨ä¸æ— ä¾èµ–å…³è”è¡¨</h3><p><em>ä¸€å¼ è¡¨é‡Œåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œæˆ–è€…æœ‰ä¸€ç§æƒ…å†µæ˜¯one primary key included two fileds.</em><br><strong>æœ‰ä¾èµ–å…³è”è¡¨ï¼šé€šè¿‡åœ¨ç”¨æˆ·ä¿¡æ¯è¡¨é‡ŒåŠ å…¥ç”¨æˆ·IDå®ç°ä¸¤å¼ è¡¨çš„å…³è”ã€‚</strong></p><p><img src="/assets/blogImg/%E6%9C%89%E4%BE%9D%E8%B5%96%E7%9A%84%E5%85%B3%E8%81%94.png" alt="æœ‰ä¾èµ–å…³è”è¡¨"><br>å…·ä½“å®ç°ï¼š<br><strong>é€»è¾‘æ¨¡å‹</strong><br><img src="/assets/blogImg/%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9E%8B.png" alt="æœ‰ä¾èµ–å…³è”è¡¨"><br><strong>ç‰©ç†æ¨¡å‹</strong><br><img src="/assets/blogImg/%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B.png" alt="æœ‰ä¾èµ–å…³è”è¡¨"></p><hr><p><strong>æ— ä¾èµ–å…³è”è¡¨ï¼šé€šè¿‡å¼•å…¥ç¬¬ä¸‰å¼ è¡¨æ¥è¿›è¡Œç”¨æˆ·è¡¨ä¸ç”¨æˆ·ä¿¡æ¯è¡¨çš„å…³è”ã€‚</strong></p><p><img src="/assets/blogImg/%E6%97%A0%E4%BE%9D%E8%B5%96%E5%85%B3%E8%81%94.png" alt="æ— ä¾èµ–å…³è”è¡¨"></p><h3 id="3-Hibernateä¸­ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šä»¥åŠå¤šå¯¹å¤šçš„æ³¨è§£å®ç°"><a href="#3-Hibernateä¸­ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šä»¥åŠå¤šå¯¹å¤šçš„æ³¨è§£å®ç°" class="headerlink" title="3.Hibernateä¸­ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šä»¥åŠå¤šå¯¹å¤šçš„æ³¨è§£å®ç°"></a>3.Hibernateä¸­ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šä»¥åŠå¤šå¯¹å¤šçš„æ³¨è§£å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1:1 &lt;==&gt; Person:IdCard</span></span><br><span class="line"><span class="comment">// Person.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_person"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å§“å</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹´é¾„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èº«ä»½è¯</span></span><br><span class="line"><span class="meta">@OneToOne</span>(mappedBy=<span class="string">"person"</span>)  <span class="comment">//æ”¾å¼ƒç»´æŠ¤ä¸»æ§æƒ</span></span><br><span class="line"><span class="keyword">private</span> IdCard card;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//IdCard.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_idcard"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdCard</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èº«ä»½è¯å·</span></span><br><span class="line"><span class="keyword">private</span> String sno;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰€å±äºº</span></span><br><span class="line"><span class="meta">@OneToOne</span></span><br><span class="line"><span class="meta">@JoinColumn</span>(name=<span class="string">"person_id"</span>, unique=<span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">private</span> Person person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1:n &lt;==&gt; Department:Employee</span></span><br><span class="line"><span class="comment">// Department.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_dept"</span>)</span><br><span class="line"><span class="meta">@Cache</span>(usage=CacheConcurrencyStrategy.READ_WRITE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åç§°</span></span><br><span class="line"><span class="meta">@Column</span>(length = <span class="number">50</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤å®ä½“ç±»æ‰€æœ‰å­—æ®µéƒ½æ˜ å°„, å¯ä½¿ç”¨@Transientå£°æ˜ä¸åšæ˜ å°„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> sn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¥æœ‰å¤šä¸ªå‘˜å·¥</span></span><br><span class="line"><span class="meta">@OneToMany</span>(mappedBy = <span class="string">"dept"</span>)  <span class="comment">//mappedByï¼šè¡¨ç¤ºæ”¾å¼ƒç»´æŠ¤ä¸»æ§æƒ</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Employee&gt; emps = <span class="keyword">new</span> HashSet&lt;Employee&gt;();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Employee.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_emp"</span>)</span><br><span class="line"><span class="meta">@Cache</span>(usage=CacheConcurrencyStrategy.READ_WRITE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">// å§“å</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éƒ¨é—¨</span></span><br><span class="line"><span class="meta">@ManyToOne</span></span><br><span class="line"><span class="meta">@JoinColumn</span>(name=<span class="string">"dept_id"</span>)</span><br><span class="line"><span class="keyword">private</span> Department dept;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// n:n &lt;==&gt; Course:Student</span></span><br><span class="line"><span class="comment">// Course.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_course"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">// åç§°</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­¦ç”Ÿ</span></span><br><span class="line"><span class="meta">@ManyToMany</span></span><br><span class="line"><span class="meta">@JoinTable</span>(name=<span class="string">"tb_student_course"</span>, </span><br><span class="line">joinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"course_id"</span>), </span><br><span class="line">inverseJoinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"student_id"</span>))</span><br><span class="line"><span class="keyword">private</span> Set&lt;Student&gt; students = <span class="keyword">new</span> HashSet&lt;Student&gt;();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Student.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_student"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="comment">// å§“å</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="comment">// è¯¾ç¨‹</span></span><br><span class="line"><span class="meta">@ManyToMany</span>(mappedBy=<span class="string">"students"</span>)</span><br><span class="line"><span class="keyword">private</span> Set&lt;Course&gt; courses = <span class="keyword">new</span> HashSet&lt;Course&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®¾è®¡æ•°æ®åº“çš„ä¸€äº›å‘çš„æ€»ç»“ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="MySQL" scheme="https://www.leezy.top/tags/MySQL/"/>
    
      <category term="Hibernate" scheme="https://www.leezy.top/tags/Hibernate/"/>
    
  </entry>
  
  <entry>
    <title>é¢è¯•-JavaåŸºç¡€çŸ¥è¯†</title>
    <link href="https://www.leezy.top/2017/07/28/JAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-%E9%9D%A2%E8%AF%95/"/>
    <id>https://www.leezy.top/2017/07/28/JAVAåŸºç¡€çŸ¥è¯†-é¢è¯•/</id>
    <published>2017-07-28T11:26:59.000Z</published>
    <updated>2019-12-21T09:40:47.902Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰å®åŸºç¡€ï¼</p><a id="more"></a><p>ç¬”è¯•è®©æˆ‘æ˜ç™½äº†è‡ªå·±çš„ä¸€äº›é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span> a = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">byte</span> b = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">byte</span> c = a + b;</span><br><span class="line"><span class="comment">// æŠ¥é”™ é»˜è®¤æœ€ä½æ˜¯Intç±»å‹</span></span><br><span class="line"><span class="keyword">byte</span> c = (<span class="keyword">byte</span>)a + b;</span><br><span class="line"><span class="keyword">int</span> c = a + b;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lzy.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> b = a++;</span><br><span class="line">System.out.println(a);<span class="comment">//1</span></span><br><span class="line"><span class="keyword">int</span> c = ++a;</span><br><span class="line">System.out.println(a);<span class="comment">//2</span></span><br><span class="line">System.out.println(a++);<span class="comment">//2</span></span><br><span class="line">System.out.println(++a);<span class="comment">//4</span></span><br><span class="line">System.out.println(b);<span class="comment">//0</span></span><br><span class="line">System.out.println(c);<span class="comment">//2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// açš„å˜åŒ–ï¼š6   7     8     9    10</span></span><br><span class="line"><span class="comment">// bçš„å˜åŒ–ï¼š 5    7     7     8     10</span></span><br><span class="line"><span class="keyword">int</span> b = a++ + ++a + a++ + a++ + ++a;</span><br><span class="line">System.out.println(b); <span class="comment">//37</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//&amp;å¯¹æ¯ä¸€ä¸ªéƒ½åˆ¤æ–­ï¼›</span></span><br><span class="line"><span class="keyword">if</span> (a==<span class="number">0</span> &amp; a++==<span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"&amp;"</span>);<span class="comment">//ä¸è¾“å‡º</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(a);<span class="comment">//1</span></span><br><span class="line"><span class="comment">//&amp;&amp;åªè¦å‰é¢æ˜¯falseå°±è¾“å‡ºfalseï¼Œè€Œä¸ç»§ç»­åˆ¤æ–­åé¢äº†</span></span><br><span class="line"><span class="keyword">if</span> (a==<span class="number">0</span> &amp;&amp; a++==<span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"&amp;&amp;"</span>);<span class="comment">//ä¸è¾“å‡º</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (a==<span class="number">1</span> &amp;&amp; a++==<span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"&amp;&amp;"</span>);<span class="comment">//è¾“å‡º</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éšæœºæ•°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// éšæœºæ•°äº§ç”Ÿçš„èŒƒå›´æ˜¯[0, 1)</span></span><br><span class="line"><span class="keyword">double</span> num = Math.random();</span><br><span class="line"><span class="comment">// è¿™æ ·å­[0, 0.5) [0.5, 1)æ‰èƒ½çœŸæ­£å¹³è¡¡</span></span><br><span class="line"><span class="keyword">if</span> (num &gt;= <span class="number">0.5</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"æˆéƒ½"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"èµµé›·"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºæŒ‡å®šèŒƒå›´çš„æ•°å­—</span></span><br><span class="line"><span class="comment">// [26, 38]</span></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸€ï¼š (int)(Math.random()*(max - min) + min);</span></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">int</span> b = <span class="number">38</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>  scal = (<span class="keyword">int</span>)(Math.random()*(b - a + <span class="number">1</span>)) + a;</span><br><span class="line">System.out.println(scal);</span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒï¼š</span></span><br><span class="line"><span class="keyword">int</span> scall = (<span class="keyword">int</span>)(Math.random() * <span class="number">100</span> % <span class="number">12</span>) + a;</span><br><span class="line">System.out.println(scall);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="åŸºç¡€çŸ¥è¯†ç‚¹"><a href="#åŸºç¡€çŸ¥è¯†ç‚¹" class="headerlink" title="åŸºç¡€çŸ¥è¯†ç‚¹"></a>åŸºç¡€çŸ¥è¯†ç‚¹</h2><h3 id="ä¸€ï¼š-ä¸-equalçš„åŒºåˆ«ï¼š"><a href="#ä¸€ï¼š-ä¸-equalçš„åŒºåˆ«ï¼š" class="headerlink" title="ä¸€ï¼š== ä¸ equalçš„åŒºåˆ«ï¼š"></a>ä¸€ï¼š== ä¸ equalçš„åŒºåˆ«ï¼š</h3><ol><li>== æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ã€‚</li><li>Equalsåˆ™æ˜¯stringå¯¹è±¡çš„æ–¹æ³•ï¼Œå¯ä»¥.ï¼ˆç‚¹ï¼‰å‡ºæ¥ã€‚</li><li>å› ä¸ºå¯¹è±¡å˜é‡çš„å­˜å‚¨çš„æ˜¯å¯¹è±¡åœ¨å†…å­˜ä¸­çš„è·¯å¾„ï¼Œå³å†…å­˜åœ°å€ã€‚æ‰€ä»¥ç”¨â€œ==â€æ¯”è¾ƒæ—¶ï¼Œå³ä½¿<br>å¯¹è±¡çš„å€¼ç›¸ç­‰ï¼Œä½†æ˜¯ä»–ä»¬çš„å†…å­˜åœ°å€ä¸åŒ(å¼•ç”¨æ•°æ®ç±»å‹)ï¼Œæ‰€ä»¥==çš„ç»“æœä¸ºfalseã€‚æ•…â€œ==â€ç”¨äºæ¯”è¾ƒä¸¤<br>ä¸ªå˜é‡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œè€Œä¸æ˜¯å˜é‡å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</li><li>equalç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚ </li><li>â€œ==â€æ¯”è¾ƒçš„æ˜¯å€¼ã€å˜é‡(æ ˆ)å†…å­˜ä¸­å­˜æ”¾çš„å¯¹è±¡çš„(å †)å†…å­˜åœ°å€ã€‘<br>equalç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸åŒã€ä¸æ˜¯æ¯”åœ°å€ã€‘ </li></ol><p>ã€ç‰¹åˆ«æ³¨æ„ã€‘Objectç±»ä¸­çš„equalsæ–¹æ³•å’Œâ€œ==â€æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰åŒºåˆ«ï¼Œè€ŒStringç±»ï¼ŒIntegerç±»ç­‰ç­‰ä¸€äº›ç±»ï¼Œæ˜¯é‡å†™äº†equalsæ–¹æ³•ï¼Œæ‰ä½¿å¾—equalså’Œâ€œ==ä¸åŒâ€ï¼Œæ‰€ä»¥ï¼Œå½“è‡ªå·±åˆ›å»ºç±»æ—¶ï¼Œè‡ªåŠ¨ç»§æ‰¿äº†Objectçš„equalsæ–¹æ³•ï¼Œè¦æƒ³å®ç°ä¸åŒçš„ç­‰äºæ¯”è¾ƒï¼Œå¿…é¡»é‡å†™equalsæ–¹æ³•ã€‚â€==â€æ¯”â€equalâ€è¿è¡Œé€Ÿåº¦å¿«,å› ä¸ºâ€==â€åªæ˜¯æ¯”è¾ƒå¼•ç”¨.</p><h3 id="äºŒï¼špublicã€protectedã€privateã€defaultï¼ˆfriendlyï¼‰çš„åŒºåˆ«"><a href="#äºŒï¼špublicã€protectedã€privateã€defaultï¼ˆfriendlyï¼‰çš„åŒºåˆ«" class="headerlink" title="äºŒï¼špublicã€protectedã€privateã€defaultï¼ˆfriendlyï¼‰çš„åŒºåˆ«:"></a>äºŒï¼špublicã€protectedã€privateã€defaultï¼ˆfriendlyï¼‰çš„åŒºåˆ«:</h3><p><img src="/assets/blogImg/public_protected_private_default.png" alt="Javaä¸­ä½œç”¨èŒƒå›´è¡¨"></p><p>publicï¼šå¯ä»¥è¢«å…¶ä»–ç±»è®¿é—®<br>privateï¼šåªèƒ½è¢«è‡ªå·±è®¿é—®å’Œä¿®æ”¹<br>protected:ç±»å†…éƒ¨ã€å­ç±»ã€åŒä¸€ä¸ªåŒ…ä¸­çš„ç±»ä¹‹é—´å¯ä»¥è®¿é—®<br>defaultï¼šä½œç”¨åŸŸæ˜¯åŒ…ï¼Œå¯ä»¥ä¸å†™ã€‚è¢«è®¤ä¸ºæ˜¯friendly</p><h3 id="finalå…³é”®å­—ï¼š"><a href="#finalå…³é”®å­—ï¼š" class="headerlink" title="finalå…³é”®å­—ï¼š"></a>finalå…³é”®å­—ï¼š</h3><p>ä¿®é¥°ç±»ï¼šè¡¨ç¤ºè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œfinalç±»çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼çš„æŒ‡å®šä¸ºfinalæ–¹æ³•<br>ä¿®é¥°æ–¹æ³•ï¼šå˜æ˜¯è¯¥æ–¹æ³•ä¸èƒ½è¢«å­ç±»ä¿®æ”¹ï¼Œç±»çš„privateæ–¹æ³•ä¼šè¢«éšå¼çš„æŒ‡å®šä¸ºfinalæ–¹æ³•<br>ä¿®é¥°å˜é‡ï¼šåŸºæœ¬æ•°æ®å˜é‡ä¸å¯ä»¥è¢«æ›´æ”¹<br>         å¼•ç”¨ç±»å‹å˜é‡ä¸å¯ä»¥å†æ›´æ”¹æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡</p><h3 id="Javaçº¿ç¨‹å®‰å…¨ä¸éçº¿ç¨‹å®‰å…¨ï¼š"><a href="#Javaçº¿ç¨‹å®‰å…¨ä¸éçº¿ç¨‹å®‰å…¨ï¼š" class="headerlink" title="Javaçº¿ç¨‹å®‰å…¨ä¸éçº¿ç¨‹å®‰å…¨ï¼š"></a>Javaçº¿ç¨‹å®‰å…¨ä¸éçº¿ç¨‹å®‰å…¨ï¼š</h3><p>å¤šçº¿ç¨‹å®‰å…¨ä¼˜ç‚¹ä½“ç°åœ¨å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡ï¼Œéçº¿ç¨‹å®‰å…¨ != ä¸å®‰å…¨<br>çº¿ç¨‹å®‰å…¨æ˜¯é€šè¿‡çº¿ç¨‹åŒæ­¥æ§åˆ¶æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯synchronizedå…³é”®å­—ã€‚<br>ArrayListæ˜¯éçº¿ç¨‹å®‰å…¨ Vectoræ˜¯çº¿ç¨‹å®‰å…¨ï¼›<br>HashMapæ˜¯éçº¿ç¨‹å®‰å…¨ HashTableæ˜¯çº¿ç¨‹å®‰å…¨ï¼›<br>StringBuilderæ˜¯éçº¿ç¨‹å®‰å…¨ StringBufferæ˜¯çº¿ç¨‹å®‰å…¨ï¼›<br><a href="http://blog.csdn.net/YiZhiCXY/article/details/51335385" target="_blank" rel="noopener">http://blog.csdn.net/YiZhiCXY/article/details/51335385</a></p><h3 id="Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«ï¼š"><a href="#Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«ï¼š" class="headerlink" title="Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«ï¼š"></a>Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«ï¼š</h3><p>Stringï¼š å­—ç¬¦ä¸²å¸¸é‡<br>StringBuffer: å­—ç¬¦ä¸²å˜é‡ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ å¤šçº¿ç¨‹ä¸‹æœ‰ä¼˜åŠ¿<br>StringBuilder: å­—ç¬¦ä¸²å˜é‡ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰ å•çº¿ç¨‹ä¸‹æœ‰ä¼˜åŠ¿</p><h3 id="Arrayã€ArrayListã€Vectoryã€LinkedListçš„åŒºåˆ«ï¼š-æ¨èçœ‹æºç "><a href="#Arrayã€ArrayListã€Vectoryã€LinkedListçš„åŒºåˆ«ï¼š-æ¨èçœ‹æºç " class="headerlink" title="Arrayã€ArrayListã€Vectoryã€LinkedListçš„åŒºåˆ«ï¼š(æ¨èçœ‹æºç )"></a>Arrayã€ArrayListã€Vectoryã€LinkedListçš„åŒºåˆ«ï¼š(æ¨èçœ‹æºç )</h3><p>ArrayListæ˜¯ä¸ºå¯å˜æ•°ç»„å®ç°çš„ï¼Œå½“æ›´å¤šçš„å…ƒç´ æ·»åŠ åˆ°ArrayListçš„æ—¶å€™ï¼Œå®ƒçš„å¤§å°ä¼šåŠ¨æ€å¢å¤§ã€‚å®ƒçš„å…ƒç´ å¯ä»¥é€šè¿‡get/setæ–¹æ³•ç›´æ¥è®¿é—®ï¼Œå› ä¸ºArrayListæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Resizable-array implementation of the &#123;<span class="doctag">@code</span> List&#125; interface.  Implements</span></span><br><span class="line"><span class="comment"> * all optional list operations, and permits all elements, including</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> null&#125;.  In addition to implementing the &#123;<span class="doctag">@code</span> List&#125; interface,</span></span><br><span class="line"><span class="comment"> * this class provides methods to manipulate the size of the array that is</span></span><br><span class="line"><span class="comment"> * used internally to store the list.  (This class is roughly equivalent to</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Vector&#125;, except that it is unsynchronized.)</span></span><br><span class="line"><span class="comment">  * &lt;p&gt;The &#123;<span class="doctag">@code</span> size&#125;, &#123;<span class="doctag">@code</span> isEmpty&#125;, &#123;<span class="doctag">@code</span> get&#125;, &#123;<span class="doctag">@code</span> set&#125;,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> iterator&#125;, and &#123;<span class="doctag">@code</span> listIterator&#125; operations run in constant</span></span><br><span class="line"><span class="comment"> * time.  The &#123;<span class="doctag">@code</span> add&#125; operation runs in &lt;i&gt;amortized constant time&lt;/i&gt;,</span></span><br><span class="line"><span class="comment"> * that is, adding n elements requires O(n) time.  All of the other operations</span></span><br><span class="line"><span class="comment"> * run in linear time (roughly speaking).  The constant factor is low compared</span></span><br><span class="line"><span class="comment"> * to that for the &#123;<span class="doctag">@code</span> LinkedList&#125; implementation.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>LinkedListæ˜¯ä¸ºåŒå‘é“¾è¡¨å®ç°çš„,éçº¿ç¨‹å®‰å…¨(not )</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Doubly-linked list implementation of the &#123;<span class="doctag">@code</span> List&#125; and &#123;<span class="doctag">@code</span> Deque&#125;</span></span><br><span class="line"><span class="comment"> * interfaces.  Implements all optional list operations, and permits all</span></span><br><span class="line"><span class="comment"> * elements (including &#123;<span class="doctag">@code</span> null&#125;).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;All of the operations perform as could be expected for a doubly-linked</span></span><br><span class="line"><span class="comment"> * list.  Operations that index into the list will traverse the list from</span></span><br><span class="line"><span class="comment"> * the beginning or the end, whichever is closer to the specified index.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;strong&gt;Note that this implementation is not synchronized.&lt;/strong&gt;</span></span><br><span class="line"><span class="comment"> * If multiple threads access a linked list concurrently, and at least</span></span><br><span class="line"><span class="comment"> * one of the threads modifies the list structurally, it &lt;i&gt;must&lt;/i&gt; be</span></span><br><span class="line"><span class="comment"> * synchronized externally.  (A structural modification is any operation</span></span><br><span class="line"><span class="comment"> * that adds or deletes one or more elements; merely setting the value of</span></span><br><span class="line"><span class="comment"> * an element is not a structural modification.)  This is typically</span></span><br><span class="line"><span class="comment"> * accomplished by synchronizing on some object that naturally</span></span><br><span class="line"><span class="comment"> * encapsulates the list.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>Vectorä¸ArrayListç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯åŒæ­¥çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The &#123;<span class="doctag">@code</span> Vector&#125; class implements a growable array of</span></span><br><span class="line"><span class="comment"> * objects. Like an array, it contains components that can be</span></span><br><span class="line"><span class="comment"> * accessed using an integer index. However, the size of a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Vector&#125; can grow or shrink as needed to accommodate</span></span><br><span class="line"><span class="comment"> * adding and removing items after the &#123;<span class="doctag">@code</span> Vector&#125; has been created.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Each vector tries to optimize storage management by maintaining a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> capacity&#125; and a &#123;<span class="doctag">@code</span> capacityIncrement&#125;. The</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> capacity&#125; is always at least as large as the vector</span></span><br><span class="line"><span class="comment"> * size; it is usually larger because as components are added to the</span></span><br><span class="line"><span class="comment"> * vector, the vector's storage increases in chunks the size of</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> capacityIncrement&#125;. An application can increase the</span></span><br><span class="line"><span class="comment"> * capacity of a vector before inserting a large number of</span></span><br><span class="line"><span class="comment"> * components; this reduces the amount of incremental reallocation.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çš„ç¨‹åºæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒArrayListæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚å½“æ›´å¤šçš„å…ƒç´ è¢«æ·»åŠ çš„æ—¶å€™ï¼ŒVectorå’ŒArrayListéœ€è¦æ›´å¤šçš„ç©ºé—´ã€‚Vectoræ¯æ¬¡æ‰©å®¹ä¼šå¢åŠ ä¸€å€çš„ç©ºé—´ï¼Œè€ŒArrayListå¢åŠ 50%ã€‚</p><p>æ³¨æ„ï¼šArrayListé»˜è®¤çš„åˆå§‹ç©ºé—´å¤§å°ç›¸å½“çš„å°ï¼Œé€šè¿‡æ„é€ å‡½æ•°å»åˆå§‹åŒ–ä¸€ä¸ªæ›´å¤§çš„ç©ºé—´æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå¯ä»¥é¿å…æ‰©å®¹å¼€é”€ã€‚<br>éƒ¨åˆ†å¼•è‡ªäºï¼š<a href="https://www.cnblogs.com/chenpi/p/5505375.html" target="_blank" rel="noopener">https://www.cnblogs.com/chenpi/p/5505375.html</a> </p><h3 id="Mapã€Listã€Setã€Arrayçš„åŒºåˆ«ï¼š"><a href="#Mapã€Listã€Setã€Arrayçš„åŒºåˆ«ï¼š" class="headerlink" title="Mapã€Listã€Setã€Arrayçš„åŒºåˆ«ï¼š"></a>Mapã€Listã€Setã€Arrayçš„åŒºåˆ«ï¼š</h3><p><a href="https://www.cnblogs.com/chuanheliu/p/6363948.html" target="_blank" rel="noopener">https://www.cnblogs.com/chuanheliu/p/6363948.html</a></p><h3 id="Iterator-çš„hasNextæ–¹æ³•å’Œnextæ–¹æ³•"><a href="#Iterator-çš„hasNextæ–¹æ³•å’Œnextæ–¹æ³•" class="headerlink" title="Iterator çš„hasNextæ–¹æ³•å’Œnextæ–¹æ³•:"></a>Iterator çš„hasNextæ–¹æ³•å’Œnextæ–¹æ³•:</h3><p>hasNext():å¦‚æœä»æœ‰å…ƒç´ å¯ä»¥è¿­ä»£ï¼Œåˆ™è¿”å› trueã€‚ï¼ˆæ¢å¥è¯è¯´ï¼Œå¦‚æœ next è¿”å›äº†å…ƒç´ è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™è¿”å› trueï¼‰ã€‚<br>next():è¿”å›è¿­ä»£çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns &#123;<span class="doctag">@code</span> true&#125; if the iteration has more elements.</span></span><br><span class="line"><span class="comment"> * (In other words, returns &#123;<span class="doctag">@code</span> true&#125; if &#123;<span class="doctag">@link</span> #next&#125; would</span></span><br><span class="line"><span class="comment"> * return an element rather than throwing an exception.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the iteration has more elements</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the next element in the iteration.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the next element in the iteration</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchElementException if the iteration has no more elements</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">E <span class="title">next</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h3 id="JAVAå¤šçº¿ç¨‹å’Œå¹¶å‘åŸºç¡€é¢è¯•é—®ç­”"><a href="#JAVAå¤šçº¿ç¨‹å’Œå¹¶å‘åŸºç¡€é¢è¯•é—®ç­”" class="headerlink" title="JAVAå¤šçº¿ç¨‹å’Œå¹¶å‘åŸºç¡€é¢è¯•é—®ç­”:"></a>JAVAå¤šçº¿ç¨‹å’Œå¹¶å‘åŸºç¡€é¢è¯•é—®ç­”:</h3><p><a href="http://www.cnblogs.com/dolphin0520/p/3932934.html" target="_blank" rel="noopener">http://www.cnblogs.com/dolphin0520/p/3932934.html</a></p><h3 id="Oracleæ•°æ®åº“ä¸­TRUNCATE-ä¸-DELETE-çš„åŒºåˆ«ï¼š"><a href="#Oracleæ•°æ®åº“ä¸­TRUNCATE-ä¸-DELETE-çš„åŒºåˆ«ï¼š" class="headerlink" title="Oracleæ•°æ®åº“ä¸­TRUNCATE ä¸ DELETE çš„åŒºåˆ«ï¼š"></a>Oracleæ•°æ®åº“ä¸­TRUNCATE ä¸ DELETE çš„åŒºåˆ«ï¼š</h3><ol><li>ROLLBACKå¯ä»¥æ’¤é”€DELETEæ“ä½œä½†æ’¤é”€ä¸äº†TRUNCATEæ“ä½œ</li><li>TRUNCATE TABLEæ¯”DELETEçš„é€Ÿåº¦å¿«ï¼›</li><li>TRUNCATE TABLEæ˜¯åˆ é™¤è¡¨çš„æ‰€æœ‰è¡Œï¼Œè€ŒDELETEæ˜¯åˆ é™¤è¡¨çš„ä¸€è¡Œæˆ–è€…å¤šè¡Œ</li><li>TRUNCATE TABLEåœ¨é‡åˆ°ä»»ä½•ä¸€è¡Œè¿åçº¦æŸ(å¤–é”®çº¦æŸ)æ—¶ä»ç„¶åˆ é™¤è¡¨çš„æ‰€æœ‰è¡Œï¼Œä½†è¡¨çš„ç»“æ„åŠå…¶åˆ—ã€çº¦æŸã€ç´¢å¼•ç­‰ä¿æŒä¸å˜ï¼ŒDELETEåˆ™ç›´æ¥è¿”å›æŠ¥é”™ã€‚</li><li>å¯¹äºè¢«å¤–é”®çº¦æŸçš„è¡¨ï¼Œä¸èƒ½ä½¿ç”¨TRUNCATE TABLEï¼Œè€Œåº”è¯¥ä½¿ç”¨ä¸å¸¦WHEREè¯­å¥çš„DELETEè¯­å¥ã€‚</li><li>å¦‚æœæƒ³ä¿ç•™æ ‡è¯†è®¡æ•°å€¼ï¼Œè¦ç”¨DELETEï¼Œå› ä¸ºTRUNCATE TABLEä¼šå¯¹æ–°è¡Œæ ‡å¿—ç¬¦åˆ—æœç”¨çš„è®¡æ•°å€¼é‡ç½®ä¸ºè¯¥åˆ—çš„ç§å­ã€‚</li></ol><h3 id="åºåˆ—åŒ–çš„ä½œç”¨ï¼š"><a href="#åºåˆ—åŒ–çš„ä½œç”¨ï¼š" class="headerlink" title="åºåˆ—åŒ–çš„ä½œç”¨ï¼š"></a>åºåˆ—åŒ–çš„ä½œç”¨ï¼š</h3><p>ä¸ºäº†ä¿å­˜åœ¨å†…å­˜ä¸­çš„å„ç§å¯¹è±¡çš„çŠ¶æ€ï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æŠŠä¿å­˜çš„å¯¹è±¡çŠ¶æ€å†è¯»å‡ºæ¥ï¼ˆååºåˆ—åŒ–ï¼‰ã€‚</p><h3 id="JAVA-ä¸­çš„-superå’Œthis"><a href="#JAVA-ä¸­çš„-superå’Œthis" class="headerlink" title="JAVA ä¸­çš„ superå’Œthis"></a>JAVA ä¸­çš„ superå’Œthis</h3><blockquote><p>thisçš„ç”¨æ³•</p></blockquote><ol><li>æŒ‡å‘å½“å‰å¯¹è±¡æœ¬èº«ã€‚</li><li>å½¢å‚ä¸æˆå‘˜åå­—é‡åï¼Œç”¨thisæ¥åŒºåˆ†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="comment">// å½¢å‚ä¸æˆå‘˜åå­—é‡åï¼Œç”¨thisæ¥åŒºåˆ†</span></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>superç”¨æ³•</p></blockquote><ol><li>æŒ‡å‘å½“å‰å¯¹è±¡çš„çˆ¶ç±»</li><li>å­ç±»ä¸­çš„æˆå‘˜å˜é‡æˆ–æ–¹æ³•ä¸çˆ¶ç±»åŒå<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTest</span> <span class="keyword">extends</span> <span class="title">Country</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name = <span class="string">"Shanghai"</span>;</span><br><span class="line">        <span class="keyword">super</span>.value();</span><br><span class="line">        System.out.println(<span class="keyword">super</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TestTest tt = <span class="keyword">new</span> TestTest();</span><br><span class="line">        tt.value();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Country</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name = <span class="string">"China"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‰å®åŸºç¡€ï¼&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Java" scheme="https://www.leezy.top/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Npmæ¨¡å—å­¦ä¹ </title>
    <link href="https://www.leezy.top/2017/07/27/Npm%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.leezy.top/2017/07/27/Npmæ¨¡å—å­¦ä¹ /</id>
    <published>2017-07-27T11:33:30.000Z</published>
    <updated>2019-12-16T07:51:56.688Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
      <category term="Npm" scheme="https://www.leezy.top/tags/Npm/"/>
    
  </entry>
  
  <entry>
    <title>éšç¬”</title>
    <link href="https://www.leezy.top/2017/07/27/%E9%9A%8F%E7%AC%94/"/>
    <id>https://www.leezy.top/2017/07/27/éšç¬”/</id>
    <published>2017-07-27T11:33:30.000Z</published>
    <updated>2019-09-18T12:12:30.746Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¹´7æœˆä¸­æ—¬ï¼Œæˆ‘æ¥åˆ°äº†æˆéƒ½ï¼Œè§è¯†åˆ°äº†æˆéƒ½çš„ç¾ã€‚</p><a id="more"></a><p><img src="/assets/blogImg/Work_Palce_Chengdu.jpg" alt="æˆéƒ½å¤§æ•°æ®ä¸­å¿ƒ"></p><h1 id="æˆéƒ½"><a href="#æˆéƒ½" class="headerlink" title="æˆéƒ½"></a>æˆéƒ½</h1><hr><p>è®©æˆ‘æ‰ä¸‹çœ¼æ³ªçš„ ä¸æ­¢æ˜¨å¤œçš„é…’</p><p>è®©æˆ‘ä¾ä¾ä¸èˆçš„ ä¸æ­¢ä½ çš„æ¸©æŸ”</p><p>ä½™è·¯è¿˜è¦èµ°å¤šä¹… ä½ æ”¥ç€æˆ‘çš„æ‰‹</p><p>è®©æˆ‘æ„Ÿåˆ°ä¸ºéš¾çš„ æ˜¯æŒ£æ‰çš„è‡ªç”±</p><p>åˆ†åˆ«æ€»æ˜¯åœ¨ä¹æœˆ å›å¿†æ˜¯æ€å¿µçš„æ„</p><p>æ·±ç§‹å«©ç»¿çš„å‚æŸ³ äº²å»ç€æˆ‘é¢å¤´</p><p>åœ¨é‚£åº§é˜´é›¨çš„å°åŸé‡Œ æˆ‘ä»æœªå¿˜è®°ä½ </p><p>æˆéƒ½ å¸¦ä¸èµ°çš„ åªæœ‰ä½ </p><p>å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ°</p><p>ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™</p><p>ä½ ä¼šæŒ½ç€æˆ‘çš„è¡£è¢– æˆ‘ä¼šæŠŠæ‰‹æ£è¿›è£¤å…œ</p><p>èµ°åˆ°ç‰æ—è·¯çš„å°½å¤´ ååœ¨(èµ°è¿‡)å°é…’é¦†çš„é—¨å£</p><p>åˆ†åˆ«æ€»æ˜¯åœ¨ä¹æœˆ å›å¿†æ˜¯æ€å¿µçš„æ„</p><p>æ·±ç§‹å«©ç»¿çš„å‚æŸ³ äº²å»ç€æˆ‘é¢å¤´</p><p>åœ¨é‚£åº§é˜´é›¨çš„å°åŸé‡Œ æˆ‘ä»æœªå¿˜è®°ä½ </p><p>æˆéƒ½ å¸¦ä¸èµ°çš„ åªæœ‰ä½ </p><p>å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ°</p><p>ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™</p><p>ä½ ä¼šæŒ½ç€æˆ‘çš„è¡£è¢– æˆ‘ä¼šæŠŠæ‰‹æ£è¿›è£¤å…œ</p><p>èµ°åˆ°ç‰æ—è·¯çš„å°½å¤´ ååœ¨(èµ°è¿‡)å°é…’é¦†çš„é—¨å£</p><p>å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ°</p><p>ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™</p><p>å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ°</p><p>ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™</p><p>ä½ ä¼šæŒ½ç€æˆ‘çš„è¡£è¢– æˆ‘ä¼šæŠŠæ‰‹æ£è¿›è£¤å…œ</p><p>èµ°åˆ°ç‰æ—è·¯çš„å°½å¤´ ååœ¨(èµ°è¿‡)å°é…’é¦†çš„é—¨å£</p><p>å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ°</p><p>ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¹´7æœˆä¸­æ—¬ï¼Œæˆ‘æ¥åˆ°äº†æˆéƒ½ï¼Œè§è¯†åˆ°äº†æˆéƒ½çš„ç¾ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="éšç¬”" scheme="https://www.leezy.top/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
</feed>
