<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Dockerå¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2020%2F02%2F04%2FUbuntu%E8%AE%BE%E7%BD%AESSH%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%2F</url>
    <content type="text"><![CDATA[é€šè¿‡SSHå…¬é’¥ï¼ˆé”ðŸ”’ï¼‰å’Œå¯†é’¥ï¼ˆé’¥åŒ™ðŸ”‘ï¼‰æ¥å®žçŽ°Puttyå…è¾“å…¥å¯†ç ç™»å½•æ“ä½œã€‚ ç”Ÿæˆå…¬é’¥å’Œç§é’¥1ssh-keygen -t rsa ç”¨WinSCPæ‰“å¼€æ–‡ä»¶ä¿å­˜è·¯å¾„/root/.ssh/ æ³¨æ„ è®¾ç½®/etc/ssh/sshd_config æ–‡ä»¶ä¸‹çš„ PermitRootLogin yesPasswordAuthentication yes æ‰å¯ä»¥rootç™»å½•ï¼Œå¹¶é‡å¯sshæœåŠ¡ systemctl restart ssh.service å°†/root/.ssh/è·¯å¾„ä¸‹çš„id_rsaå¯¼å…¥åˆ°PuTTYgen (Conversions -&gt; Import key)ï¼Œå¹¶ç”ŸæˆåŠä¿å­˜ç§é’¥ã€‚åœ¨PuTTY SSH -&gt; Auth ä¸­æ·»åŠ ç§é’¥æ–‡ä»¶ã€‚ å†æ¬¡ä¿®æ”¹SSHé…ç½®æ–‡ä»¶/etc/ssh/sshd_configï¼Œå–æ¶ˆä¸‹é¢å‡ é¡¹é…ç½®çš„æ³¨é‡Š 12#PubkeyAuthentication yes#AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2 æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œå°†å…¬é’¥æ·»åŠ åˆ°.ssh/authorized_keys 1cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys è‡³æ­¤å®ŒæˆUbuntu SSH å…å¯†ç ç™»å½•è®¾ç½®ã€‚]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dockerå¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2020%2F01%2F11%2FDocker%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[å¯åŠ¨dockeré•œåƒ12345678# æŸ¥çœ‹å·²ç»å®‰è£…çš„é•œåƒdocker images# æŸ¥çœ‹å®¹å™¨IDdoker ps# å¯åŠ¨å®¹å™¨docker start &lt;å®¹å™¨id&gt;# å¼€å¯ä¸€ä¸ªå®¹å™¨å†…éƒ¨çš„äº¤äº’å¼ç»ˆç«¯docker exec -it &lt;å®¹å™¨id&gt; Dockerå®‰è£…MySQL123456789101112docker pull mysql# å°†å®¹å™¨çš„ 3306 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 3306 ç«¯å£, å®¹å™¨confç›®å½•å’Œlogsç›®å½•ã€dataç›®å½•éƒ½æŒ‚è½½åœ¨æœ¬åœ°ï¼Œå¹¶è®¾ç½®rootå¯†ç  rootdocker run -p 3306:3306 --name mymysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql# è¿™é‡Œä¼šè¾“å‡ºå®¹å™¨ID# è¿›å…¥å®¹å™¨docker exec -it &lt;å®¹å™¨ID&gt; /bin/bash# ç™»å½•Mysqlmysql -uroot -p# æŽˆæƒè¿œç¨‹ç™»å½•GRANT ALL ON *.* TO 'root'@'%';# åˆ·æ–°æƒé™flush privileges; Dockerå®‰è£…Tomcat1234567# å®‰è£…Tomcatdocker pull tomcat# è¿è¡Œå®¹å™¨# å‘½ä»¤è¯´æ˜Ž# -p 8080:8080ï¼šå°†å®¹å™¨çš„ 8080 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£ã€‚# -v $PWD/test:/usr/local/tomcat/webapps/testï¼šå°†ä¸»æœºä¸­å½“å‰ç›®å½•ä¸‹çš„ test æŒ‚è½½åˆ°å®¹å™¨çš„ /testã€‚docker run --name tomcat -p 8080:8080 -v $PWD/test:/usr/local/tomcat/webapps/test -d tomcat]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaåŸºç¡€çŸ¥è¯†-å¹¶å‘ç¼–ç¨‹]]></title>
    <url>%2F2019%2F11%2F30%2FJAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ã€å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç ã€‚ å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ CPUå¤šçº§ç¼“å­˜ æ—¶é—´å±€éƒ¨æ€§ ç©ºé—´å±€éƒ¨æ€§ç¼“å­˜ä¸€è‡´æ€§ï¼š M E S I ç”¨äºŽä¿è¯å¤šä¸ªCPU Cacheä¹‹é—´å…±äº«æ•°æ®çš„ä¸€è‡´M ä¿®æ”¹çŠ¶æ€E ç‹¬äº«çŠ¶æ€S å…±äº«çŠ¶æ€I æ— æ•ˆçŠ¶æ€ ä¹±åºæ‰§è¡Œä¼˜åŒ– ä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦è€Œåšå‡ºè¿èƒŒä»£ç åŽŸæœ‰é¡ºåºçš„ä¼˜åŒ– JAVAå†…å­˜æ¨¡åž‹ (Java Memory Model - JMM) Heap å †å¯åŠ¨æ€åˆ†é…å†…å­˜å¤§å°ï¼Œç”Ÿå­˜æœŸä¸éœ€äº‹å…ˆå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå­˜å–é€Ÿåº¦æ…¢ï¼Œå¸¸ç”¨äºŽå­˜æ”¾å¯¹è±¡Thread Stack æ ˆå­˜å–é€Ÿåº¦å¿«ï¼Œä»…æ¬¡äºŽå¯„å­˜å™¨ï¼Œæ•°æ®å¤§å°å’Œç”Ÿå­˜æœŸå¿…é¡»ç¡®å®šï¼Œå¸¸ç”¨äºŽå­˜å–åŸºæœ¬ç±»åž‹å˜é‡ï¼Œæœ¬åœ°å˜é‡ æ ˆä¸Šçš„å¼•ç”¨å˜é‡æ•°æ®å¯ä»¥è®¿é—®å¼•ç”¨çš„å †å¯¹è±¡ï¼Œå¦‚æžœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½ä¼šè®¿é—®æˆå‘˜å˜é‡ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼šæœ‰è‡ªå·±å˜é‡çš„ç§æœ‰æ‹·è´ã€‚ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„â€œæœ¬åœ°å†…å­˜â€ï¼ŒJavaä¸­çº¿ç¨‹çš„â€œæœ¬åœ°å†…å­˜â€æŒ‡çš„æ˜¯CPUå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜çš„æŠ½è±¡æè¿°ã€‚ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å˜é‡å…±äº«æ˜¯è¦é€šè¿‡ä¸»å†…å­˜çš„ã€‚ Javaå†…å­˜æ¨¡åž‹-åŒæ­¥å…«ç§æ“ä½œ lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºŽä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çŠ¶æ€ unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºŽä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå¤„äºŽé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åŽçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚ readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºŽä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡å€¼ä»Žä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä»¥ä¾¿éšåŽçš„loadåŠ¨ä½œä½¿ç”¨ã€‚ loadï¼ˆè½½å…¥ï¼‰: ä½œç”¨äºŽå·¥ä½œå†…å­˜çš„å˜é‡,å®ƒæŠŠreadæ“ä½œä»Žä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºŽå·¥ä½œå†…å­˜çš„å˜é‡,æŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“Ž assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºŽå·¥ä½œå†…å­˜çš„å˜é‡,å®ƒæŠŠä¸€ä¸ªä»Žæ‰§è¡Œå¼•æ“ŽæŽ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜çš„å˜é‡ storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºŽå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­,ä»¥ä¾¿éšåŽçš„writeçš„æ“ä½œ writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºŽä¸»å†…å­˜çš„å˜é‡,å®ƒæŠŠstoreæ“ä½œä»Žå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜çš„å˜é‡ä¸­ å·¥ä½œè§„åˆ™ï¼š å¦‚æžœè¦æŠŠä¸€ä¸ªå˜é‡ä»Žä¸»å†…å­˜ä¸­å¤åˆ¶åˆ°å·¥ä½œå†…å­˜,å°±éœ€è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œreadå’Œloadæ“ä½œ,å¦‚æžœæŠŠå˜é‡ä»Žå·¥ä½œå†…å­˜ä¸­åŒæ­¥å›žä¸»å†…å­˜ä¸­,å°±è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚ä½†Javaå†…å­˜æ¨¡åž‹åªè¦æ±‚ä¸Šè¿°æ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œ,è€Œæ²¡æœ‰ä¿è¯å¿…é¡»æ˜¯è¿žç»­æ‰§è¡Œã€‚ ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºçŽ° ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘assignçš„æ“ä½œ,å³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åŽå¿…é¡»åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ ä¸å…è®¸â€”ä¸ªçº¿ç¨‹æ— åŽŸå› åœ°(æ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œ)æŠŠæ•°æ®ä»Žå·¥ä½œå†…å­˜åŒæ­¥å›žä¸»å†…å­˜ä¸­ ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯žç”Ÿ,ä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æŽ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–(loadæˆ–assign )çš„å˜é‡ã€‚å³å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®žæ–½useå’Œstoreæ“ä½œä¹‹å‰,å¿…é¡»å…ˆæ‰§è¡Œè¿‡äº†assignå’Œloadæ“ä½œ ä¸€ä¸ªå˜é‡åœ¨åŒ_æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡,å¤šæ¬¡æ‰§è¡ŒlockåŽ,åªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œ,å˜é‡æ‰ä¼šè¢«è§£é”ã€‚lockå’Œunlockå¿…é¡»æˆå¯¹å‡ºçŽ° å¦‚æžœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œ,å°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼,åœ¨æ‰§è¡Œå¼•æ“Žä½¿ç”¨è¿™ä¸ªå˜é‡å‰éœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŽŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»Žå·¥ä½œå†…å­˜åŒæ­¥å›žä¸»å†…å­˜ä¸­ ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯žç”Ÿ/ä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æŽ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ–assign ï¼‰çš„å˜é‡ã€‚å³å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®žæ–½useå’Œstoreæ“ä½œä¹‹å‰, å¿…é¡»å…ˆæ‰§è¡Œè¿‡äº†assignå’Œloadæ“ä½œ å¹¶å‘æ¨¡æ‹Ÿå·¥å…·åŠä»£ç :å·¥å…·ï¼š PostMan Apache Bench Apache JMeter ä»£ç ï¼š CountDownLatch - é—­é”ï¼š1. await() 2. countDown() é˜»å¡žçº¿ç¨‹ï¼Œæ»¡è¶³æŸç§ç‰¹å®šçš„æ¡ä»¶ç»§ç»­æ‰§è¡Œï¼Œå¸¸ä¸Žä¸Žçº¿ç¨‹æ± ä¸€åŒä½¿ç”¨ã€‚ Semaphore - ä¿¡å·é‡ï¼šå¯ä»¥é˜»å¡žçº¿ç¨‹ï¼ŒæŽ§åˆ¶åŒä¸€æ—¶é—´è¯·æ±‚çš„å¹¶å‘é‡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package com.leezy.concurrency;import com.leezy.concurrency.annoations.NotThreadSafe;import lombok.extern.slf4j.Slf4j;import java.util.concurrent.CountDownLatch;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Semaphore;/** * @program: spring-cloud-leezy * @description: æµ‹è¯•å¹¶å‘ * @author: LEEZY * @create: 2019-11-30 16:03 **/@Slf4j@NotThreadSafe// count:4962 ç»“æžœä¸å‡†ç¡®ï¼Œçº¿ç¨‹ä¸å®‰å…¨public class ConcurrencyTest &#123; // è¯·æ±‚æ€»æ•° public static int clientTotal = 5000; // åŒæ—¶å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•° public static int threadTotal = 200; public static int count = 0; private static void add() &#123; count++; &#125; public static void main(String[] args) throws InterruptedException &#123; // çº¿ç¨‹æ±  ExecutorService executorService = Executors.newCachedThreadPool(); // ä¿¡å·é‡ä»¥åŠå¹¶å‘çº¿ç¨‹æ•° final Semaphore semaphore = new Semaphore(threadTotal); // è®¡æ•°å™¨-é—­é” æ”¾å…¥è¯·æ±‚æ€»æ•° final CountDownLatch countDownLatch = new CountDownLatch(clientTotal); for (int i = 0; i &lt; clientTotal; i++) &#123; executorService.execute(() -&gt; &#123; try &#123; // æ ¹æ®å¹¶å‘çš„é™åˆ¶æ•°é‡, åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å…è®¸è¢«æ‰§è¡Œ semaphore.acquire(); add(); // é‡Šæ”¾çº¿ç¨‹ semaphore.release(); &#125; catch (InterruptedException e) &#123; log.error("exception", e); &#125; // æ‰§è¡Œä¸€æ¬¡å°±è¿›è¡ŒreleaseShared countDownLatch.countDown(); &#125;); &#125; // è¿™ä¸ªæ–¹æ³•å¯ä»¥ä¿è¯ countDown å‡ä¸º0 countDownLatch.await(); // å…³é—­çº¿ç¨‹æ±  executorService.shutdown(); log.info("count:" + count); &#125;&#125; çº¿ç¨‹å®‰å…¨æ€§ åŽŸå­æ€§ï¼šæä¾›äº†äº’æ–¥è®¿é—®ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å¯¹å®ƒè¿›è¡Œæ“ä½œã€‚ - AtomicåŒ… ThreadLocalçš„ä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041424344import java.util.ArrayList;import java.util.List;import java.util.logging.Logger;public class ThreadLocalTest &#123; private Logger logger = Logger.getLogger("logger"); private ThreadLocal&lt;String&gt; mThreadLocal = new ThreadLocal&lt;&gt;(); private void testThreadLocal() throws InterruptedException &#123; mThreadLocal.set("main-thread"); logger.info("result1: " + mThreadLocal.get()); Thread thread1 = new Thread() &#123; @Override public void run() &#123; super.run(); // thread1å†…éƒ¨è®¾ç½®çš„å€¼åªæœ‰thead1å†…éƒ¨å¯ä»¥å¾—åˆ°ï¼Œæ‰€ä»¥result3ä¸ºç©º mThreadLocal.set("thread_one"); logger.info("result2: " + mThreadLocal.get()); &#125; &#125;; thread1.start(); thread1.join(); Thread thread2 = new Thread() &#123; public void run() &#123; super.run(); logger.info("result3: " + mThreadLocal.get()); &#125; &#125;; thread2.start(); thread2.join(); logger.info("result4: " + mThreadLocal.get()); &#125; public static void main(String[] args) &#123; ThreadLocalTest threadLocalTest = new ThreadLocalTest(); try &#123; threadLocalTest.testThreadLocal(); &#125; catch (Exception e) &#123; System.out.println(e.getMessage()); &#125; &#125;&#125; è¾“å‡ºï¼š 12345678# åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest testThreadLocalä¿¡æ¯: result1: main-thread# åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest$1 runä¿¡æ¯: result2: thread_one# åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest$2 runä¿¡æ¯: result3: null# åäºŒæœˆ 15, 2019 4:36:21 ä¸‹åˆ ThreadLocalTest testThreadLocalä¿¡æ¯: result4: main-thread ThreadLocalè¯¦è§£å››ä¸ªæŽ¥å£ï¼š public void set(T value) { }è®¾ç½®å½“å‰çº¿ç¨‹çš„ThreadLocalå€¼ä¸ºæŒ‡å®šçš„Value public T get() { }èŽ·å–å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„ThreadLocalå€¼ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹ä¸‹æ²¡æœ‰å€¼ï¼Œå°±è°ƒç”¨initialValueå‡½æ•°å¯¹å…¶è¿›è¡Œåˆå§‹åŒ– public void remove() { }åˆ é™¤å½“å‰çº¿ç¨‹ThreadLocalå¯¹åº”çš„å€¼ï¼Œå½“å‰çº¿ç¨‹ç»“æŸæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›žæ”¶çº¿ç¨‹å±€éƒ¨å˜é‡å€¼ã€‚P.S. removeæ–¹æ³•è°ƒç”¨åŽå†è°ƒç”¨getæ–¹æ³•ä¼šä½¿initialValue()é‡æ–°è¢«è°ƒç”¨ï¼Œä»Žè€Œä½¿ThreadLocalçš„å€¼è¢«é‡æ–°è¢«åˆå§‹åŒ–ã€‚ protected T initilValue() { }å½“å‰çº¿ç¨‹é€šè¿‡get()æ–¹æ³•ç¬¬ä¸€æ¬¡å¯¹ThreadLocalè¿›è¡Œè®¿é—®æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚ å¦‚æžœæˆ‘ä»¬å¸Œæœ›ThreadLocalæ‹¥æœ‰ä¸€ä¸ªä¸ä¸ºnullçš„åˆå§‹å€¼ï¼Œåˆ™åº”è¯¥ä¸ºThreadLocalå®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œå¹¶é‡å†™initialValue()æ–¹æ³•ã€‚]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVA8 å¸¸ç”¨çš„æ—¥æœŸæ—¶é—´æ–¹æ³•]]></title>
    <url>%2F2019%2F11%2F07%2FJAVA8%E5%B8%B8%E7%94%A8%E7%9A%84%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[JAVA8 æ›´æ–°äº†åŽŸæœ¬çº¿ç¨‹ä¸å®‰å…¨çš„SimpleDateFormat, æ–°çš„DateTimeFormatteråˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¸‹é¢åˆ—å‡ºJAVA8å¼€å‘ä¸­å¸¸ç”¨çš„æ—¶é—´æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869import java.time.DayOfWeek;import java.time.Instant;import java.time.LocalDate;import java.time.LocalDateTime;import java.time.LocalTime;import java.time.Month;import java.time.ZoneId;import java.time.format.DateTimeFormatter;import java.time.temporal.ChronoField;public class TimeTest &#123; public static void main(String[] args) &#123; // èŽ·å–å½“å‰å¹´æœˆæ—¥ - 2019-11-06 LocalDate nowDate = LocalDate.now(); // 2019 int nowYear = nowDate.getYear(); // 2019 int nowYear1 = nowDate.get(ChronoField.YEAR); // NOVEMBER Month nowMonth = nowDate.getMonth(); // 11 int nowMonth1 = nowDate.get(ChronoField.MONTH_OF_YEAR); // 6 int nowDay = nowDate.getDayOfMonth(); // 6 int nowDay1 = nowDate.get(ChronoField.DAY_OF_MONTH); // WEDNESDAY DayOfWeek dayOfWeek = nowDate.getDayOfWeek(); // 3 int dayOfWeek1 = nowDate.get(ChronoField.DAY_OF_WEEK); // èŽ·å–å½“å‰æ—¶åˆ†ç§’ - 15:16:24.401 LocalTime nowTime = LocalTime.now(); // æŒ‡å®šæ—¶åˆ†ç§’ - 12:51:10 LocalTime nowTime1 = LocalTime.of(12, 51, 10); // æŒ‡å®šæ—¶é—´ - 2019-11-06 LocalDate specificTime = LocalDate.of(2019, 11, 6); // LocalDateTime èŽ·å–å¹´æœˆæ—¥æ—¶åˆ†ç§’ LocalDateTime localDateTime = LocalDateTime.now(); // æŒ‡å®šæ—¶é—´ 2019-11-11T16:14:20 LocalDateTime localDateTime1 = LocalDateTime.of(2019, Month.NOVEMBER, 11, 16, 14, 20); // 2019-11-06T16:19:51.506 LocalDateTime localDateTime2 = LocalDateTime.of(nowDate, nowTime); // LocalDateTime localDateTime3 = LocalDat // èŽ·å–æ¯«ç§’æ•° // èŽ·å–å½“å‰æ—¶é—´ 2019-11-06T07:18:39.956Z Instant instant = Instant.now(); // 1573028684 å¾—åˆ°çš„æ˜¯ç§’æ•° long currentSecond = instant.getEpochSecond(); // 1573028779924 å¾—åˆ°æ¯«ç§’æ•° long currentMilli = instant.toEpochMilli(); // èŽ·å–å½“å‰å¹´æœˆæ—¥ - 2019-11-06 LocalDate date = Instant.ofEpochMilli(instant.toEpochMilli()).atZone(ZoneId.systemDefault()).toLocalDate(); // æ ¼å¼åŒ–æ—¶é—´ // 2019-11-06 LocalDate localDate = LocalDate.of(2019, 11, 6); // 20191106 String str1 = localDate.format(DateTimeFormatter.BASIC_ISO_DATE); // 2019-11-06 String str2 = localDate.format(DateTimeFormatter.ISO_LOCAL_DATE); // è‡ªå®šä¹‰æ ¼å¼åŒ– DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"); // 2019-11-06 16:41:10 String str3 = localDateTime.format(dateTimeFormatter); System.out.println(str3); &#125;&#125;]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLä¼˜åŒ–]]></title>
    <url>%2F2019%2F10%2F08%2FMySQL%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[MySQLçš„ä¼˜åŒ–æ–¹æ³•ã€‚ MySQLçš„æ ‡å‡†æ‰§è¡Œé¡ºåºä»Žä¸Šåˆ°ä¸‹ï¼š FROM ON JOIN WHERE GROUP BY WITH {CUBE|ROLLUP} HAVING SELECT DISTINCT ORDER BY LIMIT å¸¸è§é—®é¢˜åœºæ™¯ï¼šå«æœ‰GroupByçš„è¯­å¥é‡Œå¦‚ä½•æ˜¾ç¤ºæŸ¥è¯¢Count()ä¸º0çš„å­—æ®µã€‚]]></content>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Git-ä»Žå…¥é—¨åˆ°ç²¾é€š]]></title>
    <url>%2F2019%2F09%2F29%2FGit-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%2F</url>
    <content type="text"><![CDATA[Git Bashçš„ç®€å•ä½¿ç”¨æ–¹æ³•ã€‚ git å¯ä»¥åˆ†ä¸‰ä¸ªåŒºï¼š å·¥ä½œåŒº(æ³¨è§£ç¼–è¾‘é¡µé¢)ï¼Œå°±æ˜¯æœ¬åœ°æ–‡ä»¶å¤¹ã€‚æš‚å­˜åŒº(æ•°æ®æš‚æ—¶å­˜æ”¾çš„ä½ç½®ï¼Œå¯ä»¥åœ¨å·¥ä½œåŒºå’Œç‰ˆæœ¬åº“ä¹‹é—´è¿›è¡Œæ•°æ®çš„å‹å¥½äº¤æµ)ï¼Œgit add å‘½ä»¤å°†ä»–ä»¬æ·»åŠ åˆ°æš‚å­˜åŒºã€‚ç‰ˆæœ¬åº“/æœ¬åœ°ä»“åº“(å­˜æ”¾å·²ç»æäº¤çš„æ•°æ®ï¼Œpushçš„æ—¶å€™ï¼Œå°±æ˜¯å°†è¿™ä¸ªåŒºçš„æ•°æ®pushåˆ°è¿œç¨‹ä»“åº“äº†)ï¼Œgit commit å‘½ä»¤åˆ™å°†æš‚å­˜åŒºä¸­çš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“ä¸­ã€‚ é¦–å…ˆè¿žæŽ¥åˆ°å›½é™…äº’è”ç½‘: 123# ä¸éœ€è¦çš„å°±ä¸ç”¨äº†export http_proxy="http://127.0.0.1:1080/"export https_proxy="http://127.0.0.1:1080/" åˆ›å»ºä»£ç ä»“åº“123456git config --global user.name "SAKURA"git config --global user.email "xxx@gmail.com"# å»ºç«‹ä»£ç ä»“åº“(åœ¨æŒ‡å®šç›®å½•å»ºç«‹.gitæ–‡ä»¶å¤¹)git init# æŸ¥çœ‹ä»£ç ä»“åº“çŠ¶æ€git status æäº¤æœ¬åœ°ä»£ç 123456789git add READEME.txt# å…¨éƒ¨æ›´æ–°åˆ°æš‚å­˜åŒºgit add .# åœ¨ -m åŽé¢åŠ ä¸Šå£°æ˜Ž, å°†ä»£ç æäº¤åˆ°æœ¬åœ°ä»“åº“git commit -m "Wrote a READEME file"# å¦‚æžœè¦æ±‚çš„æäº¤å¤‡æ³¨ç‰¹åˆ«å¤š,å¯ä»¥æ‰“å¼€ä¸€ä¸ªviç¼–è¾‘å™¨git commit# ä»Žæœ¬åœ°ä»“åº“æäº¤åˆ°è¿œç¨‹ä»“åº“masteråˆ†æ”¯git push -u origin master æ³¨é‡Šå¯ä»¥åœ¨ä»£ç ä»“åº“çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º.gitignoreçš„æ–‡ä»¶ï¼Œç„¶åŽç¼–è¾‘é‡Œé¢çš„å†…å®¹ï¼ŒæŠŠä¸éœ€æäº¤çš„æ–‡ä»¶å¿½ç•¥æŽ‰ï¼ commitå‰çš„æ–‡ä»¶çŠ¶æ€git statusæŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼ŒGitåœ¨æœªè¿›è¡Œcommitæ“ä½œä¹‹å‰ï¼Œå­˜åœ¨ä¸‰ç§çŠ¶æ€ï¼š Untracked files Changes not staged for commit Changes to be committed åˆ†æ”¯çš„å»ºç«‹æ—©å»ºåˆ†æ”¯, å¤šç”¨åˆ†æ”¯ 123456# å»ºç«‹åˆ†æ”¯git branch newImage# åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ newImagegit checkout newImage;# æ–°åˆ†æ”¯ä»£ç æäº¤git commit ä¸Šé¢çš„æ“ä½œå¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢ä¸¤æ­¥ 1234# åˆ›å»ºæ–°çš„åˆ†æ”¯å¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯git checkout -b newImage# æ–°åˆ†æ”¯ä»£ç æäº¤git commit åˆ†æ”¯çš„åˆå¹¶æ–¹æ³•ä¸€ï¼šMerge 123456789101112# å»ºç«‹æ–°çš„åˆ†æ”¯bugFixgit branch bugFix# åˆ‡æ¢åˆ°bugFixåˆ†æ”¯git checkout bugFix# bugFixä»£ç æäº¤git commit# åˆ‡æ¢åˆ°masteråˆ†æ”¯git checkout master# masteråˆ†æ”¯ä»£ç æäº¤git commit# åˆ†æ”¯åˆå¹¶ - çŽ°åœ¨masteråˆ†æ”¯ä¸Šæœ‰äº†bugFixçš„æäº¤git merge bugFix æ–¹æ³•äºŒï¼šRebaseç®€å•æ¥è¯´Rebaseå°±æ˜¯å–å‡ºä¸€ç³»åˆ—çš„æäº¤è®°å½•ï¼Œâ€œå¤åˆ¶â€å®ƒä»¬ï¼Œç„¶åŽåœ¨å¦å¤–ä¸€ä¸ªåœ°æ–¹é€ä¸ªå°†ä¿®æ”¹æ”¾ä¸‹åŽ»ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¼šä½¿ä»£ç åº“çš„æäº¤åŽ†å²å˜å¾—æ¸…æ™°ã€‚ 123456# å‡è®¾å½“å‰æ˜¯åœ¨bugFixåˆ†æ”¯ä¸‹ï¼Œå°†bugFixåˆ†æ”¯çš„å·¥ä½œç›´æŽ¥ç§»åŠ¨åˆ°masteråˆ†æ”¯ä¸Šgit rebase master# åˆ‡æ¢åˆ°masteråˆ†æ”¯git checkout master# å°†masteråˆ†æ”¯çš„å¼•ç”¨å‘å‰ç§»åŠ¨ï¼Œå³rebaseåˆ°bugFixgit rebase bugFix åœ¨æäº¤æ ‘ä¸Šç§»åŠ¨HEAD æ€»æ˜¯æŒ‡å‘å½“å‰åˆ†æ”¯ä¸Šæœ€è¿‘ä¸€æ¬¡æäº¤è®°å½•ï¼ŒHEADé€šå¸¸æ˜¯æŒ‡å‘åˆ†æ”¯åçš„,ä½†æ˜¯å¯ä»¥é€šè¿‡git checkout &lt;å“ˆå¸Œå€¼&gt;æ¥å°†HEADæŒ‡å‘ä¸€ä¸ªå…·ä½“çš„æäº¤è®°å½•ã€‚ 12345678# æŸ¥çœ‹HEADæŒ‡å‘çš„ä¸¤ç§æ–¹å¼cat .git/HEAD# å¦‚è‹¥HEADæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå¼•ç”¨git symbolic-ref HEAD # åˆ†ç¦»çš„HEADï¼Œä¸ºäº†è®©å…¶æŒ‡å‘æŸä¸ªå…·ä½“çš„æäº¤è®°å½•è€Œä¸æ˜¯åˆ†æ”¯å æ³¨ï¼šè¿™é‡Œçš„Hashå€¼å¹¶ä¸éœ€è¦å…¨éƒ¨40ä½ï¼Œ# èƒ½è¡¨ç¤ºå‡ºå”¯ä¸€æ ‡è¯†çš„å‰7ä½å­—ç¬¦å°±å¯ä»¥git checkout &lt;æäº¤è®°å½•çš„å“ˆå¸Œå€¼&gt;` ä¸ºäº†é¿å…ä½¿ç”¨git logå‘½ä»¤æŸ¥çœ‹Hashå€¼ï¼Œå†é€šè¿‡git checkoutå‘½ä»¤åˆ†ç¦»HEADï¼Œæ‰€ä»¥æœ‰äº†ç›¸å¯¹å¼•ç”¨ ^ è¡¨ç¤ºå‘ä¸Šç§»åŠ¨ä¸€ä¸ªæäº¤è®°å½• 123git checkout HEAD^# æˆ–è€…git checkout master^ ~&lt;num&gt;è¡¨ç¤ºå‘ä¸Šç§»åŠ¨å¤šä¸ªæäº¤è®°å½•, numä¸º1æ—¶ç­‰ä»·ä¸Ž^ 1234# å¯»æ‰¾æŒ‡å®šæäº¤è®°å½•çš„çˆ¶æäº¤git checkout HEAD~3# æˆ–è€…git checkout master~3 ç›¸å¯¹å¼•ç”¨æœ€å¸¸è§çš„åœ°æ–¹å°±æ˜¯ç”¨æ¥ç§»åŠ¨åˆ†æ”¯ 12# å°†masteråˆ†æ”¯ç§»åˆ°HEADæ‰€æŒ‡åˆ†æ”¯ä½ç½®å‰ä¸‰ä¸ªèŠ‚ç‚¹git branch -f master HEAD~3 æ’¤é”€å˜æ›´æ–¹æ³•ä¸€ï¼šgit reset - ä»…é™åœ¨æœ¬åœ°åˆ†æ”¯ä¸­ä½¿ç”¨ 123# æŠŠåˆ†æ”¯è®°å½•å›žé€€å‡ ä¸ªæäº¤è®°å½•æ¥å®žçŽ°æ’¤é”€æ”¹åŠ¨,æœ€æ–°çš„æäº¤å˜æˆäº†æœªåŠ å…¥æš‚å­˜åŒºçŠ¶æ€(git reset ç¼ºçœä¸º git reset --soft)å³æ–‡ä»¶æ²¡æœ‰æ›´æ”¹# åªæ˜¯å°†git commit çš„ä¿¡æ¯ç»™å›žé€€äº†ã€‚æŽ¨èç›´æŽ¥ä½¿ç”¨ git reset --hard HEAD^, --hardå‚æ•°ä¼šå°†æ–‡ä»¶ç›´æŽ¥ä¿®æ”¹å›žåŽ»ã€‚git reset HEAD~1 æ–¹æ³•äºŒï¼šgit revert - é€‚ç”¨äºŽæäº¤åˆ°äº†è¿œç¨‹åˆ†æ”¯ 12# ä¼šåœ¨è¿œç¨‹æ·»åŠ ä¸€ä¸ªæ–°çš„æäº¤è®°å½•ï¼Œç”¨æ¥æŠµæ¶ˆæŽ‰è¿œç¨‹ä»“åº“æœ€æ–°çš„æ›´æ”¹git revert HEAD ä½†æ˜¯å¦‚æžœä½ åŽæ‚”äº†æ€Žä¹ˆåŠžã€‚è¿™ä¸ªæ—¶å€™éœ€è¦ 1234# æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬å·git reflog# é€€å›žåˆ°æŒ‡å®šç‰ˆæœ¬ åŒ…æ‹¬å·²ç»åˆ é™¤äº†çš„ä¿®æ”¹git reset --hard XXX&lt;ç‰ˆæœ¬å·&gt; æäº¤è®°å½•çš„æ•´ç† å°†ä¸€äº›æäº¤å¤åˆ¶åˆ°å½“å‰æ‰€åœ¨çš„ä½ç½®ï¼ˆHEADï¼‰çš„ä¸‹é¢ï¼Œcherry-pick å¯ä»¥å°†æäº¤æ ‘ä¸Šä»»ä½•åœ°æ–¹çš„æäº¤è®°å½•å–è¿‡æ¥è¿½åŠ åˆ° HEADä¸Šï¼ˆåªè¦ä¸æ˜¯HEADä¸Šæ¸¸çš„æäº¤å°±æ²¡æœ‰é—®é¢˜ï¼‰ 12# git cherry-pick &lt;æäº¤å·&gt;...git cherry-pick d4b052 4aa0aa äº¤äº’å¼çš„rebase ä½ å¯ä»¥é€šè¿‡ç»™git rebaseå¢žåŠ -ié€‰é¡¹æ¥ä»¥äº¤äº’æ–¹å¼åœ°è¿è¡Œrebaseã€‚ä½ å¿…é¡»é€šè¿‡å‘Šè¯‰å‘½ä»¤è¡åˆåˆ°å“ªæ¬¡æäº¤ï¼Œæ¥æŒ‡æ˜Žä½ éœ€è¦é‡å†™çš„æäº¤çš„å›žæº¯æ·±åº¦ã€‚ 12# è¿™æ˜¯ä¸€ä¸ªè¡åˆå‘½ä»¤â€”â€”HEAD~2..HEADèŒƒå›´å†…çš„æ¯ä¸€æ¬¡æäº¤éƒ½ä¼šè¢«é‡å†™ï¼Œæ— è®ºä½ æ˜¯å¦ä¿®æ”¹è¯´æ˜Žã€‚git rebase -i HEAD~2 ä¸Šè¿°å‘½ä»¤ä¼šæ‰“å¼€ä¸€ä¸ªäº¤äº’çª—å£ï¼š å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ä½ å¾—æ³¨æ„è¿™äº›æäº¤çš„é¡ºåºä¸Žä½ é€šå¸¸é€šè¿‡logå‘½ä»¤çœ‹åˆ°çš„æ˜¯ç›¸åçš„ã€‚ é€šè¿‡rebase UIç•Œé¢, ä½ èƒ½åš3ä»¶äº‹: è°ƒæ•´æäº¤è®°å½•çš„é¡ºåº åˆ é™¤ä½ ä¸æƒ³è¦çš„æäº¤ åˆå¹¶æäº¤, æŠŠå¤šä¸ªæäº¤è®°å½•åˆå¹¶æˆä¸€ä¸ªã€‚ è¯¦æƒ…è¯·çœ‹è¿™é‡Œ æŸ¥çœ‹ä¿®æ”¹çš„å†…å®¹1234# "+"å·è¡¨ç¤ºæ–°å¢žå†…å®¹ï¼Œ "-"å·è¡¨ç¤ºåˆ é™¤çš„å†…å®¹git diff# å¯è§†åŒ–çš„æŸ¥çœ‹æ–¹æ³•git difftool æŸ¥çœ‹æäº¤è®°å½•1git log æ­¤æ¬¡æäº¤å¯¹åº”çš„ç‰ˆæœ¬å· æäº¤äººï¼šå§“å é‚®ç®± æäº¤çš„æ—¶é—´ æäº¤ç‰ˆæœ¬ä¿®æ”¹çš„å†…å®¹ï¼šå°±æ˜¯æˆ‘ä»¬commit -m â€œxxxâ€é‡Œçš„xxx è®°ä½å¯†ç 1git config --global credential.helper store ç‰ˆæœ¬å›žé€€æäº¤åŽå›žé€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ éœ€è¦ç‰ˆæœ¬å· HEADä»£è¡¨å½“å‰ç‰ˆæœ¬, HEAD^è¡¨ç¤ºä¸Šä¸€ä¸ªç‰ˆæœ¬, ä»¥æ­¤ç±»æŽ¨ 1234567# æŸ¥çœ‹ç‰ˆæœ¬å·git log git reset --hard f37911a60ca123c86c712ff0539619902a7375e8(ç›®æ ‡ç‰ˆæœ¬å·)git reset --hard HEADgit reset --hard HEAD^git log å¦‚æžœä½ åˆåŽæ‚”äº† 1git reflog é”®å…¥ç‰ˆæœ¬å· 1git reset --hard ç‰ˆæœ¬å·(ä½ è¦å›žé€€çš„ç‰ˆæœ¬å·) åˆä¼šå›žåˆ°ä½ æœŸæœ›çš„ç‰ˆæœ¬ï¼ GitHub åˆå§‹åŒ–æäº¤ create a new repository on the command line 1234567echo "# NOTES" &gt;&gt; README.mdgit init# git add .git add README.mdgit commit -m "first commit"git remote add origin https://github.com/XXX/NOTES.gitgit push -u origin master push an existing repository from the command line 12git remote add origin https://github.com/XXX/NOTES.gitgit push -u origin master è‡ªåŠ¨ä¸Šä¼ è„šæœ¬:123456789#! /bin/bashecho 'start autodeployment...:)'hexo cleanecho 'hexo clean over...'hexo generateecho 'hexo generate over...'hexo deployecho 'hexo deploy over...'echo 'run success!:)' å¸¸ç”¨æ“ä½œåœºæ™¯ï¼šæœ¬åœ°æ–°å»ºäº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œæƒ³æ‹‰å–è¿œç¨‹çš„ä¸€ä¸ªé¡¹ç›® 1234567git initgit remote add origin https://github.com/XXX/NOTES.git# git pull &lt;remote&gt; &lt;branch&gt; ç›´æŽ¥æŒ‡å®šè¿œç¨‹mastergit pull origin master# å…ˆæŒ‡å®šæœ¬åœ°masteråˆ°è¿œç¨‹çš„masterï¼Œç„¶åŽå†åŽ»pullgit branch --set-upstream-to=origin/master mastergit pull åœºæ™¯ï¼šå°†æœ¬åœ°çš„.gitæ–‡ä»¶åˆ é™¤äº†ï¼Œæœ¬åœ°æ–‡ä»¶ä¹Ÿæ›´æ–°äº†ï¼Œæ–°å»ºgitä»“åº“å’Œè¿œç¨‹åˆå¹¶ 123456789101112git initgit remote add origin https://github.com/XXX/NOTES.git# ä¼šæŠ¥é”™ï¼Œfailed to push some refs to ...git push origin master# è¿™ä¸ªæ—¶å€™éœ€è¦å…ˆæ‹‰å–è¿œç¨‹çš„é¡¹ç›®git pull origin master# ç„¶åŽä¼šæŠ¥é”™ï¼Œfatal: refusing to merge unrelated historiesgit pull origin master --allow-unrelated-histories# ç„¶åŽæŒ‰ç…§è¦æ±‚è§£å†³å†²çªå°±å¥½ï¼Œå†commitä¸€ä¸‹git add .git commit -m "fix conflicts"git push origin master åœºæ™¯ï¼šè¿œç¨‹ä»“åº“é‡Œæäº¤äº†ä¸€äº›ä¸éœ€è¦çš„æ–‡ä»¶ï¼Œæœ¬åœ°æ·»åŠ åˆ°.gitignoreæ–‡ä»¶åŽä¸èµ·ä½œç”¨ 123git rm -r --cached .git add .git commit -m 'update .gitignore' åœºæ™¯ï¼šè¿œç¨‹ä»“åº“æœ‰ä¸¤ä¸ªåˆ†æ”¯masterå’Œdevï¼Œæ¯”è¾ƒäºŒè€…çš„ç‰ˆæœ¬å·®å¼‚ 123456789101112# æŸ¥çœ‹è¿œç¨‹devæœ‰ä½†æ˜¯è¿œç¨‹masteræ²¡æœ‰çš„git log origin/dev ^origin/master# æŸ¥çœ‹è¿œç¨‹masteræœ‰ä½†æ˜¯è¿œç¨‹devæ²¡æœ‰çš„git log origin/dev..origin/master# æŸ¥çœ‹è¿œç¨‹masteræœ‰ä½†æ˜¯è¿œç¨‹devæ²¡æœ‰çš„git log origin/master ^origin/dev# æŸ¥çœ‹è¿œç¨‹devæœ‰ä½†æ˜¯è¿œç¨‹masteræ²¡æœ‰çš„git log origin/master..origin/dev# å•çº¯æƒ³æ¯”è¾ƒä¸¤è€…ä¹‹é—´çš„åŒºåˆ«git log origin/dev...origin/master# æˆ–è€…git log --left-right dev...master ä¸Šè¿°å‘½ä»¤å¯ä»¥åŠ ä¸Š--pretty=onelineè®©ç»“æžœè¾“å‡ºæ›´ç®€æ´ã€‚ åœºæ™¯ï¼šå¤„ç†å®Œå†²çªåŽå°†æ–‡ä»¶æŸ¥çœ‹åˆ†æ”¯çš„æ›´æ”¹æƒ…å†µ 1git log --graph --pretty=oneline --abbrev-commit]]></content>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAåŸºç¡€çŸ¥è¯†-Map]]></title>
    <url>%2F2019%2F09%2F09%2FJAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-Map%2F</url>
    <content type="text"><![CDATA[JAVAåŸºç¡€çŸ¥è¯†-Map ç›¸å…³çŸ¥è¯†ã€‚ éåŽ†Map æ–¹æ³•ä¸€ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243public class SlowMap &#123; public static void main(String[] args) &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put("A", "01"); map.put("B", "02"); map.put("C", "03"); // èŽ·å–é”®çš„é›†åˆ Set&lt;String&gt; keySet = map.keySet(); // åˆ©ç”¨seté›†åˆçš„è¿­ä»£å™¨ Iterator&lt;String&gt; iterator = keySet.iterator(); while(iterator.hasNext()) &#123; String key = iterator.next(); String value = map.get(key); System.out.println("MAP INFO KEY:" + key + " VALUE:" + value); &#125; &#125;&#125;``` &gt; æ–¹æ³•äºŒï¼š```javapublic class QuickMap &#123; public static void main(String[] args) &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put("A", "01"); map.put("B", "02"); map.put("C", "03"); // é€šè¿‡entrySet()æ–¹æ³•å°†mapé›†åˆä¸­çš„æ˜ å°„å…³ç³»å–å‡º Set&lt;Map.Entry&lt;String, String&gt;&gt; entry = map.entrySet(); // åˆ©ç”¨å…³ç³»é›†åˆentrySetçš„è¿­ä»£å™¨ Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iterator = entry.iterator(); while(iterator.hasNext()) &#123; // èŽ·å–Map.Entryçš„å…³ç³»å¯¹è±¡me Map.Entry&lt;String, String&gt; me = iterator.next(); // é€šè¿‡å…³ç³»å¯¹è±¡èŽ·å–key String key = me.getKey(); // é€šè¿‡å…³ç³»å¯¹è±¡èŽ·å–value String value = me.getValue(); System.out.println("Key :" + key + " value :" + value); &#125; &#125;&#125; æ–¹æ³•ä¸‰ï¼š 1234567891011121314151617public class CollectionMap &#123; public static void main(String[] args) &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put("A", "01"); map.put("B", "02"); map.put("C", "03"); // Collectioné›†åˆå­˜æ”¾Mapçš„valueå€¼ Collection&lt;String&gt; collection = map.values(); // éåŽ†Collection Iterator&lt;String&gt; it = collection.iterator(); // åªèƒ½éåŽ†valueå€¼ï¼Œä¸èƒ½éåŽ†keyå€¼ while(it.hasNext()) &#123; Object value = it.next(); System.out.println(value); &#125; &#125;&#125; æœ€ä½³å®žè·µï¼š 1234567891011public class BestMap &#123; public static void main(String[] args) &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put("A", "01"); map.put("B", "02"); map.put("C", "03"); for (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123; System.out.println("key= " + entry.getKey() + " and value= " + entry.getValue()); &#125; &#125;&#125;]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAåŸºç¡€çŸ¥è¯†-HashMap]]></title>
    <url>%2F2019%2F09%2F05%2FJAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-HashMap%2F</url>
    <content type="text"><![CDATA[JAVAåŸºç¡€çŸ¥è¯†-HashMap ç›¸å…³çŸ¥è¯†ã€‚ å¸¸ç”¨çš„é€šé…ç¬¦T, E, K, V, ? æœ¬è´¨ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä½†æ˜¯ä¸ºäº†ç»´æŒå¯è¯»æ€§ï¼Œå¸¸è¿™æ ·çº¦å®šï¼š ï¼Ÿè¡¨ç¤ºä¸ç¡®å®šçš„JAVAç±»åž‹ T (type) è¡¨ç¤ºä¸€ä¸ªå…·ä½“çš„JAVAç±»åž‹ K V (key value) åˆ†åˆ«è¡¨ç¤ºJAVAé”®å€¼å¯¹ key - value E (element) ä»£è¡¨Element RBT(çº¢é»‘æ ‘) æ¯ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…é»‘è‰² æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰² æ¯ä¸ªå¶èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ å¦‚æžœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå„¿å­éƒ½æ˜¯é»‘è‰²çš„ å¯¹äºŽæ¯ä¸ªèŠ‚ç‚¹ï¼Œä»Žè¯¥ç»“ç‚¹åˆ°å…¶å¶å­èŠ‚ç‚¹æž„æˆçš„æ‰€æœ‰è·¯å¾„ä¸Šçš„é»‘è‰²ç»“ç‚¹ä¸ªæ•°ç›¸åŒ æ’å…¥è¿‡ç¨‹ï¼š é»˜è®¤æ’å…¥èŠ‚ç‚¹ä¸ºçº¢è‰² AVL(è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘) é¦–å…ˆæ˜¯ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘ æŸèŠ‚ç‚¹çš„å·¦å­æ ‘èŠ‚ç‚¹å€¼ä»…åŒ…å«å°äºŽè¯¥èŠ‚ç‚¹å€¼ æŸèŠ‚ç‚¹çš„å³å­æ ‘èŠ‚ç‚¹å€¼ä»…åŒ…å«å¤§äºŽè¯¥èŠ‚ç‚¹å€¼ å·¦å³å­æ ‘æ¯ä¸ªä¹Ÿå¿…é¡»æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ å¸¦æœ‰å¹³è¡¡æ¡ä»¶ï¼Œæ¯ä¸ªç»“ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ï¼ˆå¹³è¡¡å› å­ï¼‰æœ€å¤šä¸º1 RBTå’ŒAVLæŸ¥æ‰¾è¿œè¿œå¤šäºŽæ’å…¥åˆ é™¤ï¼Œé€‰æ‹©AVLæ ‘ å¦‚æžœæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤é¢‘çŽ‡å·®ä¸å¤šï¼Œé‚£ä¹ˆé€‰æ‹©çº¢é»‘æ ‘ JAVA ä¸­çº¢é»‘æ ‘çš„å®žçŽ°12345678910static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; parent; // red-black tree links TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion boolean red; TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) &#123; super(hash, key, val, next); &#125;&#125; çº¢é»‘æ ‘çš„æ’å…¥è¿‡ç¨‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576static &lt;K,V&gt; TreeNode&lt;K,V&gt; balanceInsertion(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; x) &#123; // åˆå§‹æŸ“è‰²ä¸ºçº¢ x.red = true; for (TreeNode&lt;K,V&gt; xp, xpp, xppl, xppr;;) &#123; // æ’å…¥çš„ä¸ºæ ¹èŠ‚ç‚¹ï¼ˆçˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼‰ï¼Œåˆ™ç›´æŽ¥æŠŠé¢œè‰²æ”¹ä¸ºé»‘è‰² if ((xp = x.parent) == null) &#123; x.red = false; return x; &#125; // çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²èŠ‚ç‚¹æˆ–è€…æ’å…¥èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æŽ¥è¿”å›ž else if (!xp.red || (xpp = xp.parent) == null) return root; // I. çˆ¶èŠ‚ç‚¹å’Œç¥–çˆ¶èŠ‚ç‚¹éƒ½å­˜åœ¨ä¸”çˆ¶èŠ‚ç‚¹æ˜¯ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ if (xp == (xppl = xpp.left)) &#123; // 1. ç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰ä¸æ˜¯ç©ºä¸”ä¸ºçº¢è‰² if ((xppr = xpp.right) != null &amp;&amp; xppr.red) &#123; // å°†å”å”èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰² xppr.red = false; // å°†çˆ¶äº²èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰² xp.red = false; // å°†ç¥–çˆ¶èŠ‚ç‚¹æ”¹ä¸ºçº¢è‰² xpp.red = true; x = xpp; &#125; // 2. ç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰æ˜¯ç©ºæˆ–è€…ä¸ºé»‘è‰² else &#123; // æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­©å­ï¼Œå°†çˆ¶èŠ‚ç‚¹å·¦æ—‹ if (x == xp.right) &#123; root = rotateLeft(root, x = xp); xpp = (xp = x.parent) == null ? null : xp.parent; &#125; // æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­ if (xp != null) &#123; // å°†çˆ¶èŠ‚ç‚¹å˜æˆé»‘è‰²èŠ‚ç‚¹ xp.red = false; if (xpp != null) &#123; // ç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²èŠ‚ç‚¹ï¼Œç„¶åŽå°†ç¥–çˆ¶èŠ‚ç‚¹å³æ—‹ xpp.red = true; root = rotateRight(root, xpp); &#125; &#125; &#125; &#125; // II. çˆ¶èŠ‚ç‚¹å’Œç¥–çˆ¶èŠ‚ç‚¹éƒ½å­˜åœ¨ä¸”çˆ¶èŠ‚ç‚¹æ˜¯ç¥–çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ else &#123; // 1. ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰ä¸ä¸ºç©ºä¸”ä¸ºçº¢è‰² if (xppl != null &amp;&amp; xppl.red) &#123; // å°†å”å”èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰² xppl.red = false; // å°†çˆ¶äº²èŠ‚ç‚¹æ”¹ä¸ºé»‘è‰² xp.red = false; // å°†ç¥–çˆ¶èŠ‚ç‚¹æ”¹ä¸ºçº¢è‰² xpp.red = true; x = xpp; &#125; // 2. ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰æ˜¯ç©ºæˆ–è€…ä¸ºé»‘è‰² else &#123; // æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­ï¼Œå°†çˆ¶èŠ‚ç‚¹å³æ—‹ if (x == xp.left) &#123; root = rotateRight(root, x = xp); xpp = (xp = x.parent) == null ? null : xp.parent; &#125; // æ’å…¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­©å­ if (xp != null) &#123; // å°†çˆ¶èŠ‚ç‚¹å˜æˆé»‘è‰²èŠ‚ç‚¹ xp.red = false; if (xpp != null) &#123; // ç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²èŠ‚ç‚¹ï¼Œç„¶åŽå°†ç¥–çˆ¶èŠ‚ç‚¹å·¦æ—‹ xpp.red = true; root = rotateLeft(root, xpp); &#125; &#125; &#125; &#125; &#125;&#125; å·¦æ—‹å³æ—‹æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233static &lt;K,V&gt; TreeNode&lt;K,V&gt; rotateLeft(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; p) &#123; TreeNode&lt;K,V&gt; r, pp, rl; if (p != null &amp;&amp; (r = p.right) != null) &#123; if ((rl = p.right = r.left) != null) rl.parent = p; if ((pp = r.parent = p.parent) == null) (root = r).red = false; else if (pp.left == p) pp.left = r; else pp.right = r; r.left = p; p.parent = r; &#125; return root;&#125;static &lt;K,V&gt; TreeNode&lt;K,V&gt; rotateRight(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; p) &#123; TreeNode&lt;K,V&gt; l, pp, lr; if (p != null &amp;&amp; (l = p.left) != null) &#123; if ((lr = p.left = l.right) != null) lr.parent = p; if ((pp = l.parent = p.parent) == null) (root = l).red = false; else if (pp.right == p) pp.right = l; else pp.left = l; l.right = p; p.parent = l; &#125; return root;&#125; çº¢é»‘æ ‘çš„åˆ é™¤è¿‡ç¨‹ï¼š å…ˆè¿›è¡ŒäºŒå‰æœç´¢æ ‘çš„åˆ é™¤ ç„¶åŽè¿›è¡Œçº¢é»‘æ ‘çš„è°ƒæ•´ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071// pæ˜¯å¾…åˆ é™¤èŠ‚ç‚¹ï¼Œreplacementç”¨äºŽåŽç»­çš„çº¢é»‘æ ‘è°ƒæ•´ï¼ŒæŒ‡å‘çš„æ˜¯pæˆ–è€…pçš„ç»§æ‰¿è€…ã€‚if (pl != null &amp;&amp; pr != null) &#123; TreeNode&lt;K,V&gt; s = pr, sl; while ((sl = s.left) != null) // find successor s = sl; boolean c = s.red; s.red = p.red; p.red = c; // swap colors TreeNode&lt;K,V&gt; sr = s.right; TreeNode&lt;K,V&gt; pp = p.parent; if (s == pr) &#123; // p was s's direct parent p.parent = s; s.right = p; &#125; else &#123; TreeNode&lt;K,V&gt; sp = s.parent; if ((p.parent = sp) != null) &#123; if (s == sp.left) sp.left = p; else sp.right = p; &#125; if ((s.right = pr) != null) pr.parent = s; &#125; p.left = null; if ((p.right = sr) != null) sr.parent = p; if ((s.left = pl) != null) pl.parent = s; if ((s.parent = pp) == null) root = s; else if (p == pp.left) pp.left = s; else pp.right = s; if (sr != null) replacement = sr; else replacement = p;&#125;else if (pl != null) replacement = pl;else if (pr != null) replacement = pr;else replacement = p;if (replacement != p) &#123; TreeNode&lt;K,V&gt; pp = replacement.parent = p.parent; if (pp == null) root = replacement; else if (p == pp.left) pp.left = replacement; else pp.right = replacement; p.left = p.right = p.parent = null;&#125;// å¦‚æžœåˆ é™¤æ—¶çš„èŠ‚ç‚¹pæ˜¯çº¢è‰²ï¼Œåˆ™æ ‘å¹³è¡¡ä¸ä¼šè¢«ç ´åï¼Œæ— éœ€è°ƒæ•´ã€‚ TreeNode&lt;K,V&gt; r = p.red ? root : balanceDeletion(root, replacement);if (replacement == p) &#123; // detach TreeNode&lt;K,V&gt; pp = p.parent; p.parent = null; if (pp != null) &#123; if (p == pp.left) pp.left = null; else if (p == pp.right) pp.right = null; &#125;&#125;if (movable) moveRootToFront(tab, r); åˆ é™¤åŽçš„è°ƒæ•´ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112// root : æ ¹èŠ‚ç‚¹ | x : æ ¹èŠ‚ç‚¹çš„ç»§æ‰¿è€…static &lt;K,V&gt; TreeNode&lt;K,V&gt; balanceDeletion(TreeNode&lt;K,V&gt; root, TreeNode&lt;K,V&gt; x) &#123; for (TreeNode&lt;K,V&gt; xp, xpl, xpr;;) &#123; // å¦‚æžœxä¸ºç©ºæˆ–xä¸ºæ ¹èŠ‚ç‚¹ï¼Œç›´æŽ¥è¿”å›ž if (x == null || x == root) return root; // xä¸ºæ ¹èŠ‚ç‚¹ï¼ŒæŸ“æˆé»‘è‰²ï¼Œç›´æŽ¥è¿”å›ž(åˆ é™¤çš„ä¸ºæ ¹èŠ‚ç‚¹ï¼Œåˆ™æ‰¶æ¤ç»§æ‰¿è€…xä¸ºæ–°çš„æ ¹èŠ‚ç‚¹) else if ((xp = x.parent) == null) &#123; x.red = false; return x; &#125; // xä¸ºçº¢è‰²ï¼Œåˆ™æ— éœ€è°ƒæ•´ï¼Œç›´æŽ¥è¿”å›žæ ¹èŠ‚ç‚¹ else if (x.red) &#123; x.red = false; return root; &#125; // xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­ else if ((xpl = xp.left) == x) &#123; // å¦‚æžœxæœ‰çº¢è‰²å…„å¼ŸèŠ‚ç‚¹xpr, åˆ™å®ƒçš„çˆ¶èŠ‚ç‚¹xpä¸€å®šæ˜¯é»‘è‰²èŠ‚ç‚¹ if ((xpr = xp.right) != null &amp;&amp; xpr.red) &#123; xpr.red = false; xp.red = true; // å°†çˆ¶èŠ‚ç‚¹å·¦æ—‹ root = rotateLeft(root, xp); // é‡æ–°å°†xpæŒ‡å‘xçš„çˆ¶èŠ‚ç‚¹ï¼ŒxpræŒ‡å‘xpæ–°çš„å³å­©å­ xpr = (xp = x.parent) == null ? null : xp.right; &#125; //å¦‚æžœxprä¸ºç©ºï¼Œåˆ™å‘ä¸Šç»§ç»­è°ƒæ•´ï¼Œå°†xçš„çˆ¶èŠ‚ç‚¹xpä½œä¸ºæ–°çš„xç»§ç»­å¾ªçŽ¯ if (xpr == null) x = xp; else &#123; // slå’Œsråˆ†åˆ«ä¸ºå…¶è¿‘ä¾„å­å’Œè¿œä¾„å­ TreeNode&lt;K,V&gt; sl = xpr.left, sr = xpr.right; // è‹¥s1å’Œs2éƒ½ä¸ºé»‘è‰²æˆ–è€…ä¸å­˜åœ¨ï¼Œå³xpræ²¡æœ‰çº¢è‰²å­©å­ï¼Œåˆ™å°†xpræŸ“çº¢ if ((sr == null || !sr.red) &amp;&amp; (sl == null || !sl.red)) &#123; xpr.red = true; // ç»§ç»­å‘ä¸Šå¾ªçŽ¯ x = xp; &#125; else &#123; // å³å­©å­ä¸ºç©ºæˆ–è€…ä¸ºé»‘è‰² if (sr == null || !sr.red) &#123; // æœ‰å·¦å­©å­åˆ™æŸ“é»‘ if (sl != null) sl.red = false; // å°†xpræŸ“çº¢ xpr.red = true; // xprå³æ—‹ root = rotateRight(root, xpr); // å³æ—‹åŽxpræŒ‡å‘xpçš„æ–°å³å­©å­ï¼Œå³ä¸Šé¢çš„s1 xpr = (xp = x.parent) == null ? null : xp.right; &#125; if (xpr != null) &#123; // xpræŸ“æˆè·Ÿçˆ¶èŠ‚ç‚¹ä¸€è‡´çš„é¢œè‰²ï¼Œä¸ºåŽé¢çˆ¶èŠ‚ç‚¹xpçš„å·¦æ—‹åšå‡†å¤‡ if ((sr = xpr.right) != null) xpr.red = (xp == null) ? false : xp.red; if ((sr = xpr.right) != null) // xpræ–°çš„å³å­©å­æŸ“é»‘ï¼Œé˜²æ­¢å‡ºçŽ°ä¸¤ä¸ªçº¢è‰²ç›¸è¿ž sr.red = false; &#125; if (xp != null) &#123; // å°†xpæŸ“é»‘ï¼Œå¹¶å¯¹å…¶å·¦æ—‹ï¼Œè¿™æ ·å°±èƒ½ä¿è¯è¢«åˆ é™¤çš„Xæ‰€åœ¨çš„è·¯å¾„åˆå¤šäº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œä»Žè€Œè¾¾åˆ°æ¢å¤å¹³è¡¡çš„ç›®çš„ xp.red = false; root = rotateLeft(root, xp); &#125; // åˆ°æ­¤è°ƒæ•´å·²ç»å®Œæ¯•ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªçŽ¯åŽå°†ç›´æŽ¥é€€å‡º x = root; &#125; &#125; &#125; // xä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å³å­©å­... else &#123; // symmetric if (xpl != null &amp;&amp; xpl.red) &#123; xpl.red = false; xp.red = true; root = rotateRight(root, xp); xpl = (xp = x.parent) == null ? null : xp.left; &#125; if (xpl == null) x = xp; else &#123; TreeNode&lt;K,V&gt; sl = xpl.left, sr = xpl.right; if ((sl == null || !sl.red) &amp;&amp; (sr == null || !sr.red)) &#123; xpl.red = true; x = xp; &#125; else &#123; if (sl == null || !sl.red) &#123; if (sr != null) sr.red = false; xpl.red = true; root = rotateLeft(root, xpl); xpl = (xp = x.parent) == null ? null : xp.left; &#125; if (xpl != null) &#123; xpl.red = (xp == null) ? false : xp.red; if ((sl = xpl.left) != null) sl.red = false; &#125; if (xp != null) &#123; xp.red = false; root = rotateRight(root, xp); &#125; x = root; &#125; &#125; &#125; &#125;&#125; é‡å†™HashCode()æ–¹æ³•å’ŒEquals()æ–¹æ³•1234567891011121314151617// Prediction.javaimport java.util.Random;public class Prediction &#123; private static Random rand = new Random(47); private boolean shadow = rand.nextDouble() &gt; 0.5; public String toString() &#123; if (shadow) &#123; return "Six more weeks of Winner!"; &#125; else &#123; return "Early Spring"; &#125; &#125;&#125; 123456789101112// Groundhog.javapublic class Groundhog &#123; protected int number; public Groundhog(int n) &#123; number = n; &#125; public String toString() &#123; return "Groundhog #" + number; &#125;&#125; 123456789101112131415161718192021222324252627282930313233// SpringDetector.javaimport java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class SpringDetector &#123; // åˆ©ç”¨åå°„æœºåˆ¶èŽ·å–æž„é€ å‡½æ•° public static &lt;T extends Groundhog&gt; void detectSpring(Class&lt;T&gt; type) throws Exception &#123; Constructor&lt;T&gt; ghog = type.getConstructor(int.class); Map&lt;Groundhog, Prediction&gt; map = new HashMap&lt;Groundhog, Prediction&gt;(); for (int i = 0; i &lt; 10; i++) &#123; map.put(ghog.newInstance(i), new Prediction()); &#125; System.out.println("MAP" + map); Groundhog groundhog = ghog.newInstance(3); System.out.println("Looking up prediction for" + groundhog); if (map.containsKey(groundhog)) &#123; System.out.println(map.get(groundhog)); &#125; else &#123; System.out.println("Key not found:" + groundhog); &#125; &#125; public static void main(String[] args) throws Exception &#123; detectSpring(Groundhog.class); &#125;&#125; Output: 123MAP&#123;Groundhog #1=Six more weeks of Winner!, Groundhog #4=Six more weeks of Winner!, Groundhog #5=Early Spring, Groundhog #3=Early Spring, Groundhog #8=Six more weeks of Winner!, Groundhog #7=Early Spring, Groundhog #0=Six more weeks of Winner!, Groundhog #2=Early Spring, Groundhog #9=Six more weeks of Winner!, Groundhog #6=Early Spring&#125;Looking up prediction forGroundhog #3Key not found:Groundhog #3 Groundhogé»˜è®¤è°ƒç”¨çš„æ˜¯åŸºç±»Objectçš„hashCodeæ–¹æ³•ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯å¯¹è±¡çš„åœ°å€è®¡ç®—çš„æ•£åˆ—ç ã€‚åŒæ—¶åªé‡å†™hashCode()æ–¹æ³•æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦é‡å†™equals()æ–¹æ³•ã€‚ è¡¥å……ä¸€å¥ï¼ŒhashCode()æ˜¯åŸºç±»Objectçš„æ–¹æ³•ï¼Œæ‰€æœ‰Javaå¯¹è±¡éƒ½èƒ½äº§ç”Ÿæ•£åˆ—ç ã€‚ 12345678910111213// Groundhog2.javapublic class Groundhog2 extends Groundhog &#123; public Groundhog2(int n) &#123; super(n); &#125; public int hashCode() &#123; return number; &#125; public boolean equals(Object object) &#123; return object instanceof Groundhog2 &amp;&amp; (number == ((Groundhog2)object).number); &#125;&#125; 123456// SpringDetector2.javapublic class SpringDetector2 &#123; public static void main(String[] args) throws Exception &#123; SpringDetector.detectSpring(Groundhog2.class); &#125;&#125; Output: 123MAP&#123;Groundhog #0=Six more weeks of Winner!, Groundhog #1=Six more weeks of Winner!, Groundhog #2=Early Spring, Groundhog #3=Early Spring, Groundhog #4=Six more weeks of Winner!, Groundhog #5=Early Spring, Groundhog #6=Early Spring, Groundhog #7=Early Spring, Groundhog #8=Six more weeks of Winner!, Groundhog #9=Six more weeks of Winner!&#125;Looking up prediction forGroundhog #3Early Spring]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ãƒ‡ãƒ¼ã‚¿ã¨ã®çµ†]]></title>
    <url>%2F2019%2F08%2F15%2FTHE_DATA_ANALYSIS%2F</url>
    <content type="text"><![CDATA[ã‚‚ã†ä¸€å›žã‚‚ã†ä¸€å›žè¡Œã“ã†ãœ åƒ•ã‚‰ã®å£° ã‚¢ã‚¤ãƒ ã‚¢ãƒ«ãƒ¼ã‚¶ãƒ¼ ãšã£ã¨å‰ã‹ã‚‰èžã“ãˆã¦ãŸ å‡†å¤‡å·¥ä½œ1init_woody Matplotlib env init complete. Warnings off.1234import pandas as pdimport numpy as npimport seaborn as snsimport matplotlib.pyplot as plt 12# ä¸çœç•¥è¡Œçš„æŸ¥çœ‹æ•°æ®pd.set_option('display.max_columns', 200) æ•°æ®æºå‡†å¤‡1234567891011121314151617181920212223242526272829303132333435363738# å¯¼å…¥trainæ•°æ®train_idv_td = pd.read_csv("../data/2/train/IDV_TD.csv", encoding='utf-8') # ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_TDï¼‰train_idv_dpsa = pd.read_csv("../data/2/train/IDV_DPSA.csv", encoding='utf-8') # ä¸ªäººæ´»æœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_DPSAï¼‰train_loan = pd.read_csv("../data/2/train/LOAN.csv", encoding='utf-8') # è´·æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆLOANï¼‰train_bond = pd.read_csv("../data/2/train/BOND.csv", encoding='utf-8') # å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰train_fund = pd.read_csv("../data/2/train/FUND.csv", encoding='utf-8') # åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰train_prec_metal = pd.read_csv("../data/2/train/PREC_METAL.csv", encoding='utf-8') # è´µé‡‘å±žè´¦æˆ·ä¿¡æ¯ï¼ˆPREC_METALï¼‰train_aget_insr = pd.read_csv("../data/2/train/AGET_INSR.csv", encoding='utf-8') # ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET_INSRï¼‰train_thr_pty_cstd = pd.read_csv("../data/2/train/THR_PTY_CSTD.csv", encoding='utf-8') # ç¬¬ä¸‰æ–¹å­˜ç®¡è´¦æˆ·ä¿¡æ¯ï¼ˆTHR_PTY_CSTDï¼‰train_idv_cust_basic = pd.read_csv("../data/2/train/IDV_CUST_BASIC.csv", encoding='utf-8') # ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆIDV_CUST_BASICï¼‰train_tr_dc = pd.read_csv("../data/2/train/TR_DC.csv", encoding='utf-8') # äº¤æ˜“ä¿¡æ¯ï¼ˆTR_DCï¼‰train_base_excg = pd.read_csv("../data/2/train/BASE_EXCG.csv", encoding='utf-8') # æ±‡çŽ‡è¡¨ï¼ˆBASE_EXCGï¼‰train_cust_result = pd.read_csv("../data/2/train/CUST_RESULT.csv", encoding='utf-8') # å®¢æˆ·æ ‡è®°ï¼ˆCUST_RESULTï¼‰# Aæ¦œ# BASE_EXCG.csv æ— A_idv_td = pd.read_csv("../data/2/A/IDV_TD.csv", encoding='utf-8')A_idv_dpsa = pd.read_csv("../data/2/A/IDV_DPSA.csv", encoding='utf-8')A_loan = pd.read_csv("../data/2/A/LOAN.csv", encoding='utf-8')A_bond = pd.read_csv("../data/2/A/BOND.csv", encoding='utf-8')A_fund = pd.read_csv("../data/2/A/FUND.csv", encoding='utf-8')A_prec_metal = pd.read_csv("../data/2/A/PREC_METAL.csv", encoding='utf-8')A_aget_insr = pd.read_csv("../data/2/A/AGET_INSR.csv", encoding='utf-8')A_thr_pty_cstd = pd.read_csv("../data/2/A/THR_PTY_CSTD.csv", encoding='utf-8')A_idv_cust_basic = pd.read_csv("../data/2/A/IDV_CUST_BASIC.csv", encoding='utf-8')A_tr_dc = pd.read_csv("../data/2/A/TR_DC.csv", encoding='utf-8')A_customid = pd.read_csv("../data/2/A/CUSTOMID.csv", encoding='utf-8')# Bæ¦œB_idv_td = pd.read_csv("../data/2/B/IDV_TD.csv", encoding='utf-8')B_idv_dpsa = pd.read_csv("../data/2/B/IDV_DPSA.csv", encoding='utf-8')B_loan = pd.read_csv("../data/2/B/LOAN.csv", encoding='utf-8')B_bond = pd.read_csv("../data/2/B/BOND.csv", encoding='utf-8')B_fund = pd.read_csv("../data/2/B/FUND.csv", encoding='utf-8')B_prec_metal = pd.read_csv("../data/2/B/PREC_METAL.csv", encoding='utf-8')B_aget_insr = pd.read_csv("../data/2/B/AGET_INSR.csv", encoding='utf-8')B_thr_pty_cstd = pd.read_csv("../data/2/B/THR_PTY_CSTD.csv", encoding='utf-8')B_idv_cust_basic = pd.read_csv("../data/2/B/IDV_CUST_BASIC.csv", encoding='utf-8')B_tr_dc = pd.read_csv("../data/2/B/TR_DC.csv", encoding='utf-8')B_customid = pd.read_csv("../data/2/B/CUSTOMID.csv", encoding='utf-8') /root/anaconda3/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2728: DtypeWarning: Columns (12) have mixed types. Specify dtype option on import or set low_memory=False. interactivity=interactivity, compiler=compiler, result=result)1234567# æŠŠæ±‡çŽ‡è¡¨ä¸­çš„CCY_LETE_CDå­—æ®µè½¬åŒ–ä¸ºCCY_CDå­—æ®µtrain_base_excg = pd.read_csv("../data/2/train/BASE_EXCG.csv", encoding='utf-8') # æ±‡çŽ‡è¡¨ï¼ˆBASE_EXCGï¼‰train_base_excg['CCY_CD'] = train_base_excg['CCY_LETE_CD']train_base_excg = train_base_excg.drop(['CCY_LETE_CD'], axis=1)train_base_excg['RMB_MID_PRIC'].apply(lambda x: float(x))# æŠŠæ±‡çŽ‡è¡¨ä¸­çš„CCY_LETE_CDå­—æ®µè½¬åŒ–ä¸ºCCY_CDå­—æ®µtrain_tr_dc['TR_DAT'].apply(lambda x: int(x)) å…¬ç”¨å‡½æ•°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667# æŒ‰æ±‡çŽ‡è®¡ç®—ä»·å€¼ï¼ˆä¼ å…¥2ä¸ªå‚æ•°è¿”å›žè®¡ç®—ç»“æžœï¼‰def compute_REAL_MONEY(train_IDV_DPSA_SAMPLE, A, B): NEED = train_IDV_DPSA_SAMPLE[A] RMB_MID_PRIC = train_IDV_DPSA_SAMPLE[B] return NEED * float(RMB_MID_PRIC)# one-hot å¤„ç†å‡½æ•°# æœ¬åœ°è¯„ä»·def evaluate(test_y, y_pred): from sklearn import metrics test_pct_1 = test_y.sum()/test_y.shape[0] pred_pct_1 = y_pred.sum()/y_pred.shape[0] roc_auc = metrics.roc_auc_score(test_y,y_pred) acc = metrics.accuracy_score(test_y,y_pred) Recall = metrics.recall_score(test_y,y_pred) F1 = metrics.f1_score(test_y,y_pred) Precision = metrics.precision_score(test_y,y_pred) Confusion = metrics.confusion_matrix(test_y,y_pred) print ('test_pct_1: %.4f' % test_pct_1) print ('pred_pct_1: %.4f' % pred_pct_1) print ('Precesion: %.4f' % Precision) print ('Recall: %.4f' % Recall) print ('F1-score: %.4f' % F1) print('confusion matrix:') print (metrics.confusion_matrix(test_y,y_pred)) return &#123;'test_pct_1':test_pct_1,'pred_pct_1':pred_pct_1,'roc_auc':roc_auc,'acc':acc,'recall':Recall,'F1':F1,'Precision':Precision,'Confusuion':Confusion&#125;def feature_rank(model,num): ##è®¡ç®—ç‰¹å¾å¾—åˆ† feature_score = model.get_fscore() df_feature_score = pd.DataFrame(&#123;"feature_name":list(feature_score.keys()),"feature_score":list(feature_score.values())&#125;) df_feature_score_sort = df_feature_score.sort_values(ascending=0,by=['feature_score']) #result_name = "feature_score_1_A_%s_%s_%s_%6f.csv"%(time_str,feature_num,train_steps,F1_score) #result_name_full = datas_dir_e + "out/" + result_name #df_feature_score_sort.to_csv(result_name_full,index=None) return df_feature_score_sort.head(num)def stat_df(df): stats = [] for col in df.columns: stats.append((col, df[col].nunique(),df[col].isnull().sum()*100/df.shape[0], df[col].value_counts(normalize=True,dropna=False).values[0]*100,df[col].dtype)) stats_df = pd.DataFrame(stats, columns=['ç‰¹å¾','å”¯ä¸€æ•°æ•°é‡','ç¼ºå¤±å€¼å æ¯”','æœ€å¤šæ•°å æ¯”','ç±»åž‹']) stats_df.sort_values('ç¼ºå¤±å€¼å æ¯”',ascending=False) return stats_dfdef plot_feature_distribution(df1,df2,label1,label2,features,width=6,height=6): i=0 sns.set_style('whitegrid') plt.figure() fig,ax = plt.subplots(width,height,figsize=(20,12)) for feature in features: i+=1 plt.subplot(width,height,i) sns.kdeplot(df1[feature],bw=0.5,label=label1) sns.kdeplot(df2[feature],bw=0.5,label=label2) plt.xlabel(feature,fontsize=9) locs, labels = plt.xticks() plt.tick_params(axis='x',which='major',labelsize=6,pad=-6) plt.tick_params(axis='y',which='major',labelsize=6) plt.show() ç‰¹å¾å·¥ç¨‹ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨(IDV_CUST_BASIC) - å¤„ç†1234567# åˆ é™¤æ²¡ç”¨çš„å­—æ®µtrain_idv_cust_basic_SAMPLE = train_idv_cust_basic.drop(['DATA_DAT', 'PROV_CD', 'CUST_SEX_CD', 'RES_CD', 'RES_STA_CD', 'NATY_CD', 'NATN_CD', 'CULT_DGR_CD', 'DGR_CD', 'PLC_STS_CD', 'PRFN', 'ADMI_POS_CD', 'SPEC_TECH_PRFN_QUA_CD', 'TITLE_RANK_CD', 'WORK_TYP_CD', 'GC_BRTH', 'UNIT_PROP_CD', 'WORK_YEAR', 'OCP_CD'], axis=1)# å°†ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨ä¸Žç»“æžœæ•´åˆtrain_idv_cust_basic_SAMPLE = pd.merge(train_idv_cust_basic_SAMPLE, train_cust_result, on='CUST_NO') 12345features = [x for x in train_idv_cust_basic_SAMPLE.columns if x not in ['CUST_NO','FLAG']]df0 = train_idv_cust_basic_SAMPLE[train_idv_cust_basic_SAMPLE.FLAG==0]df1 = train_idv_cust_basic_SAMPLE[train_idv_cust_basic_SAMPLE.FLAG==1]plot_feature_distribution(df0,df1,'0','1',features,2,2) /root/anaconda3/lib/python3.6/site-packages/statsmodels/nonparametric/kde.py:454: RuntimeWarning: invalid value encountered in greater X = X[np.logical_and(X&gt;clip[0], X&lt;clip[1])] # won&apos;t work for two columns. /root/anaconda3/lib/python3.6/site-packages/statsmodels/nonparametric/kde.py:454: RuntimeWarning: invalid value encountered in less X = X[np.logical_and(X&gt;clip[0], X&lt;clip[1])] # won&apos;t work for two columns. &lt;matplotlib.figure.Figure at 0x7f0167e93dd8&gt; 12345678# å£°æ˜Žå‡½æ•°def IDV_CUST_BASIC_PARSE(dataset_IDV_CUST_BASIC): # åˆ é™¤ä¸ªäººç”¨æˆ·ä¿¡æ¯è¡¨ä¸­æ— å…³å…ƒç´  dataset_IDV_CUST_BASIC = dataset_IDV_CUST_BASIC.drop(['DATA_DAT', 'PROV_CD', 'CUST_SEX_CD', 'RES_CD', 'RES_STA_CD', 'NATY_CD', 'NATN_CD', 'CULT_DGR_CD', 'DGR_CD', 'PLC_STS_CD', 'PRFN', 'ADMI_POS_CD', 'SPEC_TECH_PRFN_QUA_CD', 'TITLE_RANK_CD', 'WORK_TYP_CD', 'GC_BRTH', 'UNIT_PROP_CD', 'WORK_YEAR', 'OCP_CD'], axis=1) return dataset_IDV_CUST_BASIC ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_TDï¼‰- å¤„ç†12# æŸ¥çœ‹æ•°æ®æ¯”ä¾‹stat_df(train_idv_td) 12345678910111213141516171819202122232425262728# ç¼–æˆå‡½æ•°def IDV_TD_PARSE(dataset_IDV_TD): train_idv_td_3 = dataset_IDV_TD[dataset_IDV_TD['DATA_DAT']==3734035200] # ç®€åŒ–IDV_TDè¡¨ train_idv_td_3 = train_idv_td_3.drop(['DATA_DAT', 'ARG_CRT_DAT', 'DATA_DAT', 'CLS_ACCT_DAT', 'MATU_DAT', 'LAC', 'ACCT_STS_CD','DP_DAY_CD', 'RDEP_IND_CD', 'RDEP_DP_DAY_CD', 'RAT_CTG','FXDI_SA_ACCM', 'MTH_ACT_DAYS_TOT'], axis=1) # åŽ»é‡ train_idv_td_3.drop_duplicates(subset=None, keep='first', inplace=True) # å°†train_idv_tdå’Œtrain_base_excgåˆå¹¶ train_IDV_TD_SAMPLE_3 = pd.merge(train_idv_td_3, train_base_excg, on = 'CCY_CD') # æ‰§è¡Œæ±‡çŽ‡è®¡ç®—å‡½æ•° train_IDV_TD_SAMPLE_3['CRBAL'] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('CRBAL', 'RMB_MID_PRIC')) train_IDV_TD_SAMPLE_3['REG_CAP'] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('REG_CAP', 'RMB_MID_PRIC')) train_IDV_TD_SAMPLE_3['FXDI_T_ACCM'] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('FXDI_T_ACCM', 'RMB_MID_PRIC')) train_IDV_TD_SAMPLE_3['TDOP_SHD_PAY_INTS'] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('TDOP_SHD_PAY_INTS', 'RMB_MID_PRIC')) train_IDV_TD_SAMPLE_3['MOTH_CR_ACCM'] = train_IDV_TD_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('MOTH_CR_ACCM', 'RMB_MID_PRIC')) train_IDV_TD_SAMPLE_3['IDV_TD_SUM'] = train_IDV_TD_SAMPLE_3['TDOP_SHD_PAY_INTS'] + train_IDV_TD_SAMPLE_3['REG_CAP'] # å†æ¬¡ç²¾ç®€è¡¨ train_IDV_TD_SAMPLE_3 = train_IDV_TD_SAMPLE_3.drop(['CCY_CD', 'RMB_MID_PRIC'], axis=1) # æ•°æ®åŽ»é‡ train_IDV_TD_SAMPLE_3.drop_duplicates(subset=None, keep='first', inplace=True) # å°†ä¸ªäººè´¦æˆ·é‡Œçš„æ•°æ®åˆå¹¶å³é‡‘é¢åŠ èµ·æ¥ train_IDV_TD_SAMPLE_SUM_3 = train_IDV_TD_SAMPLE_3[['CUST_NO', 'CRBAL', 'REG_CAP', 'FXDI_T_ACCM', 'TDOP_SHD_PAY_INTS', 'MOTH_CR_ACCM', 'IDV_TD_SUM']].groupby('CUST_NO').sum().reset_index() # åŒºåˆ†å­—æ®µ train_IDV_TD_SAMPLE_SUM_3 = train_IDV_TD_SAMPLE_SUM_3.rename(columns=&#123;'CRBAL':'IDV_TD_CRBAL', 'MOTH_CR_ACCM':'IDV_TD_MOTH_CR_ACCM'&#125;) # @ åŽ»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾ train_IDV_TD_SAMPLE_SUM_3 = train_IDV_TD_SAMPLE_SUM_3.drop(['TDOP_SHD_PAY_INTS', 'REG_CAP'], axis=1) # è¿”å›žç¬¬ä¸‰ä¸ªæ—¶é—´æ®µçš„æ•°æ® return train_IDV_TD_SAMPLE_SUM_3 ä¸ªäººæ´»æœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_DPSAï¼‰- å¤„ç†1234567891011121314151617181920212223242526272829303132# ç¼–æˆå‡½æ•°def IDV_DPSA_PARSE(dataset_IDV_DPSA): # åˆ’åˆ†ä¸‰å¼ è¡¨ train_idv_dpsa_1 = dataset_IDV_DPSA[dataset_IDV_DPSA['DATA_DAT']==3728764800].reset_index() train_idv_dpsa_2 = dataset_IDV_DPSA[dataset_IDV_DPSA['DATA_DAT']==3731443200].reset_index() train_idv_dpsa_3 = dataset_IDV_DPSA[dataset_IDV_DPSA['DATA_DAT']==3734035200].reset_index() # ç²¾ç®€å­—æ®µ train_idv_dpsa_3 = train_idv_dpsa_3.drop(['DATA_DAT', 'ARG_CRT_DAT', 'CLS_ACCT_DAT', 'MATU_DAT', 'LAC', 'ACCT_STS_CD', 'RAT_CTG', 'CUST_RANK_CD', 'DAY_TFO_SUM', 'MTH_ACT_DAYS_TOT'], axis=1) # å°†IDV_DPSAè¡¨ä¸Žæ±‡çŽ‡è¡¨æ•´åˆ train_IDV_DPSA_SAMPLE_3 = pd.merge(train_idv_dpsa_3, train_base_excg, on = 'CCY_CD') # åŽ»é‡ train_IDV_DPSA_SAMPLE_3.drop_duplicates(subset=None, keep='first', inplace=True) # æ‰§è¡Œæ±‡çŽ‡è®¡ç®—å‡½æ•° train_IDV_DPSA_SAMPLE_3['FRZ_TOT_AMT'] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('FRZ_TOT_AMT', 'RMB_MID_PRIC')) train_IDV_DPSA_SAMPLE_3['DAY_WD_ACT_AMT'] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_WD_ACT_AMT', 'RMB_MID_PRIC')) train_IDV_DPSA_SAMPLE_3['DAY_CSH_DP_SUM'] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_CSH_DP_SUM', 'RMB_MID_PRIC')) train_IDV_DPSA_SAMPLE_3['DAY_CSH_WD_SUM'] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_CSH_WD_SUM', 'RMB_MID_PRIC')) train_IDV_DPSA_SAMPLE_3['DAY_TFI_SUM'] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_TFI_SUM', 'RMB_MID_PRIC')) train_IDV_DPSA_SAMPLE_3['MOTH_CR_ACCM'] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('MOTH_CR_ACCM', 'RMB_MID_PRIC')) train_IDV_DPSA_SAMPLE_3['BEG_MOTH_CRBAL'] = train_IDV_DPSA_SAMPLE_3.apply(compute_REAL_MONEY, axis = 1, args = ('BEG_MOTH_CRBAL', 'RMB_MID_PRIC')) # å†æ¬¡ç²¾ç®€è¡¨ train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3.drop(['CCY_CD', 'RMB_MID_PRIC', 'index'], axis=1) # é¿å…é‡å¤å­—æ®µ train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3.rename(columns=&#123;'CRBAL':'IDV_DPSA_CRBAL', 'MOTH_CR_ACCM':'IDV_DPSA_MOTH_CR_ACCM'&#125;) # æŒ‰ CUST_NO æ±‚å’Œ train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3[['CUST_NO', 'IDV_DPSA_CRBAL', 'ITST_BRNG_ACCM', 'FRZ_TOT_AMT', 'DAY_WD_ACT_AMT', 'DAY_CSH_DP_SUM', 'DAY_CSH_WD_SUM', 'DAY_TFI_SUM', 'IDV_DPSA_MOTH_CR_ACCM', 'BEG_MOTH_CRBAL']].groupby('CUST_NO').sum().reset_index() # @ åŽ»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾ train_IDV_DPSA_SAMPLE_3 = train_IDV_DPSA_SAMPLE_3.drop(['BEG_MOTH_CRBAL', 'IDV_DPSA_MOTH_CR_ACCM'], axis=1) # è¿”å›žç¬¬ä¸‰ä¸ªæ—¶é—´æ®µçš„æ•°æ® return train_IDV_DPSA_SAMPLE_3 äº¤æ˜“ä¿¡æ¯ï¼ˆTR_DCï¼‰ - å¤„ç†1234train_tr_dc_TR_TYPE = train_tr_dc.groupby(['CUST_NO','TR_TYPE'])['TR_TYPE'].count().unstack().reset_index()train_tr_dc_TR_TYPE['TR_TYPE_TIMES'] = train_tr_dc_TR_TYPE.drop('CUST_NO',axis=1).sum(axis=1)train_tr_dc_BOE = train_tr_dc_TR_TYPE[['CUST_NO','TR_TYPE_TIMES','EBMKO5RA']]train_tr_dc_BOE.columns = ['CUST_NO', 'TR_TYPE_TIMES','EBMKO5RA'] 1train_tr_dc_BOE.head() 12345678910111213141516171819202122232425262728293031323334# å£°æ˜Žå‡½æ•°def TR_DC_PARSE(dataset_TR_DC): # åŽ»é™¤æŠ¹å¸(1),æ— æ„ä¹‰åˆ—- RED_BLU_CDï¼Œè¿™é‡Œå…¨æ˜¯0 dataset_TR_DC = dataset_TR_DC[dataset_TR_DC['CAN_IND']==0].drop(['RED_BLU_CD'],axis=1) # å°†äº¤æ˜“æŒ‰ç…§ æ­£ / è´Ÿ åˆ†å¼€ dataset_TR_DC['INCOME'] = dataset_TR_DC['TR_AMT'] &gt; 0 myseries = dataset_TR_DC.groupby(['CUST_NO', 'INCOME'])['TR_AMT'].sum() myseries = myseries.unstack() TR_DC_IN_OUT = pd.DataFrame(myseries).reset_index() TR_DC_IN_OUT['IN_SUM'] = TR_DC_IN_OUT[True] TR_DC_IN_OUT['OUT_SUM'] = TR_DC_IN_OUT[False] TR_DC_IN_OUT = TR_DC_IN_OUT.drop([True, False], axis=1) # æ ¹æ®BOEäº¤æ˜“ä»£ç åˆ’åˆ† ä»…ä½¿ç”¨ EBMKO5RA train_tr_dc_TR_TYPE = dataset_TR_DC.groupby(['CUST_NO','TR_TYPE'])['TR_TYPE'].count().unstack().reset_index() train_tr_dc_TR_TYPE['TR_TYPE_TIMES'] = train_tr_dc_TR_TYPE.drop('CUST_NO',axis=1).sum(axis=1) train_tr_dc_BOE = train_tr_dc_TR_TYPE[['CUST_NO','TR_TYPE_TIMES','EBMKO5RA']] train_tr_dc_BOE.columns = ['CUST_NO', 'TR_TYPE_TIMES','EBMKO5RA'] # æ ¹æ®SVRTOäº¤æ˜“ç åˆ’åˆ† ä½¿ç”¨SVRTO061å’ŒSVRTO161 train_tr_dc_SVRTO061 = train_tr_dc_TR_TYPE[['CUST_NO','SVRTO061']] train_tr_dc_SVRTO161 = train_tr_dc_TR_TYPE[['CUST_NO','SVRTO161']] train_tr_dc_SVRTO061.columns = ['CUST_NO', 'SVRTO061'] train_tr_dc_SVRTO161.columns = ['CUST_NO', 'SVRTO161'] # è®¡ç®—æ¯ç¬”äº¤æ˜“é‡‘é¢çš„å‡å€¼ TR_DC_IN_MEAN = dataset_TR_DC[dataset_TR_DC['TR_AMT']&gt;0][['CUST_NO', 'TR_AMT']].groupby('CUST_NO').mean().reset_index() TR_DC_IN_MEAN.columns = ['CUST_NO', 'TR_DC_IN_MEAN'] TR_DC_OUT_MEAN = dataset_TR_DC[dataset_TR_DC['TR_AMT']&lt;0][['CUST_NO', 'TR_AMT']].groupby('CUST_NO').mean().reset_index() TR_DC_OUT_MEAN.columns = ['CUST_NO', 'TR_DC_OUT_MEAN'] # åˆå¹¶å„ä¸ªç‰¹å¾ 36041 # train_TR_DC_SAMPLE = pd.merge(TR_DC_IN_OUT, train_tr_dc_BOE, on='CUST_NO', how='outer') train_TR_DC_SAMPLE = pd.merge(TR_DC_IN_OUT, TR_DC_IN_MEAN, on='CUST_NO', how='outer') train_TR_DC_SAMPLE = pd.merge(train_TR_DC_SAMPLE, TR_DC_OUT_MEAN, on='CUST_NO', how='outer') # train_TR_DC_SAMPLE = pd.merge(train_TR_DC_SAMPLE, train_tr_dc_SVRTO061, on='CUST_NO', how='outer') # train_TR_DC_SAMPLE = pd.merge(train_TR_DC_SAMPLE, train_tr_dc_SVRTO161, on='CUST_NO', how='outer') return train_TR_DC_SAMPLE ç¬¬ä¸‰æ–¹å­˜ç®¡è´¦æˆ·ä¿¡æ¯ï¼ˆTHR_PTY_CSTDï¼‰ - å¤„ç†123456# æå‰åˆ æŽ‰æ— ç”¨å­—æ®µtrain_thr_pty_cstd_temple = train_thr_pty_cstd.drop(['CCY_CD', 'CUST_CTG_CD', 'MTH_ACT_DAYS_TOT'], axis=1)# åˆ’åˆ†ä¸‰å¼ è¡¨train_thr_pty_cstd_1 = train_thr_pty_cstd_temple[train_thr_pty_cstd_temple['DATA_DAT']==3728764800].reset_index()train_thr_pty_cstd_2 = train_thr_pty_cstd_temple[train_thr_pty_cstd_temple['DATA_DAT']==3731443200].reset_index()train_thr_pty_cstd_3 = train_thr_pty_cstd_temple[train_thr_pty_cstd_temple['DATA_DAT']==3734035200].reset_index() 12345678# æ¸…ç†æ²¡ç”¨å­—æ®µtrain_thr_pty_cstd_3 = train_thr_pty_cstd_3.drop(['index', 'DATA_DAT'], axis=1)# å¯¹å­—æ®µè¿›è¡Œå¤„ç†ARG_BAL = train_thr_pty_cstd_3.groupby(['CUST_NO'])['ARG_BAL'].sum().reset_index()AVL_BAL = train_thr_pty_cstd_3.groupby(['CUST_NO'])['AVL_BAL'].sum().reset_index()MTH_ARG_BAL_ACCM = train_thr_pty_cstd_3.groupby(['CUST_NO'])['MTH_ARG_BAL_ACCM'].sum().reset_index()MTH_FUD_TF_INWD_AMT = train_thr_pty_cstd_3.groupby(['CUST_NO'])['MTH_FUD_TF_INWD_AMT'].sum().reset_index()MTH_FUD_TF_OUT_AMT = train_thr_pty_cstd_3.groupby(['CUST_NO'])['MTH_FUD_TF_OUT_AMT'].sum().reset_index() 12345# å°†å­—æ®µåˆå¹¶train_thr_pty_cstd_SAMPLE = pd.merge(ARG_BAL, AVL_BAL, on='CUST_NO', how='outer')train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_ARG_BAL_ACCM, on='CUST_NO', how='outer')train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_INWD_AMT, on='CUST_NO', how='outer')train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_OUT_AMT, on='CUST_NO', how='outer') 12# @ åŽ»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾train_thr_pty_cstd_SAMPLE = train_thr_pty_cstd_SAMPLE.drop(['ARG_BAL', 'MTH_ARG_BAL_ACCM'], axis=1) 12345678910111213141516171819202122232425# å£°æ˜Žå‡½æ•°def THR_PTY_CSTD_PARSE(dataset_THR_PTY_CSTD): # æå‰åˆ æŽ‰æ— ç”¨å­—æ®µ dataset_THR_PTY_CSTD = dataset_THR_PTY_CSTD.drop(['CCY_CD', 'CUST_CTG_CD', 'MTH_ACT_DAYS_TOT'], axis=1) # åˆ’åˆ†ä¸‰å¼ è¡¨ train_thr_pty_cstd_1 = dataset_THR_PTY_CSTD[dataset_THR_PTY_CSTD['DATA_DAT']==3728764800].reset_index() train_thr_pty_cstd_2 = dataset_THR_PTY_CSTD[dataset_THR_PTY_CSTD['DATA_DAT']==3731443200].reset_index() train_thr_pty_cstd_3 = dataset_THR_PTY_CSTD[dataset_THR_PTY_CSTD['DATA_DAT']==3734035200].reset_index() # æ¸…ç†æ²¡ç”¨å­—æ®µ train_thr_pty_cstd_3 = train_thr_pty_cstd_3.drop(['index', 'DATA_DAT'], axis=1) # å¯¹å­—æ®µè¿›è¡Œå¤„ç† ARG_BAL = train_thr_pty_cstd_3.groupby(['CUST_NO'])['ARG_BAL'].sum().reset_index() AVL_BAL = train_thr_pty_cstd_3.groupby(['CUST_NO'])['AVL_BAL'].sum().reset_index() MTH_ARG_BAL_ACCM = train_thr_pty_cstd_3.groupby(['CUST_NO'])['MTH_ARG_BAL_ACCM'].sum().reset_index() MTH_FUD_TF_INWD_AMT = train_thr_pty_cstd_3.groupby(['CUST_NO'])['MTH_FUD_TF_INWD_AMT'].sum().reset_index() MTH_FUD_TF_OUT_AMT = train_thr_pty_cstd_3.groupby(['CUST_NO'])['MTH_FUD_TF_OUT_AMT'].sum().reset_index() # å°†å­—æ®µåˆå¹¶ train_thr_pty_cstd_SAMPLE = pd.merge(AVL_BAL, ARG_BAL, on='CUST_NO', how='outer') train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_ARG_BAL_ACCM, on='CUST_NO', how='outer') train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_INWD_AMT, on='CUST_NO', how='outer') train_thr_pty_cstd_SAMPLE = pd.merge(train_thr_pty_cstd_SAMPLE, MTH_FUD_TF_OUT_AMT, on='CUST_NO', how='outer') # @ åŽ»é™¤è¿‡åˆ†å…³è”çš„ç‰¹å¾ train_thr_pty_cstd_SAMPLE = train_thr_pty_cstd_SAMPLE.drop(['ARG_BAL', 'MTH_ARG_BAL_ACCM'], axis=1) return train_thr_pty_cstd_SAMPLE è´·æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆLOANï¼‰- å¤„ç†123456789# é€‰æ‹©æœ‰ç”¨å­—æ®µtrain_loan_temple = train_loan[['CUST_NO', 'DATA_DAT', 'ARG_TYP_CD', 'CCY_CD', 'ARG_LIF_CYC_STA_CD', 'LN_STS_CD', 'CHANL_CD', 'LN_TERM', 'RPAY_MOD_CD', 'LAC', 'NON_MATU_CAP', 'ACD_NML_INTS', 'INTS_TOT_AMT' , 'BUS_BREED_CD', 'NML_CAP_BAL', 'MTH_NML_CAP_ACCM']]train_loan_temple = pd.merge(train_loan_temple, train_base_excg, on = 'CCY_CD')# åˆ’åˆ†ä¸‰å¼ è¡¨train_loan_1 = train_loan_temple[train_loan_temple['DATA_DAT']==3728764800]train_loan_2 = train_loan_temple[train_loan_temple['DATA_DAT']==3731443200]train_loan_3 = train_loan_temple[train_loan_temple['DATA_DAT']==3734035200]train_loan_3 = train_loan_3.drop(['DATA_DAT'], axis=1) 1train_loan_3.drop_duplicates(subset=None, keep='first', inplace=True) 123456# æ‰§è¡Œæ±‡çŽ‡è®¡ç®—å‡½æ•°train_loan_3['ACD_NML_INTS'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('ACD_NML_INTS', 'RMB_MID_PRIC'))train_loan_3['NON_MATU_CAP'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('NON_MATU_CAP', 'RMB_MID_PRIC'))train_loan_3['NML_CAP_BAL'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('NML_CAP_BAL', 'RMB_MID_PRIC'))train_loan_3['INTS_TOT_AMT'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('INTS_TOT_AMT', 'RMB_MID_PRIC'))train_loan_3['MTH_NML_CAP_ACCM'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('MTH_NML_CAP_ACCM', 'RMB_MID_PRIC')) 123456789101112# å¹³å‡åº”è®¡æ­£å¸¸åˆ©æ¯MEAN_ACD_NML_INTS = train_loan_3[['CUST_NO', 'ACD_NML_INTS']].groupby(['CUST_NO']).mean().reset_index()# å¹³å‡åº”è®¡æœªåˆ°æœŸæœ¬é‡‘MEAN_NON_MATU_CAP = train_loan_3[['CUST_NO', 'NON_MATU_CAP']].groupby(['CUST_NO']).mean().reset_index()# å¹³å‡æœˆå†…æ­£å¸¸æœ¬é‡‘åŸºæ•°MEAN_MTH_NML_CAP_ACCM = train_loan_3[['CUST_NO','MTH_NML_CAP_ACCM']].groupby(['CUST_NO']).mean().reset_index()# å¹³å‡è´·æ¬¾æœŸé™MEAN_LOAN_TERM = train_loan_3[['CUST_NO','LN_TERM']].groupby(['CUST_NO']).mean().reset_index()# å¹³å‡è´·æ¬¾é‡‘é¢MEAN_NML_CAP_BAL = train_loan_3[['CUST_NO', 'NML_CAP_BAL']].groupby(['CUST_NO']).mean().reset_index()# å¹³å‡åˆ©æ¯æ€»é¢MEAN_INTS_TOT_AMT = train_loan_3[['CUST_NO', 'INTS_TOT_AMT']].groupby(['CUST_NO']).mean().reset_index() 12train_loan_3_SAMPLE = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(MEAN_ACD_NML_INTS, MEAN_NON_MATU_CAP, on='CUST_NO', how='outer'), MEAN_MTH_NML_CAP_ACCM, on='CUST_NO', how='outer'), MEAN_LOAN_TERM, on='CUST_NO', how='outer'), MEAN_NML_CAP_BAL, on='CUST_NO', how='outer'), MEAN_INTS_TOT_AMT, on='CUST_NO', how='outer') 1234567891011121314151617181920212223242526272829303132def BY_MONTH_LOAN_METHOD(dataset_LOAN): # é€‰æ‹©æœ‰ç”¨å­—æ®µ train_loan_temple = dataset_LOAN[['CUST_NO', 'DATA_DAT', 'ARG_TYP_CD', 'CCY_CD', 'ARG_LIF_CYC_STA_CD', 'LN_STS_CD', 'CHANL_CD', 'LN_TERM', 'RPAY_MOD_CD', 'LAC', 'NON_MATU_CAP', 'ACD_NML_INTS', 'INTS_TOT_AMT' , 'BUS_BREED_CD', 'NML_CAP_BAL', 'MTH_NML_CAP_ACCM']] train_loan_temple = pd.merge(train_loan_temple, train_base_excg, on = 'CCY_CD') # åˆ’åˆ†ä¸‰å¼ è¡¨ train_loan_1 = train_loan_temple[train_loan_temple['DATA_DAT']==3728764800] train_loan_2 = train_loan_temple[train_loan_temple['DATA_DAT']==3731443200] train_loan_3 = train_loan_temple[train_loan_temple['DATA_DAT']==3734035200] train_loan_3 = train_loan_3.drop(['DATA_DAT'], axis=1) train_loan_3.drop_duplicates(subset=None, keep='first', inplace=True) # æ‰§è¡Œæ±‡çŽ‡è®¡ç®—å‡½æ•° train_loan_3['ACD_NML_INTS'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('ACD_NML_INTS', 'RMB_MID_PRIC')) train_loan_3['NON_MATU_CAP'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('NON_MATU_CAP', 'RMB_MID_PRIC')) train_loan_3['NML_CAP_BAL'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('NML_CAP_BAL', 'RMB_MID_PRIC')) train_loan_3['INTS_TOT_AMT'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('INTS_TOT_AMT', 'RMB_MID_PRIC')) train_loan_3['MTH_NML_CAP_ACCM'] = train_loan_3.apply(compute_REAL_MONEY, axis = 1, args = ('MTH_NML_CAP_ACCM', 'RMB_MID_PRIC')) # å¹³å‡åº”è®¡æ­£å¸¸åˆ©æ¯ MEAN_ACD_NML_INTS = train_loan_3[['CUST_NO', 'ACD_NML_INTS']].groupby(['CUST_NO']).mean().reset_index() # å¹³å‡åº”è®¡æœªåˆ°æœŸæœ¬é‡‘ MEAN_NON_MATU_CAP = train_loan_3[['CUST_NO', 'NON_MATU_CAP']].groupby(['CUST_NO']).mean().reset_index() # å¹³å‡æœˆå†…æ­£å¸¸æœ¬é‡‘åŸºæ•° MEAN_MTH_NML_CAP_ACCM = train_loan_3[['CUST_NO','MTH_NML_CAP_ACCM']].groupby(['CUST_NO']).mean().reset_index() # å¹³å‡è´·æ¬¾æœŸé™ MEAN_LOAN_TERM = train_loan_3[['CUST_NO','LN_TERM']].groupby(['CUST_NO']).mean().reset_index() # å¹³å‡è´·æ¬¾é‡‘é¢ MEAN_NML_CAP_BAL = train_loan_3[['CUST_NO', 'NML_CAP_BAL']].groupby(['CUST_NO']).mean().reset_index() # å¹³å‡åˆ©æ¯æ€»é¢ MEAN_INTS_TOT_AMT = train_loan_3[['CUST_NO', 'INTS_TOT_AMT']].groupby(['CUST_NO']).mean().reset_index() train_loan_3_SAMPLE = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(MEAN_ACD_NML_INTS, MEAN_NON_MATU_CAP, on='CUST_NO', how='outer'), MEAN_MTH_NML_CAP_ACCM, on='CUST_NO', how='outer'), MEAN_LOAN_TERM, on='CUST_NO', how='outer'), MEAN_NML_CAP_BAL, on='CUST_NO', how='outer'), MEAN_INTS_TOT_AMT, on='CUST_NO', how='outer') return train_loan_3_SAMPLE åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰- å¤„ç†123456789101112131415161718192021222324252627282930313233343536373839def BY_MONTH_FUND_METHOD(dataset_FOUND): # é¢„å¤„ç† train_fund_temple = dataset_FOUND.drop(['CCY_CD', 'ARG_CRT_DAT', 'ARG_LIF_CYC_STA_CD', 'CHANL_CD', 'VLU_DAT', 'DATE_MATU', 'CLS_ACCT_DAT', 'LAST_ACT_CHNG_DAT', 'MTH_ACT_DAYS_TOT'], axis=1) # æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„ BY_MONTH_FUND_TABLE = train_fund_temple.groupby(['CUST_NO', 'DATA_DAT'])[['FUD_UNIT_NET_VAL', 'FUD_PROD_TYP_CD', 'RSK_RANK_CD', 'SHR', 'MOTH_BAL_ACCM', 'FUND_BAL', 'FUND_BAL_MOTH_BAL_ACCM']].sum().unstack() # å£°æ˜Žå‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ def BY_MONTH_FUND(key): train_fund_temple_STD = BY_MONTH_FUND_TABLE[key].std(axis=1).reset_index() train_fund_temple_STD.columns = ['CUST_NO', str('FUND_'+key+'_STD')] train_fund_temple_MEAN = BY_MONTH_FUND_TABLE[key].mean(axis=1).reset_index() train_fund_temple_MEAN.columns = ['CUST_NO',str('FUND_'+key+'_MEAN')] train_fund_temple_MAX = BY_MONTH_FUND_TABLE[key].max(axis=1).reset_index() train_fund_temple_MAX.columns = ['CUST_NO',str('FUND_'+key+'_MAX')] train_fund_temple_MIN = BY_MONTH_FUND_TABLE[key].min(axis=1).reset_index() train_fund_temple_MIN.columns = ['CUST_NO',str('FUND_'+key+'_MIN')] # åˆå¹¶å­—æ®µ train_fund_temple = pd.merge(train_fund_temple_STD, train_fund_temple_MEAN, on='CUST_NO', how='inner') train_fund_temple = pd.merge(train_fund_temple, train_fund_temple_MAX, on='CUST_NO', how='inner') train_fund_temple = pd.merge(train_fund_temple, train_fund_temple_MIN, on='CUST_NO', how='inner') return train_fund_temple train_fund_temple = BY_MONTH_FUND('RSK_RANK_CD') for key in ['FUD_UNIT_NET_VAL', 'FUD_PROD_TYP_CD', 'SHR', 'MOTH_BAL_ACCM', 'FUND_BAL', 'FUND_BAL_MOTH_BAL_ACCM']: train_fund_temple = pd.merge(train_fund_temple, BY_MONTH_FUND(key)) train_fund_temple.drop_duplicates(subset=None, keep='first', inplace=True) # å®šç”³å®šèµŽ å¼€é€šæ ‡è¯† SUM_FUND_RATN_APLY_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_APLY_OPN_IND']].groupby(['CUST_NO']).sum().reset_index() STD_FUND_RATN_APLY_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_APLY_OPN_IND']].groupby(['CUST_NO']).std().reset_index() MEAN_FUND_RATN_APLY_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_APLY_OPN_IND']].groupby(['CUST_NO']).mean().reset_index() MAX_FUND_RATN_APLY_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_APLY_OPN_IND']].groupby(['CUST_NO']).max().reset_index() MIN_FUND_RATN_APLY_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_APLY_OPN_IND']].groupby(['CUST_NO']).min().reset_index() SUM_FUND_RATN_REDM_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_REDM_OPN_IND']].groupby(['CUST_NO']).sum().reset_index() STD_FUND_RATN_REDM_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_REDM_OPN_IND']].groupby(['CUST_NO']).std().reset_index() MEAN_FUND_RATN_REDM_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_REDM_OPN_IND']].groupby(['CUST_NO']).mean().reset_index() MAX_FUND_RATN_REDM_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_REDM_OPN_IND']].groupby(['CUST_NO']).max().reset_index() MIN_FUND_RATN_REDM_OPN_IND = dataset_FOUND[['CUST_NO', 'RATN_REDM_OPN_IND']].groupby(['CUST_NO']).min().reset_index() train_fund_temple = pd.merge(pd.merge(train_fund_temple, STD_FUND_RATN_APLY_OPN_IND, on='CUST_NO', how='outer'), MIN_FUND_RATN_REDM_OPN_IND, on='CUST_NO', how='outer') return train_fund_temple å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰- å¤„ç†1234567891011121314151617181920212223242526def BY_MONTH_BOND_METHOD(dataset_BOND): # é¢„å¤„ç† train_bond_temple = dataset_BOND.drop(['CCY_CD', 'ARG_CRT_DAT', 'MATU_DAT', 'MATU_DAT', 'PROD_CLS_CD', 'CERT_DAT', 'CLS_ACCT_DAT', 'ARG_LIF_CYC_STA_CD', 'NTNL_DEBT_INTS_TYP_CD', 'MTH_ACT_DAYS_TOT'], axis=1) # æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„ BY_MONTH_BOND_TABLE = train_bond_temple.groupby(['CUST_NO', 'DATA_DAT'])[['BOND_TERM_CD', 'ARG_CUR_BAL', 'HOD_SHR', 'UNIT_NET_VAL', 'NVTA_MOTH_ACCM']].sum().unstack() # å£°æ˜Žå‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ def BY_MONTH_BOND(key): train_bond_temple_STD = BY_MONTH_BOND_TABLE[key].std(axis=1).reset_index() train_bond_temple_STD.columns = ['CUST_NO', str('BOND_'+key+'_STD')] train_bond_temple_MEAN = BY_MONTH_BOND_TABLE[key].mean(axis=1).reset_index() train_bond_temple_MEAN.columns = ['CUST_NO',str('BOND_'+key+'_MEAN')] train_bond_temple_MAX = BY_MONTH_BOND_TABLE[key].max(axis=1).reset_index() train_bond_temple_MAX.columns = ['CUST_NO',str('BOND_'+key+'_MAX')] train_bond_temple_MIN = BY_MONTH_BOND_TABLE[key].min(axis=1).reset_index() train_bond_temple_MIN.columns = ['CUST_NO',str('BOND_'+key+'_MIN')] # åˆå¹¶å­—æ®µ train_bond_temple = pd.merge(train_bond_temple_STD, train_bond_temple_MEAN, on='CUST_NO', how='inner') train_bond_temple = pd.merge(train_bond_temple, train_bond_temple_MAX, on='CUST_NO', how='inner') train_bond_temple = pd.merge(train_bond_temple, train_bond_temple_MIN, on='CUST_NO', how='inner') return train_bond_temple train_bond_temple = BY_MONTH_BOND('BOND_TERM_CD') for key in ['ARG_CUR_BAL', 'HOD_SHR', 'UNIT_NET_VAL', 'NVTA_MOTH_ACCM']: train_bond_temple = pd.merge(train_bond_temple, BY_MONTH_BOND(key)) train_bond_temple.drop_duplicates(subset=None, keep='first', inplace=True) return train_bond_temple è´µé‡‘å±žè´¦æˆ·ä¿¡æ¯ï¼ˆPREC_METALï¼‰- å¤„ç†12345678910111213141516171819202122232425262728293031def BY_MONTH_PREC_METAL_METHOD(dataset_PREC_METAL): # é¢„å¤„ç† train_prec_metal_temple = dataset_PREC_METAL.drop(['PREC_METAL_BREED_CD', 'ARG_STS_CD', 'SIGD_DAT', 'SIGD_CHANL_CD', 'TEMN_DAT', 'TEMN_CHANL_CD', 'MTH_ACT_DAYS_TOT'], axis=1) # å°†train_prec_metalå’Œtrain_base_excgåˆå¹¶ train_prec_metal_temple = pd.merge(train_prec_metal_temple, train_base_excg, on = 'CCY_CD') # æ‰§è¡Œæ±‡çŽ‡è®¡ç®—å‡½æ•° train_prec_metal_temple['ARG_BAL'] = train_prec_metal_temple.apply(compute_REAL_MONEY, axis = 1, args = ('ARG_BAL', 'RMB_MID_PRIC')) # æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„ BY_MONTH_PREC_METAL_TABLE = train_prec_metal_temple.groupby(['CUST_NO', 'DATA_DAT'])[['BUS_CTG_CD', 'CNT', 'ARG_BAL', 'MTH_ARG_ACCM']].sum().unstack() # å£°æ˜Žå‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ def BY_MONTH_PREC_METAL(key): train_prec_metal_temple_STD = BY_MONTH_PREC_METAL_TABLE[key].std(axis=1).reset_index() train_prec_metal_temple_STD.columns = ['CUST_NO', str('PREC_METAL_'+key+'_STD')] train_prec_metal_temple_MEAN = BY_MONTH_PREC_METAL_TABLE[key].mean(axis=1).reset_index() train_prec_metal_temple_MEAN.columns = ['CUST_NO',str('PREC_METAL_'+key+'_MEAN')] train_prec_metal_temple_MAX = BY_MONTH_PREC_METAL_TABLE[key].max(axis=1).reset_index() train_prec_metal_temple_MAX.columns = ['CUST_NO',str('PREC_METAL_'+key+'_MAX')] train_prec_metal_temple_MIN = BY_MONTH_PREC_METAL_TABLE[key].min(axis=1).reset_index() train_prec_metal_temple_MIN.columns = ['CUST_NO',str('PREC_METAL_'+key+'_MIN')] # åˆå¹¶å­—æ®µ train_prec_metal_temple = pd.merge(train_prec_metal_temple_STD, train_prec_metal_temple_MEAN, on='CUST_NO', how='inner') train_prec_metal_temple = pd.merge(train_prec_metal_temple, train_prec_metal_temple_MAX, on='CUST_NO', how='inner') train_prec_metal_temple = pd.merge(train_prec_metal_temple, train_prec_metal_temple_MIN, on='CUST_NO', how='inner') return train_prec_metal_temple train_prec_metal_temple = BY_MONTH_PREC_METAL('BUS_CTG_CD') for key in ['CNT', 'ARG_BAL', 'MTH_ARG_ACCM']: train_prec_metal_temple = pd.merge(train_prec_metal_temple, BY_MONTH_PREC_METAL(key)) train_prec_metal_temple.drop_duplicates(subset=None, keep='first', inplace=True) return train_prec_metal_temple ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET_INSRï¼‰- å¤„ç†1234567891011121314151617181920212223242526def BY_MONTH_AGET_INSR_METHOD(dataset_AGET_INSR): # é¢„å¤„ç† train_aget_insr_temple = dataset_AGET_INSR[['DATA_DAT', 'CUST_NO', 'PREM', 'CVAG', 'INSE_CNT', 'MTH_PREM_ACCM', 'BEG_MTH_PREM_BAL']] # æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„ BY_MONTH_AGET_INSR_TABLE = train_aget_insr_temple.groupby(['CUST_NO', 'DATA_DAT'])[['PREM', 'CVAG', 'INSE_CNT', 'MTH_PREM_ACCM', 'BEG_MTH_PREM_BAL']].sum().unstack() # å£°æ˜Žå‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ def BY_MONTH_AGET_INSR(key): train_aget_insr_temple_STD = BY_MONTH_AGET_INSR_TABLE[key].std(axis=1).reset_index() train_aget_insr_temple_STD.columns = ['CUST_NO', str('AGET_INSR_'+key+'_STD')] train_aget_insr_temple_MEAN = BY_MONTH_AGET_INSR_TABLE[key].mean(axis=1).reset_index() train_aget_insr_temple_MEAN.columns = ['CUST_NO',str('AGET_INSR_'+key+'_MEAN')] train_aget_insr_temple_MAX = BY_MONTH_AGET_INSR_TABLE[key].max(axis=1).reset_index() train_aget_insr_temple_MAX.columns = ['CUST_NO',str('AGET_INSR_'+key+'_MAX')] train_aget_insr_temple_MIN = BY_MONTH_AGET_INSR_TABLE[key].min(axis=1).reset_index() train_aget_insr_temple_MIN.columns = ['CUST_NO',str('AGET_INSR_'+key+'_MIN')] # åˆå¹¶å­—æ®µ train_aget_insr_temple = pd.merge(train_aget_insr_temple_STD, train_aget_insr_temple_MEAN, on='CUST_NO', how='inner') train_aget_insr_temple = pd.merge(train_aget_insr_temple, train_aget_insr_temple_MAX, on='CUST_NO', how='inner') train_aget_insr_temple = pd.merge(train_aget_insr_temple, train_aget_insr_temple_MIN, on='CUST_NO', how='inner') return train_aget_insr_temple train_aget_insr_temple = BY_MONTH_AGET_INSR('PREM') for key in ['CVAG', 'INSE_CNT', 'MTH_PREM_ACCM', 'BEG_MTH_PREM_BAL']: train_aget_insr_temple = pd.merge(train_aget_insr_temple, BY_MONTH_AGET_INSR(key)) train_aget_insr_temple.drop_duplicates(subset=None, keep='first', inplace=True) return train_aget_insr_temple è¡¨é—´èžåˆTRAINé›†123456789101112131415# train é›† 38256dataset_train = pd.merge(IDV_CUST_BASIC_PARSE(CALC_AGE(train_idv_cust_basic)), IDV_TD_PARSE(train_idv_td), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, IDV_DPSA_PARSE(train_idv_dpsa), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, TR_DC_PARSE(train_tr_dc), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_IDV_TD_METHOD(train_idv_td), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_IDV_DPSA_METHOD(train_idv_dpsa), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_TR_DC_METHOD(train_tr_dc), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, THR_PTY_CSTD_PARSE(train_thr_pty_cstd), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_LOAN_METHOD(train_loan), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_FUND_METHOD(train_fund), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_BOND_METHOD(train_bond), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_PREC_METAL_METHOD(train_prec_metal), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, BY_MONTH_AGET_INSR_METHOD(train_aget_insr), on='CUST_NO', how='outer')dataset_train = pd.merge(dataset_train, AUM_NUMS(train_idv_td, train_bond, train_fund, train_prec_metal, train_aget_insr, train_idv_cust_basic), on='CUST_NO', how='outer')dataset_train = pd.merge(WEALTH(train_cust_result,train_idv_td,train_bond,train_fund,train_prec_metal,train_aget_insr,train_thr_pty_cstd), dataset_train, on='CUST_NO', how='outer') /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:20: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:26: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy /root/anaconda3/lib/python3.6/site-packages/pandas/core/reshape/merge.py:558: UserWarning: merging between different levels can give an unintended result (1 levels on the left, 2 on the right) warnings.warn(msg, UserWarning) /root/anaconda3/lib/python3.6/site-packages/pandas/core/generic.py:2530: PerformanceWarning: dropping on a non-lexsorted multi-index without a level parameter may impact performance. obj = obj._drop_axis(labels, axis, level=level, errors=errors)12# å°†ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨ä¸Žç»“æžœæ•´åˆdataset_train = pd.merge(dataset_train, train_cust_result, on='CUST_NO') TRAIN å‰ªæž12# åˆ é™¤æ— ç”¨å­—æ®µdataset_train = dataset_train.drop(['CUST_NO'], axis=1) Aé›†123456789101112131415# A é›† 4782dataset_A = pd.merge(IDV_CUST_BASIC_PARSE(CALC_AGE(A_idv_cust_basic)), IDV_TD_PARSE(A_idv_td), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, IDV_DPSA_PARSE(A_idv_dpsa), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, TR_DC_PARSE(A_tr_dc), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_IDV_TD_METHOD(A_idv_td), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_IDV_DPSA_METHOD(A_idv_dpsa), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_TR_DC_METHOD(A_tr_dc), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, THR_PTY_CSTD_PARSE(A_thr_pty_cstd), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_LOAN_METHOD(A_loan), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_FUND_METHOD(A_fund), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_BOND_METHOD(A_bond), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_PREC_METAL_METHOD(A_prec_metal), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, BY_MONTH_AGET_INSR_METHOD(A_aget_insr), on='CUST_NO', how='outer')dataset_A = pd.merge(dataset_A, AUM_NUMS(A_idv_td, A_bond, A_fund, A_prec_metal, A_aget_insr, A_idv_cust_basic), on='CUST_NO', how='outer')dataset_A = pd.merge(WEALTH(A_customid,A_idv_td,A_bond,A_fund,A_prec_metal,A_aget_insr,A_thr_pty_cstd), dataset_A, on='CUST_NO', how='outer') /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:20: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:26: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy /root/anaconda3/lib/python3.6/site-packages/pandas/core/reshape/merge.py:558: UserWarning: merging between different levels can give an unintended result (1 levels on the left, 2 on the right) warnings.warn(msg, UserWarning) /root/anaconda3/lib/python3.6/site-packages/pandas/core/generic.py:2530: PerformanceWarning: dropping on a non-lexsorted multi-index without a level parameter may impact performance. obj = obj._drop_axis(labels, axis, level=level, errors=errors)A å‰ªæž12# åˆ é™¤æ— ç”¨å­—æ®µdataset_A = dataset_A.drop(['CUST_NO'], axis=1) Bé›†123456789101112131415# A é›† 4782dataset_B = pd.merge(IDV_CUST_BASIC_PARSE(CALC_AGE(B_idv_cust_basic)), IDV_TD_PARSE(B_idv_td), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, IDV_DPSA_PARSE(B_idv_dpsa), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, TR_DC_PARSE(B_tr_dc), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_IDV_TD_METHOD(B_idv_td), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_IDV_DPSA_METHOD(B_idv_dpsa), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_TR_DC_METHOD(B_tr_dc), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, THR_PTY_CSTD_PARSE(B_thr_pty_cstd), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_LOAN_METHOD(B_loan), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_FUND_METHOD(B_fund), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_BOND_METHOD(B_bond), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_PREC_METAL_METHOD(B_prec_metal), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, BY_MONTH_AGET_INSR_METHOD(B_aget_insr), on='CUST_NO', how='outer')dataset_B = pd.merge(dataset_B, AUM_NUMS(B_idv_td, B_bond, B_fund, B_prec_metal, B_aget_insr, B_idv_cust_basic), on='CUST_NO', how='outer')dataset_B = pd.merge(WEALTH(B_customid,B_idv_td,B_bond,B_fund,B_prec_metal,B_aget_insr,B_thr_pty_cstd), dataset_B, on='CUST_NO', how='outer') /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:20: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:26: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy /root/anaconda3/lib/python3.6/site-packages/pandas/core/reshape/merge.py:558: UserWarning: merging between different levels can give an unintended result (1 levels on the left, 2 on the right) warnings.warn(msg, UserWarning) /root/anaconda3/lib/python3.6/site-packages/pandas/core/generic.py:2530: PerformanceWarning: dropping on a non-lexsorted multi-index without a level parameter may impact performance. obj = obj._drop_axis(labels, axis, level=level, errors=errors)Bé›†å‰ªæž12# åˆ é™¤æ— ç”¨å­—æ®µdataset_B = dataset_B.drop(['CUST_NO'], axis=1) æ¬ é‡‡æ ·1train_SAMPLE = pd.concat([dataset_train[dataset_train['FLAG']==0].sample(frac=0.20),dataset_train[dataset_train['FLAG']==1]],axis=0).sample(frac=1.0) ç®—æ³•åˆ†æž12345678910111213141516171819202122232425262728293031import numpy as np import pandas as pd import xgboost as xgb import time from sklearn.model_selection import StratifiedKFold from sklearn.model_selection import train_test_splitfrom imblearn.over_sampling import SMOTEfrom sklearn.model_selection import GridSearchCV# æž„å»ºç‰¹å¾ #X = dataset_train.drop(['FLAG'],axis=1).fillna(0)#y = dataset_train['FLAG']X = train_SAMPLE.drop(['FLAG'],axis=1).fillna(0)y = train_SAMPLE['FLAG']# X = dataset_train_SAMPLE.drop(['FLAG'],axis=1)# y = dataset_train_SAMPLE['FLAG'] # ç”¨sklearn.cross_validationè¿›è¡Œè®­ç»ƒæ•°æ®é›†åˆ’åˆ†X, val_X, y, val_y = train_test_split( X, y, test_size=0.01, #test_size=0.125, random_state=2020, )# SMOTEè¿‡é‡‡æ ·# smo = SMOTE(random_state=2019)# X_smo, y_smo = smo.fit_sample(X, y)# X_smo = pd.DataFrame(X_smo)# X_smo.columns=['XXX'] 123456789101112131415161718192021222324import numpy as np import pandas as pd import xgboost as xgb import time from sklearn.model_selection import StratifiedKFold from sklearn.model_selection import train_test_splitfrom imblearn.over_sampling import SMOTEfrom sklearn.model_selection import GridSearchCV# æž„å»ºç‰¹å¾ X = dataset_train.drop(['FLAG'],axis=1).fillna(0)y = dataset_train['FLAG'] # ç”¨sklearn.cross_validationè¿›è¡Œè®­ç»ƒæ•°æ®é›†åˆ’åˆ†X, val_X, y, val_y = train_test_split( X, y, test_size=0.125, random_state=2019, )train_REAL = pd.concat([X,y],axis=1)train_REAL = pd.concat([train_REAL[train_REAL['FLAG']==0].sample(frac=0.20),train_REAL[train_REAL['FLAG']==1]],axis=0).sample(frac=1.0)X = train_REAL.drop(['FLAG'],axis=1)y = train_REAL['FLAG'] XGBç®—æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243# xgbçŸ©é˜µèµ‹å€¼ xgb_val = xgb.DMatrix(val_X, label=val_y) # xgb_train = xgb.DMatrix(X_smo, label=y_smo)xgb_train = xgb.DMatrix(X, label=y) # xgboostæ¨¡åž‹#params = &#123; 'booster': 'gbtree', # 'objective': 'multi:softmax', # å¤šåˆ†ç±»çš„é—®é¢˜ã€ # 'objective': 'multi:softprob', # å¤šåˆ†ç±»æ¦‚çŽ‡ 'objective': 'binary:logistic', 'eval_metric': 'logloss', # 'num_class': 9, # ç±»åˆ«æ•°ï¼Œä¸Ž multisoftmax å¹¶ç”¨ 'gamma': 0.1, # ç”¨äºŽæŽ§åˆ¶æ˜¯å¦åŽå‰ªæžçš„å‚æ•°,è¶Šå¤§è¶Šä¿å®ˆï¼Œä¸€èˆ¬0.1ã€0.2è¿™æ ·å­ã€‚ 'max_depth': 5, # æž„å»ºæ ‘çš„æ·±åº¦ï¼Œè¶Šå¤§è¶Šå®¹æ˜“è¿‡æ‹Ÿåˆ 'alpha': 0, # L1æ­£åˆ™åŒ–ç³»æ•° 'lambda': 8, # æŽ§åˆ¶æ¨¡åž‹å¤æ‚åº¦çš„æƒé‡å€¼çš„L2æ­£åˆ™åŒ–é¡¹å‚æ•°ï¼Œå‚æ•°è¶Šå¤§ï¼Œæ¨¡åž‹è¶Šä¸å®¹æ˜“è¿‡æ‹Ÿåˆã€‚ 'subsample': 1, # éšæœºé‡‡æ ·è®­ç»ƒæ ·æœ¬ 'colsample_bytree': 0.6, # ç”Ÿæˆæ ‘æ—¶è¿›è¡Œçš„åˆ—é‡‡æ · 'min_child_weight': 3, # è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯ 1ï¼Œæ˜¯æ¯ä¸ªå¶å­é‡Œé¢ h çš„å’Œè‡³å°‘æ˜¯å¤šå°‘ï¼Œå¯¹æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡æ—¶çš„ 0-1 åˆ†ç±»è€Œè¨€ # ï¼Œå‡è®¾ h åœ¨ 0.01 é™„è¿‘ï¼Œmin_child_weight ä¸º 1 æ„å‘³ç€å¶å­èŠ‚ç‚¹ä¸­æœ€å°‘éœ€è¦åŒ…å« 100 ä¸ªæ ·æœ¬ã€‚ # è¿™ä¸ªå‚æ•°éžå¸¸å½±å“ç»“æžœï¼ŒæŽ§åˆ¶å¶å­èŠ‚ç‚¹ä¸­äºŒé˜¶å¯¼çš„å’Œçš„æœ€å°å€¼ï¼Œè¯¥å‚æ•°å€¼è¶Šå°ï¼Œè¶Šå®¹æ˜“ overfittingã€‚ 'silent': 0, # è®¾ç½®æˆ1åˆ™æ²¡æœ‰è¿è¡Œä¿¡æ¯è¾“å‡ºï¼Œæœ€å¥½æ˜¯è®¾ç½®ä¸º0. 'eta': 0.01 , #'eta': 0.1, # å¦‚åŒå­¦ä¹ çŽ‡ - result 0.554455 'seed': 1000, 'nthread': 24, # cpu çº¿ç¨‹æ•° 'missing': 1, 'scale_pos_weight': (np.sum(y==0)/np.sum(y==1)) # ç”¨æ¥å¤„ç†æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡çš„é—®é¢˜,é€šå¸¸å–ï¼šsum(negative cases) / sum(positive cases) # 'eval_metric': 'auc' &#125;plst = list(params.items()) num_rounds = 30000 # è¿­ä»£æ¬¡æ•° watchlist = [(xgb_train, 'train'), (xgb_val, 'val')] # äº¤å‰éªŒè¯ result = xgb.cv(plst, xgb_train, num_boost_round=200, nfold=4, early_stopping_rounds=200, verbose_eval=True, folds=StratifiedKFold(n_splits=4).split(X, y)) # è®­ç»ƒæ¨¡åž‹å¹¶ä¿å­˜ # early_stopping_rounds å½“è®¾ç½®çš„è¿­ä»£æ¬¡æ•°è¾ƒå¤§æ—¶ï¼Œearly_stopping_rounds å¯åœ¨ä¸€å®šçš„è¿­ä»£æ¬¡æ•°å†…å‡†ç¡®çŽ‡æ²¡æœ‰æå‡å°±åœæ­¢è®­ç»ƒ model = xgb.train(plst, xgb_train, num_rounds, watchlist, early_stopping_rounds=400) 12# æ¨¡åž‹ä¿å­˜model.save_model('./leezy_xgb.model') # ç”¨äºŽå­˜å‚¨è®­ç»ƒå‡ºçš„æ¨¡åž‹ 12345678910111213# è¯»å–æ¨¡åž‹# model = xgb.Booster(model_file='5903-xgb.model')# æœ¬åœ°éªŒè¯xgb_test = xgb.DMatrix(val_X) preds = model.predict(xgb_test)# å¯¼å‡ºç»“æžœ threshold = 0.70ans = []for pred in preds: result = 1 if pred &gt; threshold else 0 ans.append(result)pred_result= pd.Series(ans, dtype='int32')evaluate(val_y, pred_result) test_pct_1: 0.1581 pred_pct_1: 0.1836 Precesion: 0.5581 Recall: 0.6481 F1-score: 0.5998 confusion matrix: [[3638 388] [ 266 490]] {&apos;Confusuion&apos;: array([[3638, 388], [ 266, 490]]), &apos;F1&apos;: 0.5997552019583843, &apos;Precision&apos;: 0.5580865603644647, &apos;acc&apos;: 0.863237139272271, &apos;pred_pct_1&apos;: 0.1836051861145964, &apos;recall&apos;: 0.6481481481481481, &apos;roc_auc&apos;: 0.7758872881823701, &apos;test_pct_1&apos;: 0.15809284818067754}1234567891011# Aé›†è®­ç»ƒxgb_A = xgb.DMatrix(dataset_A)A_preds = model.predict(xgb_A) # å¯¼å‡ºç»“æžœ threshold = 0.40ans = []for pred in A_preds: result = 1 if pred &gt; threshold else 0 ans.append(result)pred_A_result= pd.Series(ans, dtype='int32') 1234567891011# Bé›†è®­ç»ƒxgb_B = xgb.DMatrix(dataset_B)B_preds = model.predict(xgb_B) # å¯¼å‡ºç»“æžœ threshold = 0.68ans = []for pred in B_preds: result = 1 if pred &gt; threshold else 0 ans.append(result)pred_B_result= pd.Series(ans, dtype='int32') 1234import operatorimportance = model.get_fscore()importance = sorted(importance.items(), key=operator.itemgetter(1))# print(importance) 1234import matplotlib.pyplot as pltplt.rcParams["figure.figsize"]=(30,40)xgb.plot_importance(model, max_num_features=100)plt.show() /root/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1320: UserWarning: findfont: Font family [&apos;sans-serif&apos;] not found. Falling back to DejaVu Sans (prop.get_family(), self.defaultFamily[fontext])) 12# æŸ¥çœ‹ç‰¹å¾æŽ’åfeature_rank(model, 30) æäº¤ç»“æžœ1pred_B_result.value_counts() 0 3901 1 881 dtype: int6412# åˆå¹¶ç»“æžœresult = pd.concat([B_customid, pred_B_result],axis=1) 1result.to_csv('111.csv',header=0,index=0) 1init_woody The prv extension is already loaded. To reload it, use: %reload_ext prv Matplotlib env init complete. Warnings off.1predict 2 000.csv &apos;æäº¤æ¬¡æ•°å·²ç”¨å®Œï¼Œè¯·æ˜Žæ—¥å†è¯•ï¼&apos;æ·±åŒ–ç‰¹å¾å·¥ç¨‹å„ç±»ç†è´¢äº§å“çš„æŒæœ‰æ•°é‡123456train_idv_td = pd.read_csv("../data/2/train/IDV_TD.csv", encoding='utf-8') # ä¸ªäººå®šæœŸå­˜æ¬¾è´¦æˆ·ä¿¡æ¯ï¼ˆIDV_TDï¼‰train_bond = pd.read_csv("../data/2/train/BOND.csv", encoding='utf-8') # å›½å€ºè´¦æˆ·ä¿¡æ¯ï¼ˆBONDï¼‰train_fund = pd.read_csv("../data/2/train/FUND.csv", encoding='utf-8') # åŸºé‡‘è´¦æˆ·ä¿¡æ¯ï¼ˆFUNDï¼‰train_prec_metal = pd.read_csv("../data/2/train/PREC_METAL.csv", encoding='utf-8') # è´µé‡‘å±žè´¦æˆ·ä¿¡æ¯ï¼ˆPREC_METALï¼‰train_aget_insr = pd.read_csv("../data/2/train/AGET_INSR.csv", encoding='utf-8') # ä»£ç†ä¿é™©è´¦æˆ·ä¿¡æ¯ï¼ˆAGET_INSRï¼‰train_idv_cust_basic = pd.read_csv("../data/2/train/IDV_CUST_BASIC.csv", encoding='utf-8') # ä¸ªäººå®¢æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆIDV_CUST_BASICï¼‰ /root/anaconda3/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2728: DtypeWarning: Columns (12) have mixed types. Specify dtype option on import or set low_memory=False. interactivity=interactivity, compiler=compiler, result=result)12345# å®šæœŸçš„ä¸ªæ•°train_idv_td_3 = train_idv_td[train_idv_td['DATA_DAT']==3734035200]train_idv_td_AUM = train_idv_td_3[['CUST_NO', 'ARG_CRT_DAT']]train_idv_td_num = train_idv_td_AUM.groupby('CUST_NO').count().reset_index()train_idv_td_num.rename(columns=&#123;'ARG_CRT_DAT':'IDV_TD_NUM'&#125;, inplace=True) 12345# å›½å€ºçš„ä¸ªæ•°train_bond_3 = train_bond[train_bond['DATA_DAT']==3734035200]train_bond_AUM = train_bond_3[['CUST_NO', 'ARG_CRT_DAT']]train_bond_num = train_bond_AUM.groupby('CUST_NO').count().reset_index()train_bond_num.rename(columns=&#123;'ARG_CRT_DAT':'BOND_NUM'&#125;, inplace=True) 12345# åŸºé‡‘çš„ä¸ªæ•°train_fund_3 = train_fund[train_fund['DATA_DAT']==3734035200]train_fund_AUM = train_fund[['CUST_NO', 'ARG_CRT_DAT']]train_fund_num = train_fund_AUM.groupby('CUST_NO').count().reset_index()train_fund_num.rename(columns=&#123;'ARG_CRT_DAT':'FUND_NUM'&#125;, inplace=True) 123456# è´µé‡‘å±žçš„ä¸ªæ•°train_prec_metal_3 = train_prec_metal[train_prec_metal['DATA_DAT']==3734035200]train_prec_metal_3.dropna(subset=['SIGD_DAT'], inplace=True)train_prec_metal_AUM = train_prec_metal_3[['CUST_NO', 'SIGD_DAT']]train_prec_metal_num = train_prec_metal_AUM.groupby('CUST_NO').count().reset_index()train_prec_metal_num.rename(columns=&#123;'SIGD_DAT':'PREC_METAL_NUM'&#125;, inplace=True) /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy This is separate from the ipykernel package so we can avoid doing imports until123456# ä¿é™©çš„ä¸ªæ•°train_aget_insr_3 = train_aget_insr[train_aget_insr['DATA_DAT']==3734035200]train_aget_insr_3.dropna(subset=['INSE_DAT'], inplace=True)train_aget_insr_AUM = train_aget_insr_3[['CUST_NO', 'INSE_DAT']]train_aget_insr_num = train_aget_insr_AUM.groupby('CUST_NO').count().reset_index()train_aget_insr_num.rename(columns=&#123;'INSE_DAT':'AGET_INSR_NUM'&#125;, inplace=True) /root/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: A value is trying to be set on a copy of a slice from a DataFrame See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy This is separate from the ipykernel package so we can avoid doing imports until12# å®¢æˆ·IDCUST_NO_LSIT = train_idv_cust_basic['CUST_NO'].reset_index().drop('index', axis=1) 123# åˆå¹¶ä¸ºä¸€ä¸ªè¡¨CUST_NO_AUM_LSIT = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(CUST_NO_LSIT, train_idv_td_num, on='CUST_NO', how='outer'), train_bond_num, on='CUST_NO', how='outer'), train_fund_num, on='CUST_NO', how='outer'), train_prec_metal_num, on='CUST_NO', how='outer'), train_aget_insr_num, on='CUST_NO', how='outer').fillna(0) 1CUST_NO_AUM_LSIT['PRODUCTS_NUM'] = CUST_NO_AUM_LSIT[['IDV_TD_NUM','BOND_NUM','FUND_NUM','PREC_METAL_NUM','AGET_INSR_NUM']].sum(axis=1) 1CUST_NO_AUM_LSIT[CUST_NO_AUM_LSIT['CUST_NO'] == 'a100d07faf0bc3c60d7d65abd704142a'] 1CUST_NO_AUM_LSIT.head(100) 1MyAUMTest = pd.merge(CUST_NO_AUM_LSIT, train_cust_result, on='CUST_NO', how='outer') 1MyAUMTest.head(10) 1CUST_NO_AUM_LSIT.shape (38256, 6)12# å…³è”å…³ç³»g = sns.heatmap(MyAUMTest[['FLAG', 'IDV_TD_NUM','BOND_NUM','FUND_NUM','PREC_METAL_NUM','AGET_INSR_NUM','PRODUCTS_NUM']].corr(), annot=True, cmap="coolwarm") /root/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1320: UserWarning: findfont: Font family [&apos;sans-serif&apos;] not found. Falling back to DejaVu Sans (prop.get_family(), self.defaultFamily[fontext])) 12345678910111213141516171819202122232425262728293031323334353637# èŽ·å–åˆ°æ‰€æœ‰æŠ•èµ„ç§ç±»çš„å’Œdef AUM_NUMS(train_idv_td, train_bond, train_fund, train_prec_metal, train_aget_insr, train_idv_cust_basic): # å®šæœŸçš„ä¸ªæ•° train_idv_td_3 = train_idv_td[train_idv_td['DATA_DAT']==3734035200] train_idv_td_AUM = train_idv_td_3[['CUST_NO', 'ARG_CRT_DAT']] train_idv_td_num = train_idv_td_AUM.groupby('CUST_NO').count().reset_index() train_idv_td_num.rename(columns=&#123;'ARG_CRT_DAT':'IDV_TD_NUM'&#125;, inplace=True) # å›½å€ºçš„ä¸ªæ•° train_bond_3 = train_bond[train_bond['DATA_DAT']==3734035200] train_bond_AUM = train_bond_3[['CUST_NO', 'ARG_CRT_DAT']] train_bond_num = train_bond_AUM.groupby('CUST_NO').count().reset_index() train_bond_num.rename(columns=&#123;'ARG_CRT_DAT':'BOND_NUM'&#125;, inplace=True) # åŸºé‡‘çš„ä¸ªæ•° train_fund_3 = train_fund[train_fund['DATA_DAT']==3734035200] train_fund_AUM = train_fund[['CUST_NO', 'ARG_CRT_DAT']] train_fund_num = train_fund_AUM.groupby('CUST_NO').count().reset_index() train_fund_num.rename(columns=&#123;'ARG_CRT_DAT':'FUND_NUM'&#125;, inplace=True) # è´µé‡‘å±žçš„ä¸ªæ•° train_prec_metal_3 = train_prec_metal[train_prec_metal['DATA_DAT']==3734035200] train_prec_metal_3.dropna(subset=['SIGD_DAT'], inplace=True) train_prec_metal_AUM = train_prec_metal_3[['CUST_NO', 'SIGD_DAT']] train_prec_metal_num = train_prec_metal_AUM.groupby('CUST_NO').count().reset_index() train_prec_metal_num.rename(columns=&#123;'SIGD_DAT':'PREC_METAL_NUM'&#125;, inplace=True) # ä¿é™©çš„ä¸ªæ•° train_aget_insr_3 = train_aget_insr[train_aget_insr['DATA_DAT']==3734035200] train_aget_insr_3.dropna(subset=['INSE_DAT'], inplace=True) train_aget_insr_AUM = train_aget_insr_3[['CUST_NO', 'INSE_DAT']] train_aget_insr_num = train_aget_insr_AUM.groupby('CUST_NO').count().reset_index() train_aget_insr_num.rename(columns=&#123;'INSE_DAT':'AGET_INSR_NUM'&#125;, inplace=True) # å®¢æˆ·ID CUST_NO_LSIT = train_idv_cust_basic['CUST_NO'].reset_index().drop('index', axis=1) # åˆå¹¶ä¸ºä¸€ä¸ªè¡¨ CUST_NO_AUM_LSIT = pd.merge(pd.merge(pd.merge(pd.merge(pd.merge(CUST_NO_LSIT, train_idv_td_num, on='CUST_NO', how='outer'), train_bond_num, on='CUST_NO', how='outer'), train_fund_num, on='CUST_NO', how='outer'), train_prec_metal_num, on='CUST_NO', how='outer'), train_aget_insr_num, on='CUST_NO', how='outer').fillna(0) CUST_NO_AUM_LSIT['PRODUCTS_NUM'] = CUST_NO_AUM_LSIT[['IDV_TD_NUM','BOND_NUM','FUND_NUM','PREC_METAL_NUM','AGET_INSR_NUM']].sum(axis=1) return CUST_NO_AUM_LSIT ä¸‰ä¸ªæœˆå˜åŠ¨å®šæœŸè´¦æˆ·12345678910111213141516171819202122232425262728293031323334353637def BY_MONTH_IDV_TD_METHOD(dataset_IDV_TD): # é¢„å¤„ç† # ç®€åŒ–IDV_TDè¡¨ train_idv_td_temple = dataset_IDV_TD.drop(['ARG_CRT_DAT', 'CLS_ACCT_DAT', 'MATU_DAT', 'LAC', 'ACCT_STS_CD','DP_DAY_CD', 'RDEP_IND_CD', 'RDEP_DP_DAY_CD', 'RAT_CTG','FXDI_SA_ACCM', 'MTH_ACT_DAYS_TOT'], axis=1) # å°†train_idv_tdå’Œtrain_base_excgåˆå¹¶ train_idv_td_temple = pd.merge(train_idv_td_temple, train_base_excg, on = 'CCY_CD') # æ‰§è¡Œæ±‡çŽ‡è®¡ç®—å‡½æ•° train_idv_td_temple['CRBAL'] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = 1, args = ('CRBAL', 'RMB_MID_PRIC')) train_idv_td_temple['REG_CAP'] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = 1, args = ('REG_CAP', 'RMB_MID_PRIC')) train_idv_td_temple['FXDI_T_ACCM'] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = 1, args = ('FXDI_T_ACCM', 'RMB_MID_PRIC')) train_idv_td_temple['TDOP_SHD_PAY_INTS'] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = 1, args = ('TDOP_SHD_PAY_INTS', 'RMB_MID_PRIC')) train_idv_td_temple['MOTH_CR_ACCM'] = train_idv_td_temple.apply(compute_REAL_MONEY, axis = 1, args = ('MOTH_CR_ACCM', 'RMB_MID_PRIC')) train_idv_td_temple = train_idv_td_temple.drop(['CCY_CD', 'RMB_MID_PRIC'], axis=1) # æŒ‰æœˆå°†é‡‘é¢åˆ†ç±» BY_MONTH_TD = train_idv_td_temple.groupby(['CUST_NO', 'DATA_DAT'])[['CRBAL', 'REG_CAP', 'FXDI_T_ACCM', 'TDOP_SHD_PAY_INTS', 'MOTH_CR_ACCM']].sum().unstack() # å£°æ˜Žå‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ def BY_MONTH_IDV_TD(key): train_idv_td_temple_STD = BY_MONTH_TD[key].std(axis=1).reset_index() train_idv_td_temple_STD.columns = ['CUST_NO', str('IDV_TD_'+key+'_STD')] train_idv_td_temple_MEAN = BY_MONTH_TD[key].mean(axis=1).reset_index() train_idv_td_temple_MEAN.columns = ['CUST_NO',str('IDV_TD_'+key+'_MEAN')] train_idv_td_temple_MAX = BY_MONTH_TD[key].max(axis=1).reset_index() train_idv_td_temple_MAX.columns = ['CUST_NO',str('IDV_TD_'+key+'_MAX')] train_idv_td_temple_MIN = BY_MONTH_TD[key].min(axis=1).reset_index() train_idv_td_temple_MIN.columns = ['CUST_NO',str('IDV_TD_'+key+'_MIN')] # åˆå¹¶å­—æ®µ train_idv_td_temple = pd.merge(train_idv_td_temple_STD, train_idv_td_temple_MEAN, on='CUST_NO', how='inner') train_idv_td_temple = pd.merge(train_idv_td_temple, train_idv_td_temple_MAX, on='CUST_NO', how='inner') train_idv_td_temple = pd.merge(train_idv_td_temple, train_idv_td_temple_MIN, on='CUST_NO', how='inner') train_idv_td_temple = train_idv_td_temple.fillna(0) return train_idv_td_temple train_idv_td_temple = BY_MONTH_IDV_TD('CRBAL') for key in ['REG_CAP', 'FXDI_T_ACCM','TDOP_SHD_PAY_INTS', 'MOTH_CR_ACCM']: train_idv_td_temple = pd.merge(train_idv_td_temple, BY_MONTH_IDV_TD(key)) train_idv_td_temple.drop_duplicates(subset=None, keep='first', inplace=True) return train_idv_td_temple æ´»æœŸè´¦æˆ·12345678910111213141516171819202122232425262728293031323334353637383940414243def BY_MONTH_IDV_DPSA_METHOD(dataset_IDV_DPSA): # é¢„å¤„ç† # å°†IDV_DPSAè¡¨ä¸Žæ±‡çŽ‡è¡¨æ•´åˆ train_idv_dpsa_temple = pd.merge(dataset_IDV_DPSA, train_base_excg, on = 'CCY_CD', how='inner') train_idv_dpsa_temple.drop_duplicates(subset=None, keep='first', inplace=True) # æ‰§è¡Œæ±‡çŽ‡è®¡ç®—å‡½æ•° train_idv_dpsa_temple['CRBAL'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis=1, args = ('CRBAL', 'RMB_MID_PRIC')) train_idv_dpsa_temple['ITST_BRNG_ACCM'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis=1, args = ('ITST_BRNG_ACCM', 'RMB_MID_PRIC')) train_idv_dpsa_temple['FRZ_TOT_AMT'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = 1, args = ('FRZ_TOT_AMT', 'RMB_MID_PRIC')) train_idv_dpsa_temple['DAY_WD_ACT_AMT'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_WD_ACT_AMT', 'RMB_MID_PRIC')) train_idv_dpsa_temple['DAY_CSH_DP_SUM'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_CSH_DP_SUM', 'RMB_MID_PRIC')) train_idv_dpsa_temple['DAY_CSH_WD_SUM'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_CSH_WD_SUM', 'RMB_MID_PRIC')) train_idv_dpsa_temple['DAY_TFI_SUM'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = 1, args = ('DAY_TFI_SUM', 'RMB_MID_PRIC')) train_idv_dpsa_temple['MOTH_CR_ACCM'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = 1, args = ('MOTH_CR_ACCM', 'RMB_MID_PRIC')) train_idv_dpsa_temple['BEG_MOTH_CRBAL'] = train_idv_dpsa_temple.apply(compute_REAL_MONEY, axis = 1, args = ('BEG_MOTH_CRBAL', 'RMB_MID_PRIC')) train_idv_dpsa_temple = train_idv_dpsa_temple.drop(['CCY_CD', 'RMB_MID_PRIC'], axis=1) # æŒ‰æœˆå°†é‡‘é¢åˆ†ç»„ BY_MONTH_DPSA = train_idv_dpsa_temple.groupby(['CUST_NO', 'DATA_DAT'])[['CRBAL', 'ITST_BRNG_ACCM', 'FRZ_TOT_AMT', 'DAY_WD_ACT_AMT', 'DAY_CSH_DP_SUM', 'DAY_CSH_WD_SUM', 'DAY_TFI_SUM', 'MOTH_CR_ACCM', 'BEG_MOTH_CRBAL']].sum().unstack() # å£°æ˜Žå‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ def BY_MONTH_IDV_DPSA(key): train_idv_dpsa_temple_STD = BY_MONTH_DPSA[key].std(axis=1).reset_index() train_idv_dpsa_temple_STD.columns = ['CUST_NO', str('IDV_DPSA_'+key+'_STD')] train_idv_dpsa_temple_MEAN = BY_MONTH_DPSA[key].mean(axis=1).reset_index() train_idv_dpsa_temple_MEAN.columns = ['CUST_NO',str('IDV_DPSA_'+key+'_MEAN')] train_idv_dpsa_temple_MAX = BY_MONTH_DPSA[key].max(axis=1).reset_index() train_idv_dpsa_temple_MAX.columns = ['CUST_NO',str('IDV_DPSA_'+key+'_MAX')] train_idv_dpsa_temple_MIN = BY_MONTH_DPSA[key].min(axis=1).reset_index() train_idv_dpsa_temple_MIN.columns = ['CUST_NO',str('IDV_DPSA_'+key+'_MIN')] # åˆå¹¶å­—æ®µ train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple_STD, train_idv_dpsa_temple_MEAN, on='CUST_NO', how='inner') train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple, train_idv_dpsa_temple_MAX, on='CUST_NO', how='inner') train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple, train_idv_dpsa_temple_MIN, on='CUST_NO', how='inner') train_idv_dpsa_temple = train_idv_dpsa_temple.fillna(0) return train_idv_dpsa_temple train_idv_dpsa_temple = BY_MONTH_IDV_DPSA('CRBAL') for key in ['ITST_BRNG_ACCM','FRZ_TOT_AMT', 'DAY_WD_ACT_AMT', 'DAY_CSH_DP_SUM', 'DAY_CSH_WD_SUM','DAY_TFI_SUM', 'MOTH_CR_ACCM', 'BEG_MOTH_CRBAL']: train_idv_dpsa_temple = pd.merge(train_idv_dpsa_temple, BY_MONTH_IDV_DPSA(key)) train_idv_dpsa_temple.drop_duplicates(subset=None, keep='first', inplace=True) return train_idv_dpsa_temple äº¤æ˜“ä¿¡æ¯123456789101112131415161718192021222324252627282930313233343536def BY_MONTH_TR_DC_METHOD(dataset_TR_DC): # é¢„å¤„ç† # åŽ»é™¤æŠ¹å¸(1),æ— æ„ä¹‰åˆ—ï¼Œè¿™é‡Œå…¨æ˜¯0 dataset_TR_DC = dataset_TR_DC[dataset_TR_DC['CAN_IND']==0].drop(['RED_BLU_CD', 'CRD_TYP1', 'TR_TYPE', 'TR_CHANL_CD', 'CAN_IND', 'CARD_USETYPE', 'CARD_ELECASH', 'CARD_MATERIAL'],axis=1) dataset_TR_DC.drop_duplicates(subset=None, keep='first', inplace=True) # äº¤æ˜“è¡¨æ—¶é—´æ®µæ‰“ä¸Šæ ‡ç­¾ # 2æœˆä»½ [3726432000, 3728937600), 3æœˆä»½ [3728937600, 3731616000), 4æœˆä»½ [3731616000, 3734035200] dataset_TR_DC['TR_DAT'] = pd.cut(dataset_TR_DC['TR_DAT'], [3726432000, 3728937600, 3731616000, 3734035200], labels=['2æœˆä»½', '3æœˆä»½', '4æœˆä»½']) # å°†äº¤æ˜“æŒ‰ç…§ æ­£ / è´Ÿ åˆ†å¼€ train_tr_dc['INCOME'] = train_tr_dc['TR_AMT'] &gt; 0 myseries = train_tr_dc.groupby(['CUST_NO', 'INCOME'])['TR_AMT'].sum() myseries = myseries.unstack().fillna(0) TR_DC_IN_OUT = pd.DataFrame(myseries).reset_index() TR_DC_IN_OUT['IN_SUM'] = TR_DC_IN_OUT[True] TR_DC_IN_OUT['OUT_SUM'] = TR_DC_IN_OUT[False] TR_DC_IN_OUT = TR_DC_IN_OUT.drop([True, False], axis=1) BY_MONTH_DC = dataset_TR_DC.groupby(['CUST_NO', 'TR_DAT'])[['TR_AMT']].sum().unstack() # å£°æ˜Žå‡½æ•° è®¡ç®—ä¸‰ä¸ªæœˆçš„æ ‡å‡†å·®ã€å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ def BY_MONTH_TR_DC(key): train_tr_dc_temple_STD = BY_MONTH_DC[key].std(axis=1).reset_index() train_tr_dc_temple_STD.columns = ['CUST_NO', str('TR_DC_'+key+'_STD')] train_tr_dc_temple_MEAN = BY_MONTH_DC[key].mean(axis=1).reset_index() train_tr_dc_temple_MEAN.columns = ['CUST_NO',str('TR_DC_'+key+'_MEAN')] train_tr_dc_temple_MAX = BY_MONTH_DC[key].max(axis=1).reset_index() train_tr_dc_temple_MAX.columns = ['CUST_NO',str('TR_DC_'+key+'_MAX')] train_tr_dc_temple_MIN = BY_MONTH_DC[key].min(axis=1).reset_index() train_tr_dc_temple_MIN.columns = ['CUST_NO',str('TR_DC_'+key+'_MIN')] # åˆå¹¶å­—æ®µ train_tr_dc_temple = pd.merge(train_tr_dc_temple_STD, train_tr_dc_temple_MEAN, on='CUST_NO', how='inner') train_tr_dc_temple = pd.merge(train_tr_dc_temple, train_tr_dc_temple_MAX, on='CUST_NO', how='inner') train_tr_dc_temple = pd.merge(train_tr_dc_temple, train_tr_dc_temple_MIN, on='CUST_NO', how='inner') train_tr_dc_temple = train_tr_dc_temple.fillna(0) return train_tr_dc_temple train_tr_dc_temple = BY_MONTH_TR_DC('TR_AMT') return train_tr_dc_temple 1train_tr_dc['TR_DAT'] = pd.cut(train_tr_dc['TR_DAT'], [3726432000, 3728937600, 3731616000, 3734035200], labels=['FEB', 'MAR', 'APR']) 1BY_MONTH_TR_DC_METHOD = train_tr_dc[['TR_DAT']] 1sns.countplot(x='TR_DAT', data=BY_MONTH_TR_DC_METHOD) &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f0167e23a58&gt; å¹´é¾„123456789101112# è¿”å›žå•ä¸ª æˆ– series çš„mså¯¹åº”æ—¥æœŸ, å†è¢« 2015 å‡å¾—åˆ°çš„å¹´æ•°def adj_date(series, datatype='series'): import time from datetime import datetime initial_year = 2015 adj_msj_obj = datetime.strptime("2042-08-31 16:00:00.123", "%Y-%m-%d %H:%M:%S.%f") adj_ms = int(time.mktime(adj_msj_obj.timetuple())*1000 + adj_msj_obj.microsecond/1000.0)/1000 current_ms = train_idv_cust_basic['DATA_DAT'][0] # 3736713600 if(datatype=='single'): return initial_year - int(time.strftime("%Y%m", time.localtime(current_ms-adj_ms))) else: return series.map(lambda x: initial_year - int(time.strftime("%Y", time.localtime(x - adj_ms))) if pd.notna(x) else x) 1234567# å¹´é¾„è®¡ç®—å‡½æ•°def CALC_AGE(dataset_idv_cust_basic): dataset_idv_cust_basic['GC_BRTH'] = dataset_idv_cust_basic['GC_BRTH'].fillna(dataset_idv_cust_basic['GC_BRTH'].mean()) dataset_idv_cust_basic['AGE'] = adj_date(dataset_idv_cust_basic['GC_BRTH']) dataset_idv_cust_basic['AGE'] = np.where(dataset_idv_cust_basic['AGE'] &gt; 100, 31, dataset_idv_cust_basic['AGE']) dataset_idv_cust_basic['AGE'] = np.where(dataset_idv_cust_basic['AGE'] &lt; 16, 31, dataset_idv_cust_basic['AGE']) return dataset_idv_cust_basic 1AGE = CALC_AGE(train_idv_cust_basic)['AGE'] 1AGE.hist() &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f01681b5cc0&gt; /root/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1320: UserWarning: findfont: Font family [&apos;sans-serif&apos;] not found. Falling back to DejaVu Sans (prop.get_family(), self.defaultFamily[fontext])) æ‰€æœ‰èµ„äº§123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778# tdå®šæœŸã€bondå›½å€ºã€fundåŸºé‡‘ã€prec_metalè´µé‡‘å±žã€aget_insrä¿é™©def WEALTH(target,td,bond,fund,prec_metal,agent_insurance,thr_pty_cstd): ''' # é”€æˆ·æ—¥æœŸå¿…é¡» &gt; 2æœˆåº•ï¼Œåˆçº¦å»ºç«‹æ—¥æœŸå¿…é¡» &lt; 4æœˆåº• #gp = df_tr_train.groupby(['CUST_NO','TR_CD']).agg(&#123;'TR_AMT':['sum','mean','max','min','count','std']&#125;) if len(suffix)==1: td = td[td['DATA_DAT']==time_point[1]] bond = bond[bond['DATA_DAT']==time_point[1]] fund = fund[fund['DATA_DAT']==time_point[1]] prec_metal = prec_metal[prec_metal['DATA_DAT']==time_point[1]] agent_insurance = agent_insurance[agent_insurance['DATA_DAT']==time_point[1]] thr_pty_cstd = thr_pty_cstd[thr_pty_cstd['DATA_DAT']==time_point[1]] elif len(suffix)==2: td = td[td['DATA_DAT']&gt;time_point[1]] bond = bond[bond['DATA_DAT']&gt;time_point[1]] fund = fund[fund['DATA_DAT']&gt;time_point[1]] prec_metal = prec_metal[prec_metal['DATA_DAT']&gt;time_point[1]] agent_insurance = agent_insurance[agent_insurance['DATA_DAT']&gt;time_point[1]] thr_pty_cstd = thr_pty_cstd[thr_pty_cstd['DATA_DAT']&gt;time_point[1]] ''' # é€‰å–å„è¡¨åˆå¹¶ç‰¹å¾ td = td[['CUST_NO','DATA_DAT','CRBAL','MOTH_CR_ACCM']].groupby(['CUST_NO','DATA_DAT']).sum().unstack().reset_index() bond = bond[['CUST_NO','DATA_DAT','ARG_CUR_BAL','NVTA_MOTH_ACCM']].groupby(['CUST_NO','DATA_DAT']).sum().unstack().reset_index() fund = fund[['CUST_NO','DATA_DAT','FUND_BAL','FUND_BAL_MOTH_BAL_ACCM']].groupby(['CUST_NO','DATA_DAT']).sum().unstack().reset_index() prec_metal = prec_metal[['CUST_NO','DATA_DAT','ARG_BAL','MTH_ARG_ACCM']].groupby(['CUST_NO','DATA_DAT']).sum().unstack().reset_index() agent_insurance = agent_insurance[['CUST_NO','DATA_DAT','BEG_MTH_PREM_BAL','MTH_PREM_ACCM']].groupby(['CUST_NO','DATA_DAT']).sum().unstack().reset_index() thr_pty_cstd = thr_pty_cstd[['CUST_NO','DATA_DAT','AVL_BAL','MTH_ARG_BAL_ACCM']].groupby(['CUST_NO','DATA_DAT']).sum().unstack().reset_index() # ç†è´¢å„æœˆçš„é‡‘é¢ã€æŒæœ‰äº§å“çš„æ•°é‡ã€ wealth = pd.merge(target[['CUST_NO']],td,on=['CUST_NO'],how='outer') wealth = pd.merge(wealth,bond,on=['CUST_NO'],how='outer') wealth = pd.merge(wealth,fund,on=['CUST_NO'],how='outer') wealth = pd.merge(wealth,prec_metal,on=['CUST_NO'],how='outer') wealth = pd.merge(wealth,thr_pty_cstd,on=['CUST_NO'],how='outer') wealth = pd.merge(wealth,agent_insurance,on=['CUST_NO'],how='outer').fillna(0) # ç†è´¢å„æœˆçš„é‡‘é¢ã€æŒæœ‰äº§å“çš„æ•°é‡ã€ #wealth['WEALTH_BAL'] = wealth['CRBAL'] + wealth['ARG_CUR_BAL'] + wealth['FUND_BAL'] + wealth['ARG_BAL'] + wealth['BEG_MTH_PREM_BAL'] #+ wealth['AVL_BAL'] #wealth['WEALTH_ACCM'] = wealth['MOTH_CR_ACCM'] + wealth['NVTA_MOTH_ACCM'] + wealth['FUND_BAL_MOTH_BAL_ACCM'] + wealth['MTH_ARG_ACCM'] + wealth['MTH_PREM_ACCM'] #+ wealth['MTH_ARG_BAL_ACCM'] #wealth = wealth.groupby(['CUST_NO'])['WEALTH_BAL','WEALTH_ACCM'].sum().reset_index() # æŒæœ‰çš„ç†è´¢äº§å“ç§ç±»ï¼ˆä¸åŒæœŸé™/åˆçº¦å»ºç«‹æ—¥æœŸã€ç›¸åŒå“ç§çš„ç®—ä¸åŒäº§å“ï¼‰ # é¦–ä»½ç†è´¢åˆçº¦å»ºç«‹æ—¶é—´ã€æœ€è¿‘ä¸€ä»½ç†è´¢åˆçº¦å»ºç«‹æ—¶é—´ # 3ä¸ªæœˆå†…ä¹°å…¥ç†è´¢äº§å“æ¬¡æ•° # 3ä¸ªæœˆå­˜æ¬¾ç§¯æ•°ä¹‹å’Œï¼ˆæ´»æœŸï¼Œæ´»æœŸ+å®šæœŸ+ä¸‰æ–¹å­˜ç®¡ï¼‰ X = wealth.copy() X['WEALTH_BAL_1'] = X[('CRBAL', 3728764800)]+X[('ARG_CUR_BAL', 3728764800)]+X[('FUND_BAL', 3728764800)]+X[('ARG_BAL', 3728764800)]+X[('AVL_BAL', 3728764800)]+X[('BEG_MTH_PREM_BAL', 3728764800)] X['WEALTH_BAL_2'] = X[('CRBAL', 3731443200)]+X[('ARG_CUR_BAL', 3731443200)]+X[('FUND_BAL', 3731443200)]+X[('ARG_BAL', 3731443200)]+X[('AVL_BAL', 3731443200)]+X[('BEG_MTH_PREM_BAL', 3731443200)] X['WEALTH_BAL_3'] = X[('CRBAL', 3734035200)]+X[('ARG_CUR_BAL', 3734035200)]+X[('FUND_BAL', 3734035200)]+X[('ARG_BAL', 3734035200)]+X[('AVL_BAL', 3734035200)]+X[('BEG_MTH_PREM_BAL', 3734035200)] X['WEALTH_ACCM_1'] = X[('MOTH_CR_ACCM', 3728764800)]+X[('NVTA_MOTH_ACCM', 3728764800)]+X[('FUND_BAL_MOTH_BAL_ACCM', 3728764800)]+X[('MTH_ARG_ACCM', 3728764800)]+X[('MTH_ARG_BAL_ACCM', 3728764800)]+X[('MTH_PREM_ACCM', 3728764800)] X['WEALTH_ACCM_2'] = X[('MOTH_CR_ACCM', 3731443200)]+X[('NVTA_MOTH_ACCM', 3731443200)]+X[('FUND_BAL_MOTH_BAL_ACCM', 3731443200)]+X[('MTH_ARG_ACCM', 3731443200)]+X[('MTH_ARG_BAL_ACCM', 3731443200)]+X[('MTH_PREM_ACCM', 3731443200)] X['WEALTH_ACCM_3'] = X[('MOTH_CR_ACCM', 3734035200)]+X[('NVTA_MOTH_ACCM', 3734035200)]+X[('FUND_BAL_MOTH_BAL_ACCM', 3734035200)]+X[('MTH_ARG_ACCM', 3734035200)]+X[('MTH_ARG_BAL_ACCM', 3734035200)]+X[('MTH_PREM_ACCM', 3734035200)] X2 = X[['CUST_NO','WEALTH_BAL_1','WEALTH_BAL_2','WEALTH_BAL_3','WEALTH_ACCM_1','WEALTH_ACCM_2','WEALTH_ACCM_3']].set_index('CUST_NO') X2['WEALTH_BAL_MAX'] = X2[['WEALTH_BAL_1','WEALTH_BAL_2','WEALTH_BAL_3']].max(axis=1) X2['WEALTH_BAL_MEAN'] = X2[['WEALTH_BAL_1','WEALTH_BAL_2','WEALTH_BAL_3']].mean(axis=1) X2['WEALTH_BAL_STD'] = X2[['WEALTH_BAL_1','WEALTH_BAL_2','WEALTH_BAL_3']].std(axis=1).fillna(0.0) X2['WEALTH_BAL_CV'] = X2['WEALTH_BAL_STD']/X2['WEALTH_BAL_MEAN'] X2['WEALTH_ACCM_MAX'] = X2[['WEALTH_ACCM_1','WEALTH_ACCM_2','WEALTH_ACCM_3']].max(axis=1) X2['WEALTH_ACCM_MEAN'] = X2[['WEALTH_ACCM_1','WEALTH_ACCM_2','WEALTH_ACCM_3']].mean(axis=1) X2['WEALTH_ACCM_STD'] = X2[['WEALTH_ACCM_1','WEALTH_ACCM_2','WEALTH_ACCM_3']].std(axis=1).fillna(0.0) X2['WEALTH_ACCM_CV'] = X2['WEALTH_ACCM_STD']/X2['WEALTH_ACCM_MEAN'] X3 = X2.fillna(0.0).drop(['WEALTH_BAL_1','WEALTH_BAL_2','WEALTH_BAL_3','WEALTH_ACCM_1','WEALTH_ACCM_2','WEALTH_ACCM_3','WEALTH_BAL_STD','WEALTH_ACCM_STD'],axis=1).reset_index() return X3[['CUST_NO','WEALTH_ACCM_MEAN','WEALTH_ACCM_CV']] ç»“æžœæŒ–æŽ˜12train_cust_result_1 = train_cust_result[train_cust_result['FLAG']==1]train_cust_result_0 = train_cust_result[train_cust_result['FLAG']==0] 1from lightgbm import LGBMRegressor 1! pip install lightgbm-2.2.3-py2.py3-none-manylinux1_x86_64.whl Processing ./lightgbm-2.2.3-py2.py3-none-manylinux1_x86_64.whl Requirement already satisfied: scikit-learn in /root/anaconda3/lib/python3.6/site-packages (from lightgbm==2.2.3) Requirement already satisfied: scipy in /root/anaconda3/lib/python3.6/site-packages (from lightgbm==2.2.3) Requirement already satisfied: numpy in /root/anaconda3/lib/python3.6/site-packages (from lightgbm==2.2.3) Installing collected packages: lightgbm Successfully installed lightgbm-2.2.31! cp ./xgb_rfm-Copy1.ipynb ./xgb_rfm-Copy2.ipynb 1! pip install imbalanced-learn Requirement already satisfied: imbalanced-learn in /root/anaconda3/lib/python3.6/site-packages Requirement already satisfied: scipy&gt;=0.17 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn) Requirement already satisfied: joblib&gt;=0.11 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn) Requirement already satisfied: scikit-learn&gt;=0.21 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn) Requirement already satisfied: numpy&gt;=1.11 in /root/anaconda3/lib/python3.6/site-packages (from imbalanced-learn)]]></content>
      <tags>
        <tag>Python</tag>
        <tag>æ•°æ®æŒ–æŽ˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOSå®‰è£…MySQL 8.0]]></title>
    <url>%2F2019%2F02%2F27%2FCentOS%E5%AE%89%E8%A3%85MySQL8%2F</url>
    <content type="text"><![CDATA[CentOS MySQLçš„å®‰è£…å’Œé…ç½®è®°å½•ã€‚ å®‰è£…MySQL æ‰“å¼€å®˜ç½‘ https://dev.mysql.com/downloads/repo/yum/ ä¸‹è½½(mysql80-community-release-el7-2.noarch.rpm)rpmæ–‡ä»¶ é€šè¿‡ WinSCPå°†æ–‡ä»¶ä¸Šä¼ è‡³ /usr/ ç›®å½•ä¸‹ æœ¬åœ°å®‰è£… 1yum install mysql80-community-release-el7-2.noarch.rpm æŸ¥çœ‹MySQL çš„æ‰€æœ‰ç‰ˆæœ¬ 1yum repolist all | grep mysql é»˜è®¤ä¼šä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ 12sudo yum-config-manager --disable mysql80-communitysudo yum-config-manager --enable mysql57-community æ¥è°ƒæ•´é»˜è®¤ç‰ˆæœ¬ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹ /etc/yum.repos.d/mysql-community.repo ä¸­enabledçš„å€¼(1 æˆ– 0)æ¥è¿›è¡Œä¿®æ”¹ã€‚6. å®‰è£…MySQL 1sudo yum install mysql-community-server å¯åŠ¨MySQL 1sudo service mysqld start ç”¨ä¸´æ—¶å¯†ç ç™»å½• 123456 sudo grep 'temporary password' /var/log/mysqld.log mysql -uroot -p # ä¿®æ”¹å¯†ç  ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass4!';# æŸ¥çœ‹MySQLç‰ˆæœ¬ SHOW VARIABLES WHERE Variable_name = 'version'; å…è®¸è¿œç¨‹è¿žæŽ¥MySQLæ•°æ®åº“ 123456# é¦–å…ˆç¡®ä¿3306ç«¯å£å¼€æ”¾user mysql# åˆ›å»ºç”¨æˆ·CREATE USER 'myuser'@'%' IDENTIFIED BY 'password'; (myuser å’Œ password æ›¿æ¢)GRANT ALL ON *.* TO 'myuser'@'%' WITH GRANT OPTION; (myuser æ›¿æ¢)FLUSH PRIVILEGES;]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Shiro å®‰å…¨æ¡†æž¶å­¦ä¹ ç¬”è®°]]></title>
    <url>%2F2019%2F02%2F26%2FShiro%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[è®°å½•æˆ‘å­¦ä¹ å®‰å…¨æ¡†æž¶Shiroçš„ä¸€äº›ç¬”è®°ã€‚ Shiro VS Spring SecurityApache Shiroç®€å•çµæ´»ï¼Œå¯è„±ç¦»Springï¼Œç²’åº¦è¾ƒç²—ï¼›å¯ä»¥è‡ªå·±æ‹“å±•ï¼Œé€‚åˆé€šè¿‡èµ„æºè¿›è¡Œæƒé™æŽ§åˆ¶ï¼›Spring Securityå¤æ‚ç¬¨é‡ï¼Œä¸å¯è„±ç¦»Springï¼ŒåŠ›åº¦æ›´ç»†ï¼›é€‚åˆåšæ•°æ®æƒé™æŽ§åˆ¶ï¼› Shiroçš„è®¤è¯è¿‡ç¨‹ åˆ›å»ºSecurity Manager ä¸»ä½“æäº¤è®¤è¯ Security Managerè®¤è¯ Authenticatorè®¤è¯ Realmè®¤è¯ ä»£ç å¦‚ä¸‹ï¼šjavaä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041package com.leezy.shiro.shirotest;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.mgt.DefaultSecurityManager;import org.apache.shiro.realm.SimpleAccountRealm;import org.apache.shiro.subject.Subject;import org.junit.Before;import org.junit.Test;public class AuthenticationTest &#123; SimpleAccountRealm simpleAccountRealm = new SimpleAccountRealm(); @Before public void addUser() &#123; simpleAccountRealm.addAccount("LEEZY", "123456"); &#125; @Test public void testAuthentication() &#123; // 1. æž„å»ºSecurityManagerçŽ¯å¢ƒ DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); // å°†SimpleAccountRealmè®¾ç½®åˆ°çŽ¯å¢ƒå˜é‡ä¸­æ¥ defaultSecurityManager.setRealm(simpleAccountRealm); // 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚ SecurityUtils.setSecurityManager(defaultSecurityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken("LEEZY", "123456"); subject.login(token); System.out.println("isAuthenticated: " + subject.isAuthenticated()); subject.isAuthenticated(); subject.logout(); System.out.println("isAuthenticated: " + subject.isAuthenticated()); &#125;&#125; pomæ–‡ä»¶ 1234567891011121314151617181920212223242526272829&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.leezy.shiro&lt;/groupId&gt; &lt;artifactId&gt;shirotest&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;shirotest&lt;/name&gt; &lt;url&gt;http://maven.apache.org&lt;/url&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-core&lt;/artifactId&gt; &lt;version&gt;1.4.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;/.&lt;/project&gt; ShiroæŽˆæƒ åˆ›å»º Security Manager ä¸»ä½“æŽˆæƒ Security Manager æŽˆæƒ Authorizerè®¤è¯ Realm èŽ·å–è§’è‰²æƒé™æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142package com.leezy.shiro.shirotest;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.mgt.DefaultSecurityManager;import org.apache.shiro.realm.SimpleAccountRealm;import org.apache.shiro.subject.Subject;import org.junit.Before;import org.junit.Test;public class AuthenticationTest &#123; SimpleAccountRealm simpleAccountRealm = new SimpleAccountRealm(); @Before public void addUser() &#123; simpleAccountRealm.addAccount("LEEZY", "123456", "admin", "user"); &#125; @Test public void testAuthentication() &#123; // 1. æž„å»ºSecurityManagerçŽ¯å¢ƒ DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); // å°†SimpleAccountRealmè®¾ç½®åˆ°çŽ¯å¢ƒå˜é‡ä¸­æ¥ defaultSecurityManager.setRealm(simpleAccountRealm); // 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚ SecurityUtils.setSecurityManager(defaultSecurityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken("LEEZY", "123456"); subject.login(token); System.out.println("isAuthenticated: " + subject.isAuthenticated()); subject.isAuthenticated(); // æ£€æŸ¥ä¸€ä¸ªè§’è‰² // subject.checkRole("admin"); // æ£€æŸ¥æ˜¯å¦å…·å¤‡å‚æ•°é‡Œæ‰€æœ‰çš„è§’è‰²ï¼Œé€šè¿‡éåŽ†å‚æ•°æ¥è¿›è¡ŒæŽˆæƒ subject.checkRoles("admin", "user"); &#125;&#125; InitRealmçš„ä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435package com.leezy.shiro.shirotest;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.mgt.DefaultSecurityManager;import org.apache.shiro.realm.text.IniRealm;import org.apache.shiro.subject.Subject;import org.junit.Test;public class InitRealmTest &#123; @Test public void testAuthentication() &#123; IniRealm iniRealm = new IniRealm("classpath:user.ini"); // 1. æž„å»ºSecurityManagerçŽ¯å¢ƒ DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); defaultSecurityManager.setRealm(iniRealm); // 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚ SecurityUtils.setSecurityManager(defaultSecurityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken("LEEZY", "123456"); subject.login(token); System.out.println("isAuthenticated: " + subject.isAuthenticated()); subject.checkRole("admin"); subject.checkPermission("user:delete"); subject.checkPermission("user:update"); &#125;&#125; user.ini 1234[users]LEEZY=123456,admin[roles]admin=user:delete,user:update JDBCRealmçš„ä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.leezy.shiro.shirotest;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.mgt.DefaultSecurityManager;import org.apache.shiro.realm.jdbc.JdbcRealm;import org.apache.shiro.subject.Subject;import org.junit.Test;import com.alibaba.druid.pool.DruidDataSource;public class JdbcRealmTest &#123; DruidDataSource dataSource = new DruidDataSource(); &#123; dataSource.setUrl("jdbc:mysql://192.168.56.101:3306/test"); dataSource.setUsername("root"); dataSource.setPassword("Zdh!123456"); &#125; @Test public void testAuthentication() &#123; JdbcRealm jdbcRealm = new JdbcRealm(); jdbcRealm.setDataSource(dataSource); // å¼€å¯åŽæ‰å¯ä»¥è¿›è¡Œæƒé™è®¤è¯(é»˜è®¤å…³é—­) jdbcRealm.setPermissionsLookupEnabled(true); String select_sql = "select password from test_user where username = ?"; jdbcRealm.setAuthenticationQuery(select_sql); String role_sql = "select role_name from test_user_role where user_name = ?"; jdbcRealm.setUserRolesQuery(role_sql); // 1. æž„å»ºSecurityManagerçŽ¯å¢ƒ DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); defaultSecurityManager.setRealm(jdbcRealm); // 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚ SecurityUtils.setSecurityManager(defaultSecurityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken("SAKURA", "123456"); subject.login(token); System.out.println("isAuthenticated: " + subject.isAuthenticated()); subject.checkRole("admin"); subject.checkPermission("user:select"); &#125;&#125; pom.xml 123456789101112&lt;!-- MySQLé©±åŠ¨åŒ… --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.15&lt;/version&gt;&lt;/dependency&gt;&lt;!-- æ•°æ®æº --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.1.14&lt;/version&gt;&lt;/dependency&gt; æŸ¥çœ‹JdbcRealmæºç å¯ä»¥å‘çŽ°ï¼Œå®ƒæœ‰é»˜è®¤çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œåªè¦å»ºç«‹ç›¸åº”çš„æ•°æ®è¡¨å°±å¯ä»¥ã€‚ è‡ªå®šä¹‰Realmè‡ªå®šä¹‰Realmç»§æ‰¿AuthorizingRealm 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package com.leezy.shiro.realm;import java.util.HashMap;import java.util.HashSet;import java.util.Map;import java.util.Set;import org.apache.shiro.authc.AuthenticationException;import org.apache.shiro.authc.AuthenticationInfo;import org.apache.shiro.authc.AuthenticationToken;import org.apache.shiro.authc.SimpleAuthenticationInfo;import org.apache.shiro.authz.AuthorizationInfo;import org.apache.shiro.authz.SimpleAuthorizationInfo;import org.apache.shiro.realm.AuthorizingRealm;import org.apache.shiro.subject.PrincipalCollection;public class CustomRealm extends AuthorizingRealm&#123; Map&lt;String, String&gt; userMap = new HashMap&lt;String, String&gt;(16); &#123; userMap.put("LEEZY", "123456"); super.setName("CustomRealm"); &#125; // æŽˆæƒ protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123; String username = (String) principals.getPrimaryPrincipal(); // ä»Žæ•°æ®åº“æˆ–è€…ç¼“å­˜ä¸­èŽ·å–è§’è‰²æ•°æ® Set&lt;String&gt; roles = getRolesByUserName(username); Set&lt;String&gt; permissions = getPermissionsByUserName(username); SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(); info.setRoles(roles); info.setStringPermissions(permissions); return info; &#125; // è®¤è¯ protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123; //1 ä»Žä¸»ä½“ä¼ è¿‡æ¥çš„è®¤è¯ä¿¡æ¯ä¸­èŽ·å¾—ç”¨æˆ·å String username = (String) token.getPrincipal(); //2.é€šè¿‡ç”¨æˆ·ååˆ°æ•°æ®åº“ä¸­èŽ·å–å‡­è¯ String password = getPasswordByUserName(username); if(password == null) &#123; return null; &#125; SimpleAuthenticationInfo authenticationInfo = new SimpleAuthenticationInfo("LEEZY", password, "CustomRealm"); return authenticationInfo; &#125; // æ¨¡æ‹Ÿæ•°æ®åº“ä¸­æƒé™æŸ¥è¯¢ private Set&lt;String&gt; getPermissionsByUserName(String username) &#123; Set&lt;String&gt; sets = new HashSet&lt;String&gt;(); sets.add("user:delete"); sets.add("user:add"); return sets; &#125; // æ¨¡æ‹Ÿæ•°æ®åº“ä¸­è§’è‰²æŸ¥è¯¢ public Set&lt;String&gt; getRolesByUserName(String username) &#123; Set&lt;String&gt; sets = new HashSet&lt;String&gt;(); sets.add("admin"); sets.add("user"); return sets; &#125; // æ¨¡æ‹Ÿæ•°æ®åº“çš„æŸ¥è¯¢å‡­è¯ private String getPasswordByUserName(String username) &#123; return userMap.get(username); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435package com.leezy.shiro.shirotest;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.mgt.DefaultSecurityManager;import org.apache.shiro.subject.Subject;import org.junit.Test;import com.leezy.shiro.realm.CustomRealm;public class CustomRealmTest &#123; @Test public void testAuthentication() &#123; CustomRealm customRealm = new CustomRealm(); // 1. æž„å»ºSecurityManagerçŽ¯å¢ƒ DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); defaultSecurityManager.setRealm(customRealm); // 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚ SecurityUtils.setSecurityManager(defaultSecurityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken("LEEZY", "123456"); subject.login(token); System.out.println("isAuthenticated: " + subject.isAuthenticated()); subject.checkRole("admin"); subject.checkPermission("user:delete"); subject.checkPermission("user:add"); &#125;&#125; ShiroåŠ å¯†ShiroåŠ å¯†æ–¹å¼ï¼š HashedCredentialsMatcher è‡ªå®šä¹‰Realmä¸­ä½¿ç”¨æ•£åˆ— ç›çš„ä½¿ç”¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586package com.leezy.shiro.realm;import java.util.HashMap;import java.util.HashSet;import java.util.Map;import java.util.Set;import org.apache.shiro.authc.AuthenticationException;import org.apache.shiro.authc.AuthenticationInfo;import org.apache.shiro.authc.AuthenticationToken;import org.apache.shiro.authc.SimpleAuthenticationInfo;import org.apache.shiro.authz.AuthorizationInfo;import org.apache.shiro.authz.SimpleAuthorizationInfo;import org.apache.shiro.crypto.hash.Md5Hash;import org.apache.shiro.realm.AuthorizingRealm;import org.apache.shiro.subject.PrincipalCollection;import org.apache.shiro.util.ByteSource;public class CustomRealm extends AuthorizingRealm&#123; Map&lt;String, String&gt; userMap = new HashMap&lt;String, String&gt;(16); &#123; // ä½¿ç”¨åŠ å¯†ä¹‹åŽçš„å¯†æ–‡ userMap.put("LEEZY", "e43a7da8514a1c9d566164b3ea731a4a"); super.setName("CustomRealm"); &#125; // æŽˆæƒ protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123; String username = (String) principals.getPrimaryPrincipal(); // ä»Žæ•°æ®åº“æˆ–è€…ç¼“å­˜ä¸­èŽ·å–è§’è‰²æ•°æ® Set&lt;String&gt; roles = getRolesByUserName(username); Set&lt;String&gt; permissions = getPermissionsByUserName(username); SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(); info.setRoles(roles); info.setStringPermissions(permissions); return info; &#125; // è®¤è¯ protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123; //1 ä»Žä¸»ä½“ä¼ è¿‡æ¥çš„è®¤è¯ä¿¡æ¯ä¸­èŽ·å¾—ç”¨æˆ·å String username = (String) token.getPrincipal(); //2.é€šè¿‡ç”¨æˆ·ååˆ°æ•°æ®åº“ä¸­èŽ·å–å‡­è¯ String password = getPasswordByUserName(username); if(password == null) &#123; return null; &#125; SimpleAuthenticationInfo authenticationInfo = new SimpleAuthenticationInfo("LEEZY", password, "CustomRealm"); // å°†ç›è®¾ç½®è¿›åŽ» authenticationInfo.setCredentialsSalt(ByteSource.Util.bytes("SAKURA")); return authenticationInfo; &#125; // æ¨¡æ‹Ÿæ•°æ®åº“ä¸­æƒé™æŸ¥è¯¢ private Set&lt;String&gt; getPermissionsByUserName(String username) &#123; Set&lt;String&gt; sets = new HashSet&lt;String&gt;(); sets.add("user:delete"); sets.add("user:add"); return sets; &#125; // æ¨¡æ‹Ÿæ•°æ®åº“ä¸­è§’è‰²æŸ¥è¯¢ public Set&lt;String&gt; getRolesByUserName(String username) &#123; Set&lt;String&gt; sets = new HashSet&lt;String&gt;(); sets.add("admin"); sets.add("user"); return sets; &#125; // æ¨¡æ‹Ÿæ•°æ®åº“çš„æŸ¥è¯¢å‡­è¯ private String getPasswordByUserName(String username) &#123; return userMap.get(username); &#125; public static void main(String[] args) &#123; // MD5 + åŠ ç› Md5Hash md5Hash = new Md5Hash("123456", "SAKURA"); System.out.println(md5Hash.toString()); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.leezy.shiro.shirotest;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.authc.credential.HashedCredentialsMatcher;import org.apache.shiro.mgt.DefaultSecurityManager;import org.apache.shiro.subject.Subject;import org.junit.Test;import com.leezy.shiro.realm.CustomRealm;public class CustomRealmTest &#123; @Test public void testAuthentication() &#123; CustomRealm customRealm = new CustomRealm(); // 1. æž„å»ºSecurityManagerçŽ¯å¢ƒ DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); defaultSecurityManager.setRealm(customRealm); HashedCredentialsMatcher matcher = new HashedCredentialsMatcher(); // è®¾ç½®åŠ å¯†æ–¹å¼ matcher.setHashAlgorithmName("md5"); // è®¾ç½®åŠ å¯†æ¬¡æ•° matcher.setHashIterations(1); customRealm.setCredentialsMatcher(matcher); // 2. ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚ SecurityUtils.setSecurityManager(defaultSecurityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken("LEEZY", "123456"); subject.login(token); System.out.println("isAuthenticated: " + subject.isAuthenticated()); subject.checkRole("admin"); subject.checkPermission("user:delete"); subject.checkPermission("user:add"); &#125;&#125; Shiroé›†æˆSpring]]></content>
      <tags>
        <tag>SHIRO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS7 åŠ Ubuntu18 å¸¸ç”¨å‘½ä»¤æ€»ç»“]]></title>
    <url>%2F2019%2F02%2F03%2FCentOS7%20%E5%8F%8A%20Ubuntu18%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[å¸¸ç”¨çš„CentOSå‘½ä»¤æ€»ç»“ï¼Œæ–¹ä¾¿æŸ¥çœ‹ä¸Žè®°å¿†ã€‚ Linuxå¸¸ç”¨å‘½ä»¤(1)æŸ¥çœ‹DNSè®°å½•çš„å‘½ä»¤ï¼ˆAè®°å½•ã€MXè®°å½•ï¼‰ 123yum install bind-utilsdig +noall +answer www.leezy.top (2) æŸ¥çœ‹ç«¯å£å¸¸ç”¨å‘½ä»¤ï¼š 1netstat -lnp|grep 80 (3) æŸ¥çœ‹ç‰ˆæœ¬ 12ll /etc/*centos*cat /etc/centos-release (4) æŸ¥çœ‹å†…æ ¸ç»å¸¸åœ¨æ‰§è¡Œ yum udpate å‘½ä»¤åŽCentOSä¼šå‡ºçŽ°å¤šä¸ªå¯åŠ¨é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»å¸¸è¦åˆ é™¤ï¼š 12345678# æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬uname -a# æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„å…¨éƒ¨Kernelrpm -q kernel# åˆ é™¤å¤šä½™çš„å†…æ ¸å¯åŠ¨é¡¹yum remove kernel-3.10.0-957.el7.x86_64# é‡æ–°å¯åŠ¨reboot (5) ä¿®æ”¹ä¸»æœºå 123hostnamectl set-hostname NAME# é‡å¯æœºå™¨reboot CentOS Minimalç‰ˆæœ¬é…ç½®æ¢æºï¼šhttp://mirrors.163.com/.help/centos.html å®‰è£…è½¯ä»¶123yum install net-toolsyum install wgetyum install vim é…ç½®JAVAçŽ¯å¢ƒå˜é‡12345678910111213141516171819202122vim /etc/profile# åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ çŽ¯å¢ƒé…ç½®export JAVA_HOME=/usr/jdk-11.0.2export CLASSPATH=.:$&#123;JAVA_HOME&#125;/jre/lib/rt.jar:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jarexport PATH=$PATH:$&#123;JAVA_HOME&#125;/bin# ä½¿æ–°çš„çŽ¯å¢ƒç”Ÿæ•ˆsource /etc/profile# å½“Javaç‰ˆæœ¬æ›´æ–°æ—¶ï¼Œä»…ä»…ä¿®æ”¹JAVA_HOMEçš„è·¯å¾„æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦åˆ é™¤é“¾æŽ¥which java/usr/jdk_xxx/bin/javawhich javac /usr/jdk_xxx_/bin/javac# åˆ é™¤é“¾æŽ¥rm -rf /usr/jdk_xxx/bin/javarm -rf /usr/jdk_xxx_/bin/javac# å†æ‰§è¡Œä½¿å¾—æ–°çŽ¯å¢ƒç”Ÿæ•ˆsource /etc/profile GitLab CEç‰ˆå®‰è£…æ–°å»º /etc/yum.repos.d/gitlab-ce.repoï¼Œå†…å®¹ä¸ºï¼š 12345[gitlab-ce]name=Gitlab CE Repositorybaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/gpgcheck=0enabled=1 å†æ‰§è¡Œï¼š 1234567891011sudo yum install curl openssh-server openssh-clients postfix croniesudo service postfix startsystemctl enable postfix.service(yum install lokkit)sudo lokkit -s http -s sshsudo yum makecachesudo yum install gitlab-ce#å¯åŠ¨GitLabsudo gitlab-ctl reconfigure å¸¸ç”¨çš„ç½‘ç»œé…ç½®ä¿®æ”¹DNS(è²Œä¼¼ä¼šé‡å¯å¤±æ•ˆ) 1vim /etc/resolv.conf ä¿®æ”¹IPåœ°å€ 1vim /etc/sysconfig/network-scripts/ifcfg-enp0s3 æ¸…ç†å†…å­˜1234echo 3 &gt; /proc/sys/vm/drop_caches# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µfree -h Dockerå®‰è£…åŠé…ç½®Dockerå®˜æ–¹æ–‡æ¡£è®¿é—®è¿™é‡Œ é˜¿é‡Œäº‘å®‰è£…æ–‡æ¡£è¿™é‡ŒDockerå®‰è£… 12# ä»…å…¬ç½‘çŽ¯å¢ƒï¼Œä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun ç”±äºŽç›´æŽ¥ä½¿ç”¨DockerHubä¸‹è½½çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„å®¹å™¨é•œåƒåŠ é€ŸæœåŠ¡,é˜¿é‡Œäº‘é…ç½®åœ°å€è®¿é—®ç½‘å€è¿™é‡Œï¼š 12345678sudo mkdir -p /etc/dockersudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'&#123; "registry-mirrors": ["åŠ é€Ÿå™¨åœ°å€"]&#125;EOFsudo systemctl daemon-reloadsudo systemctl restart docker è¿™æ ·å°±å¯ä»¥å¿«é€Ÿçš„ä½¿ç”¨Docker pull ç­‰å‘½ä»¤äº†ã€‚æ¸…ç†Dcoker å®¹å™¨ï¼š 1docker system prune å¼€æ”¾é˜²ç«å¢™ç«¯å£12345678# --permanent æ°¸ä¹…ç”Ÿæ•ˆfirewall-cmd --zone=public --add-port=9092/tcp --permanent# é‡æ–°è½½å…¥firewall-cmd --reload# æŸ¥çœ‹firewall-cmd --zone=public --query-port=80/tcp# åˆ é™¤firewall-cmd --zone=public --remove-port=80/tcp --permanent Puttyè¿žæŽ¥Ubuntuè™šæ‹Ÿæœº é¦–å…ˆç¡®ä¿è‡ªå·±æœ‰rootæƒé™ 12# è®¾ç½®rootå¯†ç sudo passwd é¦–å…ˆé…ç½®Host-Onlyç½‘å¡ï¼Œç„¶åŽç‚¹å‡» ç™»å…¥è™šæ‹Ÿæœºä½¿ç”¨ifconfig -aå‘½ä»¤, å‘çŽ°ä¼šæœ‰ä¸‰ä¸ªç½‘å¡(lo-æœ¬åœ°ã€enp0s3-NETã€enp0s8-Host-Only), ä½†æ˜¯Host-Onlyæ²¡æœ‰IPåœ°å€ è¾“å…¥sudo dhclient enp0s8, å³å¯èŽ·å–IPåœ°å€ Ubuntu 18.0æ–°ç‰ˆåŽ, /etc/network/interfacesçš„æ–‡ä»¶é…ç½®å·²ç»è¢«å¼ƒç”¨, vim /etc/netplan/50-cloud-init.yaml é…ç½®å¦‚ä¸‹ï¼š 12345678910111213141516# This file is generated from information provided by# the datasource. Changes to it will not persist across an instance.# To disable cloud-init's network configuration capabilities, write a file# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:# network: &#123;config: disabled&#125;network: ethernets: enp0s3: dhcp4: true enp0s8: dhcp4: false addresses: [192.168.56.101/24] nameservers: &#123;&#125; optional: true version: 2~ ä¿®æ”¹å®Œä»¥åŽç›´æŽ¥æ‰§è¡Œ sudo netplan apply é‡å¯sshæœåŠ¡ 1service ssh restart]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Šé‡æ–°å®šä¹‰SpringCloudå®žæˆ˜ã€‹è¯»ä¹¦ç¬”è®°]]></title>
    <url>%2F2018%2F12%2F18%2FSpringCloud%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[SpringCloudæä¾›äº†å¿«é€Ÿæž„å»ºåˆ†å¸ƒå¼ä¸­å¸¸è§æ¨¡å¼çš„å·¥å…·ï¼ŒåŒ…æ‹¬é…ç½®ç®¡ç†ã€æœåŠ¡å‘çŽ°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æŽ§åˆ¶æ€»çº¿ç­‰ã€‚SpringCloudä¸­é—´ä»¶æ˜¯åŸºäºŽSpringBootçš„å®žçŽ°ï¼Œæä¾›äº†å¯¹å¾®æœåŠ¡å®Œæ•´çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚ åº”ç”¨æž¶æž„çš„å‘å±•åŽ†ç¨‹ï¼šå•ä½“åº”ç”¨æž¶æž„ â€“&gt; åˆ†å¸ƒå¼æž¶æž„ â€“&gt;é¢å‘æœåŠ¡çš„SOAæž¶æž„ â€“&gt; å¾®æœåŠ¡æž¶æž„SOAæž¶æž„ä¸ªäººç†è§£æ˜¯å¤šä¸ªåº”ç”¨ä¹‹é—´é€šè¿‡ä¼ä¸šæ•°æ®æ€»çº¿ESBé€šä¿¡çš„æž¶æž„ï¼Œå…¶åº”ç”¨ç¨‹åºé€šè¿‡ç½‘ç»œåè®®æä¾›æœåŠ¡ï¼Œæ¶ˆè´¹æœåŠ¡ï¼Œä¸åŒä¸šåŠ¡æä¾›ä¸åŒçš„æœåŠ¡ã€‚(é˜¿é‡Œçš„æœåŠ¡æ²»ç†æ¡†æž¶Dubbo)å¾®æœåŠ¡æž¶æž„ï¼šä¸€ä¸ªå¤§åž‹çš„åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¹‹é—´æ¾è€¦åˆï¼Œé€šè¿‡REST APIæˆ–è€…HTTPè¿›è¡Œé€šä¿¡ã€‚ SpringCloudåŒ…åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼šæœåŠ¡æ²»ç†ç»„ä»¶ Eureka / Consul + å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç»„ä»¶ Ribbon + å£°æ˜Žå¼æœåŠ¡è°ƒç”¨ç»„ä»¶ Feign + APIç½‘å…³æ²»ç†ç»„ä»¶ Zuul / GateWay(é«˜å¹¶å‘) + ç†”æ–­æœºåˆ¶ HyStrix + åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒç»„ä»¶ Spring Cloud Config / æºç¨‹ Apollo + æ¶ˆæ¯æ€»çº¿ç»„ä»¶ Bus + æ¶ˆæ¯é©±åŠ¨ç»„ä»¶ Stream + åˆ†å¸ƒå¼æœåŠ¡è·Ÿè¸ªç»„ä»¶ Sleuth + å…¨é“¾è·¯ç›‘æŽ§ SkyWalking. Tips: ä»£ç åŸºäºŽSpring Cloud Finchley ç‰ˆæœ¬ æœåŠ¡æ²»ç†ï¼šSpring Cloud Eurekaè´Ÿè´£å¾®æœåŠ¡æž¶æž„ä¸­çš„æœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œå³å„ä¸ªå¾®æœåŠ¡å®žä¾‹çš„è‡ªåŠ¨åŒ–æ³¨å†Œä¸Žå‘çŽ°ã€‚SpringCloud Eureka æ˜¯ç”± Netflix Eurekaå®žçŽ°çš„ï¼Œå³åŒ…å«äº†æœåŠ¡ç«¯ç»„ä»¶ä¹ŸåŒ…å«äº†å®¢æˆ·ç«¯ç»„ä»¶ã€‚EurekaæœåŠ¡ç«¯ä¹Ÿè¢«ç§°ä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå„ä¸ªå¾®æœåŠ¡å¯åŠ¨æ—¶ä¼šå‘Eureka Server æ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼šåœ¨https://start.spring.io/ ä¸­æ–°å»ºä¸€ä¸ªEureka Serverçš„Demoï¼Œæˆ–è€…ç›´æŽ¥åœ¨Mavené¡¹ç›®ä¸­çš„pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹Dependence: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.1.1.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;eureka-server&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;eureka-server&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Greenwich.RC1&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;/repository&gt; &lt;/repositories&gt;&lt;/project&gt; EurekaServerApplication.java 1234567891011121314151617package com.leezy.eureka_server;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;@SpringBootApplication//è¯¥æ³¨è§£å¯åŠ¨ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒæä¾›ç»™å…¶ä»–åº”ç”¨ä¼šè¯@EnableEurekaServerpublic class EurekaServerApplication &#123; public static void main(String[] args) &#123; System.out.println("Hello Eureka Server!"); SpringApplication.run(EurekaServerApplication.class, args); &#125;&#125; Eureka Server ä¸­çš„ application.yml å’Œ application-standalone.yml 12345678910111213141516# application.ymlspring: profiles: active: standalone jackson: serialization: FAIL_ON_EMPTY_BEANS: falseeureka: server: use-read-only-response-cache: false response-cache-auto-expiration-in-seconds: 10management: endpoints: web: exposure: include: '*' 123456789101112131415# application-standalone.ymlserver: port: 8761eureka: instance: hostname: localhost client: registerWithEureka: false #æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Server, é»˜è®¤ä¸ºTrue fetchRegistry: false #æ˜¯å¦éœ€è¦ä»ŽEureka ServerèŽ·å–æ³¨å†Œä¿¡æ¯, é»˜è®¤ä¸ºTure serviceUrl: defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/ # æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡çš„åœ°å€ï¼Œå¤šä¸ªç”¨","éš”å¼€ server: waitTimeInMsWhenSyncEmpty: 0 enableSelfPreservation: false æ‰“å¼€ http://localhost:8761/ çœ‹åˆ°Eurekaçš„æŽ§åˆ¶é¢æ¿ã€‚EurekaæœåŠ¡æ³¨å†Œç«¯ï¼Œ Eureka Clientå°†å¾®æœåŠ¡æ³¨å†Œåˆ°Eureka Serverä¸Šã€‚EurekaClientApplication.java 1234567891011121314151617package com.leezy.eureka_client;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;@SpringBootApplication// è¯¥æ³¨è§£é€‚é…æ€§æ¯”è¾ƒå¥½ï¼Œå¯ä»¥ç”¨äºŽå¤šç§æœåŠ¡å‘çŽ°ç»„ä»¶(Zookeeperã€Consul)@EnableDiscoveryClientpublic class EurekaClientApplication &#123; public static void main(String[] args) &#123; System.out.println("Hello Eureka Client!"); SpringApplication.run(EurekaClientApplication.class, args); &#125;&#125; Mavenä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;&lt;/dependency&gt; Eureka Clientçš„é…ç½®æ–‡ä»¶ï¼š application.yml å’Œ application-demo.yml 1234#application.ymlspring: profiles: active: demo 1234567891011121314#application-demo.ymlserver: port: 8081Spring: application: name: demo-leezy #å£°æ˜ŽæœåŠ¡æä¾›è€…çš„åº”ç”¨åç§°eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ #è®¾ç½®ä¸ŽEureka Serveräº¤äº’çš„åœ°å€ instance: prefer-ip-address: true åˆ·æ–°EurekaæŽ§åˆ¶å°å°±å¯ä»¥çœ‹åˆ°æ³¨å†Œåˆ°Serverä¸Šçš„æœåŠ¡äº†ã€‚ Eurekaçš„è®¾è®¡ç†å¿µï¼š æœåŠ¡å®žä¾‹å¦‚ä½•æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒï¼šï¼ˆ1ï¼‰è°ƒç”¨Eureka Serverçš„REST API çš„ registeræ–¹æ³•ï¼ˆ2ï¼‰Javaè¯­è¨€ä½¿ç”¨è€…å¯ä»¥è°ƒç”¨NetFlixçš„Eureka Clientå°è£…çš„APIï¼ˆ3ï¼‰Spring Cloudä½¿ç”¨è€…åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•ç”¨ spring-cloud-starter-netflix-eureka-clientï¼ŒåŸºäºŽSpring Bootçš„è‡ªåŠ¨é…ç½®å³å¯ã€‚ æœåŠ¡å®žä¾‹ä»ŽæœåŠ¡ä¸­å¿ƒå‰”é™¤ï¼ˆ1ï¼‰æœåŠ¡å®žä¾‹æ­£å¸¸å…³é—­æ—¶ï¼Œé€šè¿‡é’©å­æ–¹æ³•æˆ–è€…ç”Ÿå‘½å‘¨æœŸå›žè°ƒæ–¹æ³•è°ƒç”¨Eureka Server çš„REST APIçš„de-registeræ–¹æ³•ã€‚ï¼ˆ2ï¼‰Eurekaè¦æ±‚Clientå®šæ—¶ç»­çº¦(30s)ï¼Œå¦‚æžœ90sæ²¡æœ‰ç»­çº¦æ“ä½œåˆ™Eureka Serverä¸»åŠ¨å‰”é™¤è¯¥æ“ä½œã€‚ æœåŠ¡å®žä¾‹ä¿¡æ¯çš„ä¸€è‡´æ€§é—®é¢˜æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°ä¸­å¿ƒåº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œå¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼ˆ1ï¼‰APä¼˜äºŽCP (Zookeeper-CP, Eureka-AP)ï¼ˆ2ï¼‰Peer to Peeræž¶æž„(1. ä¸»ä»Žå¤åˆ¶ 2. å¯¹ç­‰å¤åˆ¶)ï¼ˆ3ï¼‰ZoneåŠRegionè®¾è®¡ï¼ˆ4ï¼‰SELF PRESERVATIONè®¾è®¡ WebServiceå®¢æˆ·ç«¯ FeignFeignæ˜¯ä¸€ä¸ªå£°æ˜Žå¼çš„Web Serviceå®¢æˆ·ç«¯ï¼Œç”¨äºŽæœåŠ¡ä¸ŽæœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œæ”¯æŒSpringMVCæ³¨è§£ï¼Œæ•´åˆäº†Ribbonä»¥åŠHystrixã€‚å¯¹åº”çš„POMä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;&lt;/dependency&gt; åº”ç”¨å…¥å£ç¨‹åºSpringCloudFeignApplication.java 123456789101112131415package com.leezy.hello_feign;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.openfeign.EnableFeignClients;@SpringBootApplication@EnableFeignClientspublic class HelloFeignApplication &#123; public static void main( String[] args ) &#123; SpringApplication.run(HelloFeignApplication.class, args); &#125;&#125; æŽ¥å£ç±»ï¼šHelloFeignService.javaï¼Œä½œç”¨æ˜¯åº”ç”¨æŒ‡å®šçš„URLæœ€ç»ˆè½¬åŒ–ä¸ºGithub APIå…è®¸çš„URLã€‚egï¼šhttps://api.github.com/search/repositories?q=spring-cloud(Github RestAPIçš„æ–‡æ¡£ï¼šhttps://developer.github.com/v3/search/) 1234567891011121314package com.leezy.hello_feign.service;import org.springframework.cloud.openfeign.FeignClient;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.RequestParam;import com.leezy.hello_feign.config.HelloFeignServiceConfig;@FeignClient(name = "github-client", url = "https://api.github.com", configuration = HelloFeignServiceConfig.class)public interface HelloFeignService &#123; @RequestMapping(value = "/search/repositories", method = RequestMethod.GET) String searchRepo(@RequestParam(name = "q") String quertStr);&#125; æŽ§åˆ¶ç±»ï¼šHelloFeignController.javaï¼Œä½œç”¨ï¼šè°ƒç”¨æœåŠ¡æä¾›è€…çš„æŽ¥å£ 123456789101112131415161718192021package com.leezy.hello_feign.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;import com.leezy.hello_feign.service.HelloFeignService;@RestControllerpublic class HelloFeignController &#123; @Autowired private HelloFeignService helloFeignService; @GetMapping(value = "/search/github") public String searchGithubRepoByStr(@RequestParam("str") String queryStr) &#123; return helloFeignService.searchRepo(queryStr); &#125;&#125; é…ç½®ç±»ï¼šHelloFeignServiceConfig.javaï¼Œ@Beanæ³¨è§£é…ç½®æ—¥å¿—çš„bean 123456789101112131415package com.leezy.hello_feign.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import feign.Logger;@Configurationpublic class HelloFeignServiceConfig &#123; @Bean Logger.Level feignLoggerLevel() &#123; //levelæœ‰å››ä¸ªçº§åˆ« return Logger.Level.FULL; &#125;&#125; é…ç½®æ–‡ä»¶: application.yml 123456789server: port: 8010spring: application: name: Hello Feignlogging: level: com.leezy.hello_feign.service.HelloFeignService: DEBUG #åœ¨è¿™é‡Œé…ç½®æ—¥å¿—çš„è¾“å‡ºçº§åˆ« å¯åŠ¨åº”ç”¨åŽï¼Œè®¿é—®ç½‘å€ï¼šhttp://localhost:8010/search/github?str=spring-cloudFeignæ”¯æŒçš„å±žæ€§æ–‡ä»¶é…ç½®æ–¹å¼æœ‰ä¸¤ç§ï¼šapplication.yml(application.properties) ä»¥åŠ Javaæ–¹å¼çš„é…ç½®ç±»ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§ä¼šé«˜äºŽJavaç±»çš„ä¼˜å…ˆçº§ã€‚Feigné»˜è®¤çš„æ˜¯JDKåŽŸç”Ÿçš„URL Connectionï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨è¿žæŽ¥æ± ï¼Œå¯ä»¥ç”¨Http Clientå’Œ okHttpè¿›è¡Œæ›¿æ¢å¯¹é¡¹ç›®è¿›è¡Œè°ƒä¼˜ã€‚ Feign çš„ POST å’Œ GET çš„å¤šå‚æ•°ä¼ é€’Feignæ‹¦æˆªå™¨ï¼Œå°†Jsonè½¬åŒ–ä¸ºMapã€‚å®žçŽ°Feignçš„RequestInterceptorä¸­çš„applyæ–¹æ³•æ¥è¿›è¡Œç»Ÿä¸€æ‹¦æˆªè½¬æ¢å¤„ç†Feignä¸­çš„GETæ–¹æ³•å¤šå‚æ•°ä¼ é€’é—®é¢˜ã€‚é›†æˆSwapperï¼Œç¼–å†™æœåŠ¡æ¶ˆè´¹è€…ç”¨äºŽè°ƒç”¨Feignè¿›è¡ŒGetæˆ–Postå¤šå‚æ•°ä¼ é€’ã€‚ è´Ÿè½½å‡è¡¡ç»„ä»¶ RibbonFeignä¸­é›†æˆäº†Ribbonï¼Œä½†æ˜¯Ribbonå¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ç§è¿›ç¨‹å†…è´Ÿè½½å‡è¡¡å™¨ï¼ˆå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼‰ï¼Œå®ƒèµ‹äºˆäº†åº”ç”¨æ”¯é…Httpå’ŒTcpçš„èƒ½åŠ›ã€‚è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šæœ€å¸¸ç”¨çš„æ˜¯RoundRobinRule è½®è¯¢ç­–ç•¥ä»£ç æ ·ä¾‹ï¼špom.xml 12345678910&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; å¯åŠ¨ç±»ï¼šRibbonLoadbalancerApplication.javaæ³¨å…¥ä¸€ä¸ªRestTemplateçš„Beanï¼Œå¹¶ä¸”ä½¿ç”¨@LoadBalancesæ³¨è§£æ‰èƒ½ä½¿å…¶å…·å¤‡è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ã€‚ 1234567891011121314151617181920212223package cn.springcloud.book;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;import org.springframework.cloud.client.loadbalancer.LoadBalanced;import org.springframework.context.annotation.Bean;import org.springframework.web.client.RestTemplate;@SpringBootApplication@EnableDiscoveryClientpublic class RibbonLoadbalancerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(RibbonLoadbalancerApplication.class, args); &#125; @Bean @LoadBalanced public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125;&#125; TestController.javaRibbonå®¢æˆ·ç«¯éœ€è¦åˆ›å»ºä¸€ä¸ªAPIæ¥è°ƒç”¨EurekaæºæœåŠ¡è‡ªå®šä¹‰çš„API 12345678910111213141516171819import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;import org.springframework.web.client.RestTemplate;@RestControllerpublic class TestController &#123; @Autowired private RestTemplate restTemplate; @GetMapping("/add") public String add(Integer a, Integer b) &#123; String result = restTemplate .getForObject("http://CLIENT-A/add?a=" + a + "&amp;b=" + b, String.class); System.out.println(result); return result; &#125;&#125; é€šè¿‡æŸ¥æ‰¾ç»§æ‰¿å…³ç³»ï¼Œå‘çŽ°æŽ¥å£ILoadBalancerçš„å®žçŽ°æŠ½è±¡ç±»AbstractLoadBalancerçš„å®žçŽ°ç±»BaseLoadBalancerä¸­çš„chooseServeræ–¹æ³•æ˜¯çœŸæ­£å®žçŽ°è´Ÿè½½å‡è¡¡çš„åœ°æ–¹ã€‚ 123456789101112131415161718192021/* * Get the alive server dedicated to key * * @return the dedicated server */public Server chooseServer(Object key) &#123; if (counter == null) &#123; counter = createCounter(); &#125; counter.increment(); if (rule == null) &#123; return null; &#125; else &#123; try &#123; return rule.choose(key); &#125; catch (Exception e) &#123; logger.warn("LoadBalancer [&#123;&#125;]: Error choosing server for key &#123;&#125;", name, key, e); return null; &#125; &#125;&#125; ç†”æ–­æœºåˆ¶ Spring Cloud HystrixHystrix is a latency and fault tolerance library designed to isolate points of access to remote systems, services and 3rd party libraries, stop cascading failure and enable resilience in complex distributed systems where failure is inevitable.Hystrixçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š é€šè¿‡å®¢æˆ·ç«¯å¯¹å»¶è¿Ÿå’Œæ•…éšœè¿›è¡Œä¿æŠ¤å’ŒæŽ§åˆ¶ åœ¨ä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åœæ­¢çº§è”æ•…éšœ å¿«é€Ÿå¤±è´¥å’Œè¿…é€Ÿæ¢å¤ åœ¨åˆç†çš„æƒ…å†µä¸‹å›žé€€å’Œä¼˜é›…åœ°é™çº§ å¼€å¯å®žæ—¶ç›‘æŽ§ã€å‘Šè­¦å’Œæ“ä½œæŽ§åˆ¶pom.xml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.1.1.RELEASE&lt;/version&gt; &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.leezy&lt;/groupId&gt; &lt;artifactId&gt;hystrix&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;hystrix&lt;/name&gt; &lt;url&gt;http://maven.apache.org&lt;/url&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;Greenwich.RC1&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-milestones&lt;/id&gt; &lt;name&gt;Spring Milestones&lt;/name&gt; &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt; &lt;/repository&gt; &lt;/repositories&gt;&lt;/project&gt; ClientApplication.java 123456789101112131415package com.leezy.hystrix;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.client.discovery.EnableDiscoveryClient;import org.springframework.cloud.netflix.hystrix.EnableHystrix;@SpringBootApplication@EnableHystrix@EnableDiscoveryClientpublic class ClientApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ClientApplication.class, args); &#125;&#125; TestController.java 12345678910111213141516171819package com.leezy.hystrix.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;import com.leezy.hystrix.service.IUserService;@RestControllerpublic class TestController &#123; @Autowired private IUserService userService; @GetMapping("/getUser") public String getUser(@RequestParam String username) throws Exception&#123; return userService.getUser(username); &#125;&#125; IUserService.java 12345package com.leezy.hystrix.service;public interface IUserService &#123; public String getUser(String username) throws Exception;&#125; UserService.java 12345678910111213141516171819202122232425package com.leezy.hystrix.service.impl;import org.springframework.stereotype.Component;import com.leezy.hystrix.service.IUserService;import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;@Componentpublic class UserService implements IUserService&#123; // é™çº§å¤„ç† @Override @HystrixCommand(fallbackMethod="defaultUser") public String getUser(String username) throws Exception &#123; if (username.equals("spring")) &#123; return "This is real user."; &#125; else &#123; throw new Exception(); &#125; &#125; public String defaultUser(String username) &#123; return "The User does not exist in the system...Test!"; &#125;&#125; bootstrap.yml 1234567891011server: port: 8888spring: application: name: hystrix-client-serviceeureka: client: serviceUrl: defaultZone: http://$&#123;eureka.host:127.0.0.1&#125;:$&#123;eureka.port:8761&#125;/eureka/ instance: prefer-ip-address: true æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8888/getUser?username=spring å’Œ http://localhost:8888/getUser?username=testERROR Hystrix DashboardHystrix Dashboardä»ªè¡¨ç›˜æ˜¯æ ¹æ®ç³»ç»Ÿä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„è¯·æ±‚æƒ…å†µæ¥å±•ç¤ºçš„å¯è§†åŒ–é¢æ¿ã€‚Hystrixçš„æŒ‡æ ‡éœ€è¦ç«¯å£è¿›è¡Œæ”¯æ’‘ï¼Œæ‰€ä»¥éœ€è¦å¢žåŠ actuatorä¾èµ–ã€‚pom.xml 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;&lt;/dependency&gt; HystrixDashboardApplication.java 12345678@SpringBootApplication@EnableDiscoveryClient@EnableHystrixDashboardpublic class HystrixDashboardApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(HystrixDashboardApplication.class, args); &#125;&#125; ä¸Šé¢æ˜¯å•ä¸ªå®žä¾‹çš„Hystrix Dashboard,æ•´ä¸ªç³»ç»Ÿå’Œé›†ç¾¤çš„æƒ…å†µä¸‹å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚Turbineå°±æ˜¯èšåˆæ‰€æœ‰ç›¸å…³Hystrix.stream æµçš„æ–¹æ¡ˆã€‚ ç½‘å…³æ²»ç†ç»„ä»¶ ZuulZuul is the front door for all requests from devices and web sites to the backend of the Netflix streaming application. Zuulæ˜¯å¯¹å†…éƒ¨çš„å¾®æœåŠ¡æä¾›å¯é…ç½®çš„ï¼Œå¯¹å¤–URLåˆ°æœåŠ¡çš„æ˜ å°„å…³ç³»ï¼ŒåŸºäºŽJVMçš„åŽç«¯è·¯ç”±å™¨ã€‚pom.xml 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;&lt;/dependency&gt; å¯åŠ¨ç±»ZuulServerApplication.java 12345678@SpringBootApplication@EnableDiscoveryClient@EnableZuulProxypublic class ZuulServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ZuulServerApplication.class, args); &#125;&#125; bootstrap.yml 12345678910111213141516spring: application: name: zuul-serverserver: port: 5555eureka: client: serviceUrl: defaultZone: http://$&#123;eureka.host:127.0.0.1&#125;:$&#123;eureka.port:8888&#125;/eureka/ instance: prefer-ip-address: truezuul: routes: client-a: path: /client/** serviceId: client-a æœ€åŽäº”è¡Œçš„ä»£ç è¡¨ç¤ºï¼ŒZuulç»„ä»¶çš„ç«¯å£ä¸ºportAï¼Œåˆ™å°†/clientå¼€å¤´çš„URLæ˜ å°„æ­é…client-aè¿™ä¸ªæœåŠ¡ä¸­åŽ»ï¼Œå³å®žé™…è®¿é—®portBã€‚/* åŒ¹é…ä»»æ„æ•°é‡çš„è·¯å¾„å’Œå­—ç¬¦/ åŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦/? åŒ¹é…å•ä¸ªå­—ç¬¦ Spring Cloud Zuul Filteré“¾(1) Filterçš„ç±»åž‹(2) Filterçš„æ‰§è¡Œé¡ºåº(3) Filterçš„æ‰§è¡Œæ¡ä»¶(4) Filterçš„æ‰§è¡Œæ•ˆæžœZuulæœ‰å››ç§ä¸åŒç”Ÿå‘½å‘¨æœŸçš„Filter,åˆ†åˆ«æ˜¯ï¼špre Filter æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸‹çº§æœåŠ¡ä¹‹å‰æ‰§è¡Œã€‚æ¯”å¦‚é‰´æƒã€é™æµç­‰route Filter è·¯ç”±åŠ¨ä½œçš„æ‰§è¡Œè€…ï¼ˆApache HttpClientæˆ–Netflix Ribbonæž„å»ºå’Œå‘é€åŽŸå§‹Httpè¯·æ±‚çš„åœ°æ–¹ï¼‰post Fliter åœ¨æºæœåŠ¡è¿”å›žç»“æžœæˆ–è€…å¼‚å¸¸ä¿¡æ¯å‘ç”ŸåŽæ‰§è¡Œçš„ï¼Œå¯¹è¿”å›žä¿¡æ¯åšä¸€äº›å¤„ç†error Filter åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å¦‚æžœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™ä¼šè¿›å…¥error Filter Spring Cloud Zuul æƒé™é›†æˆOAuth2.0 + JWT(JSON Web Token) åŠ¨æ€è·¯ç”± Dynamic Routingæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šï¼ˆ1ï¼‰ Spring Cloud Config + Busã€åŠ¨æ€åˆ·æ–°é…ç½®æ–‡ä»¶ã€‚ï¼ˆ2ï¼‰ é‡å†™Zuulçš„é…ç½®è¯»å–æ–¹å¼]]></content>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootå­¦ä¹ ]]></title>
    <url>%2F2018%2F12%2F11%2FSpringBoot%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[Spring Boot makes it easy to create stand-alone, production-grade Spring-based Applications that you can run. 1. å¸¸è§æ³¨è§£@RequestMapping (@GetMapping &amp; @PostMapping)The @RequestMapping annotation provides â€œroutingâ€ information. It tells Spring that any HTTP request with the / path should be mapped to the home method.@GetMappingæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œæ˜¯@RequestMapping(method = RequestMethod.GET)çš„ç¼©å†™ã€‚@PostMappingæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œæ˜¯@RequestMapping(method = RequestMethod.POST)çš„ç¼©å†™ã€‚ @RestControllerThe @RestController annotation tells Spring to render the resulting string directly back to the caller.ç­‰ä»·äºŽ @Controller + @ResponseBody,ä¸ºäº†ä½¿Httpè¯·æ±‚è¿”å›žæ•°æ®æ ¼å¼ä¸ºjsonæ ¼å¼ã€‚ @EnableAutoConfigurationSince spring-boot-starter-web added Tomcat and Spring MVC, the auto-configuration assumes that you are developing a web application and sets up Spring accordingly. @ConditionalOnPropertyå¯ä»¥ç”¨æ¥æŽ§åˆ¶é…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚ @SpringBootApplicationThe @SpringBootApplication annotation is often placed on your main class, and it implicitly defines a base â€œsearch packageâ€ for certain items. same as @Configuration,@EnableAutoConfiguration,@ComponentScan. 12345678910111213package com.example.myapplication;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@SpringBootApplicationpublic class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125; @ConfigurationDeclare the configuration Classes. @EnableAutoConfigurationIf you find that specific auto-configuration classes that you do not want are being applied, you can use the exclude attribute of @EnableAutoConfiguration to disable them. 12345678import org.springframework.boot.autoconfigure.*;import org.springframework.boot.autoconfigure.jdbc.*;import org.springframework.context.annotation.*;@Configuration@EnableAutoConfiguration(exclude=&#123;DataSourceAutoConfiguration.class&#125;)public class MyConfiguration &#123;&#125; @EnableConfigurationProperties å’Œ @ConfigurationPropertiesè¿™ä¸¤ä¸ªæ³¨è§£çš„ä½œç”¨å¯ä»¥å‚è§ Spring Boot å®˜æ–¹æ–‡æ¡£ 12345678910111213@Component@ConfigurationPropertiespublic class UriConfigurationProperties &#123; private String httpbin = "http://httpbin.org:80"; public String getHttpbin() &#123; return httpbin; &#125; public void setHttpbin(String httpbin) &#123; this.httpbin = httpbin; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536package org.spring.cloud.gateway;import org.spring.cloud.gateway.properties.UriConfigurationProperties;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.cloud.gateway.route.RouteLocator;import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;import org.springframework.context.annotation.Bean;@SpringBootApplication//@EnableConfigurationProperties(org.spring.cloud.gateway.properties.UriConfigurationProperties.class)public class GateWayApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(GateWayApplication.class, args); &#125; @Bean public RouteLocator myRoutes(RouteLocatorBuilder builder, UriConfigurationProperties uriConfiguration) &#123; String httpUri = uriConfiguration.getHttpbin(); return builder.routes() .route(p -&gt; p .path("/get") .filters(f -&gt; f.addRequestHeader("Hello", "World")) .uri(httpUri)) .route(p -&gt; p .host("*.hystrix.com") .filters(f -&gt; f .hystrix(config -&gt; config .setName("mycmd") .setFallbackUri("forward:/fallback"))) .uri(httpUri)) .build(); &#125;&#125; ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶ä½äºŽä¸¤ä¸ªåŒ…ä¸‹ï¼Œå¦‚æžœåœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨äº†@Componentï¼Œåˆ™åœ¨ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­å°±ä¸èƒ½å†ä½¿ç”¨@EnableConfigurationPropertiesæ³¨è§£ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ï¼Œæç¤ºæœ‰ä¸¤ä¸ªBeanã€‚å¦‚æžœç¬¬ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä½¿ç”¨@Componentåˆ™ç¬¬äºŒä¸ªæ–‡ä»¶å¯ä»¥å°†æ³¨é‡ŠåŽ»æŽ‰ã€‚ å•å…ƒæµ‹è¯•å¸¸ç”¨æ³¨è§£ @RunWith(SpringJUnit4ClassRunner.class)å¼•å…¥Springå¯¹JUnit4çš„æ”¯æŒã€‚ @SpringApplicationConfiguration(classes = HelloApplication.class)æŒ‡å®šSpringBootçš„å¯åŠ¨ç±» @WebAppConfigurationå¼€å¯Webåº”ç”¨é…ç½®ï¼Œç”¨äºŽæ¨¡æ‹ŸServletContext @Before &amp; @Test &amp; @After@Beforeï¼šJUnitä¸­å®šä¹‰åœ¨æµ‹è¯•ç”¨ä¾‹@Testå†…å®¹æ‰§è¡Œå‰é¢„åŠ è½½çš„å†…å®¹ï¼ŒåŒç†åˆ¤æ–­ã€‚ 2. Starter POMs1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; å‘½åè§„åˆ™éƒ½æ˜¯spring-boot-starter-ï¼Œä»£è¡¨ä¸€ä¸ªç‰¹åˆ«çš„åº”ç”¨åŠŸèƒ½æ¨¡å—ã€‚ spring-boot-starter-webå…¨æ ˆWebå¼€å‘æ¨¡å—ï¼ŒåŒ…å«åµŒå…¥å¼çš„Tomcatã€SpringMVC spring-boot-starter-teståŒ…å«Junitã€Hamcrestã€Mockito spring-boot-starter-actuatorä¸ºSpringBootæž„å»ºçš„åº”ç”¨æä¾›ä¸€ç³»åˆ—ç”¨äºŽç›‘æŽ§çš„ç«¯ç‚¹ã€‚è®¿é—®ï¼šhttp://127.0.0.1:8080/actuatorå¯ä»¥çœ‹åˆ°è¾“å‡ºäº†å¦‚ä¸‹JSONæ–‡ä»¶ï¼š 123456789101112131415161718192021222324&#123; "_links": &#123; "self": &#123; "href": "http://127.0.0.1:8080/actuator", "templated": false &#125;, "health": &#123; "href": "http://127.0.0.1:8080/actuator/health", "templated": false &#125;, "health-component": &#123; "href": "http://127.0.0.1:8080/actuator/health/&#123;component&#125;", "templated": true &#125;, "health-component-instance": &#123; "href": "http://127.0.0.1:8080/actuator/health/&#123;component&#125;/&#123;instance&#125;", "templated": true &#125;, "info": &#123; "href": "http://127.0.0.1:8080/actuator/info", "templated": false &#125; &#125;&#125; spring-boot-devtools(1) Property Defaults(2) Automatic Restart(3) LiveReload(4) Global Settings(5) Remote Applications 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt; é…ç½®æ–‡ä»¶SpringBootçš„é»˜è®¤é…ç½®æ–‡ä»¶ä½ç½®æ˜¯src/main/resources/application.properties. 123&lt;!-- application.properties --&gt;book.name=JAVAç¼–ç¨‹æ€æƒ³book.author=Bruce Eckel åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨ @Vlaueæ³¨è§£æ¥åŠ è½½è¿™äº›è‡ªå®šä¹‰çš„å‚æ•° 1234567@Componentpublic class Book &#123; @Value("$&#123;book.name&#125;") private String name; @value("$&#123;book.author&#125;") private String author;&#125; Javaä»£ç ä¸­å¼•ç”¨æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š PlaceHolderæ–¹å¼ ${â€¦} SpELè¡¨è¾¾å¼ #{â€¦} é€šè¿‡application-{profile}å¤šçŽ¯å¢ƒé…ç½®æ–‡ä»¶ï¼šapplication-dev.properties:å¼€å‘çŽ¯å¢ƒapplication-test.properties:æµ‹è¯•çŽ¯å¢ƒapplication-prod.properties:ç”Ÿäº§çŽ¯å¢ƒåœ¨application.propertiesä¸­çš„spring.profiles.activeå±žæ€§æ¥è®¾ç½®ã€‚ 12// è°ƒç”¨æµ‹è¯•çŽ¯å¢ƒspring.profiles.active = test; åœ¨é‡‡ç”¨java -jar xxx.jar å½¢å¼è¿è¡Œé¡¹ç›®æ—¶ï¼Œâ€â€“â€å°±æ˜¯å¯¹application.propertiesä¸­çš„å±žæ€§å€¼è¿›è¡Œèµ‹å€¼çš„æ ‡è¯†ã€‚é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§é¡ºåºå¦‚ä¸‹ï¼šå‘½ä»¤è¡Œè¾“å…¥ &gt; åŒ…å¤– &gt; åŒ…å†…æ‰€ä»¥å¯ä»¥åœ¨åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å¯¹é…ç½®è¿›è¡Œå¿«é€Ÿå‡†ç¡®çš„æ›´æ”¹ã€‚ spring.factoriesæ–‡ä»¶Spring Factorieså®žçŽ°åŽŸç†(package org.springframework.core.io.supportåŒ…ä¸‹çš„SpringFactoriesLoader.classæ–‡ä»¶;)Spring å®¹å™¨åˆå§‹åŒ–æ—¶ä¼šåŠ è½½è¯¥æ–‡ä»¶å£°æ˜Žçš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡@SpringBootApplspring-coreåŒ…é‡Œå®šä¹‰äº†SpringFactoriesLoaderç±»ï¼Œè¿™ä¸ªç±»å®žçŽ°äº†æ£€ç´¢META-INF/spring.factoriesæ–‡ä»¶ï¼Œå¹¶èŽ·å–æŒ‡å®šæŽ¥å£çš„é…ç½®çš„åŠŸèƒ½ã€‚åœ¨è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªå¯¹å¤–çš„æ–¹æ³•ï¼š loadFactories: æ ¹æ®æŽ¥å£ç±»èŽ·å–å…¶å®žçŽ°ç±»çš„å®žä¾‹ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›žçš„æ˜¯å¯¹è±¡åˆ—è¡¨ã€‚loadFactoryNames: æ ¹æ®æŽ¥å£èŽ·å–å…¶æŽ¥å£ç±»çš„åç§°ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›žçš„æ˜¯ç±»åçš„åˆ—è¡¨ã€‚ bootstrap.ymlå’Œappllication.ymlçš„åŒºåˆ«bootstrap.ymlåŠ è½½ï¼ˆçˆ¶SpringApplicationContextï¼‰é¡ºåºåœ¨application.ymlä¹‹å‰ï¼Œç”¨äºŽåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µã€‚ç”¨äºŽæŒ‡å®šspring.application.nameå’Œspring.cloud.config.server.git.uriä»¥åŠä¸€äº›åŠ å¯†å’Œè§£å¯†ä¿¡æ¯ã€‚egï¼šSpring Cloud Config é…ç½®ä¸­å¿ƒå†ä½¿ç”¨æ—¶ï¼Œé€šå¸¸å°†è®¿é—®è¿œç¨‹æ–‡ä»¶é…ç½®ä¿¡æ¯å†™åœ¨bootstrap.ymlæ–‡ä»¶ä¸­ã€‚]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[WebServiceå­¦ä¹ ]]></title>
    <url>%2F2018%2F11%2F26%2FWebService%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[WebServiceçš„ä¸¤ç§å®žçŽ°æ–¹å¼ï¼ŒSoap WebServiceã€Restful WebServiceã€‚ RPC refers to Remote Procedure Call.Use of RPC is recommended when there is heavy use of the client/server model.RPC allows for the processing of multiple threads that share a given address.RPC employed on a platform that uses EJB.Web Service used in non-Java platforms when an app wants access.Web Service also is used for synchronization of asynchronous communication.[1] WebServiceæ˜¯ä¸€ç§æŠ€æœ¯ï¼Œæœ‰ä¸¤ç§å®žçŽ°æ–¹å¼ï¼šJAX-WS(Java API for XML-Based Serviceé¢å‘æ¶ˆæ¯)ã€JAX-RS(Java API for Restful WebServiceé¢å‘èµ„æº)ps. RESTful è¯·æ±‚å¸¸ç”¨çš„æ–¹æ³•æœ‰ä»¥ä¸‹å››ç§ï¼š GET: ç”¨äºŽæŸ¥è¯¢å¯¹è±¡ POST: ç”¨äºŽåˆ›å»ºå¯¹è±¡ PUT: ç”¨äºŽä¿®æ”¹å¯¹è±¡ DELETE: ç”¨äºŽåˆ é™¤å¯¹è±¡ 1. CXF åŸºäºŽ SOAP çš„ WebService12345678&lt;!-- IHelloWorld.java --&gt;package top.leezy.www;import javax.jws.WebService;@WebServicepublic interface IHelloWorld &#123; String sayHello(String name);&#125; 12345678&lt;!-- HelloWorldImpl.java --&gt;package top.leezy.www;public class HelloWorldImpl implements IHelloWorld &#123; public String sayHello(String name) &#123; return "Hello " + name; &#125;&#125; 1234567891011121314151617&lt;!-- applicationContext.xml --&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jaxws="http://cxf.apache.org/jaxws" xmlns:cxf="http://cxf.apache.org/core" xmlns:wsa="http://cxf.apache.org/ws/addressing" xsi:schemaLocation="http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.1.xsd http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd"&gt; &lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt; &lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt; &lt;jaxws:endpoint id="HelloWorld" implementor="top.leezy.www.HelloWorldImpl" address="/sayHello" /&gt; &lt;/beans&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&lt;!-- web.xml --&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" id="WebApp_ID" version="3.1"&gt; &lt;display-name&gt;CXFwebservice&lt;/display-name&gt; &lt;welcome-file-list&gt; &lt;welcome-file&gt;index.html&lt;/welcome-file&gt; &lt;/welcome-file-list&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:top/**/applicationContext.xml&lt;/param-value&gt; &lt;/context-param&gt; &lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;servlet&gt; &lt;servlet-name&gt;CxfServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet&lt;/servlet-class&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;CxfServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/webservice/*&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;filter&gt; &lt;filter-name&gt;encoding&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;UTF-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;forceEncoding&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;encoding&lt;/filter-name&gt; &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;encoding&lt;/filter-name&gt; &lt;url-pattern&gt;*.do&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;/web-app&gt; æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼šhttp://127.0.0.1:8081/SoapWebService/webservice 2. CXF åŸºäºŽ RestFul çš„ WebService12345678910111213141516&lt;!-- Config.java --&gt;package top.leezy.www;import java.util.LinkedList;import java.util.List;public class Config &#123; public static List&lt;User&gt; users; static &#123; users = new LinkedList&lt;User&gt;(); User user = new User(); user.setId("123456"); user.setName("SAKURA"); users.add(user); &#125;&#125; 12345678910111213141516171819202122232425262728&lt;!-- User.java --&gt;package top.leezy.www;import javax.xml.bind.annotation.XmlRootElement;@XmlRootElement(name = "User")public class User &#123; private String name; private String id; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getId() &#123; return id; &#125; public void setId(String id) &#123; this.id = id; &#125; &#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980&lt;!-- UserService.java --&gt;package top.leezy.www;import javax.ws.rs.Consumes;import javax.ws.rs.DELETE;import javax.ws.rs.GET;import javax.ws.rs.POST;import javax.ws.rs.PUT;import javax.ws.rs.Path;import javax.ws.rs.Produces;import javax.ws.rs.PathParam;import javax.ws.rs.QueryParam;import javax.ws.rs.core.MediaType;import javax.ws.rs.core.Response;import javax.ws.rs.core.Response.Status;@Path("/UserService")// å¯ä»¥æ³¨é‡Šåœ¨æ–¹æ³•ä¸Šæˆ–è€…ç±»ä¸Šï¼ˆä»¥æœ€å°å•ä½ä¸ºå‡†ï¼‰, æŒ‡å®šè¿”å›žç»™å®¢æˆ·ç«¯çš„ç±»åž‹@Produces(&#123;"application/json", "application/xml"&#125;)public class UserService &#123; @GET @Path("/getUser/&#123;id&#125;") @Produces(MediaType.APPLICATION_XML) public User getUser(@PathParam("id") String id) &#123; if (id != null &amp;&amp; id.length() &gt; 0) &#123; for (User user : Config.users) &#123; if(id.equals(user.getId())) return user; &#125; User add_user = new User(); add_user.setId(id); return add_user; &#125; else &#123; return new User(); &#125; &#125; @POST @Path("/regUser") // ä¸€èˆ¬ç”¨äºŽ @PUTã€@POST, ç”¨äºŽæŽ¥å—å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„MIMEç±»åž‹ @Consumes(&#123;"application/json", "application/xml"&#125;) public Response regUser(User user) &#123; if (Config.users.contains(user)) &#123; return Response.status(Status.BAD_REQUEST).build(); &#125; else &#123; Config.users.add(user); return Response.ok("id = " + user.getId() + ", name = " + user.getName()).build(); &#125; &#125; @DELETE @Path("/delUser") @Consumes(&#123;"application/json", "application/xml"&#125;) public Response delPerson(@QueryParam("id") String id) &#123; User user = new User(); user.setId(id); if (Config.users.contains(user)) &#123; return Response.status(Status.BAD_REQUEST).build(); &#125; else &#123; Config.users.remove(user); return Response.ok(user).build(); &#125; &#125; @PUT @Path("/updateUser") @Consumes(&#123;"application/json", "application/xml"&#125;) public Response updateUser(User user) &#123; if (Config.users.contains(user)) &#123; return Response.status(Status.BAD_REQUEST).build(); &#125;else &#123; for (User old_user : Config.users) &#123; if (old_user.equals(user)) &#123; old_user.setName(user.getName()); &#125; &#125; return Response.ok(user).build(); &#125; &#125;&#125; 123456789101112131415161718192021&lt;!-- beans.xml --&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jaxrs="http://cxf.apache.org/jaxrs" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd"&gt; &lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt; &lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt; &lt;bean id="userService" class="top.leezy.www.UserService" /&gt; &lt;jaxrs:server id="rs_server" address="/restfulService"&gt; &lt;jaxrs:serviceBeans&gt; &lt;ref bean="userService" /&gt; &lt;/jaxrs:serviceBeans&gt; &lt;/jaxrs:server&gt;&lt;/beans&gt; 12345678910111213141516171819202122232425262728293031&lt;!-- web.xml --&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" id="WebApp_ID" version="3.0"&gt; &lt;display-name&gt;CxfRestWebservice&lt;/display-name&gt; &lt;welcome-file-list&gt; &lt;welcome-file&gt;index.html&lt;/welcome-file&gt; &lt;/welcome-file-list&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:top/**/beans.xml&lt;/param-value&gt; &lt;/context-param&gt; &lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;servlet&gt; &lt;servlet-name&gt;cxfservlet&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet&lt;/servlet-class&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;cxfservlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/webservice/*&lt;/url-pattern&gt; &lt;/servlet-mapping&gt;&lt;/web-app&gt; æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼šhttp://127.0.0.1:8081/RestFulWebService/webservice/ä½¿ç”¨POSTManè¿›è¡Œæµ‹è¯•ï¼šRestFul WebService çš„JARåŒ…è¾ƒ Soap WebService è¦åŒºåˆ«ä»¥ä¸‹å‡ ä¸ªï¼š-javax.ws.rs-api-2.1.1.jar-cxf-rt-frontend-jaxrs-3.2.7.jar å‚è€ƒæ–‡çŒ®ï¼š[1]http://www.differencebetween.net/technology/protocols-formats/difference-between-rpc-and-web-service/#ixzz5YLemRQhd[2]https://www.cnblogs.com/zhuyiqizhi/p/6213502.html]]></content>
      <tags>
        <tag>JavaWEB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOSå®‰è£…Tomcat]]></title>
    <url>%2F2018%2F11%2F20%2FCentOS%E5%AE%89%E8%A3%85Tomcat%2F</url>
    <content type="text"><![CDATA[ç³»ç»Ÿï¼šCentOS Linux release 7.5.1804Tomcatç‰ˆæœ¬ï¼š apache-tomcat-7.0.92.tar.gz 1. ä¸‹è½½Tomcatä¸‹è½½é“¾æŽ¥ï¼šhttps://www-us.apache.org/dist/tomcat/tomcat-7/v7.0.92/bin/apache-tomcat-7.0.92.tar.gz 2. è§£åŽ‹ç¼©æ–‡ä»¶1tar -zxvf apache-tomcat-7.0.92.tar.gz 3. æ‰“å¼€8080ç«¯å£å¹¶é‡å¯é˜²ç«å¢™12firewall-cmd --zone=public --add-port=8080/tcp --permanentfirewall-cmd --reload 4. é…ç½®tomcat-users.xml12345&lt;!-- åœ¨æœ€åŽæ·»åŠ ç”¨æˆ·è§’è‰²ç”¨æˆ·åå¯†ç  å‚æ•°æ„ä¹‰å¯ä»¥åœ¨è‡ªå¸¦çš„æ–‡æ¡£ä¸ŠæŸ¥çœ‹--&gt;&lt;role rolename="admin-gui"/&gt;&lt;role rolename="manager-gui"/&gt;&lt;role rolename="manager-jmx"/&gt;&lt;user username="admin" password="admin" roles="admin-gui,manager-gui,manager-jmx" /&gt; 5. è®¿é—®Tomcat Managerè®¿é—®åœ°å€ï¼š http://192.168.56.101:8080/ å¹¶ç™»é™† admin admin]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDBå®‰è£…]]></title>
    <url>%2F2018%2F11%2F20%2FMongoDB%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[å®‰è£…è§£åŽ‹ç¼©ç‰ˆæœ¬çš„MongoDB(mongodb-win32-x86_64-2008plus-ssl-4.0.4)çš„ç®€å•å‘½ä»¤ã€‚ 1. é…ç½®çŽ¯å¢ƒå˜é‡12# åŠ å…¥çŽ¯å¢ƒå˜é‡C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\bin 2. åˆ›å»º data æ–‡ä»¶å¤¹ åŠ log æ–‡ä»¶å¤¹åˆ›å»º mongodb-data å’Œ mongodb-log æ–‡ä»¶å¤¹ 3. ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œå®‰è£…å‘½ä»¤12cd C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\binmongod --dbpath "C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\mongodb-data" --logpath "C:\Program Files\mongodb-win32-x86_64-2008plus-ssl-4.0.4\mongodb-log\MongoDB.log" --install --serviceName "mongo" --logappend --directoryperdb 4. æµ‹è¯•å®‰è£…ç»“æžœè®¿é—® http://127.0.0.1:27017/]]></content>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TensorFlowå®žéªŒè®°å½•]]></title>
    <url>%2F2018%2F03%2F06%2FTensorFlow%E5%AE%9E%E9%AA%8C%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[çŽ¯å¢ƒè¯´æ˜Žï¼šç³»ç»Ÿï¼šUbuntu Server 16.04.1 LTS 64ä½Pythonç‰ˆæœ¬ï¼šPython 3.5.2TensorFlowç‰ˆæœ¬ï¼š1.4 ç”¨æˆ·åˆ‡æ¢ï¼ˆæœ€å¥½å¯ç”¨rootå¦åˆ™ä¼šæœ‰Bugï¼‰1234# è¾“å…¥Linux rootç”¨æˆ·å¯†ç sudo passwd root# é»˜è®¤ç”¨æˆ·åˆ‡æ¢åˆ°rootç”¨æˆ·su root å®‰è£…pythonçŽ¯å¢ƒ12345# ä¸ç”¨é»˜è®¤çš„2.7 å®‰è£…python3.5sudo apt-get install python3.5# ç³»ç»ŸçŽ¯å¢ƒåˆ‡æ¢æˆpython3.5sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150 å®‰è£…TensorFlow12345678# é‡‡ç”¨pipå®‰è£…ï¼Œé¦–å…ˆå®‰è£…# æŸ¥çœ‹ç³»ç»Ÿå†…ç½®çš„pipç‰ˆæœ¬pip3 -V# æ›´æ–°å¹¶å®‰è£…sudo apt-get install python3-pip python3-devsudo pip install --upgrade pip# å®‰è£…CPUç‰ˆæœ¬çš„TensorFlowpip3 install tensorflow æ³¨æ„è¦ä¿è¯pipæ˜¯æœ€æ–°ç‰ˆæœ¬å¦åˆ™ä¼šå‡ºçŽ°ä»¥ä¸‹é”™è¯¯ï¼š æµ‹è¯•TensorFlow123456python&gt;&gt;&gt; import tensorflow as tf&gt;&gt;&gt; hello = tf.constant('Hello, TensorFlow')&gt;&gt;&gt; sess = tf.Session()&gt;&gt;&gt; print(sess.run(hello)) æŸ¥çœ‹TensorFlowç‰ˆæœ¬ å¤‡ç”¨çŸ¥è¯†ç‚¹(Note)123451. vim -r filename æ¢å¤æœªæ­£å¸¸ä¿å­˜ç”Ÿæˆçš„.swapæ–‡ä»¶2. (Note)convolutional neural network å·ç§¯ç¥žç»ç½‘ç»œrectified linear unit çº¿æ€§ä¿®æ­£å•å…ƒ ReLUinput layer --&gt; hidden layer(more than one) --&gt; output layer çŽ¯å¢ƒå‡†å¤‡12345678910111213pip3 install -U scikit-learnpip3 install scipy# ä¸‹è½½ MNIST æ•°æ®é›†ï¼ˆhttp://wiki.jikexueyuan.com/project/tensorflow-zh/tutorials/mnist_download.htmlï¼‰wget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/t10k-images-idx3-ubyte.gzwget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/t10k-labels-idx1-ubyte.gzwget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/train-images-idx3-ubyte.gzwget http://tensorflow-1253902462.cosgz.myqcloud.com/mnist_cnn/train-labels-idx1-ubyte.gzpip3 install \ -i https://pypi.tuna.tsinghua.edu.cn/simple/ \ https://mirrors.tuna.tsinghua.edu.cn/tensorflow/linux/cpu/tensorflow-1.7.0-cp35-cp35m-linux_x86_64.whl WindowsçŽ¯å¢ƒä¸‹.ipynbæ–‡ä»¶ç›¸å…³ï¼ˆpythonç¬”è®°ï¼‰1234567# å®‰è£…pythonçŽ¯å¢ƒä¸å¿…å¤šè¯´pip install ipythonpip install &quot;ipython[notebook]&quot;# cd åˆ°æœ‰.ipynbæ–‡ä»¶çš„ç›®å½•ä¸‹æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å°±ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ç‚¹å‡»æ–‡ä»¶å³å¯æ‰“å¼€æ–‡ä»¶ipython notebook]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>TensorFlow</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++æ ‡å‡†æ¨¡æ¿åº“STLå­¦ä¹ ç¬”è®°]]></title>
    <url>%2F2018%2F02%2F27%2FC%2B%2B%E6%A0%87%E5%87%86%E6%A8%A1%E6%9D%BF%E5%BA%93STL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[é¢è¯•ç¬”è¯•ç®—æ³•å¿…å¤‡çŸ¥è¯†ç‚¹ï¼æ–‡ç« å†…å®¹æ€»ç»“è‡ªã€Šç®—æ³•ç¬”è®°ã€‹ï¼Œæ—¶åˆ»å·©å›ºä»¥å…å¿˜è®°(lllï¿¢Ï‰ï¿¢) 1.vectoryç”¨æ³•ï¼šVectoryï¼šå˜é•¿æ•°ç»„ å®šä¹‰æ–¹æ³•ï¼š 1234567891011vectory&lt;typename&gt; name;// eg:vectory&lt;int&gt; nums;// å¦‚æžœtypenameç±»åž‹ä¹Ÿæ˜¯ä¸€ä¸ªSTLå®¹å™¨ï¼Œå®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼švectory&lt;vectory&lt;int&gt; &gt; name; // &gt;&gt;ä¹‹é—´æœ‰ç©ºæ ¼é¿å…æ­§ä¹‰ --ã€‹ä¸¤ç»´éƒ½å¯å˜çš„äºŒç»´æ•°ç»„// vectoryæ•°ç»„çš„å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼švectory&lt;typename&gt; Arrayname[arraySize] // ä¸€ç»´å¯å˜çš„äºŒç»´æ•°ç»„// eg:vectory&lt;int&gt; nums[10] è®¿é—®æ–¹æ³•ï¼š 123456789// é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼šnums[0], nums[1];// é€šè¿‡è¿­ä»£å™¨è®¿é—®ï¼švectory&lt;typename&gt;::iterator it;//eg:vectory&lt;int&gt;::iterator it; // å¾—åˆ°è¿­ä»£å™¨itï¼Œé€šè¿‡*itè¿›è¡Œè®¿é—®vectory// nums[i] ç­‰ä»·äºŽ *(it + i) å¸¸ç”¨å‡½æ•°ï¼š 1234567891. push_back(x) åœ¨vectoryæœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ x O(1) nums.push_back(i);2. pop_back() åœ¨vectoryæœ«å°¾åˆ é™¤ä¸€ä¸ªå…ƒç´  O(1) nums.pop_back();3. size() æ±‚å¾—vectoryå…ƒç´ ä¸ªæ•° O(1) nums.size()4. begin() æ±‚å¾—vectoryæ•°ç»„numsé¦–åœ°å€ä¸ŽitæŒ‡å‘åœ°å€ä¸€æ · O(1) nums.beagin()5. end() æ±‚å¾—vectoryæ•°ç»„numså°¾å…ƒç´ çš„ä¸‹ä¸€ä¸ªåœ°å€ O(1) nums.end()6. clear() æ¸…ç©ºvectoryæ‰€æœ‰å…ƒç´  O(n) nums.clear()7. insert(it, x) å‘vectoryä»»æ„è¿­ä»£å™¨itå¤„æ’å…¥ä¸€ä¸ªå…ƒç´ x O(N) nums.insert(nums.begin() + 2ï¼Œ 3)8. erase(it) åˆ é™¤è¿­ä»£å™¨itå¤„å…ƒç´  O(n) nums.erase(nums.begin() + 2)9. erase(first, last) åˆ é™¤[first, last)å†…çš„æ‰€æœ‰å…ƒç´  O(n) nums.erase(num.begin() + 1, num.end())åˆ é™¤é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¤–çš„å…¶ä»–å…ƒç´ ]]></content>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSMæ¡†æž¶æ€»ç»“]]></title>
    <url>%2F2017%2F08%2F09%2FSSM%E6%A1%86%E6%9E%B6%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[SSMæ¡†æž¶çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†æ€»ç»“ã€‚ 1.SSMå®šä¹‰SSM = Spring + SpringMVC + MyBatisSpring:Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æŽ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰çš„å®¹å™¨æ¡†æž¶ã€‚ SpringMVCå‘½ååŠåˆ†å±‚ï¼šedu.xju.common.util å…¬å…±éƒ¨åˆ†edu.xju.controller æŽ§åˆ¶å±‚edu.xju.dao æ•°æ®å±‚edu.xju.entity å®žä½“å±‚edu.xju.service æœåŠ¡å±‚ MyBatis:æ¯”Hibernateè¦çµæ´»å¤šç”¨äºŽéœ€æ±‚ä¸æ–­å˜æ›´çš„é¡¹ç›®ã€‚ 2.Webé¡¹ç›®æ‰§è¡Œé¡ºåº123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;!-- web.xml ç¨‹åºæ‰§è¡Œå…¥å£ --&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" id="WebApp_ID" version="3.0"&gt; &lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring-*.xml&lt;/param-value&gt; &lt;/context-param&gt; &lt;filter&gt; &lt;filter-name&gt;characterEncoding&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;UTF-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;characterEncoding&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;servlet&gt; &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt; &lt;!-- å¦‚æžœä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼ŒSpring Web MVCæ¡†æž¶å°†åŠ è½½â€œclasspath:spring-mvc.xmlâ€æ¥è¿›è¡Œåˆå§‹åŒ–ä¸Šä¸‹æ–‡è€Œä¸æ˜¯â€œ/WEB-INF/[servletåå­—]-servlet.xmlâ€ã€‚ --&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;!-- ä¼ ç»™ä¸Šä¸‹æ–‡å®žä¾‹ï¼ˆç”±contextClassæŒ‡å®šï¼‰çš„å­—ç¬¦ä¸²ï¼Œç”¨æ¥æŒ‡å®šä¸Šä¸‹æ–‡çš„ä½ç½®ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è¢«åˆ†æˆå¤šä¸ªå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ æ¥æ”¯æŒå¤šä¸ªä¸Šä¸‹æ–‡ï¼ˆåœ¨å¤šä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œå¦‚æžœåŒä¸€ä¸ªbeanè¢«å®šä¹‰ä¸¤æ¬¡ï¼ŒåŽé¢ä¸€ä¸ªä¼˜å…ˆï¼‰ã€‚ --&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;!-- load-on-startupï¼šè¡¨ç¤ºå¯åŠ¨å®¹å™¨æ—¶åˆå§‹åŒ–è¯¥Servletï¼› --&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt; &lt;!-- url-patternï¼šè¡¨ç¤ºå“ªäº›è¯·æ±‚äº¤ç»™Spring Web MVCå¤„ç†ï¼Œ â€œ/â€ æ˜¯ç”¨æ¥å®šä¹‰é»˜è®¤servletæ˜ å°„çš„ã€‚ä¹Ÿå¯ä»¥å¦‚â€œ*.htmlâ€è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰ä»¥htmlä¸ºæ‰©å±•åçš„è¯·æ±‚ã€‚ --&gt; &lt;url-pattern&gt;*.do&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.json&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;welcome-file-list&gt; &lt;!-- ä»Žmain.jspå¼€å§‹ --&gt; &lt;welcome-file&gt;main.jsp&lt;/welcome-file&gt; &lt;/welcome-file-list&gt;&lt;/web-app&gt; DispatcherServletæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œåœ¨è¿™é‡Œæ˜¯æ‹¦æˆª.doå’Œ.jsonç»“å°¾çš„è¯·æ±‚ã€‚è¯¥DispatcherServleté»˜è®¤ä½¿ç”¨WebApplicationContextä½œä¸ºä¸Šä¸‹æ–‡ï¼ŒSpringé»˜è®¤é…ç½®æ–‡ä»¶ä¸ºâ€œ/WEB-INF/[servletåå­—]-servlet.xmlâ€ã€‚ContextLoaderListeneråˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡å’ŒDispatcherServletåˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡å…³ç³»ContextLoaderListeneråˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡åŠ è½½çš„Beanæ˜¯å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå…±äº«çš„ï¼›DispatcherServletåˆå§‹åŒ–çš„ä¸Šä¸‹æ–‡åŠ è½½çš„Beanæ˜¯åªå¯¹Spring Web MVCæœ‰æ•ˆçš„Beanï¼›å³åªåŠ è½½Webç›¸å…³çš„ç»„ä»¶ã€‚DispatcherServletçš„ç»§æ‰¿å…³ç³» DispatcherServlet initialization parameters![DispatcherServlet initialization parameters](/assets/blogImg/DispatcherServlet initialization parameters.png) HttpServletBeanç»§æ‰¿HttpServletï¼Œå› æ­¤åœ¨Webå®¹å™¨å¯åŠ¨æ—¶å°†è°ƒç”¨å®ƒçš„initæ–¹æ³•ï¼Œè¯¥åˆå§‹åŒ–æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°†Servletåˆå§‹åŒ–å‚æ•°ï¼ˆinit-paramï¼‰è®¾ç½®åˆ°è¯¥ç»„ä»¶ä¸Šï¼ˆå¦‚contextAttributeã€contextClassã€namespaceã€contextConfigLocationï¼‰ï¼Œé€šè¿‡BeanWrapperç®€åŒ–è®¾å€¼è¿‡ç¨‹ï¼Œæ–¹ä¾¿åŽç»­ä½¿ç”¨ï¼›æä¾›ç»™å­ç±»åˆå§‹åŒ–æ‰©å±•ç‚¹ï¼ŒinitServletBean()ï¼Œè¯¥æ–¹æ³•ç”±FrameworkServletè¦†ç›–ã€‚ FrameworkServletç»§æ‰¿HttpServletBeanï¼Œé€šè¿‡initServletBean()è¿›è¡ŒWebä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼Œè¯¥æ–¹æ³•ä¸»è¦è¦†ç›–ä¸€ä¸‹ä¸¤ä»¶äº‹æƒ…ï¼š åˆå§‹åŒ–webä¸Šä¸‹æ–‡ï¼› æä¾›ç»™å­ç±»åˆå§‹åŒ–æ‰©å±•ç‚¹ï¼› DispatcherServletç»§æ‰¿FrameworkServletï¼Œå¹¶å®žçŽ°äº†onRefresh()æ–¹æ³•æä¾›ä¸€äº›å‰ç«¯æŽ§åˆ¶å™¨ç›¸å…³çš„é…ç½®ï¼› 12345678910111213141516171819202122232425262728&lt;!-- spring-mvc.xml --&gt;&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context" xmlns:mvc="http://www.springframework.org/schema/mvc" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt; &lt;!-- æ‰«æè¿™ä¸ªæŽ§åˆ¶åŒ…å†…éƒ¨çš„Controller --&gt; &lt;context:component-scan base-package="edu.xju.controller"/&gt; &lt;mvc:annotation-driven /&gt; &lt;bean id="jspViewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt; &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt; &lt;property name="prefix" value="/WEB-INF/jsp/"/&gt; &lt;property name="suffix" value=".jsp"/&gt; &lt;/bean&gt; &lt;bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"&gt; &lt;property name="messageConverters"&gt; &lt;list&gt; &lt;bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"&gt; &lt;/bean&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// spring-mybatis.xml&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd"&gt; &lt;context:component-scan base-package="edu"/&gt; &lt;aop:aspectj-autoproxy/&gt; &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt; &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="url" value="jdbc:mysql://localhost:3306/mydb?charsetEncoding=utf8"/&gt; &lt;property name="username" value="root"/&gt; &lt;property name="password" value="root"/&gt; &lt;/bean&gt; &lt;!--sessionFactoryä»£ç†--&gt; &lt;bean id="sessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt; &lt;property name="dataSource" ref="dataSource"/&gt; &lt;/bean&gt; &lt;!--æ³¨è§£æ‰«æ--&gt; &lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt; &lt;property name="basePackage" value="edu.xju.dao"/&gt; &lt;property name="sqlSessionFactoryBeanName" value="sessionFactory"/&gt; &lt;/bean&gt; &lt;!--spring äº‹åŠ¡ç®¡ç†--&gt; &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt; &lt;property name="dataSource" ref="dataSource"/&gt; &lt;/bean&gt; &lt;!--å®šä¹‰äº‹åŠ¡å£°æ˜Ž --&gt; &lt;tx:advice id="txAdvice" transaction-manager="transactionManager"&gt; &lt;tx:attributes&gt; &lt;tx:method name="get*" read-only="true" /&gt; &lt;tx:method name="add*" propagation="REQUIRED" /&gt; &lt;tx:method name="update*" propagation="REQUIRED" /&gt; &lt;tx:method name="delete*" propagation="REQUIRED" /&gt; &lt;/tx:attributes&gt; &lt;/tx:advice&gt; &lt;aop:config&gt; &lt;aop:pointcut id="serviceAop" expression="execution(* edu.xju.service.*Service.*(..))" /&gt; &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="serviceAop" /&gt; &lt;/aop:config&gt;&lt;/beans&gt; 1234567891011121314151617181920212223// main.jsp&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;&lt;title&gt;åŸºæœ¬çš„ ssm æ¡†æž¶&lt;/title&gt;&lt;style type="text/css"&gt; a&#123; font-size: 20px; display: block; margin-top: 30px; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;a href="$&#123;pageContext.request.contextPath &#125;/user/addUser.do"&gt;æ·»åŠ ç”¨æˆ·&lt;/a&gt;&lt;a href="$&#123;pageContext.request.contextPath &#125;/user/list.do"&gt;æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·&lt;/a&gt;&lt;a href="$&#123;pageContext.request.contextPath &#125;/user/getUserA.json?id=1"&gt;èŽ·å–æŸä¸ªç”¨æˆ·JSONæ ¼å¼1&lt;/a&gt;&lt;a href="$&#123;pageContext.request.contextPath &#125;/user/getUserB.json?id=2"&gt;èŽ·å–æŸä¸ªç”¨æˆ·JSONæ ¼å¼2&lt;/a&gt;&lt;/body&gt;&lt;/html&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172// UserController.javapackage edu.xju.controller;import java.util.List;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import edu.xju.common.util.JsonUtil;import edu.xju.entity.User;import edu.xju.service.UserService;@Controller@RequestMapping("/user")public class UserController &#123; @Autowired private UserService userService; /** * è¿™ä¸ªæ˜¯è¿”å›žé¡µé¢ * @param model * @return */ @RequestMapping("/list.do") public String getUsers(Model model,HttpSession session)&#123; List&lt;User&gt; users = userService.getAll(); model.addAttribute("list",users); return "list"; &#125; /** * èŽ·å–json çš„ç¬¬ä¸€ç§æ–¹å¼ * è¿”å›žjson æ ¼å¼ * @param model * @param session * @param id * @return */ @RequestMapping("/getUserA.json") @ResponseBody public Object getUserByIdA(Model model,HttpSession session,Integer id )&#123; User user = userService.findUserById(id); return user; &#125; /** * èŽ·å–ç¬¬json çš„ç¬¬äºŒç§æ–¹å¼ * @param model * @param response * @param session * @param id */ @RequestMapping("/getUserB.json") public void getUserByIdB(Model model,HttpServletResponse response,HttpSession session,Integer id )&#123; User user = userService.findUserById(id); JsonUtil.printByJSON(response, user); &#125; @RequestMapping("/addUser.do") public String insertUser(Model model,HttpSession session,Integer id,String name,Integer age )&#123; name = "æµ‹è¯•å§“å"; age = 99; User user = new User(name, age); userService.addUser(user); return "insertOK"; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738// User.javapackage edu.xju.entity;public class User &#123; private Integer id; private String name; private int age; public User() &#123; &#125; public User( String name, int age) &#123; this.name = name; this.age = age; &#125; public Integer getId() &#123; return id; &#125; public void setId(Integer id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; &#125; 12345678910111213// UserService.javapackage edu.xju.service;import java.util.List;import edu.xju.entity.User;public interface UserService &#123; public List&lt;User&gt; getAll(); public User findUserById(Integer id); public void addUser(User user); &#125; 1234567891011121314151617181920212223242526272829// UserServiceImpl.javapackage edu.xju.service;import java.util.List;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import edu.xju.dao.UserMapper;import edu.xju.entity.User;@Servicepublic class UserServiceImpl implements UserService &#123; @Autowired private UserMapper userMapper; public List&lt;User&gt; getAll()&#123; return userMapper.getAll(); &#125; @Override public User findUserById(Integer id) &#123; return userMapper.getUserById(id); &#125; @Override public void addUser(User user) &#123; userMapper.insertUser(user); &#125;&#125; MyBatis 12345678910111213141516// UserMapper.javapackage edu.xju.dao;import java.util.List;import org.apache.ibatis.annotations.Param;import org.springframework.stereotype.Repository;import edu.xju.entity.User;@Repositorypublic interface UserMapper &#123; public List&lt;User&gt; getAll(); public User getUserById(@Param("id")Integer id); public void insertUser(User user);&#125; 123456789101112131415161718192021// UserMapper.xml&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;&lt;mapper namespace="edu.xju.dao.UserMapper" &gt; &lt;!-- å£°æ˜Žå±žæ€§ä¸ŽæŸ¥è¯¢å­—æ®µä¹‹é—´çš„çš„å¯¹åº”å…³ç³» --&gt; &lt;resultMap id="BaseResultMap" type="edu.xju.entity.User" &gt; &lt;id column="id" property="id" jdbcType="INTEGER" /&gt; &lt;result column="name" property="name" jdbcType="VARCHAR" /&gt; &lt;result column="age" property="age" jdbcType="INTEGER" /&gt; &lt;/resultMap&gt; &lt;select id="getAll" resultMap="BaseResultMap"&gt; select id,name,age from user &lt;/select&gt; &lt;select id="getUserById" parameterType="int" resultMap="BaseResultMap"&gt; select id,name,age from user where id = #&#123;id&#125; &lt;/select&gt; &lt;insert id="insertUser" parameterType="edu.xju.entity.User"&gt; insert into user(name,age) values(#&#123;name&#125;,#&#123;age&#125;) &lt;/insert&gt;&lt;/mapper&gt; 3.åºåˆ—å›¾ 4.å¸¸ç”¨æ³¨è§£è§£æžï¼š @Autowired å’Œ @Resourceçš„ä½¿ç”¨åœºæ™¯å’ŒåŒºåˆ« @Autowired æ˜¯byTypeè‡ªåŠ¨æ³¨å…¥ï¼Œæ˜¯Springçš„æ³¨è§£ã€‚@Resourceé»˜è®¤æ˜¯byNameæ³¨å…¥ï¼Œé»˜è®¤ä½¿ç”¨æˆå‘˜å±žæ€§çš„å˜é‡åæ³¨å…¥ï¼Œæ˜¯Javaè‡ªå¸¦çš„æ³¨è§£ã€‚ @Scope(â€œprototypeâ€) å’Œ @Scope(â€œsingletonâ€) çš„åŒºåˆ« singleton è¡¨ç¤ºSpringå®¹å™¨ä¸­çš„å•ä¾‹ï¼Œé€šè¿‡spring å®¹å™¨èŽ·å–è¯¥beanæ—¶æ€»æ˜¯è¿”å›žå”¯ä¸€çš„å®žä¾‹ã€‚prototype è¡¨ç¤ºæ¯æ¬¡èŽ·å–è¯¥beanæ—¶éƒ½ä¼šnew ä¸€ä¸ªæ–°çš„å¯¹è±¡å®žä¾‹ã€‚ 123456@Service@Scope("singleton")public class SingletonTestService &#123; private static int a = 0; private int b = 0;&#125; å¦‚ä»£ç æ‰€ç¤ºï¼Œå¦‚æžœè®¾ç½®ä¸ºsingletonï¼Œå½“a++å’Œb++æ—¶ï¼Œaå’Œbéƒ½ä¼šå¢žåŠ ã€‚å¦‚æžœè®¾ç½®ä¸ºprototypeçš„è¯ï¼Œåˆ™åªæœ‰aä¼šå¢žåŠ ï¼Œbä¸ä¼šå¢žåŠ ã€‚ static é™æ€å˜é‡ é™æ€å˜é‡æ•´ä¸ªå†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œä¸ºæ‰€æœ‰å¯¹è±¡æ‰€å…±äº«ï¼Œå½“ä¸”ä»…å½“ç±»åŠ è½½æ—¶æ‰ä¼šè¢«åˆå§‹åŒ–ï¼›è€Œéžé™æ€å˜é‡æ˜¯å¯¹è±¡æ‰€æ‹¥æœ‰çš„ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶è¢«åˆå§‹åŒ–ï¼Œå­˜åœ¨å¤šä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªå¯¹è±¡ä¹‹é—´æ‹¥æœ‰çš„å‰¯æœ¬äº’ä¸å½±å“ã€‚]]></content>
      <tags>
        <tag>JavaWEB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“è®¾è®¡æŠ€å·§]]></title>
    <url>%2F2017%2F08%2F09%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%8A%80%E5%B7%A7%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ•°æ®åº“çš„ä¸€äº›å‘çš„æ€»ç»“ã€‚ 1.Intä¸ŽIntegerçš„åŒºåˆ«1234567891011121314151617181920/** * å­¦ç”Ÿ * åœ¨ä½¿ç”¨Hibernateè®¾è®¡æ•°æ®è¡¨å£°æ˜Žæ•°æ®ç±»åž‹æ—¶ï¼ŒJavaä»£ç ä¸­IDä¸€èˆ¬éƒ½è®¾ç½®æˆIntegerç±»åž‹ï¼Œå› ä¸ºå®ƒå¯ä»¥é»˜è®¤ä¸ºnullï¼Œè€Œ * åœ¨ä½¿ç”¨æ€§åˆ«æ—¶ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Intç±»åž‹ */@Entity@Table(name = "tb_student")@Cache(usage=CacheConcurrencyStrategy.READ_WRITE)public class Student &#123; @Id @GeneratedValue(strategy=GenerationType.IDENTITY) private Integer id; // å§“å private String name; // å¹´é¾„ private int age; // æ€§åˆ« private int gender;&#125; 2.æœ‰ä¾èµ–å…³è”è¡¨ä¸Žæ— ä¾èµ–å…³è”è¡¨ä¸€å¼ è¡¨é‡Œåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œæˆ–è€…æœ‰ä¸€ç§æƒ…å†µæ˜¯one primary key included two fileds.æœ‰ä¾èµ–å…³è”è¡¨ï¼šé€šè¿‡åœ¨ç”¨æˆ·ä¿¡æ¯è¡¨é‡ŒåŠ å…¥ç”¨æˆ·IDå®žçŽ°ä¸¤å¼ è¡¨çš„å…³è”ã€‚ å…·ä½“å®žçŽ°ï¼šé€»è¾‘æ¨¡åž‹ç‰©ç†æ¨¡åž‹ æ— ä¾èµ–å…³è”è¡¨ï¼šé€šè¿‡å¼•å…¥ç¬¬ä¸‰å¼ è¡¨æ¥è¿›è¡Œç”¨æˆ·è¡¨ä¸Žç”¨æˆ·ä¿¡æ¯è¡¨çš„å…³è”ã€‚ 3.Hibernateä¸­ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šä»¥åŠå¤šå¯¹å¤šçš„æ³¨è§£å®žçŽ°12345678910111213141516171819202122232425262728293031323334353637// 1:1 &lt;==&gt; Person:IdCard// Person.java@Entity@Table(name = "tb_person")public class Person &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id; // å§“å private String name; // å¹´é¾„ private int age; // èº«ä»½è¯ @OneToOne(mappedBy="person") //æ”¾å¼ƒç»´æŠ¤ä¸»æŽ§æƒ private IdCard card;&#125;//IdCard.java@Entity@Table(name = "tb_idcard")public class IdCard &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id; // èº«ä»½è¯å· private String sno; // æ‰€å±žäºº @OneToOne @JoinColumn(name="person_id", unique=true) private Person person;&#125; 123456789101112131415161718192021222324252627282930313233343536373839// 1:n &lt;==&gt; Department:Employee// Department.java@Entity@Table(name = "tb_dept")@Cache(usage=CacheConcurrencyStrategy.READ_WRITE)public class Department &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id; // åç§° @Column(length = 50) private String name; // é»˜è®¤å®žä½“ç±»æ‰€æœ‰å­—æ®µéƒ½æ˜ å°„, å¯ä½¿ç”¨@Transientå£°æ˜Žä¸åšæ˜ å°„ private int sn; // æ‹¥æœ‰å¤šä¸ªå‘˜å·¥ @OneToMany(mappedBy = "dept") //mappedByï¼šè¡¨ç¤ºæ”¾å¼ƒç»´æŠ¤ä¸»æŽ§æƒ private Set&lt;Employee&gt; emps = new HashSet&lt;Employee&gt;();&#125;// Employee.java@Entity@Table(name="tb_emp")@Cache(usage=CacheConcurrencyStrategy.READ_WRITE)public class Employee &#123; @Id @GeneratedValue(strategy=GenerationType.IDENTITY) private Integer id; // å§“å private String name; // éƒ¨é—¨ @ManyToOne @JoinColumn(name="dept_id") private Department dept;&#125; 123456789101112131415161718192021222324252627282930313233// n:n &lt;==&gt; Course:Student// Course.java@Entity@Table(name = "tb_course")public class Course &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Integer id; // åç§° private String name; // å­¦ç”Ÿ @ManyToMany @JoinTable(name="tb_student_course", joinColumns=@JoinColumn(name="course_id"), inverseJoinColumns=@JoinColumn(name="student_id")) private Set&lt;Student&gt; students = new HashSet&lt;Student&gt;();&#125;// Student.java@Entity@Table(name="tb_student")public class Student &#123; @Id @GeneratedValue(strategy=GenerationType.IDENTITY) private Integer id; // å§“å private String name; // è¯¾ç¨‹ @ManyToMany(mappedBy="students") private Set&lt;Course&gt; courses = new HashSet&lt;Course&gt;();&#125;]]></content>
      <tags>
        <tag>MySQL</tag>
        <tag>Hibernate</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¢è¯•-JavaåŸºç¡€çŸ¥è¯†]]></title>
    <url>%2F2017%2F07%2F28%2FJAVA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-%E9%9D%A2%E8%AF%95%2F</url>
    <content type="text"><![CDATA[æ‰Žå®žåŸºç¡€ï¼ ç¬”è¯•è®©æˆ‘æ˜Žç™½äº†è‡ªå·±çš„ä¸€äº›é—®é¢˜ã€‚ 123456byte a = 100;byte b = 10;byte c = a + b;// æŠ¥é”™ é»˜è®¤æœ€ä½Žæ˜¯Intç±»åž‹byte c = (byte)a + b;int c = a + b; 1234567891011121314151617181920212223package com.lzy.test;public class Test1 &#123; public static void main(String[] args) &#123; int a = 0; int b = a++; System.out.println(a);//1 int c = ++a; System.out.println(a);//2 System.out.println(a++);//2 System.out.println(++a);//4 System.out.println(b);//0 System.out.println(c);//2 &#125;&#125;public static void main(String[] args) &#123; int a = 5; // açš„å˜åŒ–ï¼š6 7 8 9 10 // bçš„å˜åŒ–ï¼š 5 7 7 8 10 int b = a++ + ++a + a++ + a++ + ++a; System.out.println(b); //37 &#125; 123456789101112131415161718public class Test2 &#123; public static void main(String[] args) &#123; int a = 0; //&amp;å¯¹æ¯ä¸€ä¸ªéƒ½åˆ¤æ–­ï¼› if (a==0 &amp; a++==1) &#123; System.out.println("&amp;");//ä¸è¾“å‡º &#125; System.out.println(a);//1 //&amp;&amp;åªè¦å‰é¢æ˜¯falseå°±è¾“å‡ºfalseï¼Œè€Œä¸ç»§ç»­åˆ¤æ–­åŽé¢äº† if (a==0 &amp;&amp; a++==1) &#123; System.out.println("&amp;&amp;");//ä¸è¾“å‡º &#125; if (a==1 &amp;&amp; a++==1) &#123; System.out.println("&amp;&amp;");//è¾“å‡º &#125; &#125;&#125; 12345678910111213141516171819202122// éšæœºæ•° public static void main(String[] args) &#123; // éšæœºæ•°äº§ç”Ÿçš„èŒƒå›´æ˜¯[0, 1) double num = Math.random(); // è¿™æ ·å­[0, 0.5) [0.5, 1)æ‰èƒ½çœŸæ­£å¹³è¡¡ if (num &gt;= 0.5) &#123; System.out.println("æˆéƒ½"); &#125; else &#123; System.out.println("èµµé›·"); &#125; // è¾“å‡ºæŒ‡å®šèŒƒå›´çš„æ•°å­— // [26, 38] // æ–¹æ³•ä¸€ï¼š (int)(Math.random()*(max - min) + min); int a = 25; int b = 38; int scal = (int)(Math.random()*(b - a + 1)) + a; System.out.println(scal); // æ–¹æ³•äºŒï¼š int scall = (int)(Math.random() * 100 % 12) + a; System.out.println(scall); &#125; åŸºç¡€çŸ¥è¯†ç‚¹ä¸€ï¼š== ä¸Ž equalçš„åŒºåˆ«ï¼š == æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ã€‚ Equalsåˆ™æ˜¯stringå¯¹è±¡çš„æ–¹æ³•ï¼Œå¯ä»¥.ï¼ˆç‚¹ï¼‰å‡ºæ¥ã€‚ å› ä¸ºå¯¹è±¡å˜é‡çš„å­˜å‚¨çš„æ˜¯å¯¹è±¡åœ¨å†…å­˜ä¸­çš„è·¯å¾„ï¼Œå³å†…å­˜åœ°å€ã€‚æ‰€ä»¥ç”¨â€œ==â€æ¯”è¾ƒæ—¶ï¼Œå³ä½¿å¯¹è±¡çš„å€¼ç›¸ç­‰ï¼Œä½†æ˜¯ä»–ä»¬çš„å†…å­˜åœ°å€ä¸åŒ(å¼•ç”¨æ•°æ®ç±»åž‹)ï¼Œæ‰€ä»¥==çš„ç»“æžœä¸ºfalseã€‚æ•…â€œ==â€ç”¨äºŽæ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œè€Œä¸æ˜¯å˜é‡å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚ equalç”¨äºŽæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚ â€œ==â€æ¯”è¾ƒçš„æ˜¯å€¼ã€å˜é‡(æ ˆ)å†…å­˜ä¸­å­˜æ”¾çš„å¯¹è±¡çš„(å †)å†…å­˜åœ°å€ã€‘equalç”¨äºŽæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸åŒã€ä¸æ˜¯æ¯”åœ°å€ã€‘ ã€ç‰¹åˆ«æ³¨æ„ã€‘Objectç±»ä¸­çš„equalsæ–¹æ³•å’Œâ€œ==â€æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰åŒºåˆ«ï¼Œè€ŒStringç±»ï¼ŒIntegerç±»ç­‰ç­‰ä¸€äº›ç±»ï¼Œæ˜¯é‡å†™äº†equalsæ–¹æ³•ï¼Œæ‰ä½¿å¾—equalså’Œâ€œ==ä¸åŒâ€ï¼Œæ‰€ä»¥ï¼Œå½“è‡ªå·±åˆ›å»ºç±»æ—¶ï¼Œè‡ªåŠ¨ç»§æ‰¿äº†Objectçš„equalsæ–¹æ³•ï¼Œè¦æƒ³å®žçŽ°ä¸åŒçš„ç­‰äºŽæ¯”è¾ƒï¼Œå¿…é¡»é‡å†™equalsæ–¹æ³•ã€‚â€==â€æ¯”â€equalâ€è¿è¡Œé€Ÿåº¦å¿«,å› ä¸ºâ€==â€åªæ˜¯æ¯”è¾ƒå¼•ç”¨. äºŒï¼špublicã€protectedã€privateã€defaultï¼ˆfriendlyï¼‰çš„åŒºåˆ«: publicï¼šå¯ä»¥è¢«å…¶ä»–ç±»è®¿é—®privateï¼šåªèƒ½è¢«è‡ªå·±è®¿é—®å’Œä¿®æ”¹protected:ç±»å†…éƒ¨ã€å­ç±»ã€åŒä¸€ä¸ªåŒ…ä¸­çš„ç±»ä¹‹é—´å¯ä»¥è®¿é—®defaultï¼šä½œç”¨åŸŸæ˜¯åŒ…ï¼Œå¯ä»¥ä¸å†™ã€‚è¢«è®¤ä¸ºæ˜¯friendly finalå…³é”®å­—ï¼šä¿®é¥°ç±»ï¼šè¡¨ç¤ºè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œfinalç±»çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼çš„æŒ‡å®šä¸ºfinalæ–¹æ³•ä¿®é¥°æ–¹æ³•ï¼šå˜æ˜¯è¯¥æ–¹æ³•ä¸èƒ½è¢«å­ç±»ä¿®æ”¹ï¼Œç±»çš„privateæ–¹æ³•ä¼šè¢«éšå¼çš„æŒ‡å®šä¸ºfinalæ–¹æ³•ä¿®é¥°å˜é‡ï¼šåŸºæœ¬æ•°æ®å˜é‡ä¸å¯ä»¥è¢«æ›´æ”¹ å¼•ç”¨ç±»åž‹å˜é‡ä¸å¯ä»¥å†æ›´æ”¹æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ Javaçº¿ç¨‹å®‰å…¨ä¸Žéžçº¿ç¨‹å®‰å…¨ï¼šå¤šçº¿ç¨‹å®‰å…¨ä¼˜ç‚¹ä½“çŽ°åœ¨å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡ï¼Œéžçº¿ç¨‹å®‰å…¨ != ä¸å®‰å…¨çº¿ç¨‹å®‰å…¨æ˜¯é€šè¿‡çº¿ç¨‹åŒæ­¥æŽ§åˆ¶æ¥å®žçŽ°çš„ï¼Œä¹Ÿå°±æ˜¯synchronizedå…³é”®å­—ã€‚ArrayListæ˜¯éžçº¿ç¨‹å®‰å…¨ Vectoræ˜¯çº¿ç¨‹å®‰å…¨ï¼›HashMapæ˜¯éžçº¿ç¨‹å®‰å…¨ HashTableæ˜¯çº¿ç¨‹å®‰å…¨ï¼›StringBuilderæ˜¯éžçº¿ç¨‹å®‰å…¨ StringBufferæ˜¯çº¿ç¨‹å®‰å…¨ï¼›http://blog.csdn.net/YiZhiCXY/article/details/51335385 Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«ï¼šStringï¼š å­—ç¬¦ä¸²å¸¸é‡StringBuffer: å­—ç¬¦ä¸²å˜é‡ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ å¤šçº¿ç¨‹ä¸‹æœ‰ä¼˜åŠ¿StringBuilder: å­—ç¬¦ä¸²å˜é‡ï¼ˆéžçº¿ç¨‹å®‰å…¨ï¼‰ å•çº¿ç¨‹ä¸‹æœ‰ä¼˜åŠ¿ Arrayã€ArrayListã€Vectoryã€LinkedListçš„åŒºåˆ«ï¼š(æŽ¨èçœ‹æºç )ArrayListæ˜¯ä¸ºå¯å˜æ•°ç»„å®žçŽ°çš„ï¼Œå½“æ›´å¤šçš„å…ƒç´ æ·»åŠ åˆ°ArrayListçš„æ—¶å€™ï¼Œå®ƒçš„å¤§å°ä¼šåŠ¨æ€å¢žå¤§ã€‚å®ƒçš„å…ƒç´ å¯ä»¥é€šè¿‡get/setæ–¹æ³•ç›´æŽ¥è®¿é—®ï¼Œå› ä¸ºArrayListæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ 1234567891011121314/** * Resizable-array implementation of the &#123;@code List&#125; interface. Implements * all optional list operations, and permits all elements, including * &#123;@code null&#125;. In addition to implementing the &#123;@code List&#125; interface, * this class provides methods to manipulate the size of the array that is * used internally to store the list. (This class is roughly equivalent to * &#123;@code Vector&#125;, except that it is unsynchronized.) * &lt;p&gt;The &#123;@code size&#125;, &#123;@code isEmpty&#125;, &#123;@code get&#125;, &#123;@code set&#125;, * &#123;@code iterator&#125;, and &#123;@code listIterator&#125; operations run in constant * time. The &#123;@code add&#125; operation runs in &lt;i&gt;amortized constant time&lt;/i&gt;, * that is, adding n elements requires O(n) time. All of the other operations * run in linear time (roughly speaking). The constant factor is low compared * to that for the &#123;@code LinkedList&#125; implementation. */ LinkedListæ˜¯ä¸ºåŒå‘é“¾è¡¨å®žçŽ°çš„,éžçº¿ç¨‹å®‰å…¨(not ) 123456789101112131415161718/** * Doubly-linked list implementation of the &#123;@code List&#125; and &#123;@code Deque&#125; * interfaces. Implements all optional list operations, and permits all * elements (including &#123;@code null&#125;). * * &lt;p&gt;All of the operations perform as could be expected for a doubly-linked * list. Operations that index into the list will traverse the list from * the beginning or the end, whichever is closer to the specified index. * * &lt;p&gt;&lt;strong&gt;Note that this implementation is not synchronized.&lt;/strong&gt; * If multiple threads access a linked list concurrently, and at least * one of the threads modifies the list structurally, it &lt;i&gt;must&lt;/i&gt; be * synchronized externally. (A structural modification is any operation * that adds or deletes one or more elements; merely setting the value of * an element is not a structural modification.) This is typically * accomplished by synchronizing on some object that naturally * encapsulates the list. */ Vectorä¸ŽArrayListç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯åŒæ­¥çš„ã€‚ 12345678910111213141516/** * The &#123;@code Vector&#125; class implements a growable array of * objects. Like an array, it contains components that can be * accessed using an integer index. However, the size of a * &#123;@code Vector&#125; can grow or shrink as needed to accommodate * adding and removing items after the &#123;@code Vector&#125; has been created. * * &lt;p&gt;Each vector tries to optimize storage management by maintaining a * &#123;@code capacity&#125; and a &#123;@code capacityIncrement&#125;. The * &#123;@code capacity&#125; is always at least as large as the vector * size; it is usually larger because as components are added to the * vector, the vector's storage increases in chunks the size of * &#123;@code capacityIncrement&#125;. An application can increase the * capacity of a vector before inserting a large number of * components; this reduces the amount of incremental reallocation. */ å¦‚æžœä½ çš„ç¨‹åºæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒArrayListæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚å½“æ›´å¤šçš„å…ƒç´ è¢«æ·»åŠ çš„æ—¶å€™ï¼ŒVectorå’ŒArrayListéœ€è¦æ›´å¤šçš„ç©ºé—´ã€‚Vectoræ¯æ¬¡æ‰©å®¹ä¼šå¢žåŠ ä¸€å€çš„ç©ºé—´ï¼Œè€ŒArrayListå¢žåŠ 50%ã€‚ æ³¨æ„ï¼šArrayListé»˜è®¤çš„åˆå§‹ç©ºé—´å¤§å°ç›¸å½“çš„å°ï¼Œé€šè¿‡æž„é€ å‡½æ•°åŽ»åˆå§‹åŒ–ä¸€ä¸ªæ›´å¤§çš„ç©ºé—´æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå¯ä»¥é¿å…æ‰©å®¹å¼€é”€ã€‚éƒ¨åˆ†å¼•è‡ªäºŽï¼šhttps://www.cnblogs.com/chenpi/p/5505375.html Mapã€Listã€Setã€Arrayçš„åŒºåˆ«ï¼šhttps://www.cnblogs.com/chuanheliu/p/6363948.html Iterator çš„hasNextæ–¹æ³•å’Œnextæ–¹æ³•:hasNext():å¦‚æžœä»æœ‰å…ƒç´ å¯ä»¥è¿­ä»£ï¼Œåˆ™è¿”å›ž trueã€‚ï¼ˆæ¢å¥è¯è¯´ï¼Œå¦‚æžœ next è¿”å›žäº†å…ƒç´ è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™è¿”å›ž trueï¼‰ã€‚next():è¿”å›žè¿­ä»£çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ 12345678910111213141516/** * Returns &#123;@code true&#125; if the iteration has more elements. * (In other words, returns &#123;@code true&#125; if &#123;@link #next&#125; would * return an element rather than throwing an exception.) * * @return &#123;@code true&#125; if the iteration has more elements */boolean hasNext();/** * Returns the next element in the iteration. * * @return the next element in the iteration * @throws NoSuchElementException if the iteration has no more elements */E next(); JAVAå¤šçº¿ç¨‹å’Œå¹¶å‘åŸºç¡€é¢è¯•é—®ç­”:http://www.cnblogs.com/dolphin0520/p/3932934.html Oracleæ•°æ®åº“ä¸­TRUNCATE ä¸Ž DELETE çš„åŒºåˆ«ï¼š ROLLBACKå¯ä»¥æ’¤é”€DELETEæ“ä½œä½†æ’¤é”€ä¸äº†TRUNCATEæ“ä½œ TRUNCATE TABLEæ¯”DELETEçš„é€Ÿåº¦å¿«ï¼› TRUNCATE TABLEæ˜¯åˆ é™¤è¡¨çš„æ‰€æœ‰è¡Œï¼Œè€ŒDELETEæ˜¯åˆ é™¤è¡¨çš„ä¸€è¡Œæˆ–è€…å¤šè¡Œ TRUNCATE TABLEåœ¨é‡åˆ°ä»»ä½•ä¸€è¡Œè¿åçº¦æŸ(å¤–é”®çº¦æŸ)æ—¶ä»ç„¶åˆ é™¤è¡¨çš„æ‰€æœ‰è¡Œï¼Œä½†è¡¨çš„ç»“æž„åŠå…¶åˆ—ã€çº¦æŸã€ç´¢å¼•ç­‰ä¿æŒä¸å˜ï¼ŒDELETEåˆ™ç›´æŽ¥è¿”å›žæŠ¥é”™ã€‚ å¯¹äºŽè¢«å¤–é”®çº¦æŸçš„è¡¨ï¼Œä¸èƒ½ä½¿ç”¨TRUNCATE TABLEï¼Œè€Œåº”è¯¥ä½¿ç”¨ä¸å¸¦WHEREè¯­å¥çš„DELETEè¯­å¥ã€‚ å¦‚æžœæƒ³ä¿ç•™æ ‡è¯†è®¡æ•°å€¼ï¼Œè¦ç”¨DELETEï¼Œå› ä¸ºTRUNCATE TABLEä¼šå¯¹æ–°è¡Œæ ‡å¿—ç¬¦åˆ—æœç”¨çš„è®¡æ•°å€¼é‡ç½®ä¸ºè¯¥åˆ—çš„ç§å­ã€‚ åºåˆ—åŒ–çš„ä½œç”¨ï¼šä¸ºäº†ä¿å­˜åœ¨å†…å­˜ä¸­çš„å„ç§å¯¹è±¡çš„çŠ¶æ€ï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æŠŠä¿å­˜çš„å¯¹è±¡çŠ¶æ€å†è¯»å‡ºæ¥ï¼ˆååºåˆ—åŒ–ï¼‰ã€‚ JAVA ä¸­çš„ superå’Œthis thisçš„ç”¨æ³• æŒ‡å‘å½“å‰å¯¹è±¡æœ¬èº«ã€‚ å½¢å‚ä¸Žæˆå‘˜åå­—é‡åï¼Œç”¨thisæ¥åŒºåˆ†123456789101112public class User &#123; private String name; public String getName() &#123; return name; &#125; public void setName(String name) &#123; // å½¢å‚ä¸Žæˆå‘˜åå­—é‡åï¼Œç”¨thisæ¥åŒºåˆ† this.name = name; &#125;&#125; superç”¨æ³• æŒ‡å‘å½“å‰å¯¹è±¡çš„çˆ¶ç±» å­ç±»ä¸­çš„æˆå‘˜å˜é‡æˆ–æ–¹æ³•ä¸Žçˆ¶ç±»åŒå12345678910111213141516171819public class TestTest extends Country &#123; String name; void value() &#123; name = "Shanghai"; super.value(); System.out.println(super.name); &#125; public static void main(String[] args) &#123; TestTest tt = new TestTest(); tt.value(); &#125;&#125;class Country &#123; String name; void value() &#123; name = "China"; &#125;&#125;]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Npmæ¨¡å—å­¦ä¹ ]]></title>
    <url>%2F2017%2F07%2F27%2FNpm%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"></content>
      <tags>
        <tag>Npm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[éšç¬”]]></title>
    <url>%2F2017%2F07%2F27%2F%E9%9A%8F%E7%AC%94%2F</url>
    <content type="text"><![CDATA[ä»Šå¹´7æœˆä¸­æ—¬ï¼Œæˆ‘æ¥åˆ°äº†æˆéƒ½ï¼Œè§è¯†åˆ°äº†æˆéƒ½çš„ç¾Žã€‚ æˆéƒ½ è®©æˆ‘æŽ‰ä¸‹çœ¼æ³ªçš„ ä¸æ­¢æ˜¨å¤œçš„é…’ è®©æˆ‘ä¾ä¾ä¸èˆçš„ ä¸æ­¢ä½ çš„æ¸©æŸ” ä½™è·¯è¿˜è¦èµ°å¤šä¹… ä½ æ”¥ç€æˆ‘çš„æ‰‹ è®©æˆ‘æ„Ÿåˆ°ä¸ºéš¾çš„ æ˜¯æŒ£æ‰Žçš„è‡ªç”± åˆ†åˆ«æ€»æ˜¯åœ¨ä¹æœˆ å›žå¿†æ˜¯æ€å¿µçš„æ„ æ·±ç§‹å«©ç»¿çš„åž‚æŸ³ äº²å»ç€æˆ‘é¢å¤´ åœ¨é‚£åº§é˜´é›¨çš„å°åŸŽé‡Œ æˆ‘ä»Žæœªå¿˜è®°ä½  æˆéƒ½ å¸¦ä¸èµ°çš„ åªæœ‰ä½  å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ° ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™ ä½ ä¼šæŒ½ç€æˆ‘çš„è¡£è¢– æˆ‘ä¼šæŠŠæ‰‹æ£è¿›è£¤å…œ èµ°åˆ°çŽ‰æž—è·¯çš„å°½å¤´ ååœ¨(èµ°è¿‡)å°é…’é¦†çš„é—¨å£ åˆ†åˆ«æ€»æ˜¯åœ¨ä¹æœˆ å›žå¿†æ˜¯æ€å¿µçš„æ„ æ·±ç§‹å«©ç»¿çš„åž‚æŸ³ äº²å»ç€æˆ‘é¢å¤´ åœ¨é‚£åº§é˜´é›¨çš„å°åŸŽé‡Œ æˆ‘ä»Žæœªå¿˜è®°ä½  æˆéƒ½ å¸¦ä¸èµ°çš„ åªæœ‰ä½  å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ° ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™ ä½ ä¼šæŒ½ç€æˆ‘çš„è¡£è¢– æˆ‘ä¼šæŠŠæ‰‹æ£è¿›è£¤å…œ èµ°åˆ°çŽ‰æž—è·¯çš„å°½å¤´ ååœ¨(èµ°è¿‡)å°é…’é¦†çš„é—¨å£ å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ° ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™ å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ° ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™ ä½ ä¼šæŒ½ç€æˆ‘çš„è¡£è¢– æˆ‘ä¼šæŠŠæ‰‹æ£è¿›è£¤å…œ èµ°åˆ°çŽ‰æž—è·¯çš„å°½å¤´ ååœ¨(èµ°è¿‡)å°é…’é¦†çš„é—¨å£ å’Œæˆ‘åœ¨æˆéƒ½çš„è¡—å¤´èµ°ä¸€èµ° ç›´åˆ°æ‰€æœ‰çš„ç¯éƒ½ç†„ç­äº†ä¹Ÿä¸åœç•™]]></content>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
</search>
